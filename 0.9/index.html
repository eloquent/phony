<!doctype html>
<html lang="en">
<head>

<meta charset="utf-8">

<title>Phony</title>

<link rel="stylesheet" href="../css/markdown.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="../css/phony.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Inconsolata:400,700">

<link rel="shortcut icon" href="//eloquent-software.com/img/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="//eloquent-software.com/img/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="57x57" href="//eloquent-software.com/img/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="72x72" href="//eloquent-software.com/img/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="114x114" href="//eloquent-software.com/img/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="144x144" href="//eloquent-software.com/img/apple-touch-icon-144x144.png">

</head>
<body class="markdown-body" data-version="0.9">

<div id="container">

<div id="toc">
    <h2>
        <span>Phony</span>

        <a href="#toc" title="Show expanded contents" id="toc-show"><i class="fa fa-plus-circle"></i></a>
        <a href="#" title="Hide expanded contents" id="toc-hide" style="display: none;">
            <i class="fa fa-minus-circle"></i>
        </a>
        <a href="#" title="Return to top"><i class="fa fa-chevron-circle-up"></i></a>
        <a href="https://github.com/eloquent/phony" title="View on GitHub"><i class="fa fa-github"></i></a>
    </h2>
    <div id="toc-relative">
        <div id="toc-scroll"></div>
        <div id="toc-fade-top"></div>
        <div id="toc-fade-bottom"></div>
    </div>
</div>

<ul id="versions"></ul>

<div id="content">

<!-- START content -->

<h1>
<a id="phony" class="anchor" href="#phony" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Phony</h1>

<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#help">Help</a></li>
<li>
<a href="#usage">Usage</a>

<ul>
<li><a href="#example-test-suites">Example test suites</a></li>
<li><a href="#standalone-usage">Standalone usage</a></li>
<li><a href="#peridot-usage">Peridot usage</a></li>
<li><a href="#pho-usage">Pho usage</a></li>
<li><a href="#phpunit-usage">PHPUnit usage</a></li>
<li><a href="#simpletest-usage">SimpleTest usage</a></li>
<li><a href="#integration-with-test-frameworks">Integration with test frameworks</a></li>
<li>
<a href="#importing">Importing</a>

<ul>
<li><a href="#importing-with-use-function">Importing with use function</a></li>
<li><a href="#importing-without-use-function">Importing without use function</a></li>
<li><a href="#importing-a-static-facade">Importing a static facade</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#mocks">Mocks</a>

<ul>
<li><a href="#the-mock-api">The mock API</a></li>
<li><a href="#the-mock-builder-api">The mock builder API</a></li>
<li><a href="#mocking-basics">Mocking basics</a></li>
<li><a href="#partial-mocks">Partial mocks</a></li>
<li><a href="#proxy-mocks">Proxy mocks</a></li>
<li><a href="#mocking-multiple-types">Mocking multiple types</a></li>
<li>
<a href="#ad-hoc-mocks">Ad hoc mocks</a>

<ul>
<li><a href="#ad-hoc-definition-values">Ad hoc definition values</a></li>
<li><a href="#ad-hoc-definition-magic-self-values">Ad hoc definition magic "self" values</a></li>
</ul>
</li>
<li><a href="#static-mocks">Static mocks</a></li>
<li><a href="#calling-a-constructor-manually">Calling a constructor manually</a></li>
<li><a href="#labeling-mocks">Labeling mocks</a></li>
<li>
<a href="#mock-handles">Mock handles</a>

<ul>
<li><a href="#stubbing-handles">Stubbing handles</a></li>
<li><a href="#verification-handles">Verification handles</a></li>
<li><a href="#mock-handle-substitution">Mock handle substitution</a></li>
</ul>
</li>
<li>
<a href="#mock-builders">Mock builders</a>

<ul>
<li><a href="#customizing-the-mock-class">Customizing the mock class</a></li>
<li><a href="#creating-mocks-from-a-builder">Creating mocks from a builder</a></li>
<li><a href="#generating-mock-classes-from-a-builder">Generating mock classes from a builder</a></li>
<li><a href="#copying-mock-builders">Copying mock builders</a></li>
</ul>
</li>
<li><a href="#pausing-mock-recording">Pausing mock recording</a></li>
<li><a href="#terminology">Terminology</a></li>
</ul>
</li>
<li>
<a href="#stubs">Stubs</a>

<ul>
<li><a href="#the-stub-api">The stub API</a></li>
<li><a href="#the-generator-answer-api">The generator answer API</a></li>
<li><a href="#stubbing-an-existing-callable">Stubbing an existing callable</a></li>
<li><a href="#anonymous-stubs">Anonymous stubs</a></li>
<li>
<a href="#stub-self-values">Stub "self" values</a>

<ul>
<li><a href="#magic-self-values">Magic "self" values</a></li>
</ul>
</li>
<li>
<a href="#stub-rules-and-answers">Stub rules and answers</a>

<ul>
<li><a href="#multiple-rules">Multiple rules</a></li>
<li><a href="#multiple-answers">Multiple answers</a></li>
<li><a href="#overriding-rules">Overriding rules</a></li>
<li>
<a href="#the-default-rule-and-answer">The default rule and answer</a>

<ul>
<li><a href="#the-default-answer-callback">The default answer callback</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#matching-stub-arguments">Matching stub arguments</a></li>
<li>
<a href="#returning-values">Returning values</a>

<ul>
<li><a href="#default-values-for-return-types">Default values for return types</a></li>
</ul>
</li>
<li><a href="#returning-arguments">Returning arguments</a></li>
<li><a href="#returning-the-self-value">Returning the "self" value</a></li>
<li><a href="#throwing-exceptions">Throwing exceptions</a></li>
<li><a href="#using-a-callable-as-an-answer">Using a callable as an answer</a></li>
<li><a href="#forwarding-to-the-original-callable">Forwarding to the original callable</a></li>
<li>
<a href="#answers-that-perform-multiple-actions">Answers that perform multiple actions</a>

<ul>
<li><a href="#setting-passed-by-reference-arguments">Setting passed-by-reference arguments</a></li>
<li><a href="#invoking-arguments">Invoking arguments</a></li>
<li><a href="#invoking-callables">Invoking callables</a></li>
</ul>
</li>
<li>
<a href="#stubbing-generators">Stubbing generators</a>

<ul>
<li>
<a href="#yielding-from-a-generator">Yielding from a generator</a>

<ul>
<li><a href="#yielding-individual-values-from-a-generator">Yielding individual values from a generator</a></li>
<li><a href="#yielding-multiple-values-from-a-generator">Yielding multiple values from a generator</a></li>
</ul>
</li>
<li><a href="#returning-values-from-a-generator">Returning values from a generator</a></li>
<li><a href="#returning-arguments-from-a-generator">Returning arguments from a generator</a></li>
<li><a href="#returning-the-self-value-from-a-generator">Returning the "self" value from a generator</a></li>
<li><a href="#throwing-exceptions-from-a-generator">Throwing exceptions from a generator</a></li>
<li>
<a href="#generator-iterations-that-perform-multiple-actions">Generator iterations that perform multiple actions</a>

<ul>
<li><a href="#setting-passed-by-reference-arguments-in-a-generator">Setting passed-by-reference arguments in a generator</a></li>
<li><a href="#invoking-arguments-in-a-generator">Invoking arguments in a generator</a></li>
<li><a href="#invoking-callables-in-a-generator">Invoking callables in a generator</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#spies">Spies</a>

<ul>
<li><a href="#the-spy-api">The spy API</a></li>
<li><a href="#spying-on-an-existing-callable">Spying on an existing callable</a></li>
<li><a href="#anonymous-spies">Anonymous spies</a></li>
<li>
<a href="#call-verification">Call verification</a>

<ul>
<li><a href="#call-count">Call count</a></li>
<li><a href="#individual-calls">Individual calls</a></li>
</ul>
</li>
<li>
<a href="#verifying-spy-input">Verifying spy input</a>

<ul>
<li><a href="#verifying-that-a-call-was-made">Verifying that a call was made</a></li>
<li><a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a></li>
<li><a href="#verifying-spy-closure-binding">Verifying spy closure binding</a></li>
</ul>
</li>
<li>
<a href="#verifying-spy-output">Verifying spy output</a>

<ul>
<li><a href="#verifying-spy-return-values">Verifying spy return values</a></li>
<li><a href="#verifying-spy-exceptions">Verifying spy exceptions</a></li>
</ul>
</li>
<li>
<a href="#verifying-spies-with-generators-or-traversables">Verifying spies with generators or traversables</a>

<ul>
<li><a href="#verifying-values-produced-by-spies">Verifying values produced by spies</a></li>
<li><a href="#verifying-values-received-by-spies">Verifying values received by spies</a></li>
<li><a href="#verifying-exceptions-received-by-spies">Verifying exceptions received by spies</a></li>
</ul>
</li>
<li>
<a href="#verifying-cardinality-with-spies">Verifying cardinality with spies</a>

<ul>
<li><a href="#verifying-that-a-spy-event-happened-an-exact-number-of-times">Verifying that a spy event happened an exact number of times</a></li>
<li><a href="#verifying-that-a-spy-event-happened-a-bounded-number-of-times">Verifying that a spy event happened a bounded number of times</a></li>
<li><a href="#verifying-that-all-spy-events-happen-the-same-way">Verifying that all spy events happen the same way</a></li>
</ul>
</li>
<li><a href="#labeling-spies">Labeling spies</a></li>
<li><a href="#invoking-spies">Invoking spies</a></li>
<li><a href="#pausing-spy-recording">Pausing spy recording</a></li>
</ul>
</li>
<li>
<a href="#calls">Calls</a>

<ul>
<li><a href="#the-call-api">The call API</a></li>
<li><a href="#the-arguments-api">The arguments API</a></li>
<li><a href="#retrieving-calls-from-a-spy">Retrieving calls from a spy</a></li>
<li>
<a href="#verifying-call-input">Verifying call input</a>

<ul>
<li><a href="#verifying-that-a-call-was-made-with-specific-arguments">Verifying that a call was made with specific arguments</a></li>
<li><a href="#verifying-call-closure-binding">Verifying call closure binding</a></li>
</ul>
</li>
<li>
<a href="#verifying-call-output">Verifying call output</a>

<ul>
<li><a href="#verifying-call-return-values">Verifying call return values</a></li>
<li><a href="#verifying-call-exceptions">Verifying call exceptions</a></li>
</ul>
</li>
<li>
<a href="#verifying-calls-with-generators-or-traversables">Verifying calls with generators or traversables</a>

<ul>
<li><a href="#verifying-values-produced-by-calls">Verifying values produced by calls</a></li>
<li><a href="#verifying-values-received-by-calls">Verifying values received by calls</a></li>
<li><a href="#verifying-exceptions-received-by-calls">Verifying exceptions received by calls</a></li>
</ul>
</li>
<li>
<a href="#verifying-cardinality-with-calls">Verifying cardinality with calls</a>

<ul>
<li><a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a></li>
<li><a href="#verifying-that-a-call-event-happened-a-bounded-number-of-times">Verifying that a call event happened a bounded number of times</a></li>
<li><a href="#verifying-that-all-call-events-happen-the-same-way">Verifying that all call events happen the same way</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#verification">Verification</a>

<ul>
<li><a href="#the-verification-result-api">The verification result API</a></li>
<li><a href="#the-event-api">The event API</a></li>
<li><a href="#the-order-verification-api">The order verification API</a></li>
<li><a href="#standard-verification">Standard verification</a></li>
<li><a href="#check-verification">Check verification</a></li>
<li>
<a href="#order-verification">Order verification</a>

<ul>
<li><a href="#dynamic-order-verification">Dynamic order verification</a></li>
<li>
<a href="#order-verification-caveats">Order verification caveats</a>

<ul>
<li><a href="#intermediate-events-in-order-verification">Intermediate events in order verification</a></li>
<li><a href="#similar-events-in-order-verification">Similar events in order verification</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#verifying-that-there-was-no-interaction-with-a-mock">Verifying that there was no interaction with a mock</a></li>
</ul>
</li>
<li>
<a href="#matchers">Matchers</a>

<ul>
<li><a href="#the-matcher-api">The matcher API</a></li>
<li><a href="#the-wildcard-matcher-api">The wildcard matcher API</a></li>
<li>
<a href="#matcher-integrations">Matcher integrations</a>

<ul>
<li><a href="#counterpart-matchers">Counterpart matchers</a></li>
<li><a href="#hamcrest-matchers">Hamcrest matchers</a></li>
<li><a href="http://docs.mockery.io/en/latest/reference/argument_validation.html">Mockery matchers</a></li>
<li><a href="http://phake.readthedocs.org/en/latest/method-parameter-matchers.html">Phake matchers</a></li>
<li><a href="#phpunit-constraints">PHPUnit constraints</a></li>
<li><a href="#prophecy-argument-tokens">Prophecy argument tokens</a></li>
<li><a href="#simpletest-expectations">SimpleTest expectations</a></li>
</ul>
</li>
<li><a href="#shorthand-matchers">Shorthand matchers</a></li>
<li><a href="#the-any-matcher">The "any" matcher</a></li>
<li>
<a href="#the-equal-to-matcher">The "equal to" matcher</a>

<ul>
<li><a href="#when-to-use-the-equal-to-matcher">When to use the "equal to" matcher</a></li>
<li>
<a href="#special-cases-for-the-equal-to-matcher">Special cases for the "equal to" matcher</a>

<ul>
<li><a href="#comparing-exceptions">Comparing exceptions</a></li>
<li><a href="#comparing-mocks">Comparing mocks</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#the-wildcard-matcher">The "wildcard" matcher</a>

<ul>
<li>
<a href="#third-party-wildcard-matcher-integrations">Third-party wildcard matcher integrations</a>

<ul>
<li><a href="#phake-wildcard-matcher-integration">Phake wildcard matcher integration</a></li>
<li><a href="#prophecy-wildcard-matcher-integration">Prophecy wildcard matcher integration</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#the-exporter">The exporter</a>

<ul>
<li><a href="#the-exporter-api">The exporter API</a></li>
<li>
<a href="#the-export-format">The export format</a>

<ul>
<li><a href="#export-identifiers-and-references">Export identifiers and references</a></li>
<li><a href="#exporting-recursive-values">Exporting recursive values</a></li>
<li>
<a href="#exporter-special-cases">Exporter special cases</a>

<ul>
<li><a href="#exporting-exceptions">Exporting exceptions</a></li>
<li><a href="#exporting-mocks">Exporting mocks</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#export-depth">Export depth</a>

<ul>
<li><a href="#setting-the-export-depth">Setting the export depth</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#thrown-exceptions">Thrown exceptions</a>

<ul>
<li><a href="#assertionexception">AssertionException</a></li>
<li><a href="#undefinedargumentexception">UndefinedArgumentException</a></li>
<li><a href="#undefinedcallexception">UndefinedCallException</a></li>
<li><a href="#undefinedeventexception">UndefinedEventException</a></li>
<li><a href="#undefinedresponseexception">UndefinedResponseException</a></li>
</ul>
</li>
<li><a href="#license">License</a></li>
</ul>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<p>Available as <a href="http://getcomposer.org/">Composer</a> package <a href="https://packagist.org/packages/eloquent/phony">eloquent/phony</a>.</p>

<h2>
<a id="help" class="anchor" href="#help" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Help</h2>

<p>For help with a difficult testing scenario, questions regarding how to use
<em>Phony</em>, or to report issues with <em>Phony</em> itself, please open a <a href="https://github.com/eloquent/phony/issues">GitHub issue</a>
so that others may benefit from the outcome.</p>

<p>Alternatively, <a href="https://github.com/ezzatron">@ezzatron</a> may be contacted directly via <a href="https://twitter.com/ezzatron">Twitter</a>.</p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>

<h3>
<a id="example-test-suites" class="anchor" href="#example-test-suites" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example test suites</h3>

<p>See the <a href="https://github.com/eloquent/phony/tree/HEAD/doc/example">example</a> directory.</p>

<h3>
<a id="standalone-usage" class="anchor" href="#standalone-usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Standalone usage</h3>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-k">function</span> <span class="pl-c1">Eloquent\Phony\mock</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">assert</span>(<span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>) <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>);</span></pre></div>

<h3>
<a id="peridot-usage" class="anchor" href="#peridot-usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="http://peridot-php.github.io/">Peridot</a> usage</h3>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-k">function</span> <span class="pl-c1">Eloquent\Phony\mock</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">describe(<span class="pl-s"><span class="pl-pds">'</span>Phony<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> () {</span>
<span class="pl-s1">    it(<span class="pl-s"><span class="pl-pds">'</span>integrates with Peridot<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> () {</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"></span>
<span class="pl-s1">        expect(<span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>))<span class="pl-k">-&gt;</span><span class="pl-smi">to</span><span class="pl-k">-&gt;</span>equal(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    });</span>
<span class="pl-s1">});</span></pre></div>

<h3>
<a id="pho-usage" class="anchor" href="#pho-usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://github.com/danielstjules/pho">Pho</a> usage</h3>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-k">function</span> <span class="pl-c1">Eloquent\Phony\Pho\mock</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">describe(<span class="pl-s"><span class="pl-pds">'</span>Phony<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> () {</span>
<span class="pl-s1">    it(<span class="pl-s"><span class="pl-pds">'</span>integrates with Pho<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> () {</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"></span>
<span class="pl-s1">        expect(<span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>))<span class="pl-k">-&gt;</span>toBe(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    });</span>
<span class="pl-s1">});</span></pre></div>

<h3>
<a id="phpunit-usage" class="anchor" href="#phpunit-usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://phpunit.de/">PHPUnit</a> usage</h3>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">Eloquent\Phony\Phpunit\Phony</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">PhonyTest</span> <span class="pl-k">extends</span> <span class="pl-e">PHPUnit_Framework_TestCase</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">testIntegration</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>mock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>assertSame(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>, <span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>));</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span></pre></div>

<h3>
<a id="simpletest-usage" class="anchor" href="#simpletest-usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://github.com/simpletest/simpletest">SimpleTest</a> usage</h3>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">Eloquent\Phony\Simpletest\Phony</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">PhonyTest</span> <span class="pl-k">extends</span> <span class="pl-e">UnitTestCase</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">testIntegration</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>mock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>assertSame(<span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>), <span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span></pre></div>

<h3>
<a id="integration-with-test-frameworks" class="anchor" href="#integration-with-test-frameworks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Integration with test frameworks</h3>

<p>In order to provide the easiest integration with test frameworks, <em>Phony</em>
exposes the same API through multiple namespaces. Integration is as simple as
importing the most appropriate namespace for the framework in use:</p>

<ul>
<li>For <a href="https://github.com/danielstjules/pho">Pho</a>, use <code>Eloquent\Phony\Pho</code>.</li>
<li>For <a href="https://phpunit.de/">PHPUnit</a>, use <code>Eloquent\Phony\Phpunit</code>.</li>
<li>For <a href="https://github.com/simpletest/simpletest">SimpleTest</a>, use <code>Eloquent\Phony\Simpletest</code>.</li>
<li>For <a href="http://peridot-php.github.io/">Peridot</a>, other frameworks, or standalone usage, use <code>Eloquent\Phony</code>.</li>
</ul>

<h3>
<a id="importing" class="anchor" href="#importing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Importing</h3>

<p>There are three ways to import <em>Phony</em>'s API. The most appropriate choice will
depend on the test framework in use, and the user's preferred coding style.</p>

<h4>
<a id="importing-with-use-function" class="anchor" href="#importing-with-use-function" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Importing with <a href="http://php.net/language.namespaces.importing">use function</a>
</h4>

<p>If the version of PHP in use supports <a href="http://php.net/language.namespaces.importing">use function</a>, the top-level functions
can be imported from the appropriate namespace and used directly:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-k">function</span> <span class="pl-c1">Eloquent\Phony\mock</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);</span></pre></div>

<h4>
<a id="importing-without-use-function" class="anchor" href="#importing-without-use-function" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Importing without <a href="http://php.net/language.namespaces.importing">use function</a>
</h4>

<p>When <a href="http://php.net/language.namespaces.importing">use function</a> is unavailable, the namespace itself can be imported, and an
alias can be used to make short references to the same functions:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">Eloquent\Phony</span> <span class="pl-k">as</span> <span class="pl-c1">x</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>mock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);</span></pre></div>

<h4>
<a id="importing-a-static-facade" class="anchor" href="#importing-a-static-facade" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Importing a static facade</h4>

<p>A static facade implementation is also provided for those who prefer a more
traditional approach:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">Eloquent\Phony\Phony</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>mock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);</span></pre></div>

<h2>
<a id="mocks" class="anchor" href="#mocks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mocks</h2>

<p><em>Mocks</em> are objects that can be used as a substitute for another object. This
can be useful when a "real" object becomes difficult to use in a test.</p>

<h3>
<a id="the-mock-api" class="anchor" href="#the-mock-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The mock API</h3>

<p><a name="facade.mock"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-mock-api">handle</a></em> <a href="#facade.mock"><strong>mock</strong></a>($types = []) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-api">handle</a></em> x\<a href="#facade.mock"><strong>mock</strong></a>($types = []) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-api">handle</a></em> Phony::<a href="#facade.mock"><strong>mock</strong></a>($types = []) <em>(static)</em></p>
</blockquote>

<p>Create a new <a href="#mocking-basics">full mock</a>, and return a <a href="#stubbing-handles">stubbing handle</a>.</p>

<p><em>Each value in <code>$types</code> can be either a class name, or an <a href="#ad-hoc-mocks">ad hoc mock</a>
definition. If only a single type is being mocked, the class name or definition
can be passed without being wrapped in an array.</em></p>

<p><em>See <a href="#mocking-basics">Mocking basics</a>.</em></p>

<p><a name="facade.partialMock"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-mock-api">handle</a></em> <a href="#facade.partialMock"><strong>partialMock</strong></a>($types = [], $arguments = []) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-api">handle</a></em> x\<a href="#facade.partialMock"><strong>partialMock</strong></a>($types = [], $arguments = []) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-api">handle</a></em> Phony::<a href="#facade.partialMock"><strong>partialMock</strong></a>($types = [], $arguments = []) <em>(static)</em></p>
</blockquote>

<p>Create a new <a href="#partial-mocks">partial mock</a>, and return a <a href="#stubbing-handles">stubbing handle</a>.</p>

<p><em>Each value in <code>$types</code> can be either a class name, or an <a href="#ad-hoc-mocks">ad hoc mock</a>
definition. If only a single type is being mocked, the class name or definition
can be passed without being wrapped in an array.</em></p>

<p><em>Omitting <code>$arguments</code> will cause the original constructor to be called with an
empty argument list. However, if a <code>null</code> value is supplied for <code>$arguments</code>,
the original constructor will not be called at all.</em></p>

<p><em>See <a href="#partial-mocks">Partial mocks</a>, <a href="#calling-a-constructor-manually">Calling a constructor manually</a>.</em></p>

<p><a name="facade.on"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-mock-api">handle</a></em> <a href="#facade.on"><strong>on</strong></a>($mock) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-api">handle</a></em> x\<a href="#facade.on"><strong>on</strong></a>($mock) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-api">handle</a></em> Phony::<a href="#facade.on"><strong>on</strong></a>($mock) <em>(static)</em></p>
</blockquote>

<p>Returns a <a href="#stubbing-handles">stubbing handle</a> for <code>$mock</code>.</p>

<p><a name="facade.verify"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-mock-api">handle</a></em> <a href="#facade.verify"><strong>verify</strong></a>($mock) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-api">handle</a></em> x\<a href="#facade.verify"><strong>verify</strong></a>($mock) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-api">handle</a></em> Phony::<a href="#facade.verify"><strong>verify</strong></a>($mock) <em>(static)</em></p>
</blockquote>

<p>Returns a <a href="#verification-handles">verification handle</a> for <code>$mock</code>.</p>

<p><a name="facade.onStatic"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-mock-api">handle</a></em> <a href="#facade.onStatic"><strong>onStatic</strong></a>($class) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-api">handle</a></em> x\<a href="#facade.onStatic"><strong>onStatic</strong></a>($class) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-api">handle</a></em> Phony::<a href="#facade.onStatic"><strong>onStatic</strong></a>($class) <em>(static)</em></p>
</blockquote>

<p>Returns a static <a href="#stubbing-handles">stubbing handle</a> for <code>$class</code>.</p>

<p><em>See <a href="#static-mocks">Static mocks</a>.</em></p>

<p><a name="facade.verifyStatic"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-mock-api">handle</a></em> <a href="#facade.verifyStatic"><strong>verifyStatic</strong></a>($class) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-api">handle</a></em> x\<a href="#facade.verifyStatic"><strong>verifyStatic</strong></a>($class) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-api">handle</a></em> Phony::<a href="#facade.verifyStatic"><strong>verifyStatic</strong></a>($class) <em>(static)</em></p>
</blockquote>

<p>Returns a static <a href="#verification-handles">verification handle</a> for <code>$class</code>.</p>

<p><em>See <a href="#static-mocks">Static mocks</a>.</em></p>

<p><a name="handle.mock"></a></p>

<hr>

<blockquote>
<p><em>mock</em> $handle-&gt;<a href="#handle.mock"><strong>mock</strong></a>()</p>
</blockquote>

<p>Get the <a href="#mocks">mock</a>.</p>

<p><em>This method is not available on <a href="#static-mocks">static mock handles</a>.</em></p>

<p><em>See <a href="#mocking-basics">Mocking basics</a>, <a href="#mock-handles">Mock handles</a>.</em></p>

<p><a name="handle.__call"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-stub-api">stub</a></em> $handle-&gt;<a href="#handle.__call"><strong>$method</strong></a>(...$arguments) (on a <a href="#stubbing-handles">stubbing handle</a>)<br>
<em>fluent</em> $handle-&gt;<a href="#handle.__call"><strong>$method</strong></a>(...$arguments) (on a <a href="#verification-handles">verification handle</a>)</p>
</blockquote>

<p><strong>When called on a <a href="#stubbing-handles">stubbing handle</a>:</strong></p>

<p>Get a stub, and modify its current criteria to match the supplied arguments.</p>

<p><em>This is equivalent to <code>$handle-&gt;$method-&gt;with(...$arguments)</code>.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#mocking-basics">Mocking basics</a>, <a href="#stubbing-handles">Stubbing handles</a>.</em></p>

<p><strong>When called on a <a href="#verification-handles">verification handle</a>:</strong></p>

<p>Throws an exception unless the specified method was called with the supplied
arguments.</p>

<p><em>This is equivalent to <code>$handle-&gt;$method-&gt;calledWith(...$arguments)</code>, except
that it returns <code>$handle</code>, allowing a fluent interface for multiple
verifications.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verification-handles">Verification handles</a>.</em></p>

<p><a name="handle.stub"></a>
<a name="handle.__get"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-stub-api">stub</a></em> $handle-&gt;<a href="#handle.stub"><strong>stub</strong></a>($method, $isNewRule = true) or
$handle-&gt;<a href="#handle.__get"><strong>$method</strong></a></p>
</blockquote>

<p>Get the <a href="#stubs">stub</a> for <code>$method</code>.</p>

<p><em>If <code>false</code> is passed for <code>$isNewRule</code>, a new rule will not be started.</em></p>

<p><em>See <a href="#mocking-basics">Mocking basics</a>.</em></p>

<p><a name="handle.label"></a></p>

<hr>

<blockquote>
<p><em>string</em> $handle-&gt;<a href="#handle.label"><strong>label</strong></a>()</p>
</blockquote>

<p>Get the <a href="#labeling-mocks">label</a>.</p>

<p><em>This method is not available on <a href="#static-mocks">static mock handles</a>.</em></p>

<p><a name="handle.setLabel"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $handle-&gt;<a href="#handle.setLabel"><strong>setLabel</strong></a>()</p>
</blockquote>

<p>Set the <a href="#labeling-mocks">label</a>.</p>

<p><em>This method is not available on <a href="#static-mocks">static mock handles</a>.</em></p>

<p><a name="handle.construct"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $handle-&gt;<a href="#handle.construct"><strong>construct</strong></a>(...$arguments)</p>
</blockquote>

<p>Call the original constructor.</p>

<p><em>This method does not support reference parameters.</em></p>

<p><em>This method is not available on <a href="#static-mocks">static mock handles</a>.</em></p>

<p><em>See <a href="#calling-a-constructor-manually">Calling a constructor manually</a>.</em></p>

<p><a name="handle.constructWith"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $handle-&gt;<a href="#handle.constructWith"><strong>constructWith</strong></a>($arguments = [])</p>
</blockquote>

<p>Call the original constructor.</p>

<p><em>This method supports reference parameters.</em></p>

<p><em>This method is not available on <a href="#static-mocks">static mock handles</a>.</em></p>

<p><em>See <a href="#calling-a-constructor-manually">Calling a constructor manually</a>.</em></p>

<p><a name="handle.clazz"></a></p>

<hr>

<blockquote>
<p><em><a href="http://php.net/reflectionclass">ReflectionClass</a></em> $handle-&gt;<a href="#handle.clazz"><strong>clazz</strong></a>()</p>
</blockquote>

<p>Get the generated mock class.</p>

<p><a name="handle.className"></a></p>

<hr>

<blockquote>
<p><em>string</em> $handle-&gt;<a href="#handle.className"><strong>className</strong></a>()</p>
</blockquote>

<p>Get the class name of the generated mock class.</p>

<p><a name="handle.full"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $handle-&gt;<a href="#handle.full"><strong>full</strong></a>()</p>
</blockquote>

<p>Turn the mock into a <a href="#mocking-basics">full mock</a>.</p>

<p><a name="handle.partial"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $handle-&gt;<a href="#handle.partial"><strong>partial</strong></a>()</p>
</blockquote>

<p>Turn the mock into a <a href="#partial-mocks">partial mock</a>.</p>

<p><a name="handle.proxy"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $handle-&gt;<a href="#handle.proxy"><strong>proxy</strong></a>()</p>
</blockquote>

<p>Use the supplied object as the implementation for all methods of the mock.</p>

<p><em>This method may help when partial mocking of a particular implementation is not
possible; as in the case of a final class.</em></p>

<p><em>See <a href="#proxy-mocks">Proxy mocks</a>.</em></p>

<p><a name="handle.defaultAnswerCallback"></a></p>

<hr>

<blockquote>
<p><em>callable</em> $handle-&gt;<a href="#handle.defaultAnswerCallback"><strong>defaultAnswerCallback</strong></a>()</p>
</blockquote>

<p>Get the <a href="#the-default-answer-callback">default answer callback</a>.</p>

<p><a name="handle.setDefaultAnswerCallback"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $handle-&gt;<a href="#handle.setDefaultAnswerCallback"><strong>setDefaultAnswerCallback</strong></a>($callback)</p>
</blockquote>

<p>Set the <a href="#the-default-answer-callback">default answer callback</a> for all method stubs of this mock.</p>

<p><em>This method accepts a callback that takes the stub as the first argument.</em></p>

<p><a name="handle.noInteraction"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $handle-&gt;<a href="#handle.noInteraction"><strong>noInteraction</strong></a>()
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless there was no interaction with the mock.</p>

<p><em>See <a href="#verifying-that-there-was-no-interaction-with-a-mock">Verifying that there was no interaction with a mock</a>.</em></p>

<p><a name="handle.checkNoInteraction"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $handle-&gt;<a href="#handle.checkNoInteraction"><strong>checkNoInteraction</strong></a>()</p>
</blockquote>

<p>Checks if there was no interaction with the mock.</p>

<p><em>See <a href="#verifying-that-there-was-no-interaction-with-a-mock">Verifying that there was no interaction with a mock</a>,
<a href="#check-verification">Check verification</a>.</em></p>

<p><a name="handle.stopRecording"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $handle-&gt;<a href="#handle.stopRecording"><strong>stopRecording</strong></a>()</p>
</blockquote>

<p>Stop recording calls.</p>

<p><em>See <a href="#pausing-mock-recording">Pausing mock recording</a>.</em></p>

<p><a name="handle.startRecording"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $handle-&gt;<a href="#handle.startRecording"><strong>startRecording</strong></a>()</p>
</blockquote>

<p>Start recording calls.</p>

<p><em>See <a href="#pausing-mock-recording">Pausing mock recording</a>.</em></p>

<h3>
<a id="the-mock-builder-api" class="anchor" href="#the-mock-builder-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The mock builder API</h3>

<p><a name="facade.mockBuilder"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-mock-builder-api">builder</a></em> <a href="#facade.mockBuilder"><strong>mockBuilder</strong></a>($types = []) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-builder-api">builder</a></em> x\<a href="#facade.mockBuilder"><strong>mockBuilder</strong></a>($types = []) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-builder-api">builder</a></em> Phony::<a href="#facade.mockBuilder"><strong>mockBuilder</strong></a>($types = []) <em>(static)</em></p>
</blockquote>

<p>Create a new <a href="#mock-builders">mock builder</a>.</p>

<p><em>Each value in <code>$types</code> can be either a class name, or an <a href="#ad-hoc-mocks">ad hoc mock</a>
definition. If only a single type is being mocked, the class name or definition
can be passed without being wrapped in an array.</em></p>

<p><a name="builder.__clone"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-mock-builder-api">builder</a></em> <a href="#builder.__clone"><strong>clone</strong></a> $builder</p>
</blockquote>

<p>Copy an existing mock builder.</p>

<p><em>See <a href="#copying-mock-builders">Copying mock builders</a>.</em></p>

<p><a name="builder.types"></a></p>

<hr>

<blockquote>
<p><em>array&lt;string,<a href="http://php.net/reflectionclass">ReflectionClass</a>&gt;</em> $builder-&gt;<a href="#builder.types"><strong>types</strong></a>()</p>
</blockquote>

<p>Get the types that will be mocked.</p>

<p><em>Returns a map of class name to class.</em></p>

<p><a name="builder.like"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $builder-&gt;<a href="#builder.like"><strong>like</strong></a>($type, ...$additionalTypes)</p>
</blockquote>

<p>Add classes, interfaces, or traits.</p>

<p><em>Each type value can be either a class name, or an <a href="#ad-hoc-mocks">ad hoc mock</a> definition.</em></p>

<p><a name="builder.addMethod"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $builder-&gt;<a href="#builder.addMethod"><strong>addMethod</strong></a>($name, $callback = null)</p>
</blockquote>

<p>Add a custom method.</p>

<p><em>See <a href="#customizing-the-mock-class">Customizing the mock class</a>.</em></p>

<p><a name="builder.addProperty"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $builder-&gt;<a href="#builder.addProperty"><strong>addProperty</strong></a>($name, $value = null)</p>
</blockquote>

<p>Add a custom property.</p>

<p><em>See <a href="#customizing-the-mock-class">Customizing the mock class</a>.</em></p>

<p><a name="builder.addStaticMethod"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $builder-&gt;<a href="#builder.addStaticMethod"><strong>addStaticMethod</strong></a>($name, $callback = null)</p>
</blockquote>

<p>Add a custom static method.</p>

<p><em>See <a href="#customizing-the-mock-class">Customizing the mock class</a>.</em></p>

<p><a name="builder.addStaticProperty"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $builder-&gt;<a href="#builder.addStaticProperty"><strong>addStaticProperty</strong></a>($name, $value = null)</p>
</blockquote>

<p>Add a custom static property.</p>

<p><em>See <a href="#customizing-the-mock-class">Customizing the mock class</a>.</em></p>

<p><a name="builder.addConstant"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $builder-&gt;<a href="#builder.addConstant"><strong>addConstant</strong></a>($name, $value = null)</p>
</blockquote>

<p>Add a custom class constant.</p>

<p><em>See <a href="#customizing-the-mock-class">Customizing the mock class</a>.</em></p>

<p><a name="builder.named"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $builder-&gt;<a href="#builder.named"><strong>named</strong></a>($className = null)</p>
</blockquote>

<p>Set the class name.</p>

<p><em>See <a href="#customizing-the-mock-class">Customizing the mock class</a>.</em></p>

<p><a name="builder.isFinalized"></a></p>

<hr>

<blockquote>
<p><em>boolean</em> $builder-&gt;<a href="#builder.isFinalized"><strong>isFinalized</strong></a>()</p>
</blockquote>

<p>Returns <code>true</code> if this builder is finalized.</p>

<p><a name="builder.finalize"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $builder-&gt;<a href="#builder.finalize"><strong>finalize</strong></a>()</p>
</blockquote>

<p>Finalize the mock builder.</p>

<p><a name="builder.isBuilt"></a></p>

<hr>

<blockquote>
<p><em>boolean</em> $builder-&gt;<a href="#builder.isBuilt"><strong>isBuilt</strong></a>()</p>
</blockquote>

<p>Returns <code>true</code> if the mock class has been built.</p>

<p><a name="builder.build"></a></p>

<hr>

<blockquote>
<p><em><a href="http://php.net/reflectionclass">ReflectionClass</a></em> $builder-&gt;<a href="#builder.build"><strong>build</strong></a>($createNew = false)</p>
</blockquote>

<p>Generate and define the mock class.</p>

<p><em>Calling this method will finalize the mock builder.</em></p>

<p><em>See <a href="#generating-mock-classes-from-a-builder">Generating mock classes from a builder</a>.</em></p>

<p><a name="builder.className"></a></p>

<hr>

<blockquote>
<p><em>string</em> $builder-&gt;<a href="#builder.className"><strong>className</strong></a>()</p>
</blockquote>

<p>Generate and define the mock class, and return the class name.</p>

<p><em>Calling this method will finalize the mock builder.</em></p>

<p><em>See <a href="#generating-mock-classes-from-a-builder">Generating mock classes from a builder</a>.</em></p>

<p><a name="builder.get"></a></p>

<hr>

<blockquote>
<p><em>mock</em> $builder-&gt;<a href="#builder.get"><strong>get</strong></a>()</p>
</blockquote>

<p>Get a mock.</p>

<p><em>This method will return the last created mock, only creating a new mock if no
existing mock is available.</em></p>

<p><em>If no existing mock is available, the created mock will be a full mock.</em></p>

<p><em>Calling this method will finalize the mock builder.</em></p>

<p><em>See <a href="#creating-mocks-from-a-builder">Creating mocks from a builder</a>.</em></p>

<p><a name="builder.full"></a></p>

<hr>

<blockquote>
<p><em>mock</em> $builder-&gt;<a href="#builder.full"><strong>full</strong></a>()</p>
</blockquote>

<p>Create a new <a href="#mocking-basics">full mock</a>.</p>

<p><em>This method will always create a new mock.</em></p>

<p><em>Calling this method will finalize the mock builder.</em></p>

<p><em>See <a href="#creating-mocks-from-a-builder">Creating mocks from a builder</a>.</em></p>

<p><a name="builder.partial"></a></p>

<hr>

<blockquote>
<p><em>mock</em> $builder-&gt;<a href="#builder.partial"><strong>partial</strong></a>(...$arguments)</p>
</blockquote>

<p>Create a new <a href="#partial-mocks">partial mock</a>.</p>

<p><em>The constructor will be called with <code>$arguments</code>.</em></p>

<p><em>This method will always create a new mock.</em></p>

<p><em>Calling this method will finalize the mock builder.</em></p>

<p><em>This method does not support reference parameters.</em></p>

<p><em>See <a href="#creating-mocks-from-a-builder">Creating mocks from a builder</a>.</em></p>

<p><a name="builder.partialWith"></a></p>

<hr>

<blockquote>
<p><em>mock</em> $builder-&gt;<a href="#builder.partialWith"><strong>partialWith</strong></a>($arguments = [], $label = null)</p>
</blockquote>

<p>Create a new <a href="#partial-mocks">partial mock</a>.</p>

<p><em>The constructor will be called with <code>$arguments</code>, unless <code>$arguments</code> is
<code>null</code>, in which case the constructor will not be called at all.</em></p>

<p><em>This method will always create a new mock.</em></p>

<p><em>Calling this method will finalize the mock builder.</em></p>

<p><em>This method supports reference parameters.</em></p>

<p><em>See <a href="#creating-mocks-from-a-builder">Creating mocks from a builder</a>.</em></p>

<h3>
<a id="mocking-basics" class="anchor" href="#mocking-basics" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mocking basics</h3>

<p>Any class, interface, or trait can be mocked. To create a mock, use
<a href="#facade.mock"><code>mock()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>mock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>mock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>); <span class="pl-c">// static</span></span></pre></div>

<p>The object returned by <a href="#facade.mock"><code>mock()</code></a> is <strong>not</strong> the mock object
itself, but a <a href="#mock-handles">mock handle</a>. This handle provides a <a href="#stubs">stub</a> for each method of
the type being mocked. Each stub is exposed as a <a href="#handle.__get">property</a> of
the same name as the stubbed method, and implements both <a href="#the-stub-api">the stub API</a>, and
<a href="#the-spy-api">the spy API</a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">// stubbing</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>1337 h4x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodB</span><span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>bad<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>input<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>throws(<span class="pl-s"><span class="pl-pds">'</span>You done goofed.<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// verification</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>swiggity<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>swooty<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodB</span><span class="pl-k">-&gt;</span>called();</span></pre></div>

<p>The mock handle returned by <a href="#facade.mock"><code>mock()</code></a> is a type of handle called
a <a href="#stubbing-handles">stubbing handle</a>, which means it implements magic
<a href="#handle.__call"><code>__call()</code></a> methods that are equivalent to a call to
<a href="#stub.with"><code>with()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">// these two statements are equivalent</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span></pre></div>

<p>To access the actual mock object, call the <a href="#handle.mock"><code>mock()</code></a> method of
the handle:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span></pre></div>

<h3>
<a id="partial-mocks" class="anchor" href="#partial-mocks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Partial mocks</h3>

<p><em>Phony</em> supports "partial mocks", or mocks that do not override methods by
default. To create a partial mock, use <a href="#facade.partialMock"><code>partialMock()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> partialMock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>partialMock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>partialMock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>); <span class="pl-c">// static</span></span></pre></div>

<p>Constructor arguments can be passed to <a href="#facade.partialMock"><code>partialMock()</code></a> as
the second parameter:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> partialMock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>, [<span class="pl-s"><span class="pl-pds">'</span>argumentA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>argumentB<span class="pl-pds">'</span></span>]);</span></pre></div>

<h3>
<a id="proxy-mocks" class="anchor" href="#proxy-mocks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Proxy mocks</h3>

<p>In cases where direct mocking is not possible, such as with <code>final</code> classes and
methods, <em>Phony</em> offers an alternative strategy in the form of "proxy" mocks.
Any mock can proxy methods on to any other object by using
<a href="#handle.proxy"><code>proxy()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">interface</span> <span class="pl-en">Animal</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">speak</span>();</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">final</span> <span class="pl-k">class</span> <span class="pl-en">Cat</span> <span class="pl-k">implements</span> <span class="pl-e">Animal</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">final</span> <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">speak</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>Meow meow meow? Meow.<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">function</span> <span class="pl-en">listen</span>(<span class="pl-c1">Animal</span> <span class="pl-smi">$animal</span>)</span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>It said: <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$animal</span><span class="pl-k">-&gt;</span>speak();</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$cat</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Cat</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>Animal<span class="pl-pds">'</span></span>); <span class="pl-c">// a generic animal mock</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>proxy(<span class="pl-smi">$cat</span>);     <span class="pl-c">// now it behaves exactly like `$cat`</span></span>
<span class="pl-s1"></span>
<span class="pl-s1">listen(<span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock());  <span class="pl-c">// outputs 'It said: Meow meow meow? Meow.'</span></span></pre></div>

<p>The <a href="#handle.proxy"><code>proxy()</code></a> method is also fluent, meaning that mock creation
and proxying can be done in a single expression:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>Animal<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>proxy(<span class="pl-k">new</span> <span class="pl-c1">Cat</span>());</span></pre></div>

<h3>
<a id="mocking-multiple-types" class="anchor" href="#mocking-multiple-types" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mocking multiple types</h3>

<p>Multiple interfaces and/or traits can be mocked simultaneously by passing an
array of types to <a href="#facade.mock"><code>mock()</code></a> or
<a href="#facade.partialMock"><code>partialMock()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock([<span class="pl-s"><span class="pl-pds">'</span>InterfaceA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>InterfaceB<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>TraitA<span class="pl-pds">'</span></span>]);        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>mock([<span class="pl-s"><span class="pl-pds">'</span>InterfaceA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>InterfaceB<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>TraitA<span class="pl-pds">'</span></span>]);      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>mock([<span class="pl-s"><span class="pl-pds">'</span>InterfaceA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>InterfaceB<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>TraitA<span class="pl-pds">'</span></span>]); <span class="pl-c">// static</span></span></pre></div>

<p>A single base class may also be mocked with other types:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock([<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>InterfaceA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>TraitA<span class="pl-pds">'</span></span>]);        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>mock([<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>InterfaceA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>TraitA<span class="pl-pds">'</span></span>]);      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>mock([<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>InterfaceA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>TraitA<span class="pl-pds">'</span></span>]); <span class="pl-c">// static</span></span></pre></div>

<h3>
<a id="ad-hoc-mocks" class="anchor" href="#ad-hoc-mocks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Ad hoc mocks</h3>

<p><em>Phony</em> supports the creation of mock objects with methods and/or properties
that are not pre-defined in some other class, interface, or trait. It does so
using special "definition" values, which can be passed to
<a href="#facade.mock"><code>mock()</code></a> or <a href="#facade.partialMock"><code>partialMock()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> partialMock(</span>
<span class="pl-s1">    [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>__toString<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> () {</span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>What is this sorcery?<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        },</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>__call<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> (<span class="pl-smi">$name</span>, <span class="pl-k">array</span> <span class="pl-smi">$arguments</span>) {</span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-c1">sprintf</span>(<span class="pl-s"><span class="pl-pds">'</span>%s(%s)<span class="pl-pds">'</span></span>, <span class="pl-smi">$name</span>, <span class="pl-c1">implode</span>(<span class="pl-s"><span class="pl-pds">'</span>, <span class="pl-pds">'</span></span>, <span class="pl-smi">$arguments</span>));</span>
<span class="pl-s1">        },</span>
<span class="pl-s1">    ]</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$mock</span>;              <span class="pl-c">// outputs 'What is this sorcery?'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>a(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'a(b, c)'</span></span></pre></div>

<p>Definition values can be mocked at the same time as regular classes, traits, and
interfaces. Multiple definitions can even be mocked at the same time. Simply
specify all types to be mocked in a single array:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> partialMock(</span>
<span class="pl-s1">    [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>Countable<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        [</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>__invoke<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> () {</span>
<span class="pl-s1">                <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>You called me?<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">            }</span>
<span class="pl-s1">        ],</span>
<span class="pl-s1">        [</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>__toString<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> () {</span>
<span class="pl-s1">                <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>Are you stringing me along?<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">            }</span>
<span class="pl-s1">        ],</span>
<span class="pl-s1">    ]</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"><span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span><span class="pl-smi">count</span><span class="pl-k">-&gt;</span>returns(<span class="pl-c1">111</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">mock</span>();      <span class="pl-c">// outputs 'You called me?'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$mock</span>;        <span class="pl-c">// outputs 'Are you stringing me along?'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">count</span>(<span class="pl-smi">$mock</span>); <span class="pl-c">// outputs '111'</span></span></pre></div>

<h4>
<a id="ad-hoc-definition-values" class="anchor" href="#ad-hoc-definition-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Ad hoc definition values</h4>

<p>Ad hoc definition values support methods, properties, and constants. By default,
callback functions will be converted to methods, and everything else will become
a property:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> partialMock(</span>
<span class="pl-s1">    [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> () {</span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>A is for apple.<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        },</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>B is for banana.<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">    ]</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>a(); <span class="pl-c">// outputs 'A is for apple.'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span><span class="pl-smi">b</span>;   <span class="pl-c">// outputs 'B is for banana.'</span></span></pre></div>

<p>To override the default treatment of values, or to define static methods or
properties, keywords can be added to the keys of the definition value:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> partialMock(</span>
<span class="pl-s1">    [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>const A<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>A is for apple.<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>static b<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> () {</span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>B is for banana.<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        },</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>static c<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>C is for cat.<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>var d<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> () {</span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>D is for dog.<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        },</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>static var e<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> () {</span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>E is for egg.<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        },</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>function f<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>implode<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">    ]</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"><span class="pl-smi">$class</span> <span class="pl-k">=</span> <span class="pl-c1">get_class</span>(<span class="pl-smi">$mock</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$class</span><span class="pl-k">::</span><span class="pl-c1">A</span>;   <span class="pl-c">// outputs 'A is for apple.'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$class</span><span class="pl-k">::</span>b(); <span class="pl-c">// outputs 'B is for banana.'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$class</span><span class="pl-k">::</span><span class="pl-c1">c</span>;   <span class="pl-c">// outputs 'C is for cat.'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">var_dump</span>(<span class="pl-c1">isset</span>(<span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span><span class="pl-smi">d</span>));  <span class="pl-c">// outputs 'bool(true)'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">var_dump</span>(<span class="pl-c1">isset</span>(<span class="pl-smi">$class</span><span class="pl-k">::</span><span class="pl-c1">e</span>)); <span class="pl-c">// outputs 'bool(true)'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>f(<span class="pl-s"><span class="pl-pds">'</span>, <span class="pl-pds">'</span></span>, [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>]); <span class="pl-c">// outputs 'a, b'</span></span></pre></div>

<h4>
<a id="ad-hoc-definition-magic-self-values" class="anchor" href="#ad-hoc-definition-magic-self-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Ad hoc definition magic "self" values</h4>

<p>Methods defined in an <a href="#ad-hoc-mocks">ad hoc mock</a> definition can take advantage of
<a href="#magic-self-values">magic "self" values</a>. When stubs are retrieved from a mock, their <a href="#stub-self-values">self value</a>
is automatically set to the mock itself.</p>

<p>Any custom method with a first parameter named <code>$phonySelf</code>, regardless of the
parameter's type, will receive the self value as the first argument. This self
value can be used in place of <code>$this</code> to access instance state, and/or implement
fluent interfaces:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> partialMock(</span>
<span class="pl-s1">    [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>set<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> (<span class="pl-smi">$phonySelf</span>, <span class="pl-smi">$key</span>, <span class="pl-smi">$value</span>) {</span>
<span class="pl-s1">            <span class="pl-smi">$phonySelf</span><span class="pl-k">-&gt;</span><span class="pl-smi">values</span>[<span class="pl-smi">$key</span>] <span class="pl-k">=</span> <span class="pl-smi">$value</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-smi">$phonySelf</span>;</span>
<span class="pl-s1">        },</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>get<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> (<span class="pl-smi">$phonySelf</span>, <span class="pl-smi">$key</span>) {</span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-smi">$phonySelf</span><span class="pl-k">-&gt;</span><span class="pl-smi">values</span>[<span class="pl-smi">$key</span>] ?? <span class="pl-c1">null</span>;</span>
<span class="pl-s1">        },</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>values<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [],</span>
<span class="pl-s1">    ]</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>set(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-c1">1</span>)<span class="pl-k">-&gt;</span>get(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs '1'</span></span></pre></div>

<h3>
<a id="static-mocks" class="anchor" href="#static-mocks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Static mocks</h3>

<p><em>Phony</em> can be used to stub the behavior of static methods of generated mock
classes. To modify the behavior of a static method, use
<a href="#facade.onStatic"><code>onStatic()</code></a> to obtain a static stubbing handle from either
an existing handle, or a mock instance:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>DateTime<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$static</span> <span class="pl-k">=</span> onStatic(<span class="pl-smi">$handle</span>);        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$static</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>onStatic(<span class="pl-smi">$handle</span>);      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$static</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>onStatic(<span class="pl-smi">$handle</span>); <span class="pl-c">// static</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$static</span> <span class="pl-k">=</span> onStatic(<span class="pl-smi">$mock</span>);        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$static</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>onStatic(<span class="pl-smi">$mock</span>);      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$static</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>onStatic(<span class="pl-smi">$mock</span>); <span class="pl-c">// static</span></span></pre></div>

<p>This static handle is just like a normal <a href="#stubbing-handles">stubbing handle</a>, except that it
refers to static methods instead of instance methods:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$static</span><span class="pl-k">-&gt;</span><span class="pl-smi">createFromFormat</span><span class="pl-k">-&gt;</span>returns(<span class="pl-k">new</span> <span class="pl-c1">DateTime</span>(<span class="pl-s"><span class="pl-pds">'</span>2001-02-03T04:05:06Z<span class="pl-pds">'</span></span>));</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$class</span> <span class="pl-k">=</span> <span class="pl-smi">$static</span><span class="pl-k">-&gt;</span>className(); <span class="pl-c">// obtain the generated class name</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$date</span> <span class="pl-k">=</span> <span class="pl-smi">$class</span><span class="pl-k">::</span>createFromFormat(<span class="pl-s"><span class="pl-pds">'</span>format<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>time<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$date</span><span class="pl-k">-&gt;</span>format(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs '2001-02-03T04:05:06+00:00'</span></span></pre></div>

<p>The static handle can also be used to verify interactions with static methods:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$static</span><span class="pl-k">-&gt;</span><span class="pl-smi">createFromFormat</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>format<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>time<span class="pl-pds">'</span></span>);</span></pre></div>

<p>There is also a static variant of the normal <a href="#verification-handles">verification handle</a>, which can
be created from either an existing handle, or a mock instance, using
<a href="#facade.verifyStatic"><code>verifyStatic()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>DateTime<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$static</span> <span class="pl-k">=</span> verifyStatic(<span class="pl-smi">$handle</span>);        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$static</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>verifyStatic(<span class="pl-smi">$handle</span>);      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$static</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>verifyStatic(<span class="pl-smi">$handle</span>); <span class="pl-c">// static</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$static</span> <span class="pl-k">=</span> verifyStatic(<span class="pl-smi">$mock</span>);        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$static</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>verifyStatic(<span class="pl-smi">$mock</span>);      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$static</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>verifyStatic(<span class="pl-smi">$mock</span>); <span class="pl-c">// static</span></span></pre></div>

<h3>
<a id="calling-a-constructor-manually" class="anchor" href="#calling-a-constructor-manually" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Calling a constructor manually</h3>

<p>In order to stub methods called in the constructor of a partial mock, it is
necessary to defer construction of the mock object. To accomplish this, pass
<code>null</code> as the second argument to <a href="#facade.partialMock"><code>partialMock()</code></a>, which
will cause <em>Phony</em> to bypass the constructor:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> partialMock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>, <span class="pl-c1">null</span>);</span></pre></div>

<p>Note that omitting the second argument will <strong>not</strong> have the same effect as
explicitly passing <code>null</code>.</p>

<p>Behavior can then be defined before the constructor is called:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>returns(<span class="pl-c1">true</span>);</span></pre></div>

<p>Finally, the constructor can be manually called using
<a href="#handle.construct"><code>construct()</code></a>, or
<a href="#handle.constructWith"><code>constructWith()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>construct(<span class="pl-s"><span class="pl-pds">'</span>argumentA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>argumentB<span class="pl-pds">'</span></span>);       <span class="pl-c">// variable arguments</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>constructWith([<span class="pl-s"><span class="pl-pds">'</span>argumentA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>argumentB<span class="pl-pds">'</span></span>]); <span class="pl-c">// array arguments</span></span></pre></div>

<p>The <a href="#handle.constructWith"><code>constructWith()</code></a> additionally supports arguments
passed by reference:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>constructWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>]);</span></pre></div>

<h3>
<a id="labeling-mocks" class="anchor" href="#labeling-mocks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Labeling mocks</h3>

<p>Every mock has a label, which is a free-form string used to help identify the
mock in verification failure messages. By default, each mock is assigned a
unique sequential integer label upon creation.</p>

<p>The label can be changed at any time by using <a href="#handle.setLabel"><code>setLabel()</code></a>
on any mock handle associated with the mock:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>label(); <span class="pl-c">// outputs 'a'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> on(<span class="pl-smi">$mock</span>)<span class="pl-k">-&gt;</span>label(); <span class="pl-c">// outputs 'a'</span></span></pre></div>

<p>The <a href="#handle.setLabel"><code>setLabel()</code></a> method is also fluent, meaning that mock
creation and label setting can be done in a single expression:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>mock();</span></pre></div>

<p>When a verification fails for a labeled mock, the output is similar to the
following:</p>

<pre><code>Expected call on ClassA[label]-&gt;methodA with arguments like:
    "x", "y"
Calls:
    - "x", "z"
</code></pre>

<h3>
<a id="mock-handles" class="anchor" href="#mock-handles" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mock handles</h3>

<p>Mock handles come in two varieties. <a href="#stubbing-handles">Stubbing handles</a> are the default type
returned when using <a href="#facade.mock"><code>mock()</code></a>, but there are also
<a href="#verification-handles">verification handles</a> that are designed to make multiple verifications easier.</p>

<p>Despite their names, both types of handles provide stubs that implement both
<a href="#the-stub-api">the stub API</a> for stubbing, and <a href="#the-spy-api">the spy API</a> for verification. The difference
is <em>only</em> in the handle's implementation of the magic
<a href="#handle.__call"><code>__call()</code></a> methods. These magic methods are tailored for
convenience when stubbing or verifying, depending on which type of handle is in
use.</p>

<h4>
<a id="stubbing-handles" class="anchor" href="#stubbing-handles" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Stubbing handles</h4>

<p>Stubbing handles are the default handle type. They are returned when
<a href="#facade.mock"><code>mock()</code></a> or <a href="#facade.partialMock"><code>partialMock()</code></a> is called:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubbingHandle</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$stubbingHandle</span> <span class="pl-k">=</span> partialMock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);</span></pre></div>

<p>They can also be retrieved at any time from a mock instance, or another handle,
by using <a href="#facade.on"><code>on()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubbingHandle</span> <span class="pl-k">=</span> on(<span class="pl-smi">$mock</span>);        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$stubbingHandle</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>on(<span class="pl-smi">$mock</span>);      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$stubbingHandle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>on(<span class="pl-smi">$mock</span>); <span class="pl-c">// static</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubbingHandle</span> <span class="pl-k">=</span> on(<span class="pl-smi">$otherHandle</span>);        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$stubbingHandle</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>on(<span class="pl-smi">$otherHandle</span>);      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$stubbingHandle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>on(<span class="pl-smi">$otherHandle</span>); <span class="pl-c">// static</span></span></pre></div>

<p>To access the actual mock object, call the <a href="#handle.mock"><code>mock()</code></a> method of
the handle:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$stubbingHandle</span><span class="pl-k">-&gt;</span>mock();</span></pre></div>

<p>Stubbing handles implement magic <a href="#handle.__call"><code>__call()</code></a> methods that are
equivalent to a call to <a href="#stub.with"><code>with()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">// these two statements are equivalent</span></span>
<span class="pl-s1"><span class="pl-smi">$stubbingHandle</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$stubbingHandle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span></pre></div>

<p>This provides the most convenience when setting up mock behaviors.</p>

<p>Note that a static variant of the stubbing handle exists. See <a href="#static-mocks">Static mocks</a>.</p>

<h4>
<a id="verification-handles" class="anchor" href="#verification-handles" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verification handles</h4>

<p>Verification handles are a type of handle that provides the ability to make
verifications using a fluent interface.</p>

<p>A verification handle can also be created at any time from a mock instance, or
another handle, by using <a href="#facade.verify"><code>verify()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$verificationHandle</span> <span class="pl-k">=</span> verify(<span class="pl-smi">$mock</span>);        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$verificationHandle</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>verify(<span class="pl-smi">$mock</span>);      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$verificationHandle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>verify(<span class="pl-smi">$mock</span>); <span class="pl-c">// static</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$verificationHandle</span> <span class="pl-k">=</span> verify(<span class="pl-smi">$otherHandle</span>);        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$verificationHandle</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>verify(<span class="pl-smi">$otherHandle</span>);      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$verificationHandle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>verify(<span class="pl-smi">$otherHandle</span>); <span class="pl-c">// static</span></span></pre></div>

<p>To access the actual mock object, call the <a href="#handle.mock"><code>mock()</code></a> method of
the handle:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$verificationHandle</span><span class="pl-k">-&gt;</span>mock();</span></pre></div>

<p>Verification handles implement magic <a href="#handle.__call"><code>__call()</code></a> methods that
are equivalent to a call to <a href="#stub.calledWith"><code>calledWith()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">// these two statements are equivalent</span></span>
<span class="pl-s1"><span class="pl-smi">$verificationHandle</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$verificationHandle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span></pre></div>

<p>These magic methods can be used in a fluent manner to perform multiple
verifications easily:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$verificationHandle</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>methodB(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>methodC(<span class="pl-s"><span class="pl-pds">'</span>e<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>f<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// the above is equivalent to these statements:</span></span>
<span class="pl-s1"><span class="pl-smi">$verificationHandle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$verificationHandle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodB</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$verificationHandle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodC</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>e<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>f<span class="pl-pds">'</span></span>);</span></pre></div>

<p>Note that this does not verify the order of events. If order is important, use
<a href="#order-verification">order verification</a>.</p>

<p>Note that a static variant of the verification handle exists. See
<a href="#static-mocks">Static mocks</a>.</p>

<h4>
<a id="mock-handle-substitution" class="anchor" href="#mock-handle-substitution" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mock handle substitution</h4>

<p><em>Phony</em> will sometimes accept a mock handle as equivalent to the mock it
represents. This simplifies some common mocking scenarios, and improves test
readability.</p>

<p>One such scenario is returning a <a href="#mocks">mock</a> from another <a href="#stubs">stub</a> (this includes
stubbed mock methods). Returning a handle from a stub is equivalent to returning
the mock itself:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$database</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>Database<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$result</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>Result<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// these two statements are equivalent</span></span>
<span class="pl-s1"><span class="pl-smi">$database</span><span class="pl-k">-&gt;</span><span class="pl-smi">select</span><span class="pl-k">-&gt;</span>returns(<span class="pl-smi">$result</span>);</span>
<span class="pl-s1"><span class="pl-smi">$database</span><span class="pl-k">-&gt;</span><span class="pl-smi">select</span><span class="pl-k">-&gt;</span>returns(<span class="pl-smi">$result</span><span class="pl-k">-&gt;</span>mock());</span></pre></div>

<p>Another common situation is the use of a mock handle when
<a href="#matching-stub-arguments">matching stub arguments</a>. Use of a mock handle in a argument list is equivalent
to use of the mock itself:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$database</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>Database<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$query</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>Query<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$result</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>Result<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// these two statements are equivalent</span></span>
<span class="pl-s1"><span class="pl-smi">$database</span><span class="pl-k">-&gt;</span>select(<span class="pl-smi">$query</span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-smi">$result</span>);</span>
<span class="pl-s1"><span class="pl-smi">$database</span><span class="pl-k">-&gt;</span>select(<span class="pl-smi">$query</span><span class="pl-k">-&gt;</span>mock())<span class="pl-k">-&gt;</span>returns(<span class="pl-smi">$result</span>);</span></pre></div>

<p>The same is true when <a href="#verifying-that-a-spy-was-called-with-specific-arguments">verifying that a spy was called with specific arguments</a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$database</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>Database<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$query</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>Query<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// these two statements are equivalent</span></span>
<span class="pl-s1"><span class="pl-smi">$database</span><span class="pl-k">-&gt;</span><span class="pl-smi">select</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-smi">$query</span>);</span>
<span class="pl-s1"><span class="pl-smi">$database</span><span class="pl-k">-&gt;</span><span class="pl-smi">select</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-smi">$query</span><span class="pl-k">-&gt;</span>mock());</span></pre></div>

<p>There are other edge-case situations where <em>Phony</em> will exhibit this behaviour.
Refer to the API documentation for more detailed information.</p>

<h3>
<a id="mock-builders" class="anchor" href="#mock-builders" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mock builders</h3>

<p>Mock builders provide an alternative method for defining and creating mocks,
when more fine-grained control is desired. To create a mock builder, use
<a href="#facade.mockBuilder"><code>mockBuilder()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$builder</span> <span class="pl-k">=</span> mockBuilder();        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$builder</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>mockBuilder();      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$builder</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>mockBuilder(); <span class="pl-c">// static</span></span></pre></div>

<p>Types to mock can be passed directly to <a href="#facade.mockBuilder"><code>mockBuilder()</code></a>
in a similar fashion to <a href="#facade.mock"><code>mock()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$builder</span> <span class="pl-k">=</span> mockBuilder([<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>InterfaceA<span class="pl-pds">'</span></span>]);</span></pre></div>

<h4>
<a id="customizing-the-mock-class" class="anchor" href="#customizing-the-mock-class" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Customizing the mock class</h4>

<p>Mock builders implement a fluent interface, with many methods for customizing
the generated mock class:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$builder</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>like(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>InterfaceA<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>named(<span class="pl-s"><span class="pl-pds">'</span>CustomClassName<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>addMethod(</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>methodA<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-k">function</span> (<span class="pl-smi">$argumentA</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$argumentB</span>) {</span>
<span class="pl-s1">            <span class="pl-c">// ...</span></span>
<span class="pl-s1">        }</span>
<span class="pl-s1">    )</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>addProperty(<span class="pl-s"><span class="pl-pds">'</span>propertyA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)</span></pre></div>

<p>This is only a small example of what is possible. For a full list of the
available methods, see <a href="#the-mock-builder-api">the mock builder API</a>.</p>

<h4>
<a id="creating-mocks-from-a-builder" class="anchor" href="#creating-mocks-from-a-builder" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating mocks from a builder</h4>

<p>Once the builder is configured, there are several options for creating mock
instances. All of these will internally "finalize" the mock builder, and no
further customizations can be made.</p>

<p>Use <a href="#builder.full"><code>full()</code></a> to create a new full mock instance:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>full();</span></pre></div>

<p>Use <a href="#builder.partial"><code>partial()</code></a> to create a new partial mock instance:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>partial();</span></pre></div>

<p>Constructor arguments can also be passed to <a href="#builder.partial"><code>partial()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>partial(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span></pre></div>

<p>There is also a more advanced method, <a href="#builder.partialWith"><code>partialWith()</code></a>,
that accepts arguments passed by reference:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>partialWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>]);</span></pre></div>

<p>All of the above methods for creating mock instances store the last created mock
instance on the builder. To retrieve the last created mock instance, use
<a href="#builder.get"><code>get()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$mockA</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>full();</span>
<span class="pl-s1"><span class="pl-smi">$mockB</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$mockA</span> <span class="pl-k">===</span> <span class="pl-smi">$mockB</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c">// outputs 'true'</span></span></pre></div>

<p>If no mock instance already exists, <a href="#builder.get"><code>get()</code></a> will create a new
full mock instance, and return it.</p>

<p>Note that unlike using <a href="#facade.mock"><code>mock()</code></a>, these methods do not
automatically wrap the returned mock in a <a href="#mock-handles">mock handle</a>. To obtain a stubbing
handle, use <a href="#facade.on"><code>on()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> on(<span class="pl-smi">$mock</span>);</span></pre></div>

<h4>
<a id="generating-mock-classes-from-a-builder" class="anchor" href="#generating-mock-classes-from-a-builder" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Generating mock classes from a builder</h4>

<p>The mock class can be generated without actually creating a mock instance. To
generate and return a mock class, use <a href="#builder.build"><code>build()</code></a>, (which
returns a <a href="http://php.net/reflectionclass">ReflectionClass</a>):</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$class</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>build();</span></pre></div>

<p>The <a href="#builder.build"><code>build()</code></a> method will normally return the same class for
subsequent calls. To generate a new class each time, pass <code>true</code> as the first
argument:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$classA</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>build(<span class="pl-c1">true</span>);</span>
<span class="pl-s1"><span class="pl-smi">$classB</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>build(<span class="pl-c1">true</span>);</span></pre></div>

<p>Note that this is not possible when a custom class name has been set.</p>

<p>If only the class <em>name</em> is required, <a href="#builder.className"><code>className()</code></a> will
generate the mock class, and return the class name as a string:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$className</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>className();</span></pre></div>

<p>All of the above methods will internally "finalize" the mock builder, and no
further customizations can be made.</p>

<h4>
<a id="copying-mock-builders" class="anchor" href="#copying-mock-builders" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Copying mock builders</h4>

<p>Mock builders can be copied by using the <a href="#builder.__clone"><code>clone</code></a> operator:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$builderA</span> <span class="pl-k">=</span> mockBuilder();</span>
<span class="pl-s1"><span class="pl-smi">$builderB</span> <span class="pl-k">=</span> <span class="pl-k">clone</span> <span class="pl-smi">$builderA</span>;</span></pre></div>

<p>A copied mock builder can be modified even if the original mock builder is
"finalized":</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$countableBuilder</span> <span class="pl-k">=</span> mockBuilder(<span class="pl-s"><span class="pl-pds">'</span>Countable<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$countable</span> <span class="pl-k">=</span> <span class="pl-smi">$countableBuilder</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$countableIteratorBuilder</span> <span class="pl-k">=</span> <span class="pl-k">clone</span> <span class="pl-smi">$countableBuilder</span>;</span>
<span class="pl-s1"><span class="pl-smi">$countableIteratorBuilder</span><span class="pl-k">-&gt;</span>like(<span class="pl-s"><span class="pl-pds">'</span>Iterator<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$countableIterator</span> <span class="pl-k">=</span> <span class="pl-smi">$countableIteratorBuilder</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$countable</span> <span class="pl-k">instanceof</span> <span class="pl-c1">Countable</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>;         <span class="pl-c">// outputs 'true'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$countableIterator</span> <span class="pl-k">instanceof</span> <span class="pl-c1">Countable</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c">// outputs 'true'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$countable</span> <span class="pl-k">instanceof</span> <span class="pl-c1">Iterator</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>;         <span class="pl-c">// outputs 'false'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$countableIterator</span> <span class="pl-k">instanceof</span> <span class="pl-c1">Iterator</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c">// outputs 'true'</span></span></pre></div>

<p>The copied mock builder will also ignore any mock instances generated by the
original builder:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$builderA</span> <span class="pl-k">=</span> mockBuilder();</span>
<span class="pl-s1"><span class="pl-smi">$mockA</span> <span class="pl-k">=</span> <span class="pl-smi">$builderA</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$builderB</span> <span class="pl-k">=</span> <span class="pl-k">clone</span> <span class="pl-smi">$builderA</span>;</span>
<span class="pl-s1"><span class="pl-smi">$mockB</span> <span class="pl-k">=</span> <span class="pl-smi">$builderB</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$mockA</span> <span class="pl-k">===</span> <span class="pl-smi">$mockB</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c">// outputs 'false'</span></span></pre></div>

<h3>
<a id="pausing-mock-recording" class="anchor" href="#pausing-mock-recording" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Pausing mock recording</h3>

<p>To temporarily prevent an entire mock from recording calls, use
<a href="#handle.stopRecording"><code>stopRecording()</code></a> and
<a href="#handle.startRecording"><code>startRecording()</code></a> as necessary:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(</span>
<span class="pl-s1">    [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>methodA<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> () {},</span>
<span class="pl-s1">    ]</span>
<span class="pl-s1">);</span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>stopRecording();</span>
<span class="pl-s1"><span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>startRecording();</span>
<span class="pl-s1"><span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// passes</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>); <span class="pl-c">// passes</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c">// fails</span></span></pre></div>

<h3>
<a id="terminology" class="anchor" href="#terminology" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Terminology</h3>

<p>By some popular definitions, <em>Phony</em>'s mocks are not technically mocks at all,
because they do not implement "expectations". According to these definitions,
<em>Phony</em>'s mocks would be more correctly called stubs.</p>

<p>However, throughout <em>Phony</em>'s API and documentation, the term "mock" is used to
refer to any test double that is an object. The term "stub" is used to refer to
a callable that can be programmed to provide canned answers to incoming calls.</p>

<h2>
<a id="stubs" class="anchor" href="#stubs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Stubs</h2>

<p><em>Stubs</em> are callable entities that can be configured to behave according to a
set of rules when called. In <em>Phony</em>, every stub also implements <a href="#the-spy-api">the spy API</a>.</p>

<h3>
<a id="the-stub-api" class="anchor" href="#the-stub-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The stub API</h3>

<p><a name="facade.stub"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-stub-api">stub</a></em> <a href="#facade.stub"><strong>stub</strong></a>($callback = null) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-stub-api">stub</a></em> x\<a href="#facade.stub"><strong>stub</strong></a>($callback = null) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-stub-api">stub</a></em> Phony::<a href="#facade.stub"><strong>stub</strong></a>($callback = null) <em>(static)</em></p>
</blockquote>

<p>Create a new <a href="#stubs">stub</a>.</p>

<p><em>See <a href="#stubbing-an-existing-callable">Stubbing an existing callable</a>, <a href="#anonymous-stubs">Anonymous stubs</a>.</em></p>

<p><a name="stub.invoke"></a>
<a name="stub.__invoke"></a></p>

<hr>

<blockquote>
<p><em>mixed</em> $stub-&gt;<a href="#stub.invoke"><strong>invoke</strong></a>(...$arguments) or
<a href="#stub.__invoke"><strong>$stub(...$arguments)</strong></a>
throws <a href="http://php.net/class.exception">Exception</a>, <a href="http://php.net/class.error">Error</a></p>
</blockquote>

<p>Invoke the stub, record the call, and return or throw the result.</p>

<p><em>This method does not support reference parameters.</em></p>

<p><em>See <a href="#invoking-spies">Invoking spies</a>.</em></p>

<p><a name="stub.invokeWith"></a></p>

<hr>

<blockquote>
<p><em>mixed</em> $stub-&gt;<a href="#stub.invokeWith"><strong>invokeWith</strong></a>($arguments)
throws <a href="http://php.net/class.exception">Exception</a>, <a href="http://php.net/class.error">Error</a></p>
</blockquote>

<p>Invoke the stub, record the call, and return or throw the result.</p>

<p><em>This method supports reference parameters.</em></p>

<p><em>See <a href="#invoking-spies">Invoking spies</a>.</em></p>

<p><a name="stub.label"></a></p>

<hr>

<blockquote>
<p><em>string|null</em> $stub-&gt;<a href="#stub.label"><strong>label</strong></a>()</p>
</blockquote>

<p>Get the <a href="#labeling-spies">label</a>.</p>

<p><a name="stub.setLabel"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.setLabel"><strong>setLabel</strong></a>($label)</p>
</blockquote>

<p>Set the <a href="#labeling-spies">label</a>.</p>

<p><a name="stub.self"></a></p>

<hr>

<blockquote>
<p><em>mixed</em> $stub-&gt;<a href="#stub.self"><strong>self</strong></a>()</p>
</blockquote>

<p>Get the <a href="#stub-self-values">self value</a> of this stub.</p>

<p><a name="stub.setSelf"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.setSelf"><strong>setSelf</strong></a>($self)</p>
</blockquote>

<p>Set the <a href="#stub-self-values">self value</a> of this stub.</p>

<p><a name="stub.defaultAnswerCallback"></a></p>

<hr>

<blockquote>
<p><em>callable</em> $stub-&gt;<a href="#stub.defaultAnswerCallback"><strong>defaultAnswerCallback</strong></a>()</p>
</blockquote>

<p>Get the <a href="#the-default-answer-callback">default answer callback</a>.</p>

<p><a name="stub.setDefaultAnswerCallback"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.setDefaultAnswerCallback"><strong>setDefaultAnswerCallback</strong></a>($callback)</p>
</blockquote>

<p>Set the <a href="#the-default-answer-callback">default answer callback</a> of this stub.</p>

<p><em>This method accepts a callback that takes the stub as the first argument.</em></p>

<p><a name="stub.with"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.with"><strong>with</strong></a>(...$arguments)</p>
</blockquote>

<p>Modify the current criteria to match the supplied arguments.</p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#matching-stub-arguments">Matching stub arguments</a>.</em></p>

<p><a name="stub.calls"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.calls"><strong>calls</strong></a>($callback, ...$additionalCallbacks)</p>
</blockquote>

<p>Add callbacks to be called as part of an answer.</p>

<p><em>Note that all supplied callbacks will be called in the same invocation.</em></p>

<p><em>See <a href="#invoking-callables">Invoking callables</a>.</em></p>

<p><a name="stub.callsWith"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.callsWith"><strong>callsWith</strong></a>($callback, $arguments = [], $prefixSelf = false, $suffixArgumentsObject = false, $suffixArguments = true)</p>
</blockquote>

<p>Add a callback to be called as part of an answer.</p>

<p><em>Note that all supplied callbacks will be called in the same invocation.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>. Any mock handles in
<code>$arguments</code> are equivalent to the mocks themselves.</em></p>

<p><em>See <a href="#invoking-callables">Invoking callables</a>.</em></p>

<p><a name="stub.callsArgument"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.callsArgument"><strong>callsArgument</strong></a>($index = 0, ...$additionalIndices)</p>
</blockquote>

<p>Add argument callbacks to be called as part of an answer.</p>

<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>

<p><em>Note that all supplied callbacks will be called in the same invocation.</em></p>

<p><em>See <a href="#invoking-arguments">Invoking arguments</a>.</em></p>

<p><a name="stub.callsArgumentWith"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.callsArgumentWith"><strong>callsArgumentWith</strong></a>($index = 0, $arguments = [], $prefixSelf = false, $suffixArgumentsObject = false, $suffixArguments = true)</p>
</blockquote>

<p>Add an argument callback to be called as part of an answer.</p>

<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>

<p><em>This method supports reference parameters.</em></p>

<p><em>Note that all supplied callbacks will be called in the same invocation.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>. Any mock handles in
<code>$arguments</code> are equivalent to the mocks themselves.</em></p>

<p><em>See <a href="#invoking-arguments">Invoking arguments</a>.</em></p>

<p><a name="stub.setsArgument"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.setsArgument"><strong>setsArgument</strong></a>($indexOrValue = null, $value = null)</p>
</blockquote>

<p>Set the value of an argument passed by reference as part of an answer.</p>

<p><em>If called with no arguments, sets the first argument to <code>null</code>.</em></p>

<p><em>If called with one argument, sets the first argument to <code>$indexOrValue</code>.</em></p>

<p><em>If called with two arguments, sets the argument at <code>$indexOrValue</code> to
<code>$value</code>.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> of the value.</em></p>

<p><em>See <a href="#setting-passed-by-reference-arguments">Setting passed-by-reference arguments</a>.</em></p>

<p><a name="stub.does"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.does"><strong>does</strong></a>($callback, ...$additionalCallbacks)</p>
</blockquote>

<p>Add callbacks as answers.</p>

<p><em>See <a href="#using-a-callable-as-an-answer">Using a callable as an answer</a>.</em></p>

<p><a name="stub.doesWith"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.doesWith"><strong>doesWith</strong></a>($callback, $arguments = [], $prefixSelf = false, $suffixArgumentsObject = false, $suffixArguments = true)</p>
</blockquote>

<p>Add a callback as an answer.</p>

<p><em>The supplied arguments support reference parameters.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>. Any mock handles in
<code>$arguments</code> are equivalent to the mocks themselves.</em></p>

<p><em>See <a href="#using-a-callable-as-an-answer">Using a callable as an answer</a>.</em></p>

<p><a name="stub.forwards"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.forwards"><strong>forwards</strong></a>($arguments = [], $prefixSelf = false, $suffixArgumentsObject = false, $suffixArguments = true)</p>
</blockquote>

<p>Add an answer that calls the wrapped callback.</p>

<p><em>The supplied arguments support reference parameters.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>. Any mock handles in
<code>$arguments</code> are equivalent to the mocks themselves.</em></p>

<p><em>See <a href="#forwarding-to-the-original-callable">Forwarding to the original callable</a>.</em></p>

<p><a name="stub.returns"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.returns"><strong>returns</strong></a>($value = null, ...$additionalValues)</p>
</blockquote>

<p>Add answers that return values.</p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#returning-values">Returning values</a>.</em></p>

<p><a name="stub.returnsArgument"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.returnsArgument"><strong>returnsArgument</strong></a>($index = 0)</p>
</blockquote>

<p>Add an answer that returns an argument.</p>

<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>

<p><em>See <a href="#returning-arguments">Returning arguments</a>.</em></p>

<p><a name="stub.returnsSelf"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.returnsSelf"><strong>returnsSelf</strong></a>()</p>
</blockquote>

<p>Add an answer that returns the self value.</p>

<p><em>See <a href="#returning-the-self-value">Returning the "self" value</a>, <a href="#stub-self-values">Stub "self" values</a>.</em></p>

<p><a name="stub.throws"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.throws"><strong>throws</strong></a>($exception = null, ...$additionalExceptions)</p>
</blockquote>

<p>Add answers that throw exceptions.</p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>. Any supplied exception mock
handles are equivalent to the mocks themselves.</em></p>

<p><em>See <a href="#throwing-exceptions">Throwing exceptions</a>.</em></p>

<p><a name="stub.generates"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-generator-answer-api">generator-answer</a></em> $stub-&gt;<a href="#stub.generates"><strong>generates</strong></a>($values = [])</p>
</blockquote>

<p>Add an answer that returns a generator, and return the answer for further
behavior customization.</p>

<p><em>Any supplied <code>$values</code> will be yielded from the resulting generator.</em></p>

<p><em>See <a href="#stubbing-generators">Stubbing generators</a>, <a href="#yielding-from-a-generator">Yielding from a generator</a>.</em></p>

<p><a name="stub.useGeneratorSpies"></a></p>

<hr>

<blockquote>
<p><em>boolean</em> $stub-&gt;<a href="#stub.useGeneratorSpies"><strong>useGeneratorSpies</strong></a>()</p>
</blockquote>

<p>Returns <code>true</code> if this stub uses <a href="#verifying-spies-with-generators-or-traversables">generator spies</a>.</p>

<p><a name="stub.setUseGeneratorSpies"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.setUseGeneratorSpies"><strong>setUseGeneratorSpies</strong></a>($useGeneratorSpies)</p>
</blockquote>

<p>Turn on or off the use of <a href="#verifying-spies-with-generators-or-traversables">generator spies</a>.</p>

<p><a name="stub.useTraversableSpies"></a></p>

<hr>

<blockquote>
<p><em>boolean</em> $stub-&gt;<a href="#stub.useTraversableSpies"><strong>useTraversableSpies</strong></a>()</p>
</blockquote>

<p>Returns <code>true</code> if this stub uses <a href="#verifying-spies-with-generators-or-traversables">traversable spies</a>.</p>

<p><a name="stub.setUseTraversableSpies"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.setUseTraversableSpies"><strong>setUseTraversableSpies</strong></a>($useTraversableSpies)</p>
</blockquote>

<p>Turn on or off the use of <a href="#verifying-spies-with-generators-or-traversables">traversable spies</a>.</p>

<p><a name="stub.stopRecording"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.stopRecording"><strong>stopRecording</strong></a>()</p>
</blockquote>

<p>Stop recording calls.</p>

<p><em>See <a href="#pausing-spy-recording">Pausing spy recording</a>.</em></p>

<p><a name="stub.startRecording"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.startRecording"><strong>startRecording</strong></a>()</p>
</blockquote>

<p>Start recording calls.</p>

<p><em>See <a href="#pausing-spy-recording">Pausing spy recording</a>.</em></p>

<p><a name="stub.arguments"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-arguments-api">arguments</a></em> $stub-&gt;<a href="#stub.arguments"><strong>arguments</strong></a>()
throws <a href="#undefinedcallexception">UndefinedCallException</a></p>
</blockquote>

<p>Get the arguments of the first call.</p>

<p><a name="stub.argument"></a></p>

<hr>

<blockquote>
<p><em>mixed</em> $stub-&gt;<a href="#stub.argument"><strong>argument</strong></a>($index = 0)
throws <a href="#undefinedcallexception">UndefinedCallException</a>, <a href="#undefinedargumentexception">UndefinedArgumentException</a></p>
</blockquote>

<p>Get the argument of the first call at <code>$index</code>.</p>

<p><a name="stub.hasCalls"></a></p>

<hr>

<blockquote>
<p><em>boolean</em> $stub-&gt;<a href="#stub.hasCalls"><strong>hasCalls</strong></a>()</p>
</blockquote>

<p>Returns <code>true</code> if any calls were recorded.</p>

<p><a name="stub.callCount"></a></p>

<hr>

<blockquote>
<p><em>integer</em> $stub-&gt;<a href="#stub.callCount"><strong>callCount</strong></a>()</p>
</blockquote>

<p>Get the number of calls.</p>

<p><a name="stub.allCalls"></a></p>

<hr>

<blockquote>
<p><em>array&lt;<a href="#the-call-api">call</a>&gt;</em> $stub-&gt;<a href="#stub.allCalls"><strong>allCalls</strong></a>()</p>
</blockquote>

<p>Get all calls as an array.</p>

<p><a name="stub.firstCall"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-call-api">call</a></em> $stub-&gt;<a href="#stub.firstCall"><strong>firstCall</strong></a>()
throws <a href="#undefinedcallexception">UndefinedCallException</a></p>
</blockquote>

<p>Get the first call.</p>

<p><a name="stub.lastCall"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-call-api">call</a></em> $stub-&gt;<a href="#stub.lastCall"><strong>lastCall</strong></a>()
throws <a href="#undefinedcallexception">UndefinedCallException</a></p>
</blockquote>

<p>Get the last call.</p>

<p><a name="stub.callAt"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-call-api">call</a></em> $stub-&gt;<a href="#stub.callAt"><strong>callAt</strong></a>($index = 0)
throws <a href="#undefinedcallexception">UndefinedCallException</a></p>
</blockquote>

<p>Get the call at <code>$index</code>.</p>

<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>

<p><a name="stub.hasEvents"></a></p>

<hr>

<blockquote>
<p><em>boolean</em> $stub-&gt;<a href="#stub.hasEvents"><strong>hasEvents</strong></a>()</p>
</blockquote>

<p>Returns <code>true</code> if any events were recorded.</p>

<p><a name="stub.eventCount"></a></p>

<hr>

<blockquote>
<p><em>integer</em> $stub-&gt;<a href="#stub.eventCount"><strong>eventCount</strong></a>()</p>
</blockquote>

<p>Get the number of events.</p>

<p><a name="stub.allEvents"></a></p>

<hr>

<blockquote>
<p><em>array&lt;<a href="#the-event-api">event</a>&gt;</em> $stub-&gt;<a href="#stub.allEvents"><strong>allEvents</strong></a>()</p>
</blockquote>

<p>Get all events as an array.</p>

<p><a name="stub.firstEvent"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-event-api">event</a></em> $stub-&gt;<a href="#stub.firstEvent"><strong>firstEvent</strong></a>()
throws <a href="#undefinedeventexception">UndefinedEventException</a></p>
</blockquote>

<p>Get the first event.</p>

<p><a name="stub.lastEvent"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-event-api">event</a></em> $stub-&gt;<a href="#stub.lastEvent"><strong>lastEvent</strong></a>()
throws <a href="#undefinedeventexception">UndefinedEventException</a></p>
</blockquote>

<p>Get the last event.</p>

<p><a name="stub.eventAt"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-event-api">event</a></em> $stub-&gt;<a href="#stub.eventAt"><strong>eventAt</strong></a>($index = 0)
throws <a href="#undefinedeventexception">UndefinedEventException</a></p>
</blockquote>

<p>Get the event at <code>$index</code>.</p>

<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>

<p><a name="stub.called"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $stub-&gt;<a href="#stub.called"><strong>called</strong></a>()
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless called.</p>

<p><em>See <a href="#verifying-that-a-call-was-made">Verifying that a call was made</a>.</em></p>

<p><a name="stub.checkCalled"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $stub-&gt;<a href="#stub.checkCalled"><strong>checkCalled</strong></a>()</p>
</blockquote>

<p>Checks if called.</p>

<p><em>See <a href="#verifying-that-a-call-was-made">Verifying that a call was made</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="stub.calledWith"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $stub-&gt;<a href="#stub.calledWith"><strong>calledWith</strong></a>(...$arguments)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless called with the supplied arguments.</p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>. Any mock handles in
<code>$arguments</code> are equivalent to the mocks themselves.</em></p>

<p><em>See <a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a>.</em></p>

<p><a name="stub.checkCalledWith"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $stub-&gt;<a href="#stub.checkCalledWith"><strong>checkCalledWith</strong></a>(...$arguments)</p>
</blockquote>

<p>Checks if called with the supplied arguments.</p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>. Any mock handles in
<code>$arguments</code> are equivalent to the mocks themselves.</em></p>

<p><em>See <a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a>,
<a href="#check-verification">Check verification</a>.</em></p>

<p><a name="stub.calledOn"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $stub-&gt;<a href="#stub.calledOn"><strong>calledOn</strong></a>($value)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless the bound <code>$this</code> value is equal to the supplied
value.</p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-spy-closure-binding">Verifying spy closure binding</a>.</em></p>

<p><a name="stub.checkCalledOn"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $stub-&gt;<a href="#stub.checkCalledOn"><strong>checkCalledOn</strong></a>($value)</p>
</blockquote>

<p>Checks if the bound <code>$this</code> value is equal to the supplied value.</p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-spy-closure-binding">Verifying spy closure binding</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="stub.returned"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $stub-&gt;<a href="#stub.returned"><strong>returned</strong></a>($value = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless this stub returned the supplied value.</p>

<p><em>When called with no arguments, this method simply checks that the stub returned
any value.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-spy-return-values">Verifying spy return values</a>.</em></p>

<p><a name="stub.checkReturned"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $stub-&gt;<a href="#stub.checkReturned"><strong>checkReturned</strong></a>($value = null)</p>
</blockquote>

<p>Checks if this stub returned the supplied value.</p>

<p><em>When called with no arguments, this method simply checks that the stub returned
any value.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-spy-return-values">Verifying spy return values</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="stub.threw"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $stub-&gt;<a href="#stub.threw"><strong>threw</strong></a>($type = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless this stub threw an exception of the supplied type.</p>

<p><em>When called with no arguments, this method simply checks that the stub threw
any exception.</em></p>

<p><em>When called with a string, this method checks that the stub threw an exception
that is an instance of <code>$type</code>.</em></p>

<p><em>When called with an exception instance, this method checks that the stub threw
an exception that is equal to the supplied instance.</em></p>

<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the stub threw an
exception that matches the supplied matcher.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-spy-exceptions">Verifying spy exceptions</a>.</em></p>

<p><a name="stub.checkThrew"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $stub-&gt;<a href="#stub.checkThrew"><strong>checkThrew</strong></a>($type = null)</p>
</blockquote>

<p>Checks if an exception of the supplied type was thrown.</p>

<p><em>When called with no arguments, this method simply checks that the stub threw
any exception.</em></p>

<p><em>When called with a string, this method checks that the stub threw an exception
that is an instance of <code>$type</code>.</em></p>

<p><em>When called with an exception instance, this method checks that the stub threw
an exception that is equal to the supplied instance.</em></p>

<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the stub threw an
exception that matches the supplied matcher.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-spy-exceptions">Verifying spy exceptions</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="stub.produced"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $stub-&gt;<a href="#stub.produced"><strong>produced</strong></a>($keyOrValue = null, $value = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Checks if this stub produced the supplied values.</p>

<p><em>When called with no arguments, this method simply checks that the stub produced
any value.</em></p>

<p><em>With a single argument, it checks that a value matching the argument was
produced.</em></p>

<p><em>With two arguments, it checks that a key and value matching the respective
arguments were produced together.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> for both keys and values.</em></p>

<p><em>See <a href="#verifying-values-produced-by-spies">Verifying values produced by spies</a>.</em></p>

<p><a name="stub.checkProduced"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $stub-&gt;<a href="#stub.checkProduced"><strong>checkProduced</strong></a>($keyOrValue = null, $value = null)</p>
</blockquote>

<p>Checks if this stub produced the supplied values.</p>

<p><em>When called with no arguments, this method simply checks that the stub produced
any value.</em></p>

<p><em>With a single argument, it checks that a value matching the argument was
produced.</em></p>

<p><em>With two arguments, it checks that a key and value matching the respective
arguments were produced together.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> for both keys and values.</em></p>

<p><em>See <a href="#verifying-values-produced-by-spies">Verifying values produced by spies</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="stub.producedAll"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $stub-&gt;<a href="#stub.producedAll"><strong>producedAll</strong></a>(...$pairs)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless this stub produced all of the supplied key-value
pairs, in the supplied order, in a single call.</p>

<p><em>Each value in <code>$pairs</code> is equivalent to a set of arguments passed to
<a href="#stub.produced"><code>produced()</code></a>.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> for both keys and values.</em></p>

<p><em>See <a href="#verifying-values-produced-by-spies">Verifying values produced by spies</a>.</em></p>

<p><a name="stub.checkProducedAll"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $stub-&gt;<a href="#stub.checkProducedAll"><strong>checkProducedAll</strong></a>(...$pairs)</p>
</blockquote>

<p>Checks if this stub produced all of the supplied key-value pairs, in the
supplied order, in a single call.</p>

<p><em>Each value in <code>$pairs</code> is equivalent to a set of arguments passed to
<a href="#stub.checkProduced"><code>checkProduced()</code></a>.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> for both keys and values.</em></p>

<p><em>See <a href="#verifying-values-produced-by-spies">Verifying values produced by spies</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="stub.received"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $stub-&gt;<a href="#stub.received"><strong>received</strong></a>($value = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless this stub received the supplied value.</p>

<p><em>When called with no arguments, this method simply checks that the stub received
any value.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-values-received-by-spies">Verifying values received by spies</a>.</em></p>

<p><a name="stub.checkReceived"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $stub-&gt;<a href="#stub.checkReceived"><strong>checkReceived</strong></a>($value = null)</p>
</blockquote>

<p>Checks if this stub received the supplied value.</p>

<p><em>When called with no arguments, this method simply checks that the stub received
any value.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-values-received-by-spies">Verifying values received by spies</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="stub.receivedException"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $stub-&gt;<a href="#stub.receivedException"><strong>receivedException</strong></a>($type = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless this call received an exception of the supplied type.</p>

<p><em>When called with no arguments, this method simply checks that the stub received
any exception.</em></p>

<p><em>When called with a string, this method checks that the stub received an
exception that is an instance of <code>$type</code>.</em></p>

<p><em>When called with an exception instance, this method checks that the stub
received an exception that is equal to the supplied instance.</em></p>

<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the stub received an
exception that matches the supplied matcher.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-exceptions-received-by-spies">Verifying exceptions received by spies</a>.</em></p>

<p><a name="stub.checkReceivedException"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $stub-&gt;<a href="#stub.checkReceivedException"><strong>checkReceivedException</strong></a>($type = null)</p>
</blockquote>

<p>Checks if this stub received an exception of the supplied type.</p>

<p><em>When called with no arguments, this method simply checks that the stub received
any exception.</em></p>

<p><em>When called with a string, this method checks that the stub received an
exception that is an instance of <code>$type</code>.</em></p>

<p><em>When called with an exception instance, this method checks that the stub
received an exception that is equal to the supplied instance.</em></p>

<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the stub received an
exception that matches the supplied matcher.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-exceptions-received-by-spies">Verifying exceptions received by spies</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="stub.never"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.never"><strong>never</strong></a>()</p>
</blockquote>

<p>Requires that the next verification never matches.</p>

<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>

<p><a name="stub.once"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.once"><strong>once</strong></a>()</p>
</blockquote>

<p>Requires that the next verification matches only once.</p>

<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>

<p><a name="stub.twice"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.twice"><strong>twice</strong></a>()</p>
</blockquote>

<p>Requires that the next verification matches exactly two times.</p>

<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>

<p><a name="stub.thrice"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.thrice"><strong>thrice</strong></a>()</p>
</blockquote>

<p>Requires that the next verification matches exactly three times.</p>

<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>

<p><a name="stub.times"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.times"><strong>times</strong></a>($times)</p>
</blockquote>

<p>Requires that the next verification matches exactly <code>$times</code> times.</p>

<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>

<p><a name="stub.atLeast"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.atLeast"><strong>atLeast</strong></a>($minimum)</p>
</blockquote>

<p>Requires that the next verification matches a number of times greater than or
equal to <code>$minimum</code>.</p>

<p><em>See <a href="#verifying-that-a-spy-event-happened-a-bounded-number-of-times">Verifying that a spy event happened a bounded number of times</a>.</em></p>

<p><a name="stub.atMost"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.atMost"><strong>atMost</strong></a>($maximum)</p>
</blockquote>

<p>Requires that the next verification matches a number of times less than or equal
to <code>$maximum</code>.</p>

<p><em>See <a href="#verifying-that-a-spy-event-happened-a-bounded-number-of-times">Verifying that a spy event happened a bounded number of times</a>.</em></p>

<p><a name="stub.between"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.between"><strong>between</strong></a>($minimum, $maximum)</p>
</blockquote>

<p>Requires that the next verification matches a number of times greater than or
equal to <code>$minimum</code>, and less than or equal to <code>$maximum</code>.</p>

<p><em>See <a href="#verifying-that-a-spy-event-happened-a-bounded-number-of-times">Verifying that a spy event happened a bounded number of times</a>.</em></p>

<p><a name="stub.always"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.always"><strong>always</strong></a>()</p>
</blockquote>

<p>Requires that the next verification matches for all possible items.</p>

<p><em>See <a href="#verifying-that-all-spy-events-happen-the-same-way">Verifying that all spy events happen the same way</a>.</em></p>

<h3>
<a id="the-generator-answer-api" class="anchor" href="#the-generator-answer-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The generator answer API</h3>

<p><a name="generatorAnswer.calls"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $generatorAnswer-&gt;<a href="#generatorAnswer.calls"><strong>calls</strong></a>($callback, ...$additionalCallbacks)</p>
</blockquote>

<p>Add callbacks to be called as part of the answer.</p>

<p><em>See <a href="#invoking-callables-in-a-generator">Invoking callables in a generator</a>.</em></p>

<p><a name="generatorAnswer.callsWith"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $generatorAnswer-&gt;<a href="#generatorAnswer.callsWith"><strong>callsWith</strong></a>($callback, $arguments = [], $prefixSelf = false, $suffixArgumentsObject = false, $suffixArguments = true)</p>
</blockquote>

<p>Add callbacks to be called as part of the answer.</p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>. Any mock handles in
<code>$arguments</code> are equivalent to the mocks themselves.</em></p>

<p><em>See <a href="#invoking-callables-in-a-generator">Invoking callables in a generator</a>.</em></p>

<p><a name="generatorAnswer.callsArgument"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $generatorAnswer-&gt;<a href="#generatorAnswer.callsArgument"><strong>callsArgument</strong></a>($index = 0, ...$additionalIndices)</p>
</blockquote>

<p>Add argument callbacks to be called as part of the answer.</p>

<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>

<p><em>See <a href="#invoking-arguments-in-a-generator">Invoking arguments in a generator</a>.</em></p>

<p><a name="generatorAnswer.callsArgumentWith"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $generatorAnswer-&gt;<a href="#generatorAnswer.callsArgumentWith"><strong>callsArgumentWith</strong></a>($index = 0, $arguments = [], $prefixSelf = false, $suffixArgumentsObject = false, $suffixArguments = true)</p>
</blockquote>

<p>Add an argument callback to be called as part of the answer.</p>

<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>

<p><em>This method supports reference parameters.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>. Any mock handles in
<code>$arguments</code> are equivalent to the mocks themselves.</em></p>

<p><em>See <a href="#invoking-arguments-in-a-generator">Invoking arguments in a generator</a>.</em></p>

<p><a name="generatorAnswer.setsArgument"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $generatorAnswer-&gt;<a href="#generatorAnswer.setsArgument"><strong>setsArgument</strong></a>($indexOrValue = null, $value = null)</p>
</blockquote>

<p>Set the value of an argument passed by reference as part of the answer.</p>

<p><em>If called with no arguments, sets the first argument to <code>null</code>.</em></p>

<p><em>If called with one argument, sets the first argument to <code>$indexOrValue</code>.</em></p>

<p><em>If called with two arguments, sets the argument at <code>$indexOrValue</code> to
<code>$value</code>.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> of the value.</em></p>

<p><em>See <a href="#setting-passed-by-reference-arguments-in-a-generator">Setting passed-by-reference arguments in a generator</a>.</em></p>

<p><a name="generatorAnswer.yields"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $generatorAnswer-&gt;<a href="#generatorAnswer.yields"><strong>yields</strong></a>($keyOrValue = null, $value = null)</p>
</blockquote>

<p>Add a yielded value to the answer.</p>

<p><em>If both <code>$keyOrValue</code> and <code>$value</code> are supplied, the stub will yield like
<code>yield $keyOrValue =&gt; $value;</code>.</em></p>

<p><em>If only <code>$keyOrValue</code> is supplied, the stub will yield like
<code>yield $keyOrValue;</code>.</em></p>

<p><em>If no arguments are supplied, the stub will yield like <code>yield;</code>.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#yielding-individual-values-from-a-generator">Yielding individual values from a generator</a>.</em></p>

<p><a name="generatorAnswer.yieldsFrom"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $generatorAnswer-&gt;<a href="#generatorAnswer.yieldsFrom"><strong>yieldsFrom</strong></a>($values)</p>
</blockquote>

<p>Add a set of yielded values to the answer.</p>

<p><em>The <code>$values</code> argument can be an array, an iterator, or even another
generator.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#yielding-multiple-values-from-a-generator">Yielding multiple values from a generator</a>.</em></p>

<p><a name="generatorAnswer.returns"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-stub-api">stub</a></em> $generatorAnswer-&gt;<a href="#generatorAnswer.returns"><strong>returns</strong></a>($value = null, ...$additionalValues)</p>
</blockquote>

<p>End the generator by returning a value.</p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#returning-values-from-a-generator">Returning values from a generator</a>.</em></p>

<p><a name="generatorAnswer.returnsArgument"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-stub-api">stub</a></em> $generatorAnswer-&gt;<a href="#generatorAnswer.returnsArgument"><strong>returnsArgument</strong></a>($index = 0)</p>
</blockquote>

<p>End the generator by returning an argument.</p>

<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>

<p><em>See <a href="#returning-arguments-from-a-generator">Returning arguments from a generator</a>.</em></p>

<p><a name="generatorAnswer.returnsSelf"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-stub-api">stub</a></em> $generatorAnswer-&gt;<a href="#generatorAnswer.returnsSelf"><strong>returnsSelf</strong></a>()</p>
</blockquote>

<p>End the generator by returning the self value.</p>

<p><em>See <a href="#returning-the-self-value-from-a-generator">Returning the "self" value from a generator</a>, <a href="#stub-self-values">Stub "self" values</a>.</em></p>

<p><a name="generatorAnswer.throws"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-stub-api">stub</a></em> $generatorAnswer-&gt;<a href="#generatorAnswer.throws"><strong>throws</strong></a>($exception = null, ...$additionalExceptions)</p>
</blockquote>

<p>End the generator by throwing an exception.</p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>. Any supplied exception mock
handles are equivalent to the mocks themselves.</em></p>

<p><em>See <a href="#throwing-exceptions-from-a-generator">Throwing exceptions from a generator</a>.</em></p>

<h3>
<a id="stubbing-an-existing-callable" class="anchor" href="#stubbing-an-existing-callable" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Stubbing an existing callable</h3>

<p>Any callable can be stubbed, by passing the callable to
<a href="#facade.stub"><code>stub()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-smi">$callable</span>);        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>stub(<span class="pl-smi">$callable</span>);      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>stub(<span class="pl-smi">$callable</span>); <span class="pl-c">// static</span></span></pre></div>

<p>By default, the created stub will behave exactly like the wrapped callable:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-s"><span class="pl-pds">'</span>max<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>); <span class="pl-c">// outputs '3'</span></span></pre></div>

<p>The stub can be configured to behave differently in specific circumstances,
whilst falling back to the default behavior during regular operation:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-s"><span class="pl-pds">'</span>max<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>with(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-c1">9</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>); <span class="pl-c">// outputs '3'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>); <span class="pl-c">// outputs '9'</span></span></pre></div>

<p>The stub can also be configured to completely replace the default behavior:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-s"><span class="pl-pds">'</span>max<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-c1">9</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>); <span class="pl-c">// outputs '9'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>); <span class="pl-c">// outputs '9'</span></span></pre></div>

<h3>
<a id="anonymous-stubs" class="anchor" href="#anonymous-stubs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Anonymous stubs</h3>

<p><em>Anonymous stubs</em> are stubs that do not wrap an existing callable. An anonymous
stub is created by calling <a href="#facade.stub"><code>stub()</code></a> without passing a callable:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub();        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>stub();      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>stub(); <span class="pl-c">// static</span></span></pre></div>

<p>By default, anonymous stubs will always return <code>null</code> regardless of input
arguments:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">gettype</span>($<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)); <span class="pl-c">// outputs 'NULL'</span></span></pre></div>

<p>The stub can be configured to behave differently in specific circumstances,
whilst returning <code>null</code> during regular operation:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">gettype</span>($<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)); <span class="pl-c">// outputs 'NULL'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);          <span class="pl-c">// outputs 'x'</span></span></pre></div>

<p>The stub can also be configured to behave the same in all circumstances:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>();    <span class="pl-c">// outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'x'</span></span></pre></div>

<h3>
<a id="stub-self-values" class="anchor" href="#stub-self-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Stub "self" values</h3>

<p>All stubs have a special "self" value that is used in multiple ways by <em>Phony</em>.
The self value defaults to the callback passed to <a href="#facade.stub"><code>stub()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$callback</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () {};</span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-smi">$callback</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>self() <span class="pl-k">===</span> <span class="pl-smi">$callback</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c">// outputs 'true'</span></span></pre></div>

<p>The self value can also be set manually by calling <a href="#stub.setSelf"><code>setSelf()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub();</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>setSelf(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>self(); <span class="pl-c">// outputs 'a'</span></span></pre></div>

<p>The <a href="#stub.setSelf"><code>setSelf()</code></a> method is also fluent, meaning that stub
creation and self value setting can be done in a single expression:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>setSelf(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span></pre></div>

<p>When stubs are retrieved from a <a href="#mocks">mock</a>, their "self" value is automatically set
to the mock itself:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>self() <span class="pl-k">===</span> <span class="pl-smi">$mock</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c">// outputs 'true'</span></span></pre></div>

<h4>
<a id="magic-self-values" class="anchor" href="#magic-self-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Magic "self" values</h4>

<p>A stubbed callback that has a first parameter named <code>$phonySelf</code>, regardless of
the parameter's type, will receive the stub <a href="#stub-self-values">self value</a> as the first argument.</p>

<p>In the case of stubs created outside of a mock, this self value will be the
callback passed to <a href="#facade.stub"><code>stub()</code></a>, allowing recursive calls without
creating an explicit reference to the callback:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-smi">$phonySelf</span>, <span class="pl-smi">$n</span>, <span class="pl-smi">$total</span> <span class="pl-k">=</span> <span class="pl-c1">1</span>) {</span>
<span class="pl-s1">        <span class="pl-k">if</span> (<span class="pl-smi">$n</span> <span class="pl-k">&lt;</span> <span class="pl-c1">2</span>) {</span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-smi">$total</span>;</span>
<span class="pl-s1">        }</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-k">return</span> $<span class="pl-smi">phonySelf</span>(<span class="pl-smi">$n</span> <span class="pl-k">-</span> <span class="pl-c1">1</span>, <span class="pl-smi">$total</span> <span class="pl-k">*</span> <span class="pl-smi">$n</span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">);</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>forwards();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">0</span>); <span class="pl-c">// outputs '1'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">1</span>); <span class="pl-c">// outputs '1'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">2</span>); <span class="pl-c">// outputs '2'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">3</span>); <span class="pl-c">// outputs '6'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">4</span>); <span class="pl-c">// outputs '24'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">5</span>); <span class="pl-c">// outputs '120'</span></span></pre></div>

<h3>
<a id="stub-rules-and-answers" class="anchor" href="#stub-rules-and-answers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Stub rules and answers</h3>

<p><em>Stub rules</em> define the circumstances under which a stub changes its behavior.
<em>Stub answers</em> define how the stub behaves for a given rule. Each time a stub is
called, it will chose an answer by determining which rule matches the incoming
arguments:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)     <span class="pl-c">// starts the rule</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>); <span class="pl-c">// creates an answer for the rule</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'x'</span></span></pre></div>

<h4>
<a id="multiple-rules" class="anchor" href="#multiple-rules" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Multiple rules</h4>

<p>Each time <a href="#stub.with"><code>with()</code></a> is called (not to be confused with
<a href="#spy.calledWith"><code>calledWith()</code></a>, which is part of <a href="#the-spy-api">the spy API</a>), a new rule
is started:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>) <span class="pl-c">// starts a rule</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>) <span class="pl-c">// starts another rule</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'y'</span></span></pre></div>

<h4>
<a id="multiple-answers" class="anchor" href="#multiple-answers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Multiple answers</h4>

<p>A rule can have multiple answers. Each time a stub is called, <em>Phony</em> finds a
matching rule, and uses the next answer for that rule. When the last answer is
reached, <em>Phony</em> will continue to use it for any subsequent calls:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)  <span class="pl-c">// creates the first answer</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>); <span class="pl-c">// creates a subsequent answer</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'x'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">while</span> (<span class="pl-c1">true</span>) {</span>
<span class="pl-s1">  <span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'y' forever</span></span>
<span class="pl-s1">}</span></pre></div>

<h4>
<a id="overriding-rules" class="anchor" href="#overriding-rules" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Overriding rules</h4>

<p>Defining a rule that matches the same arguments as a previous rule will override
the previous rule:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>); <span class="pl-c">// overrides previous rule</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'y'</span></span></pre></div>

<p>Defining a new rule that matches any arguments will override <strong>all</strong> previous
rules:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>); <span class="pl-c">// overrides all previous rules</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'z'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'z'</span></span></pre></div>

<p>Later rules take precedence over earlier ones, so more generic rules should be
defined first, with more specific rules being defined later:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)  <span class="pl-c">// a generic rule</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>); <span class="pl-c">// a more specific rule</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);      <span class="pl-c">// outputs 'y'</span></span></pre></div>

<h4>
<a id="the-default-rule-and-answer" class="anchor" href="#the-default-rule-and-answer" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The default rule and answer</h4>

<p>When a new stub is created, the first rule is started implicitly, as if
<a href="#shorthand-matchers"><code>with('*')</code></a> were called. For example, the two following
stubs behave the same:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-c">// implicit -&gt;with('*')</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span></pre></div>

<p>If a new rule is started before any answers are defined, the stub behaves as if
<a href="#stub.forwards"><code>forwards()</code></a> were called, causing the stub to behave the same
as the stubbed callable by default. For example, the two following stubs behave
the same:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub(<span class="pl-smi">$callable</span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>forwards()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub(<span class="pl-smi">$callable</span>)</span>
<span class="pl-s1">    <span class="pl-c">// implicit -&gt;with('*')-&gt;forwards()</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span></pre></div>

<h5>
<a id="the-default-answer-callback" class="anchor" href="#the-default-answer-callback" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The default answer callback</h5>

<p>To change the default behavior of a stub, use
<a href="#stub.setDefaultAnswerCallback"><code>setDefaultAnswerCallback()</code></a>. This method
accepts a callback that takes the stub as the first argument:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub();</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>setDefaultAnswerCallback(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-smi">$stub</span>) {</span>
<span class="pl-s1">        <span class="pl-c">// custom answer logic goes here</span></span>
<span class="pl-s1">        <span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>default<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'default'</span></span></pre></div>

<p>The <a href="#stub.setDefaultAnswerCallback"><code>setDefaultAnswerCallback()</code></a> method is
also fluent, meaning stub creation and setting of this option can be done in a
single expression:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>setDefaultAnswerCallback(<span class="pl-smi">$defaultAnswerCallback</span>);</span></pre></div>

<h3>
<a id="matching-stub-arguments" class="anchor" href="#matching-stub-arguments" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Matching stub arguments</h3>

<p>Stub arguments can be matched using <a href="#stub.with"><code>with()</code></a> (not to be confused
with <a href="#spy.calledWith"><code>calledWith()</code></a>, which is part of <a href="#the-spy-api">the spy API</a>).
Arguments passed to <a href="#stub.with"><code>with()</code></a> can be literal values, or <a href="#matchers">matchers</a>,
including <a href="#shorthand-matchers">shorthand matchers</a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>v<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>w<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with()<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);           <span class="pl-c">// outputs 'v'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'w'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);      <span class="pl-c">// outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);      <span class="pl-c">// outputs 'y'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>();              <span class="pl-c">// outputs 'z'</span></span></pre></div>

<h3>
<a id="returning-values" class="anchor" href="#returning-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Returning values</h3>

<p>To return a value from a stub, use <a href="#stub.returns"><code>returns()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubA</span>();          <span class="pl-c">// outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">gettype</span>($<span class="pl-smi">stubB</span>()); <span class="pl-c">// outputs 'NULL'</span></span></pre></div>

<p>Calling <a href="#stub.returns"><code>returns()</code></a> with multiple arguments is equivalent to
calling it once with each argument. For example, the two following stubs behave
the same:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubA</span>(); <span class="pl-c">// outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubA</span>(); <span class="pl-c">// outputs 'y'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubB</span>(); <span class="pl-c">// outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubB</span>(); <span class="pl-c">// outputs 'y'</span></span></pre></div>

<h4>
<a id="default-values-for-return-types" class="anchor" href="#default-values-for-return-types" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Default values for return types</h4>

<p>When using <a href="#stub.returns"><code>returns()</code></a> without passing an explicit value,
<em>Phony</em> will attempt to return a value that conforms to the stubbed callable's
<a href="http://php.net/functions.returning-values#functions.returning-values.type-declaration">return type</a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (): int {}</span>
<span class="pl-s1">);</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>($<span class="pl-smi">stubA</span>()); <span class="pl-c">// outputs 'int(0)'</span></span></pre></div>

<p>This table details the return types that <em>Phony</em> handles, and the values
returned for each:</p>

<table>
<thead>
<tr>
<th>Return type</th>
<th>Returned value</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>(none)</em></td>
<td><code>null</code></td>
</tr>
<tr>
<td><code>bool</code></td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>float</code></td>
<td><code>.0</code></td>
</tr>
<tr>
<td><code>string</code></td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>array</code></td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>stdClass</code></td>
<td><code>(object) []</code></td>
</tr>
<tr>
<td><code>callable</code></td>
<td><code>function () {}</code></td>
</tr>
<tr>
<td><code>Traversable</code></td>
<td><code>new EmptyIterator()</code></td>
</tr>
<tr>
<td><code>Iterator</code></td>
<td><code>new EmptyIterator()</code></td>
</tr>
<tr>
<td><code>Generator</code></td>
<td><code>(function () {return; yield;})()</code></td>
</tr>
</tbody>
</table>

<p>When using a <a href="http://php.net/functions.returning-values#functions.returning-values.type-declaration">return type</a> that is not listed above, the return value <em>must</em> be
explicitly passed, or <em>Phony</em> will throw an exception:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (): DateTime {}</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>returns(<span class="pl-k">new</span> <span class="pl-c1">DateTime</span>()); <span class="pl-c">// works fine</span></span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>returns();               <span class="pl-c">// throws an exception</span></span></pre></div>

<h3>
<a id="returning-arguments" class="anchor" href="#returning-arguments" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Returning arguments</h3>

<p>To return an argument from a stub, use
<a href="#stub.returnsArgument"><code>returnsArgument()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>returnsArgument();   <span class="pl-c">// returns the first argument</span></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>returnsArgument(<span class="pl-c1">1</span>);  <span class="pl-c">// returns the second argument</span></span>
<span class="pl-s1"><span class="pl-smi">$stubC</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>returnsArgument(<span class="pl-k">-</span><span class="pl-c1">1</span>); <span class="pl-c">// returns the last argument</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubA</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubB</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'y'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubC</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'z'</span></span></pre></div>

<h3>
<a id="returning-the-self-value" class="anchor" href="#returning-the-self-value" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Returning the "self" value</h3>

<p>When stubs are retrieved from a mock, their <a href="#stub-self-values">self value</a> is automatically set to
the mock itself. This allows mocking of <a href="http://en.wikipedia.org/wiki/Fluent_interface">fluent interfaces</a> with the
<a href="#stub.returnsSelf"><code>returnsSelf()</code></a> method:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">interface</span> <span class="pl-en">FluentInterface</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">methodA</span>();</span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">methodB</span>();</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>FluentInterface<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>returnsSelf();</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodB</span><span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$fluent</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$fluent</span><span class="pl-k">-&gt;</span>methodA()<span class="pl-k">-&gt;</span>methodB(); <span class="pl-c">// outputs 'x'</span></span></pre></div>

<h3>
<a id="throwing-exceptions" class="anchor" href="#throwing-exceptions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Throwing exceptions</h3>

<p>To throw an exception from a stub, use <a href="#stub.throws"><code>throws()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$exception</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>You done goofed.<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>throws(<span class="pl-smi">$exception</span>);</span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>throws();</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">stubA</span>(); <span class="pl-c">// throws $exception</span></span>
<span class="pl-s1">$<span class="pl-smi">stubB</span>(); <span class="pl-c">// throws a generic exception</span></span></pre></div>

<p>Calling <a href="#stub.throws"><code>throws()</code></a> with multiple arguments is equivalent to
calling it once with each argument. For example, the two following stubs behave
the same:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$exceptionA</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>You done goofed.<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$exceptionB</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>Consequences will never be the same.<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>throws(<span class="pl-smi">$exceptionA</span>, <span class="pl-smi">$exceptionB</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">stubA</span>(); <span class="pl-c">// throws $exceptionA</span></span>
<span class="pl-s1">$<span class="pl-smi">stubA</span>(); <span class="pl-c">// throws $exceptionB</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>throws(<span class="pl-smi">$exceptionA</span>)<span class="pl-k">-&gt;</span>throws(<span class="pl-smi">$exceptionB</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">stubB</span>(); <span class="pl-c">// throws $exceptionA</span></span>
<span class="pl-s1">$<span class="pl-smi">stubB</span>(); <span class="pl-c">// throws $exceptionB</span></span></pre></div>

<h3>
<a id="using-a-callable-as-an-answer" class="anchor" href="#using-a-callable-as-an-answer" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using a callable as an answer</h3>

<p>To use a callable as an answer, use <a href="#stub.does"><code>does()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>does(<span class="pl-s"><span class="pl-pds">'</span>max<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>); <span class="pl-c">// outputs '3'</span></span></pre></div>

<p>Calling <a href="#stub.does"><code>does()</code></a> with multiple arguments is equivalent to calling
it once with each argument. For example, the two following stubs behave the
same:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>does(<span class="pl-s"><span class="pl-pds">'</span>min<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>max<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubA</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>); <span class="pl-c">// outputs '1'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubA</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>); <span class="pl-c">// outputs '3'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>does(<span class="pl-s"><span class="pl-pds">'</span>min<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>does(<span class="pl-s"><span class="pl-pds">'</span>max<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubB</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>); <span class="pl-c">// outputs '1'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubB</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>); <span class="pl-c">// outputs '3'</span></span></pre></div>

<p>There is also a more powerful version of <a href="#stub.does"><code>does()</code></a>, named
<a href="#stub.doesWith"><code>doesWith()</code></a>, that allows more control over which arguments
are passed to the callable, and how they are passed:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>doesWith(</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>implode<span class="pl-pds">'</span></span>, <span class="pl-c">// callable</span></span>
<span class="pl-s1">    [<span class="pl-s"><span class="pl-pds">'</span>, <span class="pl-pds">'</span></span>],    <span class="pl-c">// fixed arguments</span></span>
<span class="pl-s1">    <span class="pl-c1">false</span>,     <span class="pl-c">// prefix the "self" value?</span></span>
<span class="pl-s1">    <span class="pl-c1">true</span>,      <span class="pl-c">// suffix the arguments object?</span></span>
<span class="pl-s1">    <span class="pl-c1">false</span>      <span class="pl-c">// suffix the arguments normally?</span></span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'x, y, z'</span></span></pre></div>

<p>The <a href="#stub.doesWith"><code>doesWith()</code></a> method also supports arguments passed by
reference:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$d</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>doesWith(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>) {</span>
<span class="pl-s1">        <span class="pl-c1">list</span>(<span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>, <span class="pl-smi">$c</span>, <span class="pl-smi">$d</span>) <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">    },</span>
<span class="pl-s1">    [<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>],</span>
<span class="pl-s1">    <span class="pl-c1">false</span>,</span>
<span class="pl-s1">    <span class="pl-c1">false</span>,</span>
<span class="pl-s1">    <span class="pl-c1">true</span></span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c">// outputs 'a'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$b</span>; <span class="pl-c">// outputs 'b'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$c</span>; <span class="pl-c">// outputs 'c'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$d</span>; <span class="pl-c">// outputs 'd'</span></span></pre></div>

<h3>
<a id="forwarding-to-the-original-callable" class="anchor" href="#forwarding-to-the-original-callable" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Forwarding to the original callable</h3>

<p>When stubbing an existing callable, the stub can "forward" calls on to the
original callable using <a href="#stub.forwards"><code>forwards()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-s"><span class="pl-pds">'</span>max<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns(<span class="pl-c1">9</span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>)<span class="pl-k">-&gt;</span>forwards();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>); <span class="pl-c">// outputs '3'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">3</span>, <span class="pl-c1">4</span>, <span class="pl-c1">5</span>); <span class="pl-c">// outputs '9'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">7</span>, <span class="pl-c1">6</span>, <span class="pl-c1">5</span>); <span class="pl-c">// outputs '9'</span></span></pre></div>

<p>This technique can be used to return a mocked method to its default behavior in
specific circumstances:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">Cat</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">speak</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>Cower in fear, mortal.<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>Cat<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">speak</span><span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>Meow.<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>speak(<span class="pl-c1">true</span>)<span class="pl-k">-&gt;</span>forwards();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$cat</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$cat</span><span class="pl-k">-&gt;</span>speak();     <span class="pl-c">// outputs 'Meow.'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$cat</span><span class="pl-k">-&gt;</span>speak(<span class="pl-c1">true</span>); <span class="pl-c">// outputs 'Cower in fear, mortal.'</span></span></pre></div>

<p>The <a href="#stub.forwards"><code>forwards()</code></a> method also supports advanced usage,
including the ability to add to, and/or remove from, the arguments passed on to
the original callable:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-s"><span class="pl-pds">'</span>implode<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>forwards(</span>
<span class="pl-s1">    [<span class="pl-s"><span class="pl-pds">'</span>, <span class="pl-pds">'</span></span>],    <span class="pl-c">// fixed arguments</span></span>
<span class="pl-s1">    <span class="pl-c1">false</span>,     <span class="pl-c">// prefix the "self" value?</span></span>
<span class="pl-s1">    <span class="pl-c1">true</span>,      <span class="pl-c">// suffix the arguments object?</span></span>
<span class="pl-s1">    <span class="pl-c1">false</span>      <span class="pl-c">// suffix the arguments normally?</span></span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'x, y, z'</span></span></pre></div>

<p>Arguments passed by reference are also supported:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$d</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>) {</span>
<span class="pl-s1">        <span class="pl-c1">list</span>(<span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>, <span class="pl-smi">$c</span>, <span class="pl-smi">$d</span>) <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>forwards([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>], <span class="pl-c1">false</span>, <span class="pl-c1">false</span>, <span class="pl-c1">true</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c">// outputs 'a'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$b</span>; <span class="pl-c">// outputs 'b'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$c</span>; <span class="pl-c">// outputs 'c'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$d</span>; <span class="pl-c">// outputs 'd'</span></span></pre></div>

<h3>
<a id="answers-that-perform-multiple-actions" class="anchor" href="#answers-that-perform-multiple-actions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Answers that perform multiple actions</h3>

<p>Stubs can perform multiple actions as part of a single answer. This allows
callables that have side effects other than return values or exceptions to be
emulated.</p>

<p>The most familiar of these side effects is probably the modification of
passed-by-reference arguments, and the invocation of other callables, such as in
an event emitter implementation.</p>

<h4>
<a id="setting-passed-by-reference-arguments" class="anchor" href="#setting-passed-by-reference-arguments" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setting passed-by-reference arguments</h4>

<p>To set a reference argument as part of an answer, use
<a href="#stub.setsArgument"><code>setsArgument()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>) {})</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-c1">0</span>, <span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)  <span class="pl-c">// sets the first argument to 'x'</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-c1">1</span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)  <span class="pl-c">// sets the second argument to 'y'</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-k">-</span><span class="pl-c1">1</span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>) <span class="pl-c">// sets the last argument to 'z'</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c">// outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$b</span>; <span class="pl-c">// outputs 'y'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$c</span>; <span class="pl-c">// outputs 'z'</span></span></pre></div>

<p>If only one argument is passed to <a href="#stub.setsArgument"><code>setsArgument()</code></a>, it
sets the first argument:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>) {})</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>) <span class="pl-c">// sets the first argument to 'x'</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c">// outputs 'x'</span></span></pre></div>

<p>If <a href="#stub.setsArgument"><code>setsArgument()</code></a> is called without any arguments, it
sets the first argument to <code>null</code>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>) {})</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument() <span class="pl-c">// sets the first argument to `null`</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">gettype</span>(<span class="pl-smi">$a</span>); <span class="pl-c">// outputs 'NULL'</span></span></pre></div>

<h4>
<a id="invoking-arguments" class="anchor" href="#invoking-arguments" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Invoking arguments</h4>

<p>To invoke an argument as part of an answer, use
<a href="#stub.callsArgument"><code>callsArgument()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgument()   <span class="pl-c">// calls the first argument</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgument(<span class="pl-c1">1</span>)  <span class="pl-c">// calls the second argument</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgument(<span class="pl-k">-</span><span class="pl-c1">1</span>) <span class="pl-c">// calls the last argument</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$x</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"><span class="pl-smi">$y</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"><span class="pl-smi">$z</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">stub</span>(<span class="pl-smi">$x</span>, <span class="pl-smi">$y</span>, <span class="pl-smi">$z</span>); <span class="pl-c">// outputs 'xyz'</span></span></pre></div>

<p>There is also a more powerful version of
<a href="#stub.callsArgument"><code>callsArgument()</code></a>, named
<a href="#stub.callsArgumentWith"><code>callsArgumentWith()</code></a>, that allows more control over
which arguments are passed to the callable, and how they are passed:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgumentWith(</span>
<span class="pl-s1">        <span class="pl-c1">1</span>,              <span class="pl-c">// argument to invoke</span></span>
<span class="pl-s1">        [<span class="pl-s"><span class="pl-pds">'</span>%s, %s, %s<span class="pl-pds">'</span></span>], <span class="pl-c">// fixed arguments</span></span>
<span class="pl-s1">        <span class="pl-c1">false</span>,          <span class="pl-c">// prefix the "self" value?</span></span>
<span class="pl-s1">        <span class="pl-c1">true</span>,           <span class="pl-c">// suffix the arguments object?</span></span>
<span class="pl-s1">        <span class="pl-c1">false</span>           <span class="pl-c">// suffix the arguments normally?</span></span>
<span class="pl-s1">    )</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>printf<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'x, printf, y'</span></span></pre></div>

<p>The <a href="#stub.callsArgumentWith"><code>callsArgumentWith()</code></a> method also supports
arguments passed by reference:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$d</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>callsArgumentWith(</span>
<span class="pl-s1">    <span class="pl-k">-</span><span class="pl-c1">1</span>,</span>
<span class="pl-s1">    [<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>],</span>
<span class="pl-s1">    <span class="pl-c1">false</span>,</span>
<span class="pl-s1">    <span class="pl-c1">false</span>,</span>
<span class="pl-s1">    <span class="pl-c1">true</span></span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$callback</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">list</span>(<span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>, <span class="pl-smi">$c</span>, <span class="pl-smi">$d</span>) <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">};</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>, <span class="pl-smi">$callback</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c">// outputs 'a'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$b</span>; <span class="pl-c">// outputs 'b'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$c</span>; <span class="pl-c">// outputs 'c'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$d</span>; <span class="pl-c">// outputs 'd'</span></span></pre></div>

<h4>
<a id="invoking-callables" class="anchor" href="#invoking-callables" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Invoking callables</h4>

<p>To invoke a callable as part of an answer, use <a href="#stub.calls"><code>calls()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>calls(<span class="pl-s"><span class="pl-pds">'</span>printf<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>%s, %s<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'a, b'</span></span></pre></div>

<p>Calling <a href="#stub.calls"><code>calls()</code></a> with multiple arguments is equivalent to
calling it once with each argument. For example, the two following stubs behave
the same:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$x</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"><span class="pl-smi">$y</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$x</span>, <span class="pl-smi">$y</span>)<span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">stubA</span>(); <span class="pl-c">// outputs 'xy'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$x</span>)<span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$y</span>)<span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">stubB</span>(); <span class="pl-c">// outputs 'xy'</span></span></pre></div>

<p>There is also a more powerful version of <a href="#stub.calls"><code>calls()</code></a>, named
<a href="#stub.callsWith"><code>callsWith()</code></a>, that allows more control over which arguments
are passed to the callable, and how they are passed:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsWith(</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>printf<span class="pl-pds">'</span></span>,   <span class="pl-c">// argument to invoke</span></span>
<span class="pl-s1">        [<span class="pl-s"><span class="pl-pds">'</span>%s, %s<span class="pl-pds">'</span></span>], <span class="pl-c">// fixed arguments</span></span>
<span class="pl-s1">        <span class="pl-c1">false</span>,      <span class="pl-c">// prefix the "self" value?</span></span>
<span class="pl-s1">        <span class="pl-c1">false</span>,      <span class="pl-c">// suffix the arguments object?</span></span>
<span class="pl-s1">        <span class="pl-c1">true</span>        <span class="pl-c">// suffix the arguments normally?</span></span>
<span class="pl-s1">    )</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>); <span class="pl-c">// outputs 'x, y'</span></span></pre></div>

<p>The <a href="#stub.callsWith"><code>callsWith()</code></a> method also supports arguments passed by
reference:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$d</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>callsWith(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>) {</span>
<span class="pl-s1">        <span class="pl-c1">list</span>(<span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>, <span class="pl-smi">$c</span>, <span class="pl-smi">$d</span>) <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">    },</span>
<span class="pl-s1">    [<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>],</span>
<span class="pl-s1">    <span class="pl-c1">false</span>,</span>
<span class="pl-s1">    <span class="pl-c1">false</span>,</span>
<span class="pl-s1">    <span class="pl-c1">true</span></span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c">// outputs 'a'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$b</span>; <span class="pl-c">// outputs 'b'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$c</span>; <span class="pl-c">// outputs 'c'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$d</span>; <span class="pl-c">// outputs 'd'</span></span></pre></div>

<h3>
<a id="stubbing-generators" class="anchor" href="#stubbing-generators" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Stubbing generators</h3>

<p>To return a <a href="http://php.net/language.generators.overview">generator</a> from a stub, use <a href="#stub.generates"><code>generates()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub();</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>generates();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>();</span>
<span class="pl-s1"><span class="pl-smi">$values</span> <span class="pl-k">=</span> <span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c">// consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generator</span> <span class="pl-k">instanceof</span> <span class="pl-c1">Generator</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c">// outputs 'true'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">json_encode</span>(<span class="pl-smi">$values</span>);                               <span class="pl-c">// outputs '[]'</span></span></pre></div>

<p>The result of <a href="#stub.generates"><code>generates()</code></a> is a <a href="#the-generator-answer-api">generator answer</a>. This
object can be used to further customize the behavior of the generator. See the
subsequent headings for details of these customizations.</p>

<p>Certain methods, such as <a href="#generatorAnswer.returns"><code>returns()</code></a>, or
<a href="#generatorAnswer.throws"><code>throws()</code></a>, mark the "end" of generator answer. When
a generator answer is "ended", the original stub is returned, allowing continued
stubbing in a fluent manner:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates()     <span class="pl-c">// returns a generator</span></span>
<span class="pl-s1">        <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">        <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">        <span class="pl-k">-&gt;</span>returns()   <span class="pl-c">// ends the generator</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>)    <span class="pl-c">// returns a normal value</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates()     <span class="pl-c">// returns another generator</span></span>
<span class="pl-s1">        <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">        <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>e<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">        <span class="pl-k">-&gt;</span>throws();   <span class="pl-c">// ends the generator by throwing</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$resultA</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>();</span>
<span class="pl-s1"><span class="pl-smi">$resultB</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>();</span>
<span class="pl-s1"><span class="pl-smi">$resultC</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$resultA</span> <span class="pl-k">instanceof</span> <span class="pl-c1">Generator</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c">// outputs 'true'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$resultB</span> <span class="pl-k">instanceof</span> <span class="pl-c1">Generator</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c">// outputs 'false'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$resultC</span> <span class="pl-k">instanceof</span> <span class="pl-c1">Generator</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c">// outputs 'true'</span></span></pre></div>

<h4>
<a id="yielding-from-a-generator" class="anchor" href="#yielding-from-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Yielding from a generator</h4>

<p>Keys and values to be yielded can be passed directly to
<a href="#stub.generates"><code>generates()</code></a> as any traversable value:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates([<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>])<span class="pl-k">-&gt;</span>returns()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates([<span class="pl-s"><span class="pl-pds">'</span>e<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>f<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>g<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>h<span class="pl-pds">'</span></span>])<span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generatorA</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>();</span>
<span class="pl-s1"><span class="pl-smi">$generatorB</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$valuesA</span> <span class="pl-k">=</span> <span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorA</span>); <span class="pl-c">// consume the generator</span></span>
<span class="pl-s1"><span class="pl-smi">$valuesB</span> <span class="pl-k">=</span> <span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorB</span>); <span class="pl-c">// consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">json_encode</span>(<span class="pl-smi">$valuesA</span>); <span class="pl-c">// outputs '["a","b","c","d"]'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">json_encode</span>(<span class="pl-smi">$valuesB</span>); <span class="pl-c">// outputs '{"e":"f","g":"h"}'</span></span></pre></div>

<h5>
<a id="yielding-individual-values-from-a-generator" class="anchor" href="#yielding-individual-values-from-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Yielding individual values from a generator</h5>

<p>For more complicated generator behavior stubbing,
<a href="#generatorAnswer.yields"><code>yields()</code></a> can be used to interleave yields with
other actions:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$count</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>;</span>
<span class="pl-s1"><span class="pl-smi">$callback</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () <span class="pl-k">use</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$count</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Called %d time(s)<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, <span class="pl-k">++</span><span class="pl-smi">$count</span>);</span>
<span class="pl-s1">};</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$argument</span>) {});</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$callback</span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$callback</span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">foreach</span> ($<span class="pl-smi">stub</span>() <span class="pl-k">as</span> <span class="pl-smi">$value</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Value: %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, <span class="pl-smi">$value</span>);</span>
<span class="pl-s1">}</span></pre></div>

<p>The above example outputs:</p>

<pre><code>Called 1 time(s)
Value: a
Called 2 time(s)
Value: b
</code></pre>

<p>If <a href="#generatorAnswer.yields"><code>yields()</code></a> is called with 2 arguments, they are
treated as key and value respectively. When called with 1 argument, the argument
is treated as the value to yield. When called with no arguments, the generator
will yield with no value:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$values</span> <span class="pl-k">=</span> <span class="pl-c1">iterator_to_array</span>($<span class="pl-smi">stub</span>()); <span class="pl-c">// consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">json_encode</span>(<span class="pl-smi">$values</span>); <span class="pl-c">// outputs '{"a":"b","0":"c","1":null}'</span></span></pre></div>

<h5>
<a id="yielding-multiple-values-from-a-generator" class="anchor" href="#yielding-multiple-values-from-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Yielding multiple values from a generator</h5>

<p>To yield a set of values from an array, an iterator, or another generator, use
<a href="#generatorAnswer.yieldsFrom"><code>yieldsFrom()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yieldsFrom([<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>])</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yieldsFrom([<span class="pl-s"><span class="pl-pds">'</span>e<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>f<span class="pl-pds">'</span></span>])</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$values</span> <span class="pl-k">=</span> <span class="pl-c1">iterator_to_array</span>($<span class="pl-smi">stub</span>()); <span class="pl-c">// consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">json_encode</span>(<span class="pl-smi">$values</span>); <span class="pl-c">// outputs '{"a":"b","c":"d","e":"f"}'</span></span></pre></div>

<p>Calling <a href="#stub.generates"><code>generates()</code></a> with multiple sets of values creates
multiple answers that yield the supplied values on subsequent invocations. The
returned <a href="#the-generator-answer-api">generator answer</a> will allow customization of the final answer only.
For example, the two following stubs behave the same:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates([<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>], [<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>])</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>e<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">json_encode</span>(<span class="pl-c1">iterator_to_array</span>($<span class="pl-smi">stubA</span>())); <span class="pl-c">// outputs '["a","b"]'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">json_encode</span>(<span class="pl-c1">iterator_to_array</span>($<span class="pl-smi">stubA</span>())); <span class="pl-c">// outputs '["c","d","e"]'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates([<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>])</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates([<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>])</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>e<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">json_encode</span>(<span class="pl-c1">iterator_to_array</span>($<span class="pl-smi">stubB</span>())); <span class="pl-c">// outputs '["a","b"]'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">json_encode</span>(<span class="pl-c1">iterator_to_array</span>($<span class="pl-smi">stubB</span>())); <span class="pl-c">// outputs '["c","d","e"]'</span></span></pre></div>

<h4>
<a id="returning-values-from-a-generator" class="anchor" href="#returning-values-from-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Returning values from a generator</h4>

<p>To return a value from a generator, use <a href="#generatorAnswer.returns"><code>returns()</code></a>
on any <a href="#the-generator-answer-api">generator answer</a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>();</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c">// consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>getReturn(); <span class="pl-c">// outputs 'a'</span></span></pre></div>

<p>Calling <a href="#generatorAnswer.returns"><code>returns()</code></a> with multiple arguments allows
for easy specification of the generator return value on subsequent invocations.
For example, the two following stubs behave the same:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generatorA</span> <span class="pl-k">=</span> $<span class="pl-smi">stubA</span>();</span>
<span class="pl-s1"><span class="pl-smi">$generatorB</span> <span class="pl-k">=</span> $<span class="pl-smi">stubA</span>();</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorA</span>);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorB</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generatorA</span><span class="pl-k">-&gt;</span>getReturn(); <span class="pl-c">// outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generatorB</span><span class="pl-k">-&gt;</span>getReturn(); <span class="pl-c">// outputs 'y'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generatorA</span> <span class="pl-k">=</span> $<span class="pl-smi">stubB</span>();</span>
<span class="pl-s1"><span class="pl-smi">$generatorB</span> <span class="pl-k">=</span> $<span class="pl-smi">stubB</span>();</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorA</span>);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorB</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generatorA</span><span class="pl-k">-&gt;</span>getReturn(); <span class="pl-c">// outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generatorB</span><span class="pl-k">-&gt;</span>getReturn(); <span class="pl-c">// outputs 'y'</span></span></pre></div>

<p>Note that attempting to return anything other than <code>null</code> will result in an
exception unless the current runtime supports generator return expressions. For
older runtimes, it is perfectly valid to call
<a href="#generatorAnswer.returns"><code>returns()</code></a> with no arguments in order to end the
generator:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>returns();</span></pre></div>

<h4>
<a id="returning-arguments-from-a-generator" class="anchor" href="#returning-arguments-from-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Returning arguments from a generator</h4>

<p>To return an argument from a generator, use
<a href="#generatorAnswer.returnsArgument"><code>returnsArgument()</code></a> on any
<a href="#the-generator-answer-api">generator answer</a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>returnsArgument();   <span class="pl-c">// returns the first argument</span></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>returnsArgument(<span class="pl-c1">1</span>);  <span class="pl-c">// returns the second argument</span></span>
<span class="pl-s1"><span class="pl-smi">$stubC</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>returnsArgument(<span class="pl-k">-</span><span class="pl-c1">1</span>); <span class="pl-c">// returns the last argument</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generatorA</span> <span class="pl-k">=</span> $<span class="pl-smi">stubA</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$generatorB</span> <span class="pl-k">=</span> $<span class="pl-smi">stubB</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$generatorC</span> <span class="pl-k">=</span> $<span class="pl-smi">stubC</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorA</span>); <span class="pl-c">// consume the generator</span></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorB</span>); <span class="pl-c">// consume the generator</span></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorC</span>); <span class="pl-c">// consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generatorA</span><span class="pl-k">-&gt;</span>getReturn(); <span class="pl-c">// outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generatorB</span><span class="pl-k">-&gt;</span>getReturn(); <span class="pl-c">// outputs 'y'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generatorC</span><span class="pl-k">-&gt;</span>getReturn(); <span class="pl-c">// outputs 'z'</span></span></pre></div>

<h4>
<a id="returning-the-self-value-from-a-generator" class="anchor" href="#returning-the-self-value-from-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Returning the "self" value from a generator</h4>

<p>The stub <a href="#stub-self-values">self value</a> can be returned from a generator by using
<a href="#generatorAnswer.returnsSelf"><code>returnsSelf()</code></a> on any <a href="#the-generator-answer-api">generator answer</a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock();</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>returnsSelf();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c">// consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>getReturn() <span class="pl-k">===</span> <span class="pl-smi">$mock</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c">// outputs 'true'</span></span></pre></div>

<h4>
<a id="throwing-exceptions-from-a-generator" class="anchor" href="#throwing-exceptions-from-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Throwing exceptions from a generator</h4>

<p>To throw an exception from a generator, use
<a href="#generatorAnswer.throws"><code>throws()</code></a> on any <a href="#the-generator-answer-api">generator answer</a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$exception</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>You done goofed.<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>throws(<span class="pl-smi">$exception</span>);</span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>throws();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generatorA</span> <span class="pl-k">=</span> $<span class="pl-smi">stubA</span>();</span>
<span class="pl-s1"><span class="pl-smi">$generatorB</span> <span class="pl-k">=</span> $<span class="pl-smi">stubB</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorA</span>); <span class="pl-c">// throws $exception</span></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorB</span>); <span class="pl-c">// throws a generic exception</span></span></pre></div>

<p>Calling <a href="#generatorAnswer.throws"><code>throws()</code></a> with multiple arguments allows for
easy specification of the thrown exception on subsequent invocations. For
example, the two following stubs behave the same:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$exceptionA</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>You done goofed.<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$exceptionB</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>Consequences will never be the same.<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>throws(<span class="pl-smi">$exceptionA</span>, <span class="pl-smi">$exceptionB</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generatorA</span> <span class="pl-k">=</span> $<span class="pl-smi">stubA</span>();</span>
<span class="pl-s1"><span class="pl-smi">$generatorB</span> <span class="pl-k">=</span> $<span class="pl-smi">stubA</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorA</span>); <span class="pl-c">// throws $exceptionA</span></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorB</span>); <span class="pl-c">// throws $exceptionB</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>throws(<span class="pl-smi">$exceptionA</span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>throws(<span class="pl-smi">$exceptionB</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generatorA</span> <span class="pl-k">=</span> $<span class="pl-smi">stubB</span>();</span>
<span class="pl-s1"><span class="pl-smi">$generatorB</span> <span class="pl-k">=</span> $<span class="pl-smi">stubB</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorA</span>); <span class="pl-c">// throws $exceptionA</span></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorB</span>); <span class="pl-c">// throws $exceptionB</span></span></pre></div>

<h4>
<a id="generator-iterations-that-perform-multiple-actions" class="anchor" href="#generator-iterations-that-perform-multiple-actions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Generator iterations that perform multiple actions</h4>

<p>Stubbed generators can perform multiple actions as part of a single iteration.
This allows side effects other than yielded values to be emulated.</p>

<p>The most familiar of these side effects is probably the modification of
passed-by-reference arguments, and the invocation of other callables.</p>

<h5>
<a id="setting-passed-by-reference-arguments-in-a-generator" class="anchor" href="#setting-passed-by-reference-arguments-in-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setting passed-by-reference arguments in a generator</h5>

<p>To set a reference argument as part of a generator, use
<a href="#generatorAnswer.setsArgument"><code>setsArgument()</code></a> on any <a href="#the-generator-answer-api">generator answer</a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>) {})<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-c1">0</span>, <span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)  <span class="pl-c">// sets the first argument to 'x'</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-c1">1</span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)  <span class="pl-c">// sets the second argument to 'y'</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-k">-</span><span class="pl-c1">1</span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>) <span class="pl-c">// sets the last argument to 'z'</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>]);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c">// consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c">// outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$b</span>; <span class="pl-c">// outputs 'y'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$c</span>; <span class="pl-c">// outputs 'z'</span></span></pre></div>

<p>If only one argument is passed to
<a href="#generatorAnswer.setsArgument"><code>setsArgument()</code></a>, it sets the first argument:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>) {})<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>) <span class="pl-c">// sets the first argument to 'x'</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>]);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c">// consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c">// outputs 'x'</span></span></pre></div>

<p>If <a href="#generatorAnswer.setsArgument"><code>setsArgument()</code></a> is called without any
arguments, it sets the first argument to <code>null</code>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>) {})<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument() <span class="pl-c">// sets the first argument to `null`</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>]);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c">// consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">gettype</span>(<span class="pl-smi">$a</span>); <span class="pl-c">// outputs 'NULL'</span></span></pre></div>

<p>Setting of arguments can be configured to occur in between yields:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>) {})<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>) <span class="pl-c">// first iteration starts</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)       <span class="pl-c">// first iteration ends</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>) <span class="pl-c">// second iteration starts</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)       <span class="pl-c">// second iteration ends</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">foreach</span> (<span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>]) <span class="pl-k">as</span> <span class="pl-smi">$value</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>%s, %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, <span class="pl-smi">$value</span>, <span class="pl-smi">$a</span>);</span>
<span class="pl-s1">}</span></pre></div>

<p>The above example outputs:</p>

<pre><code>a, x
b, y
</code></pre>

<h5>
<a id="invoking-arguments-in-a-generator" class="anchor" href="#invoking-arguments-in-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Invoking arguments in a generator</h5>

<p>To invoke an argument as part of a generator, use
<a href="#generatorAnswer.callsArgument"><code>callsArgument()</code></a> on any <a href="#the-generator-answer-api">generator answer</a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgument()   <span class="pl-c">// calls the first argument</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgument(<span class="pl-c1">1</span>)  <span class="pl-c">// calls the second argument</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgument(<span class="pl-k">-</span><span class="pl-c1">1</span>) <span class="pl-c">// calls the last argument</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$x</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"><span class="pl-smi">$y</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"><span class="pl-smi">$z</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>(<span class="pl-smi">$x</span>, <span class="pl-smi">$y</span>, <span class="pl-smi">$z</span>);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c">// outputs 'xyz'</span></span></pre></div>

<p>There is also a more powerful version of
<a href="#generatorAnswer.callsArgument"><code>callsArgument()</code></a>, named
<a href="#generatorAnswer.callsArgumentWith"><code>callsArgumentWith()</code></a>, that allows more
control over which arguments are passed to the callable, and how they are
passed:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgumentWith(</span>
<span class="pl-s1">        <span class="pl-c1">1</span>,              <span class="pl-c">// argument to invoke</span></span>
<span class="pl-s1">        [<span class="pl-s"><span class="pl-pds">'</span>%s, %s, %s<span class="pl-pds">'</span></span>], <span class="pl-c">// fixed arguments</span></span>
<span class="pl-s1">        <span class="pl-c1">false</span>,          <span class="pl-c">// prefix the "self" value?</span></span>
<span class="pl-s1">        <span class="pl-c1">true</span>,           <span class="pl-c">// suffix the arguments object?</span></span>
<span class="pl-s1">        <span class="pl-c1">false</span>           <span class="pl-c">// suffix the arguments normally?</span></span>
<span class="pl-s1">    )</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>printf<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c">// outputs 'x, printf, y'</span></span></pre></div>

<p>The <a href="#generatorAnswer.callsArgumentWith"><code>callsArgumentWith()</code></a> method also
supports arguments passed by reference:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$d</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgumentWith(</span>
<span class="pl-s1">        <span class="pl-k">-</span><span class="pl-c1">1</span>,</span>
<span class="pl-s1">        [<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>],</span>
<span class="pl-s1">        <span class="pl-c1">false</span>,</span>
<span class="pl-s1">        <span class="pl-c1">false</span>,</span>
<span class="pl-s1">        <span class="pl-c1">true</span></span>
<span class="pl-s1">    )</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$callback</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">list</span>(<span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>, <span class="pl-smi">$c</span>, <span class="pl-smi">$d</span>) <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">};</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>, <span class="pl-smi">$callback</span>]);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c">// consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c">// outputs 'a'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$b</span>; <span class="pl-c">// outputs 'b'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$c</span>; <span class="pl-c">// outputs 'c'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$d</span>; <span class="pl-c">// outputs 'd'</span></span></pre></div>

<p>Calling of arguments can be configured to occur in between yields:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$count</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>;</span>
<span class="pl-s1"><span class="pl-smi">$callback</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () <span class="pl-k">use</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$count</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Called %d time(s)<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, <span class="pl-k">++</span><span class="pl-smi">$count</span>);</span>
<span class="pl-s1">};</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>) {})<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgument() <span class="pl-c">// first iteration starts</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)     <span class="pl-c">// first iteration ends</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgument() <span class="pl-c">// second iteration starts</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)     <span class="pl-c">// second iteration ends</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">foreach</span> ($<span class="pl-smi">stub</span>(<span class="pl-smi">$callback</span>) <span class="pl-k">as</span> <span class="pl-smi">$value</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Value: %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, <span class="pl-smi">$value</span>);</span>
<span class="pl-s1">}</span></pre></div>

<p>The above example outputs:</p>

<pre><code>Called 1 time(s)
Value: a
Called 2 time(s)
Value: b
</code></pre>

<h5>
<a id="invoking-callables-in-a-generator" class="anchor" href="#invoking-callables-in-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Invoking callables in a generator</h5>

<p>To invoke a callable as part of a generator, use
<a href="#generatorAnswer.calls"><code>calls()</code></a> on any <a href="#the-generator-answer-api">generator answer</a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>calls(<span class="pl-s"><span class="pl-pds">'</span>printf<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>%s, %s<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c">// outputs 'a, b'</span></span></pre></div>

<p>Calling <a href="#generatorAnswer.calls"><code>calls()</code></a> with multiple arguments is
equivalent to calling it once with each argument. For example, the two following
stubs behave the same:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$x</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"><span class="pl-smi">$y</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$x</span>, <span class="pl-smi">$y</span>)<span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> $<span class="pl-smi">stubA</span>();</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c">// outputs 'xy'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$x</span>)<span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$y</span>)<span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> $<span class="pl-smi">stubB</span>();</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c">// outputs 'xy'</span></span></pre></div>

<p>There is also a more powerful version of <a href="#generatorAnswer.calls"><code>calls()</code></a>,
named <a href="#generatorAnswer.callsWith"><code>callsWith()</code></a>, that allows more control over
which arguments are passed to the callable, and how they are passed:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsWith(</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>printf<span class="pl-pds">'</span></span>,   <span class="pl-c">// argument to invoke</span></span>
<span class="pl-s1">        [<span class="pl-s"><span class="pl-pds">'</span>%s, %s<span class="pl-pds">'</span></span>], <span class="pl-c">// fixed arguments</span></span>
<span class="pl-s1">        <span class="pl-c1">false</span>,      <span class="pl-c">// prefix the "self" value?</span></span>
<span class="pl-s1">        <span class="pl-c1">false</span>,      <span class="pl-c">// suffix the arguments object?</span></span>
<span class="pl-s1">        <span class="pl-c1">true</span>        <span class="pl-c">// suffix the arguments normally?</span></span>
<span class="pl-s1">    )</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c">// outputs 'x, y'</span></span></pre></div>

<p>The <a href="#generatorAnswer.callsWith"><code>callsWith()</code></a> method also supports arguments
passed by reference:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$d</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsWith(</span>
<span class="pl-s1">        <span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>) {</span>
<span class="pl-s1">            <span class="pl-c1">list</span>(<span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>, <span class="pl-smi">$c</span>, <span class="pl-smi">$d</span>) <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">        },</span>
<span class="pl-s1">        [<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>],</span>
<span class="pl-s1">        <span class="pl-c1">false</span>,</span>
<span class="pl-s1">        <span class="pl-c1">false</span>,</span>
<span class="pl-s1">        <span class="pl-c1">true</span></span>
<span class="pl-s1">    )</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>])</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c">// consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c">// outputs 'a'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$b</span>; <span class="pl-c">// outputs 'b'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$c</span>; <span class="pl-c">// outputs 'c'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$d</span>; <span class="pl-c">// outputs 'd'</span></span></pre></div>

<p>Calling of callables can be configured to occur in between yields:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$count</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>;</span>
<span class="pl-s1"><span class="pl-smi">$callback</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () <span class="pl-k">use</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$count</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Called %d time(s)<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, <span class="pl-k">++</span><span class="pl-smi">$count</span>);</span>
<span class="pl-s1">};</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>) {})<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$callback</span>) <span class="pl-c">// first iteration starts</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)      <span class="pl-c">// first iteration ends</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$callback</span>) <span class="pl-c">// second iteration starts</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)      <span class="pl-c">// second iteration ends</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">foreach</span> ($<span class="pl-smi">stub</span>(<span class="pl-smi">$callback</span>) <span class="pl-k">as</span> <span class="pl-smi">$value</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Value: %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, <span class="pl-smi">$value</span>);</span>
<span class="pl-s1">}</span></pre></div>

<p>The above example outputs:</p>

<pre><code>Called 1 time(s)
Value: a
Called 2 time(s)
Value: b
</code></pre>

<h2>
<a id="spies" class="anchor" href="#spies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Spies</h2>

<p><em>Spies</em> record interactions with callable entities, such as functions, methods,
closures, and objects with an <a href="http://php.net/language.oop5.magic#object.invoke"><code>__invoke()</code></a> method. They can be used to verify
both the <em>input</em>, and <em>output</em> of function calls.</p>

<p>Most of the methods in the spy API are mirrored in <a href="#the-call-api">the call API</a>.</p>

<h3>
<a id="the-spy-api" class="anchor" href="#the-spy-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The spy API</h3>

<p><a name="facade.spy"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-spy-api">spy</a></em> <a href="#facade.spy"><strong>spy</strong></a>($callback = null) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-spy-api">spy</a></em> x\<a href="#facade.spy"><strong>spy</strong></a>($callback = null) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-spy-api">spy</a></em> Phony::<a href="#facade.spy"><strong>spy</strong></a>($callback = null) <em>(static)</em></p>
</blockquote>

<p>Create a new <a href="#spies">spy</a>.</p>

<p><em>See <a href="#spying-on-an-existing-callable">Spying on an existing callable</a>, <a href="#anonymous-spies">Anonymous spies</a>.</em></p>

<p><a name="spy.invoke"></a>
<a name="spy.__invoke"></a></p>

<hr>

<blockquote>
<p><em>mixed</em> $spy-&gt;<a href="#spy.invoke"><strong>invoke</strong></a>(...$arguments) or
<a href="#spy.__invoke"><strong>$spy(...$arguments)</strong></a>
throws <a href="http://php.net/class.exception">Exception</a>, <a href="http://php.net/class.error">Error</a></p>
</blockquote>

<p>Invoke the spy, record the call, and return or throw the result.</p>

<p><em>This method does not support reference parameters.</em></p>

<p><em>See <a href="#invoking-spies">Invoking spies</a>.</em></p>

<p><a name="spy.invokeWith"></a></p>

<hr>

<blockquote>
<p><em>mixed</em> $spy-&gt;<a href="#spy.invokeWith"><strong>invokeWith</strong></a>($arguments)
throws <a href="http://php.net/class.exception">Exception</a>, <a href="http://php.net/class.error">Error</a></p>
</blockquote>

<p>Invoke the spy, record the call, and return or throw the result.</p>

<p><em>This method supports reference parameters.</em></p>

<p><em>See <a href="#invoking-spies">Invoking spies</a>.</em></p>

<p><a name="spy.label"></a></p>

<hr>

<blockquote>
<p><em>string|null</em> $spy-&gt;<a href="#spy.label"><strong>label</strong></a>()</p>
</blockquote>

<p>Get the <a href="#labeling-spies">label</a>.</p>

<p><a name="spy.setLabel"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.setLabel"><strong>setLabel</strong></a>($label)</p>
</blockquote>

<p>Set the <a href="#labeling-spies">label</a>.</p>

<p><a name="spy.useGeneratorSpies"></a></p>

<hr>

<blockquote>
<p><em>boolean</em> $spy-&gt;<a href="#spy.useGeneratorSpies"><strong>useGeneratorSpies</strong></a>()</p>
</blockquote>

<p>Returns <code>true</code> if this spy uses <a href="#verifying-spies-with-generators-or-traversables">generator spies</a>.</p>

<p><a name="spy.setUseGeneratorSpies"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.setUseGeneratorSpies"><strong>setUseGeneratorSpies</strong></a>($useGeneratorSpies)</p>
</blockquote>

<p>Turn on or off the use of <a href="#verifying-spies-with-generators-or-traversables">generator spies</a>.</p>

<p><a name="spy.useTraversableSpies"></a></p>

<hr>

<blockquote>
<p><em>boolean</em> $spy-&gt;<a href="#spy.useTraversableSpies"><strong>useTraversableSpies</strong></a>()</p>
</blockquote>

<p>Returns <code>true</code> if this spy uses <a href="#verifying-spies-with-generators-or-traversables">traversable spies</a>.</p>

<p><a name="spy.setUseTraversableSpies"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.setUseTraversableSpies"><strong>setUseTraversableSpies</strong></a>($useTraversableSpies)</p>
</blockquote>

<p>Turn on or off the use of <a href="#verifying-spies-with-generators-or-traversables">traversable spies</a>.</p>

<p><a name="spy.stopRecording"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.stopRecording"><strong>stopRecording</strong></a>()</p>
</blockquote>

<p>Stop recording calls.</p>

<p><em>See <a href="#pausing-spy-recording">Pausing spy recording</a>.</em></p>

<p><a name="spy.startRecording"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.startRecording"><strong>startRecording</strong></a>()</p>
</blockquote>

<p>Start recording calls.</p>

<p><em>See <a href="#pausing-spy-recording">Pausing spy recording</a>.</em></p>

<p><a name="spy.arguments"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-arguments-api">arguments</a></em> $spy-&gt;<a href="#spy.arguments"><strong>arguments</strong></a>()
throws <a href="#undefinedcallexception">UndefinedCallException</a></p>
</blockquote>

<p>Get the arguments of the first call.</p>

<p><a name="spy.argument"></a></p>

<hr>

<blockquote>
<p><em>mixed</em> $spy-&gt;<a href="#spy.argument"><strong>argument</strong></a>($index = 0)
throws <a href="#undefinedcallexception">UndefinedCallException</a>, <a href="#undefinedargumentexception">UndefinedArgumentException</a></p>
</blockquote>

<p>Get the argument of the first call at <code>$index</code>.</p>

<p><a name="spy.hasCalls"></a></p>

<hr>

<blockquote>
<p><em>boolean</em> $spy-&gt;<a href="#spy.hasCalls"><strong>hasCalls</strong></a>()</p>
</blockquote>

<p>Returns <code>true</code> if any calls were recorded.</p>

<p><a name="spy.callCount"></a></p>

<hr>

<blockquote>
<p><em>integer</em> $spy-&gt;<a href="#spy.callCount"><strong>callCount</strong></a>()</p>
</blockquote>

<p>Get the number of calls.</p>

<p><a name="spy.allCalls"></a></p>

<hr>

<blockquote>
<p><em>array&lt;<a href="#the-call-api">call</a>&gt;</em> $spy-&gt;<a href="#spy.allCalls"><strong>allCalls</strong></a>()</p>
</blockquote>

<p>Get all calls as an array.</p>

<p><a name="spy.firstCall"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-call-api">call</a></em> $spy-&gt;<a href="#spy.firstCall"><strong>firstCall</strong></a>()
throws <a href="#undefinedcallexception">UndefinedCallException</a></p>
</blockquote>

<p>Get the first call.</p>

<p><a name="spy.lastCall"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-call-api">call</a></em> $spy-&gt;<a href="#spy.lastCall"><strong>lastCall</strong></a>()
throws <a href="#undefinedcallexception">UndefinedCallException</a></p>
</blockquote>

<p>Get the last call.</p>

<p><a name="spy.callAt"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-call-api">call</a></em> $spy-&gt;<a href="#spy.callAt"><strong>callAt</strong></a>($index = 0)
throws <a href="#undefinedcallexception">UndefinedCallException</a></p>
</blockquote>

<p>Get the call at <code>$index</code>.</p>

<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>

<p><a name="spy.hasEvents"></a></p>

<hr>

<blockquote>
<p><em>boolean</em> $spy-&gt;<a href="#spy.hasEvents"><strong>hasEvents</strong></a>()</p>
</blockquote>

<p>Returns <code>true</code> if any events were recorded.</p>

<p><a name="spy.eventCount"></a></p>

<hr>

<blockquote>
<p><em>integer</em> $spy-&gt;<a href="#spy.eventCount"><strong>eventCount</strong></a>()</p>
</blockquote>

<p>Get the number of events.</p>

<p><a name="spy.allEvents"></a></p>

<hr>

<blockquote>
<p><em>array&lt;<a href="#the-event-api">event</a>&gt;</em> $spy-&gt;<a href="#spy.allEvents"><strong>allEvents</strong></a>()</p>
</blockquote>

<p>Get all events as an array.</p>

<p><a name="spy.firstEvent"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-event-api">event</a></em> $spy-&gt;<a href="#spy.firstEvent"><strong>firstEvent</strong></a>()
throws <a href="#undefinedeventexception">UndefinedEventException</a></p>
</blockquote>

<p>Get the first event.</p>

<p><a name="spy.lastEvent"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-event-api">event</a></em> $spy-&gt;<a href="#spy.lastEvent"><strong>lastEvent</strong></a>()
throws <a href="#undefinedeventexception">UndefinedEventException</a></p>
</blockquote>

<p>Get the last event.</p>

<p><a name="spy.eventAt"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-event-api">event</a></em> $spy-&gt;<a href="#spy.eventAt"><strong>eventAt</strong></a>($index = 0)
throws <a href="#undefinedeventexception">UndefinedEventException</a></p>
</blockquote>

<p>Get the event at <code>$index</code>.</p>

<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>

<p><a name="spy.called"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $spy-&gt;<a href="#spy.called"><strong>called</strong></a>()
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless called.</p>

<p><em>See <a href="#verifying-that-a-call-was-made">Verifying that a call was made</a>.</em></p>

<p><a name="spy.checkCalled"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $spy-&gt;<a href="#spy.checkCalled"><strong>checkCalled</strong></a>()</p>
</blockquote>

<p>Checks if called.</p>

<p><em>See <a href="#verifying-that-a-call-was-made">Verifying that a call was made</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="spy.calledWith"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $spy-&gt;<a href="#spy.calledWith"><strong>calledWith</strong></a>(...$arguments)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless called with the supplied arguments.</p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>. Any mock handles in
<code>$arguments</code> are equivalent to the mocks themselves.</em></p>

<p><em>See <a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a>.</em></p>

<p><a name="spy.checkCalledWith"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $spy-&gt;<a href="#spy.checkCalledWith"><strong>checkCalledWith</strong></a>(...$arguments)</p>
</blockquote>

<p>Checks if called with the supplied arguments.</p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>. Any mock handles in
<code>$arguments</code> are equivalent to the mocks themselves.</em></p>

<p><em>See <a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a>,
<a href="#check-verification">Check verification</a>.</em></p>

<p><a name="spy.calledOn"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $spy-&gt;<a href="#spy.calledOn"><strong>calledOn</strong></a>($value)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless the bound <code>$this</code> value is equal to the supplied
value.</p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-spy-closure-binding">Verifying spy closure binding</a>.</em></p>

<p><a name="spy.checkCalledOn"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $spy-&gt;<a href="#spy.checkCalledOn"><strong>checkCalledOn</strong></a>($value)</p>
</blockquote>

<p>Checks if the bound <code>$this</code> value is equal to the supplied value.</p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-spy-closure-binding">Verifying spy closure binding</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="spy.returned"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $spy-&gt;<a href="#spy.returned"><strong>returned</strong></a>($value = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless this spy returned the supplied value.</p>

<p><em>When called with no arguments, this method simply checks that the spy returned
any value.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-spy-return-values">Verifying spy return values</a>.</em></p>

<p><a name="spy.checkReturned"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $spy-&gt;<a href="#spy.checkReturned"><strong>checkReturned</strong></a>($value = null)</p>
</blockquote>

<p>Checks if this spy returned the supplied value.</p>

<p><em>When called with no arguments, this method simply checks that the spy returned
any value.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-spy-return-values">Verifying spy return values</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="spy.threw"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $spy-&gt;<a href="#spy.threw"><strong>threw</strong></a>($type = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless this spy threw an exception of the supplied type.</p>

<p><em>When called with no arguments, this method simply checks that the spy threw any
exception.</em></p>

<p><em>When called with a string, this method checks that the spy threw an exception
that is an instance of <code>$type</code>.</em></p>

<p><em>When called with an exception instance, this method checks that the spy threw
an exception that is equal to the supplied instance.</em></p>

<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the spy threw an
exception that matches the supplied matcher.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-spy-exceptions">Verifying spy exceptions</a>.</em></p>

<p><a name="spy.checkThrew"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $spy-&gt;<a href="#spy.checkThrew"><strong>checkThrew</strong></a>($type = null)</p>
</blockquote>

<p>Checks if an exception of the supplied type was thrown.</p>

<p><em>When called with no arguments, this method simply checks that the spy threw any
exception.</em></p>

<p><em>When called with a string, this method checks that the spy threw an exception
that is an instance of <code>$type</code>.</em></p>

<p><em>When called with an exception instance, this method checks that the spy threw
an exception that is equal to the supplied instance.</em></p>

<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the spy threw an
exception that matches the supplied matcher.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-spy-exceptions">Verifying spy exceptions</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="spy.produced"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $spy-&gt;<a href="#spy.produced"><strong>produced</strong></a>($keyOrValue = null, $value = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Checks if this spy produced the supplied values.</p>

<p><em>When called with no arguments, this method simply checks that the spy produced
any value.</em></p>

<p><em>With a single argument, it checks that a value matching the argument was
produced.</em></p>

<p><em>With two arguments, it checks that a key and value matching the respective
arguments were produced together.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> for both keys and values.</em></p>

<p><em>See <a href="#verifying-values-produced-by-spies">Verifying values produced by spies</a>.</em></p>

<p><a name="spy.checkProduced"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $spy-&gt;<a href="#spy.checkProduced"><strong>checkProduced</strong></a>($keyOrValue = null, $value = null)</p>
</blockquote>

<p>Checks if this spy produced the supplied values.</p>

<p><em>When called with no arguments, this method simply checks that the spy produced
any value.</em></p>

<p><em>With a single argument, it checks that a value matching the argument was
produced.</em></p>

<p><em>With two arguments, it checks that a key and value matching the respective
arguments were produced together.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> for both keys and values.</em></p>

<p><em>See <a href="#verifying-values-produced-by-spies">Verifying values produced by spies</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="spy.producedAll"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $spy-&gt;<a href="#spy.producedAll"><strong>producedAll</strong></a>(...$pairs)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless this spy produced all of the supplied key-value
pairs, in the supplied order, in a single call.</p>

<p><em>Each value in <code>$pairs</code> is equivalent to a set of arguments passed to
<a href="#spy.produced"><code>produced()</code></a>.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> for both keys and values.</em></p>

<p><em>See <a href="#verifying-values-produced-by-spies">Verifying values produced by spies</a>.</em></p>

<p><a name="spy.checkProducedAll"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $spy-&gt;<a href="#spy.checkProducedAll"><strong>checkProducedAll</strong></a>(...$pairs)</p>
</blockquote>

<p>Checks if this spy produced all of the supplied key-value pairs, in the supplied
order, in a single call.</p>

<p><em>Each value in <code>$pairs</code> is equivalent to a set of arguments passed to
<a href="#spy.checkProduced"><code>checkProduced()</code></a>.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> for both keys and values.</em></p>

<p><em>See <a href="#verifying-values-produced-by-spies">Verifying values produced by spies</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="spy.received"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $spy-&gt;<a href="#spy.received"><strong>received</strong></a>($value = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless this spy received the supplied value.</p>

<p><em>When called with no arguments, this method simply checks that the spy received
any value.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-values-received-by-spies">Verifying values received by spies</a>.</em></p>

<p><a name="spy.checkReceived"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $spy-&gt;<a href="#spy.checkReceived"><strong>checkReceived</strong></a>($value = null)</p>
</blockquote>

<p>Checks if this spy received the supplied value.</p>

<p><em>When called with no arguments, this method simply checks that the spy received
any value.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-values-received-by-spies">Verifying values received by spies</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="spy.receivedException"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $spy-&gt;<a href="#spy.receivedException"><strong>receivedException</strong></a>($type = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless this call received an exception of the supplied type.</p>

<p><em>When called with no arguments, this method simply checks that the spy received
any exception.</em></p>

<p><em>When called with a string, this method checks that the spy received an
exception that is an instance of <code>$type</code>.</em></p>

<p><em>When called with an exception instance, this method checks that the spy
received an exception that is equal to the supplied instance.</em></p>

<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the spy received an
exception that matches the supplied matcher.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-exceptions-received-by-spies">Verifying exceptions received by spies</a>.</em></p>

<p><a name="spy.checkReceivedException"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $spy-&gt;<a href="#spy.checkReceivedException"><strong>checkReceivedException</strong></a>($type = null)</p>
</blockquote>

<p>Checks if this spy received an exception of the supplied type.</p>

<p><em>When called with no arguments, this method simply checks that the spy received
any exception.</em></p>

<p><em>When called with a string, this method checks that the spy received an
exception that is an instance of <code>$type</code>.</em></p>

<p><em>When called with an exception instance, this method checks that the spy
received an exception that is equal to the supplied instance.</em></p>

<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the spy received an
exception that matches the supplied matcher.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-exceptions-received-by-spies">Verifying exceptions received by spies</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="spy.never"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.never"><strong>never</strong></a>()</p>
</blockquote>

<p>Requires that the next verification never matches.</p>

<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>

<p><a name="spy.once"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.once"><strong>once</strong></a>()</p>
</blockquote>

<p>Requires that the next verification matches only once.</p>

<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>

<p><a name="spy.twice"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.twice"><strong>twice</strong></a>()</p>
</blockquote>

<p>Requires that the next verification matches exactly two times.</p>

<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>

<p><a name="spy.thrice"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.thrice"><strong>thrice</strong></a>()</p>
</blockquote>

<p>Requires that the next verification matches exactly three times.</p>

<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>

<p><a name="spy.times"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.times"><strong>times</strong></a>($times)</p>
</blockquote>

<p>Requires that the next verification matches exactly <code>$times</code> times.</p>

<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>

<p><a name="spy.atLeast"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.atLeast"><strong>atLeast</strong></a>($minimum)</p>
</blockquote>

<p>Requires that the next verification matches a number of times greater than or
equal to <code>$minimum</code>.</p>

<p><em>See <a href="#verifying-that-a-spy-event-happened-a-bounded-number-of-times">Verifying that a spy event happened a bounded number of times</a>.</em></p>

<p><a name="spy.atMost"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.atMost"><strong>atMost</strong></a>($maximum)</p>
</blockquote>

<p>Requires that the next verification matches a number of times less than or equal
to <code>$maximum</code>.</p>

<p><em>See <a href="#verifying-that-a-spy-event-happened-a-bounded-number-of-times">Verifying that a spy event happened a bounded number of times</a>.</em></p>

<p><a name="spy.between"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.between"><strong>between</strong></a>($minimum, $maximum)</p>
</blockquote>

<p>Requires that the next verification matches a number of times greater than or
equal to <code>$minimum</code>, and less than or equal to <code>$maximum</code>.</p>

<p><em>See <a href="#verifying-that-a-spy-event-happened-a-bounded-number-of-times">Verifying that a spy event happened a bounded number of times</a>.</em></p>

<p><a name="spy.always"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.always"><strong>always</strong></a>()</p>
</blockquote>

<p>Requires that the next verification matches for all possible items.</p>

<p><em>See <a href="#verifying-that-all-spy-events-happen-the-same-way">Verifying that all spy events happen the same way</a>.</em></p>

<h3>
<a id="spying-on-an-existing-callable" class="anchor" href="#spying-on-an-existing-callable" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Spying on an existing callable</h3>

<p>Any callable can be wrapped in a spy, by passing the callable to
<a href="#facade.spy"><code>spy()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy(<span class="pl-smi">$callable</span>);        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>spy(<span class="pl-smi">$callable</span>);      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>spy(<span class="pl-smi">$callable</span>); <span class="pl-c">// static</span></span></pre></div>

<p>The created spy will behave exactly like the wrapped callable:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy(<span class="pl-s"><span class="pl-pds">'</span>max<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">spy</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>); <span class="pl-c">// outputs '3'</span></span></pre></div>

<h3>
<a id="anonymous-spies" class="anchor" href="#anonymous-spies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Anonymous spies</h3>

<p><em>Anonymous spies</em> are spies that do not wrap an existing callable. Their only
purpose is to record input arguments. An anonymous spy is created by calling
<a href="#facade.spy"><code>spy()</code></a> without passing a callable:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy();        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>spy();      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>spy(); <span class="pl-c">// static</span></span></pre></div>

<p>Regardless of input arguments, anonymous spies will always return <code>null</code>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">gettype</span>($<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)); <span class="pl-c">// outputs 'NULL'</span></span></pre></div>

<h3>
<a id="call-verification" class="anchor" href="#call-verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Call verification</h3>

<p><em>Phony</em> provides the ability to make verifications on individual recorded calls.
The API for verifying calls mirrors the methods available for spy verification.</p>

<p>See <a href="#the-call-api">the call API</a> for more information.</p>

<h4>
<a id="call-count" class="anchor" href="#call-count" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Call count</h4>

<p>The number of calls recorded by a spy can be retrieved using
<a href="#spy.callCount"><code>callCount()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>callCount();</span></pre></div>

<h4>
<a id="individual-calls" class="anchor" href="#individual-calls" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Individual calls</h4>

<p>To get the first call, use <a href="#spy.firstCall"><code>firstCall()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>firstCall();</span></pre></div>

<p>To get the last call, use <a href="#spy.lastCall"><code>lastCall()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>lastCall();</span></pre></div>

<p>To get a specific call by index, use <a href="#spy.callAt"><code>callAt()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>callAt(<span class="pl-c1">0</span>); <span class="pl-c">// returns the first call</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>callAt(<span class="pl-c1">9</span>); <span class="pl-c">// returns the tenth call</span></span></pre></div>

<p>These methods will throw an exception if no call is found.</p>

<h3>
<a id="verifying-spy-input" class="anchor" href="#verifying-spy-input" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying spy input</h3>

<h4>
<a id="verifying-that-a-call-was-made" class="anchor" href="#verifying-that-a-call-was-made" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that a call was made</h4>

<p>To verify that a spy was called, use <a href="#spy.called"><code>called()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>called();</span></pre></div>

<h4>
<a id="verifying-that-a-spy-was-called-with-specific-arguments" class="anchor" href="#verifying-that-a-spy-was-called-with-specific-arguments" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that a spy was called with specific arguments</h4>

<p>To verify input arguments, use <a href="#spy.calledWith"><code>calledWith()</code></a>. Arguments
passed to <a href="#spy.calledWith"><code>calledWith()</code></a> can be literal values, or
<a href="#matchers">matchers</a>, including <a href="#shorthand-matchers">shorthand matchers</a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith();         <span class="pl-c">// called with no arguments</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c">// called with 'a' followed by 'b'</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>); <span class="pl-c">// called with 'a' followed by 0-n arguments</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>); <span class="pl-c">// called with 'a' followed by exactly 1 argument</span></span></pre></div>

<p>Arguments can be retrieved by calling <a href="#spy.arguments"><code>arguments()</code></a> or
<a href="#spy.argument"><code>argument()</code></a> on a spy:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>arguments(); <span class="pl-c">// all arguments as an array</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>argument();  <span class="pl-c">// first argument</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>argument(<span class="pl-c1">1</span>); <span class="pl-c">// second argument</span></span></pre></div>

<p>Note that this will return the arguments for the first call made on the spy.</p>

<p>Arguments can also be retrieved by calling
<a href="#verification.arguments"><code>arguments()</code></a> or
<a href="#verification.argument"><code>argument()</code></a> on any <a href="#the-verification-result-api">verification result</a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>called()<span class="pl-k">-&gt;</span>arguments(); <span class="pl-c">// all arguments as an array</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>called()<span class="pl-k">-&gt;</span>argument();  <span class="pl-c">// first argument</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>called()<span class="pl-k">-&gt;</span>argument(<span class="pl-c1">1</span>); <span class="pl-c">// second argument</span></span></pre></div>

<p>Note that this will return the arguments for the first call that matches the
verification in use.</p>

<h4>
<a id="verifying-spy-closure-binding" class="anchor" href="#verifying-spy-closure-binding" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying spy closure binding</h4>

<p>Where <a href="http://php.net/closure.bind">closure binding</a> is supported, the bound object can be verified using
<a href="#spy.calledOn"><code>calledOn()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledOn(<span class="pl-smi">$object</span>);</span></pre></div>

<h3>
<a id="verifying-spy-output" class="anchor" href="#verifying-spy-output" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying spy output</h3>

<h4>
<a id="verifying-spy-return-values" class="anchor" href="#verifying-spy-return-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying spy return values</h4>

<p>To verify a spy's return value, use <a href="#spy.returned"><code>returned()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>returned();    <span class="pl-c">// returned anything</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// returned 'a'</span></span></pre></div>

<h4>
<a id="verifying-spy-exceptions" class="anchor" href="#verifying-spy-exceptions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying spy exceptions</h4>

<p>To verify that a spy threw an exception, use <a href="#spy.threw"><code>threw()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>threw();                                         <span class="pl-c">// threw any exception</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>threw(<span class="pl-s"><span class="pl-pds">'</span>RuntimeException<span class="pl-pds">'</span></span>);                       <span class="pl-c">// threw a runtime exception</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>threw(<span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>You done goofed.<span class="pl-pds">'</span></span>)); <span class="pl-c">// threw a runtime exception with a specific message</span></span></pre></div>

<h3>
<a id="verifying-spies-with-generators-or-traversables" class="anchor" href="#verifying-spies-with-generators-or-traversables" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying spies with generators or traversables</h3>

<p><em>Phony</em> records values and exceptions that are passed in and out of
<a href="http://php.net/language.generators.overview">generators</a>:</p>

<ul>
<li>When a generator uses the <a href="http://php.net/language.generators.syntax#control-structures.yield">yield</a> keyword, this is recorded as a <em>produced
value</em>.</li>
<li>When calling code uses <a href="http://php.net/generator.send">Generator::send()</a>, this is recorded as a <em>sent
value</em>.</li>
<li>When calling code uses <a href="http://php.net/generator.throw">Generator::throw()</a>, this is recorded as a <em>sent
exception</em>.</li>
<li>When a generator ends, either implicitly, or with an explicit <code>return</code>
statement, this is recorded as a <em>returned value</em> of <code>null</code> (as generators
cannot return values).</li>
<li>When a generator ends because of an exception, this is recorded as a <em>thrown
exception</em>.</li>
</ul>

<p>This behavior is enabled by default for generators, and can optionally be
enabled for other traversables by calling
<a href="#spy.setUseTraversableSpies"><code>setUseTraversableSpies()</code></a> on a spy:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>setUseTraversableSpies(<span class="pl-c1">true</span>);</span></pre></div>

<p>For other traversables, such as arrays and iterators, the values are recorded as
<em>produced values</em>.</p>

<p>To turn off generator spies, use
<a href="#spy.setUseGeneratorSpies"><code>setUseGeneratorSpies()</code></a> on a spy:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>setUseGeneratorSpies(<span class="pl-c1">false</span>);</span></pre></div>

<p>Both <a href="#spy.setUseGeneratorSpies"><code>setUseGeneratorSpies()</code></a> and
<a href="#spy.setUseTraversableSpies"><code>setUseTraversableSpies()</code></a> are fluent, meaning
spy creation and setting of these options can be done in a single expression:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setUseTraversableSpies(<span class="pl-c1">true</span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setUseGeneratorSpies(<span class="pl-c1">false</span>);</span></pre></div>

<h4>
<a id="verifying-values-produced-by-spies" class="anchor" href="#verifying-values-produced-by-spies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying values produced by spies</h4>

<p>To verify that a value was produced by a spy, use <a href="#spy.produced"><code>produced()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>produced();         <span class="pl-c">// produced anything</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);      <span class="pl-c">// produced 'a' with any key</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c">// produced 'b' with key 'a'</span></span></pre></div>

<p>To verify that a set of values were produced by a spy in a specific order, in a
single call, use <a href="#spy.producedAll"><code>producedAll()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>producedAll();                <span class="pl-c">// produced nothing (an empty traversable)</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>producedAll(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);        <span class="pl-c">// produced 'a', then 'b', with any keys</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>producedAll(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, [<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>]); <span class="pl-c">// produced 'a' with any key, then 'c' with key 'b'</span></span></pre></div>

<h4>
<a id="verifying-values-received-by-spies" class="anchor" href="#verifying-values-received-by-spies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying values received by spies</h4>

<p>To verify that a value was received by a spy, use <a href="#spy.received"><code>received()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>received();    <span class="pl-c">// received anything</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// received 'a'</span></span></pre></div>

<h4>
<a id="verifying-exceptions-received-by-spies" class="anchor" href="#verifying-exceptions-received-by-spies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying exceptions received by spies</h4>

<p>To verify that an exception was received by a spy, use
<a href="#spy.receivedException"><code>receivedException()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>receivedException();                                         <span class="pl-c">// received any exception</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>receivedException(<span class="pl-s"><span class="pl-pds">'</span>RuntimeException<span class="pl-pds">'</span></span>);                       <span class="pl-c">// received a runtime exception</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>receivedException(<span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>You done goofed.<span class="pl-pds">'</span></span>)); <span class="pl-c">// received a runtime exception with a specific message</span></span></pre></div>

<h3>
<a id="verifying-cardinality-with-spies" class="anchor" href="#verifying-cardinality-with-spies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying cardinality with spies</h3>

<p>Cardinality modifiers change the amount of times a call, or other event, must
meet the requirements of a subsequent verification.</p>

<p>Cardinality must be specified <strong>before</strong> verification, and can be applied to
any verification call:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>once()<span class="pl-k">-&gt;</span>called();        <span class="pl-c">// called exactly 1 time</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>once()<span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// called exactly 1 time with 'a'</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>once()<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);   <span class="pl-c">// returned 'b' exactly 1 time</span></span></pre></div>

<p>The default cardinality is <code>atLeast(1)</code>, meaning verifications will pass if at
least one matching event was recorded.</p>

<h4>
<a id="verifying-that-a-spy-event-happened-an-exact-number-of-times" class="anchor" href="#verifying-that-a-spy-event-happened-an-exact-number-of-times" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that a spy event happened an exact number of times</h4>

<p>To verify that an event happened an exact number of times, use one of
<a href="#spy.never"><code>never()</code></a>, <a href="#spy.once"><code>once()</code></a>, <a href="#spy.twice"><code>twice()</code></a>,
<a href="#spy.thrice"><code>thrice()</code></a>, or <a href="#spy.times"><code>times()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>never()<span class="pl-k">-&gt;</span>called();   <span class="pl-c">// never called</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>once()<span class="pl-k">-&gt;</span>called();    <span class="pl-c">// called exactly 1 time</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>twice()<span class="pl-k">-&gt;</span>called();   <span class="pl-c">// called exactly 2 times</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>thrice()<span class="pl-k">-&gt;</span>called();  <span class="pl-c">// called exactly 3 times</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>times(<span class="pl-c1">10</span>)<span class="pl-k">-&gt;</span>called(); <span class="pl-c">// called exactly 10 times</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>never()<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);   <span class="pl-c">// never returned 'a'</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>once()<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);    <span class="pl-c">// returned 'a' exactly 1 time</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>twice()<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);   <span class="pl-c">// returned 'a' exactly 2 times</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>thrice()<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);  <span class="pl-c">// returned 'a' exactly 3 times</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>times(<span class="pl-c1">10</span>)<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// returned 'a' exactly 10 times</span></span></pre></div>

<h4>
<a id="verifying-that-a-spy-event-happened-a-bounded-number-of-times" class="anchor" href="#verifying-that-a-spy-event-happened-a-bounded-number-of-times" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that a spy event happened a bounded number of times</h4>

<p>To verify that an event happened a bounded number of times, use one of
<a href="#spy.atLeast"><code>atLeast()</code></a>, <a href="#spy.atMost"><code>atMost()</code></a>, or
<a href="#spy.between"><code>between()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>atLeast(<span class="pl-c1">2</span>)<span class="pl-k">-&gt;</span>called();    <span class="pl-c">// called 2 or more times</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>atMost(<span class="pl-c1">3</span>)<span class="pl-k">-&gt;</span>called();     <span class="pl-c">// called no more than 3 times</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>between(<span class="pl-c1">2</span>, <span class="pl-c1">4</span>)<span class="pl-k">-&gt;</span>called(); <span class="pl-c">// called 2, 3, or 4 times</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>atLeast(<span class="pl-c1">2</span>)<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);    <span class="pl-c">// returned 'a' 2 or more times</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>atMost(<span class="pl-c1">3</span>)<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);     <span class="pl-c">// returned 'a' no more than 3 times</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>between(<span class="pl-c1">2</span>, <span class="pl-c1">4</span>)<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// returned 'a' 2, 3, or 4 times</span></span></pre></div>

<h4>
<a id="verifying-that-all-spy-events-happen-the-same-way" class="anchor" href="#verifying-that-all-spy-events-happen-the-same-way" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that all spy events happen the same way</h4>

<p>To verify that all events happen the same way, use <a href="#spy.always"><code>always()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>always()<span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// always called with 'a'</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>always()<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);   <span class="pl-c">// always returned 'b'</span></span></pre></div>

<p>Note that <a href="#spy.always"><code>always()</code></a> does not interfere with other cardinality
modifiers, and can be combined to produce powerful verifications:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>twice()<span class="pl-k">-&gt;</span>always()<span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// called exactly 2 times, and always with 'a'</span></span></pre></div>

<h3>
<a id="labeling-spies" class="anchor" href="#labeling-spies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Labeling spies</h3>

<p>Every spy has a label, which is a free-form string used to help identify the spy
in verification failure messages. By default, each spy is assigned a unique
sequential integer label upon creation.</p>

<p>The label can be changed at any time by using <a href="#spy.setLabel"><code>setLabel()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy();</span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>label(); <span class="pl-c">// outputs 'a'</span></span></pre></div>

<p>The <a href="#spy.setLabel"><code>setLabel()</code></a> method is also fluent, meaning that spy
creation and label setting can be done in a single expression:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy()<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span></pre></div>

<p>When a verification fails for a labeled spy, the output is similar to the
following:</p>

<pre><code>Expected call on {spy}[label] with arguments like:
    "x", "y"
Calls:
    - "x", "z"
</code></pre>

<h3>
<a id="invoking-spies" class="anchor" href="#invoking-spies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Invoking spies</h3>

<p>Spies can be invoked directly like any other dynamic callable:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c">// passes</span></span></pre></div>

<p>They can also be invoked more explicitly using <a href="#spy.invoke"><code>invoke()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>invoke(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c">// passes</span></span></pre></div>

<p>There is also a more advanced method, <a href="#spy.invokeWith"><code>invokeWith()</code></a>, that
supports arguments passed by reference:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>) {</span>
<span class="pl-s1">        <span class="pl-c1">list</span>(<span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>) <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c">// passes</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c">// outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$b</span>; <span class="pl-c">// outputs 'y'</span></span></pre></div>

<h3>
<a id="pausing-spy-recording" class="anchor" href="#pausing-spy-recording" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Pausing spy recording</h3>

<p>To temporarily prevent spies from recording calls, use
<a href="#spy.stopRecording"><code>stopRecording()</code></a> and
<a href="#spy.startRecording"><code>startRecording()</code></a> as necessary:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy();</span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>stopRecording();</span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>startRecording();</span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// passes</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>); <span class="pl-c">// passes</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c">// fails</span></span></pre></div>

<h2>
<a id="calls" class="anchor" href="#calls" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Calls</h2>

<p><em>Phony</em> provides the ability to make verifications on individual recorded calls.
The call API mirrors the methods available on <a href="#the-spy-api">the spy API</a>.</p>

<h3>
<a id="the-call-api" class="anchor" href="#the-call-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The call API</h3>

<p><a name="call.arguments"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-arguments-api">arguments</a></em> $call-&gt;<a href="#call.arguments"><strong>arguments</strong></a>()</p>
</blockquote>

<p>Get the arguments.</p>

<p><a name="call.argument"></a></p>

<hr>

<blockquote>
<p><em>mixed</em> $call-&gt;<a href="#call.argument"><strong>argument</strong></a>($index = 0)
throws <a href="#undefinedargumentexception">UndefinedArgumentException</a></p>
</blockquote>

<p>Get an argument by index.</p>

<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>

<p><a name="call.argumentCount"></a></p>

<hr>

<blockquote>
<p><em>integer</em> $call-&gt;<a href="#call.argumentCount"><strong>argumentCount</strong></a>()</p>
</blockquote>

<p>Get the number of arguments.</p>

<p><a name="call.returnValue"></a></p>

<hr>

<blockquote>
<p><em>mixed</em> $call-&gt;<a href="#call.returnValue"><strong>returnValue</strong></a>()
throws <a href="#undefinedresponseexception">UndefinedResponseException</a></p>
</blockquote>

<p>Get the return value.</p>

<p><em>An <a href="#undefinedresponseexception">UndefinedResponseException</a> will be thrown if the call has not yet
responded, or threw an exception.</em></p>

<p><a name="call.exception"></a></p>

<hr>

<blockquote>
<p><em><a href="http://php.net/class.throwable">Throwable</a></em> $call-&gt;<a href="#call.exception"><strong>exception</strong></a>()
throws <a href="#undefinedresponseexception">UndefinedResponseException</a></p>
</blockquote>

<p>Get the thrown exception.</p>

<p><em>An <a href="#undefinedresponseexception">UndefinedResponseException</a> will be thrown if the call has not yet
responded, or did not throw an exception.</em></p>

<p><a name="call.response"></a></p>

<hr>

<blockquote>
<p><em>tuple&lt;<a href="http://php.net/class.throwable">Throwable</a>|null,mixed&gt;</em> $call-&gt;<a href="#call.response"><strong>response</strong></a>()
throws <a href="#undefinedresponseexception">UndefinedResponseException</a></p>
</blockquote>

<p>Get the response.</p>

<p><em>This method returns a 2-tuple. The first element is the thrown exception, or
<code>null</code> if no exception was thrown. The second element is the returned value,
or <code>null</code> if an exception was thrown.</em></p>

<p><em>An <a href="#undefinedresponseexception">UndefinedResponseException</a> will be thrown if the call has not yet
responded.</em></p>

<p><a name="call.hasResponded"></a></p>

<hr>

<blockquote>
<p><em>boolean</em> $call-&gt;<a href="#call.hasResponded"><strong>hasResponded</strong></a>()</p>
</blockquote>

<p>Returns true if this call has responded.</p>

<p><em>A call that has "responded" has returned a value, or thrown an exception.</em></p>

<p><a name="call.isTraversable"></a></p>

<hr>

<blockquote>
<p><em>boolean</em> $call-&gt;<a href="#call.isTraversable"><strong>isTraversable</strong></a>()</p>
</blockquote>

<p>Returns true if this call has responded with a traversable.</p>

<p><em>A call that has "responded" has returned a value, or thrown an exception.</em></p>

<p><a name="call.isGenerator"></a></p>

<hr>

<blockquote>
<p><em>boolean</em> $call-&gt;<a href="#call.isGenerator"><strong>isGenerator</strong></a>()</p>
</blockquote>

<p>Returns true if this call has responded with a generator.</p>

<p><em>A call that has "responded" has returned a value, or thrown an exception.</em></p>

<p><a name="call.hasCompleted"></a></p>

<hr>

<blockquote>
<p><em>boolean</em> $call-&gt;<a href="#call.hasCompleted"><strong>hasCompleted</strong></a>()</p>
</blockquote>

<p>Returns true if this call has completed.</p>

<p><em>When <a href="#verifying-spies-with-generators-or-traversables">generator spies</a> are in use, a call that returns a generator will not be
considered "complete" until the generator has been completely consumed via
iteration.</em></p>

<p><em>Similarly, when <a href="#verifying-spies-with-generators-or-traversables">traversable spies</a> are in use, a call that returns a
traversable will not be considered "complete" until the traversable has been
completely consumed via iteration.</em></p>

<p><a name="call.time"></a></p>

<hr>

<blockquote>
<p><em>float</em> $call-&gt;<a href="#call.time"><strong>time</strong></a>()</p>
</blockquote>

<p>Get the time at which the call occurred, in seconds since the Unix epoch.</p>

<p><a name="call.responseTime"></a></p>

<hr>

<blockquote>
<p><em>float|null</em> $call-&gt;<a href="#call.responseTime"><strong>responseTime</strong></a>()</p>
</blockquote>

<p>Get the time at which the call responded, in seconds since the Unix epoch.</p>

<p><em>If the call has not yet responded, <code>null</code> will be returned.</em></p>

<p><em>A call that has "responded" has returned a value, or thrown an exception.</em></p>

<p><a name="call.endTime"></a></p>

<hr>

<blockquote>
<p><em>float|null</em> $call-&gt;<a href="#call.endTime"><strong>endTime</strong></a>()</p>
</blockquote>

<p>Get the time at which the call completed, in seconds since the Unix epoch.</p>

<p><em>If the call has not yet completed, <code>null</code> will be returned.</em></p>

<p><em>When <a href="#verifying-spies-with-generators-or-traversables">generator spies</a> are in use, a call that returns a generator will not be
considered "complete" until the generator has been completely consumed via
iteration.</em></p>

<p><em>Similarly, when <a href="#verifying-spies-with-generators-or-traversables">traversable spies</a> are in use, a call that returns a
traversable will not be considered "complete" until the traversable has been
completely consumed via iteration.</em></p>

<p><a name="call.responseDuration"></a></p>

<hr>

<blockquote>
<p><em>float|null</em> $call-&gt;<a href="#call.responseDuration"><strong>responseDuration</strong></a>()</p>
</blockquote>

<p>Get the call response duration, in seconds.</p>

<p><em>If the call has not yet responded, <code>null</code> will be returned.</em></p>

<p><em>A call that has "responded" has returned a value, or thrown an exception.</em></p>

<p><a name="call.duration"></a></p>

<hr>

<blockquote>
<p><em>float|null</em> $call-&gt;<a href="#call.duration"><strong>duration</strong></a>()</p>
</blockquote>

<p>Get the call response duration, in seconds.</p>

<p><em>If the call has not yet completed, <code>null</code> will be returned.</em></p>

<p><em>When <a href="#verifying-spies-with-generators-or-traversables">generator spies</a> are in use, a call that returns a generator will not be
considered "complete" until the generator has been completely consumed via
iteration.</em></p>

<p><em>Similarly, when <a href="#verifying-spies-with-generators-or-traversables">traversable spies</a> are in use, a call that returns a
traversable will not be considered "complete" until the traversable has been
completely consumed via iteration.</em></p>

<p><a name="call.sequenceNumber"></a></p>

<hr>

<blockquote>
<p><em>integer</em> $call-&gt;<a href="#call.sequenceNumber"><strong>sequenceNumber</strong></a>()</p>
</blockquote>

<p>Get the sequence number.</p>

<p><em>The sequence number is a unique number assigned to every event that Phony
records. The numbers are assigned sequentially, meaning that sequence numbers
can be used to determine event order.</em></p>

<p><a name="call.calledWith"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $call-&gt;<a href="#call.calledWith"><strong>calledWith</strong></a>(...$arguments)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless called with the supplied arguments.</p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>. Any mock handles in
<code>$arguments</code> are equivalent to the mocks themselves.</em></p>

<p><em>See <a href="#verifying-that-a-call-was-made-with-specific-arguments">Verifying that a call was made with specific arguments</a>.</em></p>

<p><a name="call.checkCalledWith"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $call-&gt;<a href="#call.checkCalledWith"><strong>checkCalledWith</strong></a>(...$arguments)</p>
</blockquote>

<p>Checks if called with the supplied arguments.</p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>. Any mock handles in
<code>$arguments</code> are equivalent to the mocks themselves.</em></p>

<p><em>See <a href="#verifying-that-a-call-was-made-with-specific-arguments">Verifying that a call was made with specific arguments</a>,
<a href="#check-verification">Check verification</a>.</em></p>

<p><a name="call.calledOn"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $call-&gt;<a href="#call.calledOn"><strong>calledOn</strong></a>($value)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless the bound <code>$this</code> value is equal to the supplied
value.</p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-call-closure-binding">Verifying call closure binding</a>.</em></p>

<p><a name="call.checkCalledOn"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $call-&gt;<a href="#call.checkCalledOn"><strong>checkCalledOn</strong></a>($value)</p>
</blockquote>

<p>Checks if the bound <code>$this</code> value is equal to the supplied value.</p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-call-closure-binding">Verifying call closure binding</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="call.returned"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $call-&gt;<a href="#call.returned"><strong>returned</strong></a>($value = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless this call returned the supplied value.</p>

<p><em>When called with no arguments, this method simply checks that the call returned
any value.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-call-return-values">Verifying call return values</a>.</em></p>

<p><a name="call.checkReturned"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $call-&gt;<a href="#call.checkReturned"><strong>checkReturned</strong></a>($value = null)</p>
</blockquote>

<p>Checks if this call returned the supplied value.</p>

<p><em>When called with no arguments, this method simply checks that the call returned
any value.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-call-return-values">Verifying call return values</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="call.threw"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $call-&gt;<a href="#call.threw"><strong>threw</strong></a>($type = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless this call threw an exception of the supplied type.</p>

<p><em>When called with no arguments, this method simply checks that the call threw
any exception.</em></p>

<p><em>When called with a string, this method checks that the call threw an exception
that is an instance of <code>$type</code>.</em></p>

<p><em>When called with an exception instance, this method checks that the call threw
an exception that is equal to the supplied instance.</em></p>

<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the call threw an
exception that matches the supplied matcher.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-call-exceptions">Verifying call exceptions</a>.</em></p>

<p><a name="call.checkThrew"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $call-&gt;<a href="#call.checkThrew"><strong>checkThrew</strong></a>($type = null)</p>
</blockquote>

<p>Checks if an exception of the supplied type was thrown.</p>

<p><em>When called with no arguments, this method simply checks that the call threw
any exception.</em></p>

<p><em>When called with a string, this method checks that the call threw an exception
that is an instance of <code>$type</code>.</em></p>

<p><em>When called with an exception instance, this method checks that the call threw
an exception that is equal to the supplied instance.</em></p>

<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the call threw an
exception that matches the supplied matcher.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-call-exceptions">Verifying call exceptions</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="call.produced"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $call-&gt;<a href="#call.produced"><strong>produced</strong></a>($keyOrValue = null, $value = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Checks if this call produced the supplied values.</p>

<p><em>When called with no arguments, this method simply checks that the call produced
any value.</em></p>

<p><em>With a single argument, it checks that a value matching the argument was
produced.</em></p>

<p><em>With two arguments, it checks that a key and value matching the respective
arguments were produced together.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> for both keys and values.</em></p>

<p><em>See <a href="#verifying-values-produced-by-calls">Verifying values produced by calls</a>.</em></p>

<p><a name="call.checkProduced"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $call-&gt;<a href="#call.checkProduced"><strong>checkProduced</strong></a>($keyOrValue = null, $value = null)</p>
</blockquote>

<p>Checks if this call produced the supplied values.</p>

<p><em>When called with no arguments, this method simply checks that the call produced
any value.</em></p>

<p><em>With a single argument, it checks that a value matching the argument was
produced.</em></p>

<p><em>With two arguments, it checks that a key and value matching the respective
arguments were produced together.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> for both keys and values.</em></p>

<p><em>See <a href="#verifying-values-produced-by-calls">Verifying values produced by calls</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="call.producedAll"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $call-&gt;<a href="#call.producedAll"><strong>producedAll</strong></a>(...$pairs)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless this call produced all of the supplied key-value
pairs, in the supplied order.</p>

<p><em>Each value in <code>$pairs</code> is equivalent to a set of arguments passed to
<a href="#call.produced"><code>produced()</code></a>.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> for both keys and values.</em></p>

<p><em>See <a href="#verifying-values-produced-by-calls">Verifying values produced by calls</a>.</em></p>

<p><a name="call.checkProducedAll"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $call-&gt;<a href="#call.checkProducedAll"><strong>checkProducedAll</strong></a>(...$pairs)</p>
</blockquote>

<p>Checks if this call produced all of the supplied key-value pairs, in the
supplied order.</p>

<p><em>Each value in <code>$pairs</code> is equivalent to a set of arguments passed to
<a href="#call.checkProduced"><code>checkProduced()</code></a>.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> for both keys and values.</em></p>

<p><em>See <a href="#verifying-values-produced-by-calls">Verifying values produced by calls</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="call.received"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $call-&gt;<a href="#call.received"><strong>received</strong></a>($value = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless this call received the supplied value.</p>

<p><em>When called with no arguments, this method simply checks that the call received
any value.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-values-received-by-calls">Verifying values received by calls</a>.</em></p>

<p><a name="call.checkReceived"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $call-&gt;<a href="#call.checkReceived"><strong>checkReceived</strong></a>($value = null)</p>
</blockquote>

<p>Checks if this call received the supplied value.</p>

<p><em>When called with no arguments, this method simply checks that the call received
any value.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-values-received-by-calls">Verifying values received by calls</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="call.receivedException"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $call-&gt;<a href="#call.receivedException"><strong>receivedException</strong></a>($type = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless this call received an exception of the supplied type.</p>

<p><em>When called with no arguments, this method simply checks that the call received
any exception.</em></p>

<p><em>When called with a string, this method checks that the call received an
exception that is an instance of <code>$type</code>.</em></p>

<p><em>When called with an exception instance, this method checks that the call
received an exception that is equal to the supplied instance.</em></p>

<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the call received an
exception that matches the supplied matcher.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-exceptions-received-by-calls">Verifying exceptions received by calls</a>.</em></p>

<p><a name="call.checkReceivedException"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $call-&gt;<a href="#call.checkReceivedException"><strong>checkReceivedException</strong></a>($type = null)</p>
</blockquote>

<p>Checks if this call received an exception of the supplied type.</p>

<p><em>When called with no arguments, this method simply checks that the call received
any exception.</em></p>

<p><em>When called with a string, this method checks that the call received an
exception that is an instance of <code>$type</code>.</em></p>

<p><em>When called with an exception instance, this method checks that the call
received an exception that is equal to the supplied instance.</em></p>

<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the call received an
exception that matches the supplied matcher.</em></p>

<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>

<p><em>See <a href="#verifying-exceptions-received-by-calls">Verifying exceptions received by calls</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="call.never"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $call-&gt;<a href="#call.never"><strong>never</strong></a>()</p>
</blockquote>

<p>Requires that the next verification never matches.</p>

<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>

<p><a name="call.once"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $call-&gt;<a href="#call.once"><strong>once</strong></a>()</p>
</blockquote>

<p>Requires that the next verification matches only once.</p>

<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>

<p><a name="call.twice"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $call-&gt;<a href="#call.twice"><strong>twice</strong></a>()</p>
</blockquote>

<p>Requires that the next verification matches exactly two times.</p>

<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>

<p><a name="call.thrice"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $call-&gt;<a href="#call.thrice"><strong>thrice</strong></a>()</p>
</blockquote>

<p>Requires that the next verification matches exactly three times.</p>

<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>

<p><a name="call.times"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $call-&gt;<a href="#call.times"><strong>times</strong></a>($times)</p>
</blockquote>

<p>Requires that the next verification matches exactly <code>$times</code> times.</p>

<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>

<p><a name="call.atLeast"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $call-&gt;<a href="#call.atLeast"><strong>atLeast</strong></a>($minimum)</p>
</blockquote>

<p>Requires that the next verification matches a number of times greater than or
equal to <code>$minimum</code>.</p>

<p><em>See <a href="#verifying-that-a-call-event-happened-a-bounded-number-of-times">Verifying that a call event happened a bounded number of times</a>.</em></p>

<p><a name="call.atMost"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $call-&gt;<a href="#call.atMost"><strong>atMost</strong></a>($maximum)</p>
</blockquote>

<p>Requires that the next verification matches a number of times less than or equal
to <code>$maximum</code>.</p>

<p><em>See <a href="#verifying-that-a-call-event-happened-a-bounded-number-of-times">Verifying that a call event happened a bounded number of times</a>.</em></p>

<p><a name="call.between"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $call-&gt;<a href="#call.between"><strong>between</strong></a>($minimum, $maximum)</p>
</blockquote>

<p>Requires that the next verification matches a number of times greater than or
equal to <code>$minimum</code>, and less than or equal to <code>$maximum</code>.</p>

<p><em>See <a href="#verifying-that-a-call-event-happened-a-bounded-number-of-times">Verifying that a call event happened a bounded number of times</a>.</em></p>

<p><a name="call.always"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $call-&gt;<a href="#call.always"><strong>always</strong></a>()</p>
</blockquote>

<p>Requires that the next verification matches for all possible items.</p>

<p><em>See <a href="#verifying-that-all-call-events-happen-the-same-way">Verifying that all call events happen the same way</a>.</em></p>

<h3>
<a id="the-arguments-api" class="anchor" href="#the-arguments-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The arguments API</h3>

<p><a name="arguments.all"></a></p>

<hr>

<blockquote>
<p><em>array&lt;mixed&gt;</em> $arguments-&gt;<a href="#arguments.all"><strong>all</strong></a>()</p>
</blockquote>

<p>Get the arguments as an array.</p>

<p><em>Arguments passed by reference will be references in the returned array.</em></p>

<p><a name="arguments.has"></a></p>

<hr>

<blockquote>
<p><em>boolean</em> $arguments-&gt;<a href="#arguments.has"><strong>has</strong></a>($index = 0)</p>
</blockquote>

<p>Returns <code>true</code> if an argument exists at <code>$index</code>.</p>

<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>

<p><a name="arguments.get"></a></p>

<hr>

<blockquote>
<p><em>mixed</em> $arguments-&gt;<a href="#arguments.get"><strong>get</strong></a>($index = 0)
throws <a href="#undefinedargumentexception">UndefinedArgumentException</a></p>
</blockquote>

<p>Get the argument at <code>$index</code>.</p>

<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>

<p><a name="arguments.set"></a></p>

<hr>

<blockquote>
<p><em>fluent</em> $arguments-&gt;<a href="#arguments.set"><strong>set</strong></a>($indexOrValue = null, $value = null)
throws <a href="#undefinedargumentexception">UndefinedArgumentException</a></p>
</blockquote>

<p>Set an argument by index.</p>

<p><em>If called with no arguments, sets the first argument to <code>null</code>.</em></p>

<p><em>If called with one argument, sets the first argument to <code>$indexOrValue</code>.</em></p>

<p><em>If called with two arguments, sets the argument at <code>$indexOrValue</code> to
<code>$value</code>.</em></p>

<p><a name="arguments.copy"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-arguments-api">arguments</a></em> $arguments-&gt;<a href="#arguments.copy"><strong>copy</strong></a>()</p>
</blockquote>

<p>Copy these arguments, breaking any references.</p>

<h3>
<a id="retrieving-calls-from-a-spy" class="anchor" href="#retrieving-calls-from-a-spy" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Retrieving calls from a spy</h3>

<p>To get the first call, use <a href="#spy.firstCall"><code>firstCall()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>firstCall();</span></pre></div>

<p>To get the last call, use <a href="#spy.lastCall"><code>lastCall()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>lastCall();</span></pre></div>

<p>To get a specific call by index, use <a href="#spy.callAt"><code>callAt()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>callAt(<span class="pl-c1">0</span>); <span class="pl-c">// returns the first call</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>callAt(<span class="pl-c1">9</span>); <span class="pl-c">// returns the tenth call</span></span></pre></div>

<p>These methods will throw an exception if no call is found.</p>

<h3>
<a id="verifying-call-input" class="anchor" href="#verifying-call-input" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying call input</h3>

<h4>
<a id="verifying-that-a-call-was-made-with-specific-arguments" class="anchor" href="#verifying-that-a-call-was-made-with-specific-arguments" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that a call was made with specific arguments</h4>

<p>To verify input arguments, use <a href="#call.calledWith"><code>calledWith()</code></a>. Arguments
passed to <a href="#call.calledWith"><code>calledWith()</code></a> can be literal values, or
<a href="#matchers">matchers</a>, including <a href="#shorthand-matchers">shorthand matchers</a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>calledWith();         <span class="pl-c">// called with no arguments</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c">// called with 'a' followed by 'b'</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>); <span class="pl-c">// called with 'a' followed by 0-n arguments</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>); <span class="pl-c">// called with 'a' followed by exactly 1 argument</span></span></pre></div>

<p>Arguments can also be retrieved with <a href="#call.arguments"><code>arguments()</code></a> or
<a href="#call.argument"><code>argument()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>arguments(); <span class="pl-c">// all arguments as an array</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>argument();  <span class="pl-c">// first argument</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>argument(<span class="pl-c1">1</span>); <span class="pl-c">// second argument</span></span></pre></div>

<h4>
<a id="verifying-call-closure-binding" class="anchor" href="#verifying-call-closure-binding" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying call closure binding</h4>

<p>Where <a href="http://php.net/closure.bind">closure binding</a> is supported, the bound object can be verified using
<a href="#call.calledOn"><code>calledOn()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>calledOn(<span class="pl-smi">$object</span>);</span></pre></div>

<h3>
<a id="verifying-call-output" class="anchor" href="#verifying-call-output" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying call output</h3>

<h4>
<a id="verifying-call-return-values" class="anchor" href="#verifying-call-return-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying call return values</h4>

<p>To verify a call's return value, use <a href="#call.returned"><code>returned()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>returned();    <span class="pl-c">// returned anything</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// returned 'a'</span></span></pre></div>

<h4>
<a id="verifying-call-exceptions" class="anchor" href="#verifying-call-exceptions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying call exceptions</h4>

<p>To verify that a call threw an exception, use <a href="#call.threw"><code>threw()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>threw();                                         <span class="pl-c">// threw any exception</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>threw(<span class="pl-s"><span class="pl-pds">'</span>RuntimeException<span class="pl-pds">'</span></span>);                       <span class="pl-c">// threw a runtime exception</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>threw(<span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>You done goofed.<span class="pl-pds">'</span></span>)); <span class="pl-c">// threw a runtime exception with a specific message</span></span></pre></div>

<h3>
<a id="verifying-calls-with-generators-or-traversables" class="anchor" href="#verifying-calls-with-generators-or-traversables" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying calls with generators or traversables</h3>

<p><em>Phony</em> records values and exceptions that are passed in and out of
<a href="http://php.net/language.generators.overview">generators</a>:</p>

<ul>
<li>When a generator uses the <a href="http://php.net/language.generators.syntax#control-structures.yield">yield</a> keyword, this is recorded as a <em>produced
value</em>.</li>
<li>When calling code uses <a href="http://php.net/generator.send">Generator::send()</a>, this is recorded as a <em>sent
value</em>.</li>
<li>When calling code uses <a href="http://php.net/generator.throw">Generator::throw()</a>, this is recorded as a <em>sent
exception</em>.</li>
<li>When a generator ends, either implicitly, or with an explicit <code>return</code>
statement, this is recorded as a <em>returned value</em> of <code>null</code> (as generators
cannot return values).</li>
<li>When a generator ends because of an exception, this is recorded as a <em>thrown
exception</em>.</li>
</ul>

<p>This behavior is enabled by default for generators, and can optionally be
enabled for other traversables by calling
<a href="#spy.setUseTraversableSpies"><code>setUseTraversableSpies()</code></a> on a spy:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>setUseTraversableSpies(<span class="pl-c1">true</span>);</span></pre></div>

<p>For other traversables, such as arrays and iterators, the values are recorded as
<em>produced values</em>.</p>

<h4>
<a id="verifying-values-produced-by-calls" class="anchor" href="#verifying-values-produced-by-calls" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying values produced by calls</h4>

<p>To verify that a value was produced by a call, use
<a href="#call.produced"><code>produced()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>produced();         <span class="pl-c">// produced anything</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);      <span class="pl-c">// produced 'a' with any key</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c">// produced 'b' with key 'a'</span></span></pre></div>

<p>To verify that a set of values were produced by a call in a specific order, use
<a href="#call.producedAll"><code>producedAll()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>producedAll();                <span class="pl-c">// produced nothing (an empty traversable)</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>producedAll(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);        <span class="pl-c">// produced 'a', then 'b', with any keys</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>producedAll(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, [<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>]); <span class="pl-c">// produced 'a' with any key, then 'c' with key 'b'</span></span></pre></div>

<h4>
<a id="verifying-values-received-by-calls" class="anchor" href="#verifying-values-received-by-calls" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying values received by calls</h4>

<p>To verify that a value was received by a call, use
<a href="#call.received"><code>received()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>received();    <span class="pl-c">// received anything</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// received 'a'</span></span></pre></div>

<h4>
<a id="verifying-exceptions-received-by-calls" class="anchor" href="#verifying-exceptions-received-by-calls" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying exceptions received by calls</h4>

<p>To verify that an exception was received by a call, use
<a href="#call.receivedException"><code>receivedException()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>receivedException();                                         <span class="pl-c">// received any exception</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>receivedException(<span class="pl-s"><span class="pl-pds">'</span>RuntimeException<span class="pl-pds">'</span></span>);                       <span class="pl-c">// received a runtime exception</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>receivedException(<span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>You done goofed.<span class="pl-pds">'</span></span>)); <span class="pl-c">// received a runtime exception with a specific message</span></span></pre></div>

<h3>
<a id="verifying-cardinality-with-calls" class="anchor" href="#verifying-cardinality-with-calls" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying cardinality with calls</h3>

<p>Cardinality modifiers change the amount of times a call, or other event, must
meet the requirements of a subsequent verification.</p>

<p>Cardinality must be specified <strong>before</strong> verification, and can be applied to
any verification call:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>never()<span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// not called with 'a'</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>never()<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);   <span class="pl-c">// did not return 'b'</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>never()<span class="pl-k">-&gt;</span>threw();         <span class="pl-c">// did not throw an exception</span></span></pre></div>

<p>The default cardinality is <code>atLeast(1)</code>, meaning verifications will pass if at
least one matching event was recorded.</p>

<h4>
<a id="verifying-that-a-call-event-happened-an-exact-number-of-times" class="anchor" href="#verifying-that-a-call-event-happened-an-exact-number-of-times" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that a call event happened an exact number of times</h4>

<p>To verify that an event happened an exact number of times, use one of
<a href="#call.never"><code>never()</code></a>, <a href="#call.once"><code>once()</code></a>, <a href="#call.twice"><code>twice()</code></a>,
<a href="#call.thrice"><code>thrice()</code></a>, or <a href="#call.times"><code>times()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>never()<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);   <span class="pl-c">// never produced 'a'</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>once()<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);    <span class="pl-c">// produced 'a' exactly 1 time</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>twice()<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);   <span class="pl-c">// produced 'a' exactly 2 times</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>thrice()<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);  <span class="pl-c">// produced 'a' exactly 3 times</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>times(<span class="pl-c1">10</span>)<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// produced 'a' exactly 10 times</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>never()<span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);   <span class="pl-c">// never received 'a'</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>once()<span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);    <span class="pl-c">// received 'a' exactly 1 time</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>twice()<span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);   <span class="pl-c">// received 'a' exactly 2 times</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>thrice()<span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);  <span class="pl-c">// received 'a' exactly 3 times</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>times(<span class="pl-c1">10</span>)<span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// received 'a' exactly 10 times</span></span></pre></div>

<h4>
<a id="verifying-that-a-call-event-happened-a-bounded-number-of-times" class="anchor" href="#verifying-that-a-call-event-happened-a-bounded-number-of-times" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that a call event happened a bounded number of times</h4>

<p>To verify that an event happened a bounded number of times, use one of
<a href="#call.atLeast"><code>atLeast()</code></a>, <a href="#call.atMost"><code>atMost()</code></a>, or
<a href="#call.between"><code>between()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>atLeast(<span class="pl-c1">2</span>)<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);    <span class="pl-c">// produced 'a' 2 or more times</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>atMost(<span class="pl-c1">3</span>)<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);     <span class="pl-c">// produced 'a' no more than 3 times</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>between(<span class="pl-c1">2</span>, <span class="pl-c1">4</span>)<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// produced 'a' 2, 3, or 4 times</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>atLeast(<span class="pl-c1">2</span>)<span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);    <span class="pl-c">// received 'a' 2 or more times</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>atMost(<span class="pl-c1">3</span>)<span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);     <span class="pl-c">// received 'a' no more than 3 times</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>between(<span class="pl-c1">2</span>, <span class="pl-c1">4</span>)<span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// received 'a' 2, 3, or 4 times</span></span></pre></div>

<h4>
<a id="verifying-that-all-call-events-happen-the-same-way" class="anchor" href="#verifying-that-all-call-events-happen-the-same-way" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that all call events happen the same way</h4>

<p>To verify that all events happen the same way, use <a href="#call.always"><code>always()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>always()<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// always produced 'a'</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>always()<span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c">// always received 'b'</span></span></pre></div>

<p>Note that <a href="#call.always"><code>always()</code></a> does not interfere with other cardinality
modifiers, and can be combined to produce powerful verifications:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>twice()<span class="pl-k">-&gt;</span>always()<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c">// produced exactly 2 values, both of which are 'a'</span></span></pre></div>

<h2>
<a id="verification" class="anchor" href="#verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verification</h2>

<p>"Verification" is a general term, used to refer to any <em>Phony</em> method or
function that asserts that something happened. <em>Phony</em> implements many
verification methods and functions across its APIs, but they all behave in a
similar manner.</p>

<p>Each verification method or function has two variants. For most use-cases, the
<a href="#standard-verification">standard verification</a> style will be the best fit. When verification fails,
this variant will record an assertion failure with the <a href="#integration-with-test-frameworks">testing framework</a> in
use. This typically (but not always) involves an exception being thrown.</p>

<p>For situations where this is not desirable, the <a href="#check-verification">check verification</a> style can
be used. When verification fails, this variant will simply return <code>null</code>, and no
assertion failure will be recorded with the <a href="#integration-with-test-frameworks">testing framework</a> in use.</p>

<p>For information on specific verification methods, see these sections:</p>

<ul>
<li>
<a href="#spies">Spies</a>

<ul>
<li>
<a href="#call-verification">Call verification</a>

<ul>
<li><a href="#call-count">Call count</a></li>
<li><a href="#individual-calls">Individual calls</a></li>
</ul>
</li>
<li>
<a href="#verifying-spy-input">Verifying spy input</a>

<ul>
<li><a href="#verifying-that-a-call-was-made">Verifying that a call was made</a></li>
<li><a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a></li>
<li><a href="#verifying-spy-closure-binding">Verifying spy closure binding</a></li>
</ul>
</li>
<li>
<a href="#verifying-spy-output">Verifying spy output</a>

<ul>
<li><a href="#verifying-spy-return-values">Verifying spy return values</a></li>
<li><a href="#verifying-spy-exceptions">Verifying spy exceptions</a></li>
</ul>
</li>
<li>
<a href="#verifying-spies-with-generators-or-traversables">Verifying spies with generators or traversables</a>

<ul>
<li><a href="#verifying-values-produced-by-spies">Verifying values produced by spies</a></li>
<li><a href="#verifying-values-received-by-spies">Verifying values received by spies</a></li>
<li><a href="#verifying-exceptions-received-by-spies">Verifying exceptions received by spies</a></li>
</ul>
</li>
<li>
<a href="#verifying-cardinality-with-spies">Verifying cardinality with spies</a>

<ul>
<li><a href="#verifying-that-a-spy-event-happened-an-exact-number-of-times">Verifying that a spy event happened an exact number of times</a></li>
<li><a href="#verifying-that-a-spy-event-happened-a-bounded-number-of-times">Verifying that a spy event happened a bounded number of times</a></li>
<li><a href="#verifying-that-all-spy-events-happen-the-same-way">Verifying that all spy events happen the same way</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#calls">Calls</a>

<ul>
<li>
<a href="#verifying-call-input">Verifying call input</a>

<ul>
<li><a href="#verifying-that-a-call-was-made-with-specific-arguments">Verifying that a call was made with specific arguments</a></li>
<li><a href="#verifying-call-closure-binding">Verifying call closure binding</a></li>
</ul>
</li>
<li>
<a href="#verifying-call-output">Verifying call output</a>

<ul>
<li><a href="#verifying-call-return-values">Verifying call return values</a></li>
<li><a href="#verifying-call-exceptions">Verifying call exceptions</a></li>
</ul>
</li>
<li>
<a href="#verifying-calls-with-generators-or-traversables">Verifying calls with generators or traversables</a>

<ul>
<li><a href="#verifying-values-produced-by-calls">Verifying values produced by calls</a></li>
<li><a href="#verifying-values-received-by-calls">Verifying values received by calls</a></li>
<li><a href="#verifying-exceptions-received-by-calls">Verifying exceptions received by calls</a></li>
</ul>
</li>
<li>
<a href="#verifying-cardinality-with-calls">Verifying cardinality with calls</a>

<ul>
<li><a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a></li>
<li><a href="#verifying-that-a-call-event-happened-a-bounded-number-of-times">Verifying that a call event happened a bounded number of times</a></li>
<li><a href="#verifying-that-all-call-events-happen-the-same-way">Verifying that all call events happen the same way</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#verification">Verification</a>

<ul>
<li><a href="#the-verification-result-api">The verification result API</a></li>
<li><a href="#the-event-api">The event API</a></li>
<li><a href="#the-order-verification-api">The order verification API</a></li>
<li><a href="#standard-verification">Standard verification</a></li>
<li><a href="#check-verification">Check verification</a></li>
<li>
<a href="#order-verification">Order verification</a>

<ul>
<li><a href="#dynamic-order-verification">Dynamic order verification</a></li>
<li>
<a href="#order-verification-caveats">Order verification caveats</a>

<ul>
<li><a href="#intermediate-events-in-order-verification">Intermediate events in order verification</a></li>
<li><a href="#similar-events-in-order-verification">Similar events in order verification</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#verifying-that-there-was-no-interaction-with-a-mock">Verifying that there was no interaction with a mock</a></li>
</ul>
</li>
</ul>

<h3>
<a id="the-verification-result-api" class="anchor" href="#the-verification-result-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The verification result API</h3>

<p><a name="verification.arguments"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-arguments-api">arguments</a></em> $verification-&gt;<a href="#verification.arguments"><strong>arguments</strong></a>()
throws <a href="#undefinedcallexception">UndefinedCallException</a></p>
</blockquote>

<p>Get the arguments of the first call.</p>

<p><a name="verification.hasCalls"></a></p>

<hr>

<blockquote>
<p><em>boolean</em> $verification-&gt;<a href="#verification.hasCalls"><strong>hasCalls</strong></a>()</p>
</blockquote>

<p>Returns <code>true</code> if this verification matched any calls.</p>

<p><a name="verification.callCount"></a></p>

<hr>

<blockquote>
<p><em>integer</em> $verification-&gt;<a href="#verification.callCount"><strong>callCount</strong></a>()</p>
</blockquote>

<p>Get the number of calls.</p>

<p><a name="verification.allCalls"></a></p>

<hr>

<blockquote>
<p><em>array&lt;<a href="#the-call-api">call</a>&gt;</em> $verification-&gt;<a href="#verification.allCalls"><strong>allCalls</strong></a>()</p>
</blockquote>

<p>Get all calls as an array.</p>

<p><a name="verification.firstCall"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-call-api">call</a></em> $verification-&gt;<a href="#verification.firstCall"><strong>firstCall</strong></a>()
throws <a href="#undefinedcallexception">UndefinedCallException</a></p>
</blockquote>

<p>Get the first call.</p>

<p><a name="verification.lastCall"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-call-api">call</a></em> $verification-&gt;<a href="#verification.lastCall"><strong>lastCall</strong></a>()
throws <a href="#undefinedcallexception">UndefinedCallException</a></p>
</blockquote>

<p>Get the last call.</p>

<p><a name="verification.callAt"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-call-api">call</a></em> $verification-&gt;<a href="#verification.callAt"><strong>callAt</strong></a>($index = 0)
throws <a href="#undefinedcallexception">UndefinedCallException</a></p>
</blockquote>

<p>Get the call at <code>$index</code>.</p>

<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>

<p><a name="verification.hasEvents"></a></p>

<hr>

<blockquote>
<p><em>boolean</em> $verification-&gt;<a href="#verification.hasEvents"><strong>hasEvents</strong></a>()</p>
</blockquote>

<p>Returns <code>true</code> if this verification matched any events.</p>

<p><a name="verification.eventCount"></a></p>

<hr>

<blockquote>
<p><em>integer</em> $verification-&gt;<a href="#verification.eventCount"><strong>eventCount</strong></a>()</p>
</blockquote>

<p>Get the number of events.</p>

<p><a name="verification.allEvents"></a></p>

<hr>

<blockquote>
<p><em>array&lt;<a href="#the-event-api">event</a>&gt;</em> $verification-&gt;<a href="#verification.allEvents"><strong>allEvents</strong></a>()</p>
</blockquote>

<p>Get all events as an array.</p>

<p><a name="verification.firstEvent"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-event-api">event</a></em> $verification-&gt;<a href="#verification.firstEvent"><strong>firstEvent</strong></a>()
throws <a href="#undefinedeventexception">UndefinedEventException</a></p>
</blockquote>

<p>Get the first event.</p>

<p><a name="verification.lastEvent"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-event-api">event</a></em> $verification-&gt;<a href="#verification.lastEvent"><strong>lastEvent</strong></a>()
throws <a href="#undefinedeventexception">UndefinedEventException</a></p>
</blockquote>

<p>Get the last event.</p>

<p><a name="verification.eventAt"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-event-api">event</a></em> $verification-&gt;<a href="#verification.eventAt"><strong>eventAt</strong></a>($index = 0)
throws <a href="#undefinedeventexception">UndefinedEventException</a></p>
</blockquote>

<p>Get the event at <code>$index</code>.</p>

<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>

<h3>
<a id="the-event-api" class="anchor" href="#the-event-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The event API</h3>

<p><a name="event.time"></a></p>

<hr>

<blockquote>
<p><em>float</em> $event-&gt;<a href="#event.time"><strong>time</strong></a>()</p>
</blockquote>

<p>Get the time at which the event occurred, in seconds since the Unix epoch.</p>

<p><a name="event.sequenceNumber"></a></p>

<hr>

<blockquote>
<p><em>integer</em> $event-&gt;<a href="#event.sequenceNumber"><strong>sequenceNumber</strong></a>()</p>
</blockquote>

<p>Get the sequence number.</p>

<p><em>The sequence number is a unique number assigned to every event that Phony
records. The numbers are assigned sequentially, meaning that sequence numbers
can be used to determine event order.</em></p>

<h3>
<a id="the-order-verification-api" class="anchor" href="#the-order-verification-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The order verification API</h3>

<p><a name="facade.checkInOrder"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> <a href="#facade.checkInOrder"><strong>checkInOrder</strong></a>(...$events) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-verification-result-api">verification</a>|null</em> x\<a href="#facade.checkInOrder"><strong>checkInOrder</strong></a>(...$events) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-verification-result-api">verification</a>|null</em> Phony::<a href="#facade.checkInOrder"><strong>checkInOrder</strong></a>(...$events) <em>(static)</em></p>
</blockquote>

<p>Checks if the supplied events happened in chronological order.</p>

<p><em>Each value in <code>$events</code> should be an event, or a <a href="#the-verification-result-api">verification result</a>.</em></p>

<p><em>See <a href="#order-verification">Order verification</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="facade.inOrder"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> <a href="#facade.inOrder"><strong>inOrder</strong></a>(...$events) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em>
throws <a href="#assertionexception">AssertionException</a><br>
<em><a href="#the-verification-result-api">verification</a></em> x\<a href="#facade.inOrder"><strong>inOrder</strong></a>(...$events) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em>
throws <a href="#assertionexception">AssertionException</a><br>
<em><a href="#the-verification-result-api">verification</a></em> Phony::<a href="#facade.inOrder"><strong>inOrder</strong></a>(...$events) <em>(static)</em>
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless the supplied events happened in chronological order.</p>

<p><em>Each value in <code>$events</code> should be an event, or a <a href="#the-verification-result-api">verification result</a>.</em></p>

<p><em>See <a href="#order-verification">Order verification</a>.</em></p>

<p><a name="facade.checkInOrderSequence"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> <a href="#facade.checkInOrderSequence"><strong>checkInOrderSequence</strong></a>($events) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-verification-result-api">verification</a>|null</em> x\<a href="#facade.checkInOrderSequence"><strong>checkInOrderSequence</strong></a>($events) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-verification-result-api">verification</a>|null</em> Phony::<a href="#facade.checkInOrderSequence"><strong>checkInOrderSequence</strong></a>($events) <em>(static)</em></p>
</blockquote>

<p>Checks if the supplied event sequence happened in chronological order.</p>

<p><em>Each value in <code>$events</code> should be an event, or a <a href="#the-verification-result-api">verification result</a>.</em></p>

<p><em>See <a href="#dynamic-order-verification">Dynamic order verification</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="facade.inOrderSequence"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> <a href="#facade.inOrderSequence"><strong>inOrderSequence</strong></a>($events) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em>
throws <a href="#assertionexception">AssertionException</a><br>
<em><a href="#the-verification-result-api">verification</a></em> x\<a href="#facade.inOrderSequence"><strong>inOrderSequence</strong></a>($events) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em>
throws <a href="#assertionexception">AssertionException</a><br>
<em><a href="#the-verification-result-api">verification</a></em> Phony::<a href="#facade.inOrderSequence"><strong>inOrderSequence</strong></a>($events) <em>(static)</em>
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless the supplied event sequence happened in chronological
order.</p>

<p><em>Each value in <code>$events</code> should be an event, or a <a href="#the-verification-result-api">verification result</a>.</em></p>

<p><em>See <a href="#dynamic-order-verification">Dynamic order verification</a>.</em></p>

<p><a name="facade.checkAnyOrder"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> <a href="#facade.checkAnyOrder"><strong>checkAnyOrder</strong></a>(...$events) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-verification-result-api">verification</a>|null</em> x\<a href="#facade.checkAnyOrder"><strong>checkAnyOrder</strong></a>(...$events) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-verification-result-api">verification</a>|null</em> Phony::<a href="#facade.checkAnyOrder"><strong>checkAnyOrder</strong></a>(...$events) <em>(static)</em></p>
</blockquote>

<p>Checks that at least one event is supplied.</p>

<p><em>Each value in <code>$events</code> should be an event, or a <a href="#the-verification-result-api">verification result</a>.</em></p>

<p><em>See <a href="#order-verification">Order verification</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="facade.anyOrder"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> <a href="#facade.anyOrder"><strong>anyOrder</strong></a>(...$events) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em>
throws <a href="#assertionexception">AssertionException</a><br>
<em><a href="#the-verification-result-api">verification</a></em> x\<a href="#facade.anyOrder"><strong>anyOrder</strong></a>(...$events) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em>
throws <a href="#assertionexception">AssertionException</a><br>
<em><a href="#the-verification-result-api">verification</a></em> Phony::<a href="#facade.anyOrder"><strong>anyOrder</strong></a>(...$events) <em>(static)</em>
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless at least one event is supplied.</p>

<p><em>Each value in <code>$events</code> should be an event, or a <a href="#the-verification-result-api">verification result</a>.</em></p>

<p><em>See <a href="#order-verification">Order verification</a>.</em></p>

<p><a name="facade.checkAnyOrderSequence"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> <a href="#facade.checkAnyOrderSequence"><strong>checkAnyOrderSequence</strong></a>($events) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-verification-result-api">verification</a>|null</em> x\<a href="#facade.checkAnyOrderSequence"><strong>checkAnyOrderSequence</strong></a>($events) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-verification-result-api">verification</a>|null</em> Phony::<a href="#facade.checkAnyOrderSequence"><strong>checkAnyOrderSequence</strong></a>($events) <em>(static)</em></p>
</blockquote>

<p>Checks if the supplied event sequence contains at least one event.</p>

<p><em>Each value in <code>$events</code> should be an event, or a <a href="#the-verification-result-api">verification result</a>.</em></p>

<p><em>See <a href="#dynamic-order-verification">Dynamic order verification</a>, <a href="#check-verification">Check verification</a>.</em></p>

<p><a name="facade.anyOrderSequence"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> <a href="#facade.anyOrderSequence"><strong>anyOrderSequence</strong></a>($events) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em>
throws <a href="#assertionexception">AssertionException</a><br>
<em><a href="#the-verification-result-api">verification</a></em> x\<a href="#facade.anyOrderSequence"><strong>anyOrderSequence</strong></a>($events) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em>
throws <a href="#assertionexception">AssertionException</a><br>
<em><a href="#the-verification-result-api">verification</a></em> Phony::<a href="#facade.anyOrderSequence"><strong>anyOrderSequence</strong></a>($events) <em>(static)</em>
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>

<p>Throws an exception unless the supplied event sequence contains at least one
event.</p>

<p><em>Each value in <code>$events</code> should be an event, or a <a href="#the-verification-result-api">verification result</a>.</em></p>

<p><em>See <a href="#dynamic-order-verification">Dynamic order verification</a>.</em></p>

<h3>
<a id="standard-verification" class="anchor" href="#standard-verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Standard verification</h3>

<p>"Standard" verification involves "recording" failures with the
<a href="#integration-with-test-frameworks">testing framework</a> in use. For most testing frameworks, this involves throwing
a specific type of exception used by the framework.</p>

<p>In some cases, the framework will not use a specific exception type, and will
treat <em>any</em> exception as a failure. In this case, and in the case that no
<a href="#integration-with-test-frameworks">testing framework</a> is being used, <em>Phony</em> will simply throw its own
<a href="#assertionexception">AssertionException</a> on failure.</p>

<p>In rare cases, such as use with <a href="https://github.com/simpletest/simpletest">SimpleTest</a>, failures do not result in any
exception being thrown. The failure is recorded with the <a href="#integration-with-test-frameworks">testing framework</a>
via whatever method the framework uses instead. This may mean that execution
continues past the failed verification call.</p>

<p>As with <a href="#check-verification">check verification</a>, verification successes will return a
<a href="#the-verification-result-api">verification result</a>, which can be used for further verifications, including
<a href="#order-verification">order verification</a>.</p>

<h3>
<a id="check-verification" class="anchor" href="#check-verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Check verification</h3>

<p>In contrast to <a href="#standard-verification">standard verification</a>, "check" verification does not involve
integration with the <a href="#integration-with-test-frameworks">testing framework</a> in use.</p>

<p>In the case of verification failure, <code>null</code> will be returned. As with
<a href="#standard-verification">standard verification</a>, verification successes will return a
<a href="#the-verification-result-api">verification result</a>, which can be used for further verifications, including
<a href="#order-verification">order verification</a>.</p>

<p>Check verification may be used to integrate with <a href="#integration-with-test-frameworks">testing frameworks</a> that do
not yet have first-class support in <em>Phony</em>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">expect(<span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>checkCalled())<span class="pl-k">-&gt;</span><span class="pl-smi">to</span><span class="pl-k">-&gt;</span><span class="pl-smi">be</span><span class="pl-k">-&gt;</span><span class="pl-smi">ok</span>;</span></pre></div>

<h3>
<a id="order-verification" class="anchor" href="#order-verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Order verification</h3>

<p>To verify that events happened in a particular order, use
<a href="#facade.inOrder"><code>inOrder()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">// with `use function`</span></span>
<span class="pl-s1">inOrder(</span>
<span class="pl-s1">    <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">    <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">    <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">    <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-c1">x\</span>inOrder(</span>
<span class="pl-s1">    <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">    <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">    <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">    <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// static</span></span>
<span class="pl-s1"><span class="pl-c1">Phony</span><span class="pl-k">::</span>inOrder(</span>
<span class="pl-s1">    <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">    <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">    <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">    <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">);</span></pre></div>

<p>To relax order verification within a call to <a href="#facade.inOrder"><code>inOrder()</code></a>, use
<a href="#facade.anyOrder"><code>anyOrder()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">// with `use function`</span></span>
<span class="pl-s1">inOrder(</span>
<span class="pl-s1">    anyOrder(</span>
<span class="pl-s1">        <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">        <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    ),</span>
<span class="pl-s1">    anyOrder(</span>
<span class="pl-s1">        <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">        <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    )</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-c1">x\</span>inOrder(</span>
<span class="pl-s1">    <span class="pl-c1">x\</span>anyOrder(</span>
<span class="pl-s1">        <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">        <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    ),</span>
<span class="pl-s1">    <span class="pl-c1">x\</span>anyOrder(</span>
<span class="pl-s1">        <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">        <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    )</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// static</span></span>
<span class="pl-s1"><span class="pl-c1">Phony</span><span class="pl-k">::</span>inOrder(</span>
<span class="pl-s1">    <span class="pl-c1">Phony</span><span class="pl-k">::</span>anyOrder(</span>
<span class="pl-s1">        <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">        <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    ),</span>
<span class="pl-s1">    <span class="pl-c1">Phony</span><span class="pl-k">::</span>anyOrder(</span>
<span class="pl-s1">        <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">        <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    )</span>
<span class="pl-s1">);</span></pre></div>

<p>Event order can be verified across all defined mocks, stubs, and spies, using
any <a href="#verification">verification</a> implemented by <em>Phony</em>. Both <a href="#facade.inOrder"><code>inOrder()</code></a>
and <a href="#facade.anyOrder"><code>anyOrder()</code></a> will accept any number of
<a href="#the-verification-result-api">verification results</a> to verify.</p>

<h4>
<a id="dynamic-order-verification" class="anchor" href="#dynamic-order-verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Dynamic order verification</h4>

<p>In addition to <a href="#facade.inOrder"><code>inOrder()</code></a> and
<a href="#facade.anyOrder"><code>anyOrder()</code></a>, there are also
<a href="#facade.inOrderSequence"><code>inOrderSequence()</code></a> and
<a href="#facade.anyOrderSequence"><code>anyOrderSequence()</code></a> variants that accept any array
or traversable containing <a href="#the-verification-result-api">verification results</a>. These variants can be used
when the number of events to verify is dynamic:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$calledEvents</span> <span class="pl-k">=</span> [];</span>
<span class="pl-s1"><span class="pl-smi">$returnedEvents</span> <span class="pl-k">=</span> [];</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">foreach</span> (<span class="pl-smi">$spies</span> <span class="pl-k">as</span> <span class="pl-smi">$spy</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$calledEvents</span>[] <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>called();</span>
<span class="pl-s1">    <span class="pl-smi">$returnedEvents</span>[] <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>returned();</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// with `use function`</span></span>
<span class="pl-s1">inOrderSequence(</span>
<span class="pl-s1">    [</span>
<span class="pl-s1">        anyOrderSequence(<span class="pl-smi">$calledEvents</span>),</span>
<span class="pl-s1">        anyOrderSequence(<span class="pl-smi">$returnedEvents</span>),</span>
<span class="pl-s1">    ]</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-c1">x\</span>inOrderSequence(</span>
<span class="pl-s1">    [</span>
<span class="pl-s1">        <span class="pl-c1">x\</span>anyOrderSequence(<span class="pl-smi">$calledEvents</span>),</span>
<span class="pl-s1">        <span class="pl-c1">x\</span>anyOrderSequence(<span class="pl-smi">$returnedEvents</span>),</span>
<span class="pl-s1">    ]</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// static</span></span>
<span class="pl-s1"><span class="pl-c1">Phony</span><span class="pl-k">::</span>inOrderSequence(</span>
<span class="pl-s1">    [</span>
<span class="pl-s1">        <span class="pl-c1">Phony</span><span class="pl-k">::</span>anyOrderSequence(<span class="pl-smi">$calledEvents</span>),</span>
<span class="pl-s1">        <span class="pl-c1">Phony</span><span class="pl-k">::</span>anyOrderSequence(<span class="pl-smi">$returnedEvents</span>),</span>
<span class="pl-s1">    ]</span>
<span class="pl-s1">);</span></pre></div>

<p>Note that <a href="#facade.inOrder"><code>inOrder()</code></a>, <a href="#facade.anyOrder"><code>anyOrder()</code></a>,
<a href="#facade.inOrderSequence"><code>inOrderSequence()</code></a>, and
<a href="#facade.anyOrderSequence"><code>anyOrderSequence()</code></a> can be used together in
whatever fashion is most appropriate for the situation:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">inOrder(</span>
<span class="pl-s1">    anyOrderSequence(<span class="pl-smi">$calledEvents</span>),</span>
<span class="pl-s1">    anyOrderSequence(<span class="pl-smi">$returnedEvents</span>),</span>
<span class="pl-s1">);</span></pre></div>

<h4>
<a id="order-verification-caveats" class="anchor" href="#order-verification-caveats" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Order verification caveats</h4>

<h5>
<a id="intermediate-events-in-order-verification" class="anchor" href="#intermediate-events-in-order-verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Intermediate events in order verification</h5>

<p>Order verification <strong>does not</strong> verify that the specified events were the <em>only</em>
events that occurred:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$withA</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$withB</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$withC</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">inOrder(<span class="pl-smi">$withA</span>, <span class="pl-smi">$withB</span>); <span class="pl-c">// passes</span></span>
<span class="pl-s1">inOrder(<span class="pl-smi">$withA</span>, <span class="pl-smi">$withC</span>); <span class="pl-c">// passes</span></span>
<span class="pl-s1">inOrder(<span class="pl-smi">$withB</span>, <span class="pl-smi">$withC</span>); <span class="pl-c">// passes</span></span></pre></div>

<p>To verify that specific events did not occur, use <a href="#spy.never"><code>$spy-&gt;never()</code></a>
or <a href="#call.never"><code>$call-&gt;never()</code></a>.</p>

<h5>
<a id="similar-events-in-order-verification" class="anchor" href="#similar-events-in-order-verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Similar events in order verification</h5>

<p>Order verification <strong>does not</strong> verify that the specified events happened in
<em>only</em> one order:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$withA</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$withB</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">inOrder(<span class="pl-smi">$withA</span>, <span class="pl-smi">$withB</span>);         <span class="pl-c">// passes</span></span>
<span class="pl-s1">inOrder(<span class="pl-smi">$withB</span>, <span class="pl-smi">$withA</span>);         <span class="pl-c">// passes</span></span>
<span class="pl-s1">inOrder(<span class="pl-smi">$withA</span>, <span class="pl-smi">$withB</span>, <span class="pl-smi">$withA</span>); <span class="pl-c">// passes</span></span></pre></div>

<p>However, it <em>is</em> possible to verify event order more explicitly using
<a href="#individual-calls">individual calls</a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">inOrder(<span class="pl-smi">$withA</span><span class="pl-k">-&gt;</span>firstCall(), <span class="pl-smi">$withB</span>); <span class="pl-c">// passes</span></span>
<span class="pl-s1">inOrder(<span class="pl-smi">$withA</span><span class="pl-k">-&gt;</span>lastCall(), <span class="pl-smi">$withB</span>);  <span class="pl-c">// fails</span></span></pre></div>

<p>Of course, extracting <a href="#individual-calls">individual calls</a> is only helpful when verifying the
order of calls. Similar methods exist to aid in explicitly verifying the order
of other types of events:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-smi">$x</span>) {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-smi">$x</span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$returnedA</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$returnedB</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">inOrder(<span class="pl-smi">$returnedA</span><span class="pl-k">-&gt;</span>firstEvent(), <span class="pl-smi">$returnedB</span>); <span class="pl-c">// passes</span></span>
<span class="pl-s1">inOrder(<span class="pl-smi">$returnedA</span><span class="pl-k">-&gt;</span>lastEvent(), <span class="pl-smi">$returnedB</span>);  <span class="pl-c">// fails</span></span></pre></div>

<h3>
<a id="verifying-that-there-was-no-interaction-with-a-mock" class="anchor" href="#verifying-that-there-was-no-interaction-with-a-mock" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that there was no interaction with a mock</h3>

<p>To verify that there was no interaction with a mock, use
<a href="#handle.noInteraction"><code>noInteraction()</code></a> on any <a href="#mock-handles">mock handle</a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>noInteraction(); <span class="pl-c">// passes</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>noInteraction(); <span class="pl-c">// fails</span></span></pre></div>

<p>This verification will fail if any of the mock's methods have been called.</p>

<h2>
<a id="matchers" class="anchor" href="#matchers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Matchers</h2>

<p><em>Matchers</em> are used to determine whether the arguments of a call match certain
criteria. Utilized correctly, they can make verifications less brittle, and
improve the quality of a test suite.</p>

<p><em>Phony</em> implements only a few matchers itself, and provides first-class support
for numerous third-party matcher libraries.</p>

<h3>
<a id="the-matcher-api" class="anchor" href="#the-matcher-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The matcher API</h3>

<p><a name="facade.any"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-matcher-api">matcher</a></em> <a href="#facade.any"><strong>any</strong></a>() <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-matcher-api">matcher</a></em> x\<a href="#facade.any"><strong>any</strong></a>() <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-matcher-api">matcher</a></em> Phony::<a href="#facade.any"><strong>any</strong></a>() <em>(static)</em></p>
</blockquote>

<p>Create a new <a href="#the-any-matcher">"any" matcher</a>.</p>

<p><a name="facade.equalTo"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-matcher-api">matcher</a></em> <a href="#facade.equalTo"><strong>equalTo</strong></a>($value) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-matcher-api">matcher</a></em> x\<a href="#facade.equalTo"><strong>equalTo</strong></a>($value) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-matcher-api">matcher</a></em> Phony::<a href="#facade.equalTo"><strong>equalTo</strong></a>($value) <em>(static)</em></p>
</blockquote>

<p>Create a new <a href="#the-equal-to-matcher">"equal to" matcher</a>.</p>

<p><a name="matcher.matches"></a></p>

<hr>

<blockquote>
<p><em>boolean</em> $matcher-&gt;<a href="#matcher.matches"><strong>matches</strong></a>($value)</p>
</blockquote>

<p>Returns <code>true</code> if <code>$value</code> matches this matcher's criteria.</p>

<p><a name="matcher.describe"></a>
<a name="matcher.__toString"></a></p>

<hr>

<blockquote>
<p><em>string</em> $matcher-&gt;<a href="#matcher.describe"><strong>describe</strong></a>() or
<a href="#matcher.__toString"><strong>"$matcher"</strong></a></p>
</blockquote>

<p>Describe this matcher.</p>

<h3>
<a id="the-wildcard-matcher-api" class="anchor" href="#the-wildcard-matcher-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The wildcard matcher API</h3>

<p><a name="facade.wildcard"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-wildcard-matcher-api">wildcard</a></em> <a href="#facade.wildcard"><strong>wildcard</strong></a>($value = null, $minimumArguments = 0, $maximumArguments = null) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-wildcard-matcher-api">wildcard</a></em> x\<a href="#facade.wildcard"><strong>wildcard</strong></a>($value = null, $minimumArguments = 0, $maximumArguments = null) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-wildcard-matcher-api">wildcard</a></em> Phony::<a href="#facade.wildcard"><strong>wildcard</strong></a>($value = null, $minimumArguments = 0, $maximumArguments = null) <em>(static)</em></p>
</blockquote>

<p>Create a new <a href="#the-wildcard-matcher">"wildcard" matcher</a>.</p>

<p><em>The <code>$value</code> parameter accepts a value, or a <a href="#matchers">matcher</a>, to check against each
argument that the wildcard matches.</em></p>

<p><a name="wildcard.matcher"></a></p>

<hr>

<blockquote>
<p><em><a href="#the-matcher-api">matcher</a></em> $wildcard-&gt;<a href="#wildcard.matcher"><strong>matcher</strong></a>()</p>
</blockquote>

<p>Get the matcher to use for each argument.</p>

<p><a name="wildcard.minimumArguments"></a></p>

<hr>

<blockquote>
<p><em>integer</em> $wildcard-&gt;<a href="#wildcard.minimumArguments"><strong>minimumArguments</strong></a>()</p>
</blockquote>

<p>Get the minimum number of arguments to match.</p>

<p><a name="wildcard.maximumArguments"></a></p>

<hr>

<blockquote>
<p><em>integer|null</em> $wildcard-&gt;<a href="#wildcard.maximumArguments"><strong>maximumArguments</strong></a>()</p>
</blockquote>

<p>Get the maximum number of arguments to match.</p>

<p><a name="wildcard.describe"></a>
<a name="wildcard.__toString"></a></p>

<hr>

<blockquote>
<p><em>string</em> $wildcard-&gt;<a href="#wildcard.describe"><strong>describe</strong></a>() or
<a href="#wildcard.__toString"><strong>"$wildcard"</strong></a></p>
</blockquote>

<p>Describe this matcher.</p>

<h3>
<a id="matcher-integrations" class="anchor" href="#matcher-integrations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Matcher integrations</h3>

<h4>
<a id="counterpart-matchers" class="anchor" href="#counterpart-matchers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="http://docs.counterpartphp.org/">Counterpart</a> matchers</h4>

<p><a href="http://docs.counterpartphp.org/">Counterpart</a> is a stand-alone matcher library. Its matchers can be used in any
<em>Phony</em> verification:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-c1">Counterpart\</span><span class="pl-c1">Matchers</span><span class="pl-k">::</span>isEqual(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>));</span></pre></div>

<h4>
<a id="hamcrest-matchers" class="anchor" href="#hamcrest-matchers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://github.com/hamcrest/hamcrest-php">Hamcrest</a> matchers</h4>

<p><a href="https://github.com/hamcrest/hamcrest-php">Hamcrest</a> is a popular stand-alone matcher library, that originated in Java,
and has been ported to many languages, including an "official" port for PHP. Its
matchers can be used in any <em>Phony</em> verification:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(equalTo(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>));</span></pre></div>

<h4>
<a id="mockery-matchers" class="anchor" href="#mockery-matchers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="http://docs.mockery.io/">Mockery</a> matchers</h4>

<p><a href="http://docs.mockery.io/">Mockery</a> is a mocking library, similar to <em>Phony</em>. <a href="http://docs.mockery.io/en/latest/reference/argument_validation.html">Mockery matchers</a> can be
used in any <em>Phony</em> verification:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-c1">Mockery</span><span class="pl-k">::</span>mustBe(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>));</span></pre></div>

<h4>
<a id="phake-matchers" class="anchor" href="#phake-matchers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="http://phake.readthedocs.org/">Phake</a> matchers</h4>

<p><a href="http://phake.readthedocs.org/">Phake</a> is a mocking library, similar to <em>Phony</em>. <a href="http://phake.readthedocs.org/en/latest/method-parameter-matchers.html">Phake matchers</a> can be used
in any <em>Phony</em> verification:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-c1">Phake</span><span class="pl-k">::</span>equalTo(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>));</span></pre></div>

<h4>
<a id="phpunit-constraints" class="anchor" href="#phpunit-constraints" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://phpunit.de/">PHPUnit</a> constraints</h4>

<p><a href="https://phpunit.de/">PHPUnit</a> is a popular unit testing framework. <a href="https://phpunit.de/manual/current/en/appendixes.assertions.html#appendixes.assertions.assertThat">PHPUnit matchers</a> (referred to
as "constraints") can be used in any <em>Phony</em> verification:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">// where $this is a PHPUnit test case</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>equalTo(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>));</span></pre></div>

<h4>
<a id="prophecy-argument-tokens" class="anchor" href="#prophecy-argument-tokens" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://github.com/phpspec/prophecy">Prophecy</a> argument tokens</h4>

<p><a href="https://github.com/phpspec/prophecy">Prophecy</a> is a mocking library, similar to <em>Phony</em>. <a href="https://github.com/phpspec/prophecy#arguments-wildcarding">Prophecy matchers</a>
(referred to as "argument tokens") can be used in any <em>Phony</em> verification:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-c1">Prophecy\</span><span class="pl-c1">Argument</span><span class="pl-k">::</span>exact(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>));</span></pre></div>

<h4>
<a id="simpletest-expectations" class="anchor" href="#simpletest-expectations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://github.com/simpletest/simpletest">SimpleTest</a> expectations</h4>

<p><a href="https://github.com/simpletest/simpletest">SimpleTest</a> is a legacy unit testing framework. <a href="http://www.simpletest.org/en/expectation_documentation.html">SimpleTest matchers</a>
(referred to as "expectations") can be used in any <em>Phony</em> verification:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-k">new</span> <span class="pl-c1">EqualExpectation</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>));</span></pre></div>

<h3>
<a id="shorthand-matchers" class="anchor" href="#shorthand-matchers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Shorthand matchers</h3>

<p><em>Phony</em> provides two "shorthand matchers"; <code>'~'</code>, and <code>'*'</code>. These strings are
automatically transformed into specific matchers:</p>

<ul>
<li>
<code>'~'</code> is equivalent to an <a href="#the-any-matcher">"any" matcher</a>
</li>
<li>
<code>'*'</code> is equivalent to a <a href="#the-wildcard-matcher">"wildcard" matcher</a>
</li>
</ul>

<p>For typical <em>Phony</em> usage, this results in much simpler verifications. For
example, the following verifications are exactly equivalent:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, any(), <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, wildcard());</span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>);</span></pre></div>

<p>In the case that a verification expects a literal <code>'~'</code>, or <code>'*'</code> value, the
<a href="#the-equal-to-matcher">"equal to" matcher</a> can be used to prevent <em>Phony</em> interpreting shorthand
matchers:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(equalTo(<span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>), equalTo(<span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>));</span></pre></div>

<h3>
<a id="the-any-matcher" class="anchor" href="#the-any-matcher" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The "any" matcher</h3>

<p>This matcher matches a single argument of any value:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> any(<span class="pl-smi">$value</span>);        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>any(<span class="pl-smi">$value</span>);      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>any(<span class="pl-smi">$value</span>); <span class="pl-c">// static</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(any()); <span class="pl-c">// typical usage</span></span></pre></div>

<h3>
<a id="the-equal-to-matcher" class="anchor" href="#the-equal-to-matcher" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The "equal to" matcher</h3>

<p>This is the default matcher used by <em>Phony</em>. It takes a single argument, and
matches values that are equal to that argument:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> equalTo(<span class="pl-smi">$value</span>);        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> <span class="pl-c1">x\</span>equalTo(<span class="pl-smi">$value</span>);      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>equalTo(<span class="pl-smi">$value</span>); <span class="pl-c">// static</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(equalTo(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)); <span class="pl-c">// typical usage</span></span></pre></div>

<p>This matcher is equivalent to strict comparison (<code>===</code>), except that it does not
require objects to be the same <em>instance</em>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> equalTo((<span class="pl-k">object</span>) [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">0</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>(<span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches((<span class="pl-k">object</span>) [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">0</span>]));    <span class="pl-c">// outputs 'bool(true)'</span></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>(<span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches((<span class="pl-k">object</span>) [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">null</span>])); <span class="pl-c">// outputs 'bool(false)'</span></span></pre></div>

<h4>
<a id="when-to-use-the-equal-to-matcher" class="anchor" href="#when-to-use-the-equal-to-matcher" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>When to use the "equal to" matcher</h4>

<p>In most cases, it's not necessary to create an "equal to" matcher manually,
because <em>Phony</em> implicitly wraps anything that's not already a matcher. For
example, this verification:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span></pre></div>

<p>is exactly equivalent to this one:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(equalTo(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>));</span></pre></div>

<p>In fact, there are only two circumstances in which this matcher should be used.
The first is when a verification expects a literal <code>*</code> or <code>~</code> string (which
<em>Phony</em> would otherwise interpret as special <a href="#shorthand-matchers">shorthand matchers</a>):</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(equalTo(<span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>), equalTo(<span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>));</span></pre></div>

<p>The second circumstance is when a verification expects an actual matcher as an
argument:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(equalTo(<span class="pl-k">new</span> <span class="pl-c1">EqualToMatcher</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)));</span></pre></div>

<h4>
<a id="special-cases-for-the-equal-to-matcher" class="anchor" href="#special-cases-for-the-equal-to-matcher" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Special cases for the "equal to" matcher</h4>

<p>For certain types of values, the "equal to" matcher will exhibit special
behavior, in order to improve the usefulness of its comparisons, or to improve
performance in common use cases.</p>

<h5>
<a id="comparing-exceptions" class="anchor" href="#comparing-exceptions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Comparing exceptions</h5>

<p>When an exception is compared, some internal PHP details are stripped from the
output, including file path, line number, and stack trace.</p>

<p>In the following example, note that differing line numbers are ignored, but
differing codes are not:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> equalTo(<span class="pl-k">new</span> <span class="pl-c1">Exception</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>));</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Exception</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Exception</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-c1">1</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches(<span class="pl-smi">$a</span>) ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c">// outputs 'true'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches(<span class="pl-smi">$b</span>) ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c">// outputs 'false'</span></span></pre></div>

<h5>
<a id="comparing-mocks" class="anchor" href="#comparing-mocks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Comparing mocks</h5>

<p>When a mock is compared, some internal <em>Phony</em> details are ignored. In addition,
if a <a href="#labeling-mocks">label</a> has been set on the mock, it will be included in
the comparison.</p>

<p>In the following example, note that differing mock behaviors are ignored, but
differing labels are not:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> equalTo(mock(<span class="pl-s"><span class="pl-pds">'</span>ClassX<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>mock());</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>ClassX<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$a</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodX</span><span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches(<span class="pl-smi">$a</span><span class="pl-k">-&gt;</span>mock()) ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c">// outputs 'true'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>ClassX<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>ClassX<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches(<span class="pl-smi">$b</span><span class="pl-k">-&gt;</span>mock()) ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c">// outputs 'false'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches(<span class="pl-smi">$c</span><span class="pl-k">-&gt;</span>mock()) ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c">// outputs 'false'</span></span></pre></div>

<p>Since mocks are labeled with a unique integer by default, they can normally be
used to differentiate calls without requiring the use of an 'identical to'
matcher:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>ClassX<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>ClassX<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub();</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>with(<span class="pl-smi">$a</span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>with(<span class="pl-smi">$b</span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-smi">$a</span>); <span class="pl-c">// outputs 'a'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-smi">$b</span>); <span class="pl-c">// outputs 'b'</span></span></pre></div>

<h3>
<a id="the-wildcard-matcher" class="anchor" href="#the-wildcard-matcher" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The "wildcard" matcher</h3>

<p>The "wildcard" matcher is a special matcher that can match multiple arguments:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, wildcard()); <span class="pl-c">// verification passes</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, any());      <span class="pl-c">// verification fails (not enough arguments)</span></span></pre></div>

<p>It is usually much simpler to take advantage of <a href="#shorthand-matchers">shorthand matchers</a> when
dealing with wildcards:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>); <span class="pl-c">// verification passes</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>); <span class="pl-c">// verification fails (not enough arguments)</span></span></pre></div>

<p>By default, wildcard matchers will match any argument value. This behavior can
be modified by wrapping any non-wildcard matcher (including literal values) in a
wildcard. This is accomplished by passing the matcher to the wildcard as the
first argument:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(wildcard(equalTo(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>))); <span class="pl-c">// verification passes</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(wildcard(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>));          <span class="pl-c">// verification passes</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(wildcard(equalTo(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>))); <span class="pl-c">// verification fails</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(wildcard(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>));          <span class="pl-c">// verification fails</span></span></pre></div>

<p>Wildcards can also have minimum and/or maximum options, which limit how many
arguments they match. The second and third parameters, respectively, are for
specifying the minimum, and maximum argument counts:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(wildcard(<span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>)); <span class="pl-c">// verification passes</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(wildcard(<span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>, <span class="pl-c1">4</span>));    <span class="pl-c">// verification fails (too few arguments)</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(wildcard(<span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>, <span class="pl-c1">0</span>, <span class="pl-c1">2</span>)); <span class="pl-c">// verification fails (too many arguments)</span></span></pre></div>

<p>The behavior of wildcard matchers is only well defined when they appear at the
end of a matcher list. If a wildcard appears before any other matcher, any
behavior exhibited by <em>Phony</em> is not guaranteed, and may change in future
versions:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>);           <span class="pl-c">// this is supported</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>); <span class="pl-c">// this is supported</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>); <span class="pl-c">// this is not supported</span></span></pre></div>

<h4>
<a id="third-party-wildcard-matcher-integrations" class="anchor" href="#third-party-wildcard-matcher-integrations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Third-party wildcard matcher integrations</h4>

<p><em>Phony</em> also supports the use of "wildcard" style matchers from third-party
matcher systems:</p>

<h5>
<a id="phake-wildcard-matcher-integration" class="anchor" href="#phake-wildcard-matcher-integration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Phake wildcard matcher integration</h5>

<p><a href="http://phake.readthedocs.org/en/latest/method-stubbing.html?highlight=anyparameters#stubbing-consecutive-calls">Phake wildcard matchers</a> (<code>Phake::anyParameters()</code>) can be used in any <em>Phony</em>
verification:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-c1">Phake</span><span class="pl-k">::</span>anyParameters()); <span class="pl-c">// verification passes</span></span></pre></div>

<h5>
<a id="prophecy-wildcard-matcher-integration" class="anchor" href="#prophecy-wildcard-matcher-integration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Prophecy wildcard matcher integration</h5>

<p><a href="https://github.com/phpspec/prophecy#arguments-wildcarding">Prophecy wildcard matchers</a> (<code>Argument::cetera()</code>) can be used in any <em>Phony</em>
verification:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-c1">Prophecy\</span><span class="pl-c1">Argument</span><span class="pl-k">::</span>cetera()); <span class="pl-c">// verification passes</span></span></pre></div>

<h2>
<a id="the-exporter" class="anchor" href="#the-exporter" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The exporter</h2>

<p>When a <em>Phony</em> verification fails, the failure message will often contain string
representations of the actual, or expected PHP values involved. These string
representations are generated by <em>Phony</em>'s internal exporter.</p>

<h3>
<a id="the-exporter-api" class="anchor" href="#the-exporter-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The exporter API</h3>

<p><a name="facade.setExportDepth"></a></p>

<hr>

<blockquote>
<p><em>integer</em> <a href="#facade.setExportDepth"><strong>setExportDepth</strong></a>($depth) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em>integer</em> x\<a href="#facade.setExportDepth"><strong>setExportDepth</strong></a>($depth) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em>integer</em> Phony::<a href="#facade.setExportDepth"><strong>setExportDepth</strong></a>($depth) <em>(static)</em></p>
</blockquote>

<p>Set the default export depth, and return the previous depth.</p>

<p><em>Negative depths are treated as infinite depth.</em></p>

<h3>
<a id="the-export-format" class="anchor" href="#the-export-format" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The export format</h3>

<p>The exporter generates a concise, unambiguous, human-readable representation of
any PHP value, including recursive objects and arrays:</p>

<table>
<thead>
<tr>
<th>Input value</th>
<th>Exporter output</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>null</code></td>
<td><code>'null'</code></td>
</tr>
<tr>
<td><code>true</code></td>
<td><code>'true'</code></td>
</tr>
<tr>
<td><code>false</code></td>
<td><code>'false'</code></td>
</tr>
<tr>
<td><code>111</code></td>
<td><code>'111'</code></td>
</tr>
<tr>
<td><code>1.11</code></td>
<td><code>'1.110000e+0'</code></td>
</tr>
<tr>
<td><code>'1.11'</code></td>
<td><code>'"1.11"'</code></td>
</tr>
<tr>
<td><code>"a\nb"</code></td>
<td><code>'"a\nb"'</code></td>
</tr>
<tr>
<td><code>STDIN</code></td>
<td><code>'resource#1'</code></td>
</tr>
<tr>
<td><code>[1, 2]</code></td>
<td><code>'#0[1, 2]'</code></td>
</tr>
<tr>
<td><code>['a' =&gt; 1, 'b' =&gt; 2]</code></td>
<td><code>'#0[a: 1, b: 2]'</code></td>
</tr>
<tr>
<td><code>(object) ['a' =&gt; 1, 'b' =&gt; 2]</code></td>
<td><code>'#0{a: 1, b: 2}'</code></td>
</tr>
<tr>
<td><code>new ClassA()</code></td>
<td><code>'ClassA#0{}'</code></td>
</tr>
</tbody>
</table>

<h4>
<a id="export-identifiers-and-references" class="anchor" href="#export-identifiers-and-references" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Export identifiers and references</h4>

<p>Exported arrays and objects include a numeric identifier that can be used to
identify re-use of the same value in nested structures. When a value appears
multiple times, its internal structure will only be described the first time.
Subsequent appearances will be indicated by a reference to the value's
identifier:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$inner</span> <span class="pl-k">=</span> [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>];</span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [<span class="pl-smi">$inner</span>, <span class="pl-smi">$inner</span>];</span>
<span class="pl-s1"><span class="pl-c">// $value is exported as '#0[#1[1, 2], #1[]]'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$inner</span> <span class="pl-k">=</span> (<span class="pl-k">object</span>) [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">1</span>];</span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> (<span class="pl-k">object</span>) [<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$inner</span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$inner</span>];</span>
<span class="pl-s1"><span class="pl-c">// $value is exported as '#0{b: #1{a: 1}, c: #1{}}'</span></span></pre></div>

<p>Array references appear followed by brackets (e.g. <code>#0[]</code>), and object
references appear followed by braces (e.g. <code>#0{}</code>). This is because the
identifier sequences used for arrays and objects are independent, meaning that
identical array identifiers and object identifiers can co-exist in the same
exporter output:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [</span>
<span class="pl-s1">    (<span class="pl-k">object</span>) [],</span>
<span class="pl-s1">    [</span>
<span class="pl-s1">        (<span class="pl-k">object</span>) [],</span>
<span class="pl-s1">    ],</span>
<span class="pl-s1">];</span>
<span class="pl-s1"><span class="pl-c">// $value is exported as '#0[#0{}, #1[#1{}]]'</span></span></pre></div>

<p>Object references also exclude the class name for brevity:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$inner</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">ClassA</span>();</span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> (<span class="pl-k">object</span>) [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$inner</span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$inner</span>];</span>
<span class="pl-s1"><span class="pl-c">// $value is exported as '#0{a: ClassA#1{}, b: #1{}}'</span></span></pre></div>

<p>Identifiers for objects are persistent across invocations of the exporter:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> (<span class="pl-k">object</span>) [];</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> (<span class="pl-k">object</span>) [];</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [<span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>, <span class="pl-smi">$a</span>];</span>
<span class="pl-s1"><span class="pl-c">// $value is exported as '#0[#0{}, #1{}, #0{}]'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [<span class="pl-smi">$b</span>, <span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>];</span>
<span class="pl-s1"><span class="pl-c">// $value is exported as '#0[#1{}, #0{}, #1{}]'</span></span></pre></div>

<p>But due to PHP's limitations, array identifiers are only persistent within a
single exporter invocation:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> [];</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> [];</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$valueA</span> <span class="pl-k">=</span> [<span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>, <span class="pl-smi">$a</span>];</span>
<span class="pl-s1"><span class="pl-smi">$valueB</span> <span class="pl-k">=</span> [<span class="pl-smi">$b</span>, <span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>];</span>
<span class="pl-s1"><span class="pl-c">// both $valueA and $valueB are exported as '#0[#1[], #2[], #1[]]'</span></span></pre></div>

<h4>
<a id="exporting-recursive-values" class="anchor" href="#exporting-recursive-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exporting recursive values</h4>

<p>If a recursive value is exported, the points of recursion are exported as
<a href="#export-identifiers-and-references">references</a>, in the same way that multiple instances of the same value are
handled:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [];</span>
<span class="pl-s1"><span class="pl-smi">$value</span>[] <span class="pl-k">=</span> <span class="pl-k">&amp;</span><span class="pl-smi">$value</span>;</span>
<span class="pl-s1"><span class="pl-c">// $value is exported as '#0[#0[]]'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> (<span class="pl-k">object</span>) [];</span>
<span class="pl-s1"><span class="pl-smi">$value</span><span class="pl-k">-&gt;</span><span class="pl-smi">a</span> <span class="pl-k">=</span> <span class="pl-smi">$value</span>;</span>
<span class="pl-s1"><span class="pl-c">// $value is exported as '#0{"a": #0{}}'</span></span></pre></div>

<h4>
<a id="exporter-special-cases" class="anchor" href="#exporter-special-cases" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exporter special cases</h4>

<p>For certain types of values, the exporter will exhibit special behavior, in
order to improve the usefulness of its output, or to improve performance in
common use cases.</p>

<h5>
<a id="exporting-exceptions" class="anchor" href="#exporting-exceptions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exporting exceptions</h5>

<p>When an exception is exported, some internal PHP details are stripped from the
output, including file path, line number, and stack trace:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Exception</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-c1">1</span>, <span class="pl-k">new</span> <span class="pl-c1">Exception</span>());</span>
<span class="pl-s1"><span class="pl-c">// $value is exported as 'Exception#0{message: "a", code: 1, previous: Exception#1{}}'</span></span></pre></div>

<p>Additionally, when the message is <code>''</code>, the code is <code>0</code>, and/or the previous
exception is <code>null</code>, these values are excluded for brevity:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>();</span>
<span class="pl-s1"><span class="pl-c">// $value is exported as 'RuntimeException#0{}'</span></span></pre></div>

<h5>
<a id="exporting-mocks" class="anchor" href="#exporting-mocks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exporting mocks</h5>

<p>When a mock is exported, some internal <em>Phony</em> details are stripped from the
output. In addition, if a <a href="#labeling-mocks">label</a> has been set on the mock, this
will be included as a special property <code>phony.label</code>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"><span class="pl-c">// $value is exported as 'Phony_ClassA_0#0{phony.label: "a"}'</span></span></pre></div>

<h3>
<a id="export-depth" class="anchor" href="#export-depth" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Export depth</h3>

<p>For complicated nested structures, exporting the entire value right down to its
innermost values is not always desirable. <em>Phony</em> sets a limit on how deep into
a nested structure the exporter will traverse.</p>

<p>When a value is beyond the export depth, and has sub-values, its contents will
be replaced with a special notation that simply indicates how many sub-values
exist within that value:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [[], [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>]];</span>
<span class="pl-s1"><span class="pl-c">// $value is exported as '#0[#1[], #2[:3]]'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [(<span class="pl-k">object</span>) [], (<span class="pl-k">object</span>) [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>]];</span>
<span class="pl-s1"><span class="pl-c">// $value is exported as '#0[#1{}, #2{:3}]'</span></span></pre></div>

<h4>
<a id="setting-the-export-depth" class="anchor" href="#setting-the-export-depth" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setting the export depth</h4>

<p>To set the export depth, use <a href="#facade.setExportDepth"><code>setExportDepth()</code></a>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">setExportDepth(<span class="pl-smi">$depth</span>);        <span class="pl-c">// with `use function`</span></span>
<span class="pl-s1"><span class="pl-c1">x\</span>setExportDepth(<span class="pl-smi">$depth</span>);      <span class="pl-c">// without `use function`</span></span>
<span class="pl-s1"><span class="pl-c1">Phony</span><span class="pl-k">::</span>setExportDepth(<span class="pl-smi">$depth</span>); <span class="pl-c">// static</span></span></pre></div>

<p>Where <code>$depth</code> is an integer indicating the desired export depth.</p>

<p>Negative values are treated as infinite depth, and will cause <em>Phony</em> to export
values in their entirety. Note that this can produce immense amounts of output
for large nested structures.</p>

<h2>
<a id="thrown-exceptions" class="anchor" href="#thrown-exceptions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Thrown exceptions</h2>

<h3>
<a id="assertionexception" class="anchor" href="#assertionexception" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AssertionException</h3>

<p>Thrown when a verification fails. The exact exception class and implementation
depends on the <a href="#integration-with-test-frameworks">testing framework</a> in use. See <a href="#standard-verification">Standard verification</a>.</p>

<p>Other than the standard PHP <a href="http://php.net/class.exception">Exception</a> methods, assertion exceptions have no
public API methods.</p>

<h3>
<a id="undefinedargumentexception" class="anchor" href="#undefinedargumentexception" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>UndefinedArgumentException</h3>

<p>Thrown when an argument that was requested does not exist.</p>

<p>Namespace: <code>Eloquent\Phony\Call\Argument\Exception</code></p>

<p><a name="undefinedargumentexception.index"></a></p>

<hr>

<blockquote>
<p><em>integer</em> $exception-&gt;<a href="#undefinedargumentexception.index"><strong>index</strong></a>()</p>
</blockquote>

<p>Get the index.</p>

<h3>
<a id="undefinedcallexception" class="anchor" href="#undefinedcallexception" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>UndefinedCallException</h3>

<p>Thrown when a call that was requested does not exist.</p>

<p>Namespace: <code>Eloquent\Phony\Call\Exception</code></p>

<p><a name="undefinedcallexception.index"></a></p>

<hr>

<blockquote>
<p><em>integer</em> $exception-&gt;<a href="#undefinedcallexception.index"><strong>index</strong></a>()</p>
</blockquote>

<p>Get the index.</p>

<h3>
<a id="undefinedeventexception" class="anchor" href="#undefinedeventexception" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>UndefinedEventException</h3>

<p>Thrown when an event that was requested does not exist.</p>

<p>Namespace: <code>Eloquent\Phony\Event\Exception</code></p>

<p><a name="undefinedeventexception.index"></a></p>

<hr>

<blockquote>
<p><em>integer</em> $exception-&gt;<a href="#undefinedeventexception.index"><strong>index</strong></a>()</p>
</blockquote>

<p>Get the index.</p>

<h3>
<a id="undefinedresponseexception" class="anchor" href="#undefinedresponseexception" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>UndefinedResponseException</h3>

<p>Thrown when the call has not yet produced a response of the requested type.</p>

<p>This can occur when an individual call is queried for its response details
before the call has returned a value, or thrown an exception.</p>

<p>Other than the standard PHP <a href="http://php.net/class.exception">Exception</a> methods, undefined response exceptions
have no public API methods.</p>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>

<p>For the full copyright and license information, please view the <a href="https://github.com/eloquent/phony/blob/HEAD/LICENSE">LICENSE file</a>.</p>

<!-- END content -->

</div>

</div>

<script src="//cdnjs.cloudflare.com/ajax/libs/gumshoe/3.1.2/js/gumshoe.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/svg-injector/1.1.3/svg-injector.min.js"></script>
<script src="../js/phony.js"></script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-41826908-1', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>
