<!doctype html>
<html lang="en">
<head>

<meta charset="utf-8">

<title>Phony</title>

<link rel="stylesheet" href="../css/markdown.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="../css/phony.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700|Inconsolata:400,700">

<link rel="shortcut icon" href="//eloquent-software.com/img/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="//eloquent-software.com/img/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="57x57" href="//eloquent-software.com/img/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="72x72" href="//eloquent-software.com/img/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="114x114" href="//eloquent-software.com/img/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="144x144" href="//eloquent-software.com/img/apple-touch-icon-144x144.png">

</head>
<body class="markdown-body" data-version="master">

<div id="container">

<div id="toc">
    <h2>
        <span>Phony</span>

        <a href="#toc" title="Show expanded contents" id="toc-show"><i class="fa fa-plus-circle"></i></a>
        <a href="#" title="Hide expanded contents" id="toc-hide" style="display: none;">
            <i class="fa fa-minus-circle"></i>
        </a>
        <a href="#" title="Return to top"><i class="fa fa-chevron-circle-up"></i></a>
        <a href="https://github.com/eloquent/phony" title="View on GitHub"><i class="fa fa-github"></i></a>
    </h2>
    <div id="toc-relative">
        <div id="toc-scroll"></div>
        <div id="toc-fade-top"></div>
        <div id="toc-fade-bottom"></div>
    </div>
</div>

<ul id="versions"></ul>

<div id="content">

<!-- START content -->

<h1>
<a id="phony" class="anchor" href="#phony" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Phony</h1>
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#help">Help</a></li>
<li>
<a href="#usage">Usage</a>
<ul>
<li><a href="#using-this-documentation">Using this documentation</a></li>
<li><a href="#example-test-suites">Example test suites</a></li>
<li><a href="#standalone-usage">Standalone usage</a></li>
<li><a href="#kahlan-usage">Kahlan usage</a></li>
<li><a href="#peridot-usage">Peridot usage</a></li>
<li><a href="#pho-usage">Pho usage</a></li>
<li><a href="#phpunit-usage">PHPUnit usage</a></li>
<li><a href="#simpletest-usage">SimpleTest usage</a></li>
<li><a href="#integration-with-test-frameworks">Integration with test frameworks</a></li>
<li>
<a href="#importing">Importing</a>
<ul>
<li><a href="#importing-with-use-function">Importing with use function</a></li>
<li><a href="#importing-without-use-function">Importing without use function</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#mocks">Mocks</a>
<ul>
<li><a href="#mocking-basics">Mocking basics</a></li>
<li><a href="#partial-mocks">Partial mocks</a></li>
<li><a href="#proxy-mocks">Proxy mocks</a></li>
<li><a href="#mocking-multiple-types">Mocking multiple types</a></li>
<li>
<a href="#ad-hoc-mocks">Ad hoc mocks</a>
<ul>
<li><a href="#ad-hoc-definition-values">Ad hoc definition values</a></li>
<li><a href="#ad-hoc-definition-magic-self-values">Ad hoc definition magic "self" values</a></li>
</ul>
</li>
<li><a href="#static-mocks">Static mocks</a></li>
<li><a href="#calling-a-constructor-manually">Calling a constructor manually</a></li>
<li><a href="#labeling-mocks">Labeling mocks</a></li>
<li>
<a href="#mock-handles">Mock handles</a>
<ul>
<li><a href="#mock-handle-substitution">Mock handle substitution</a></li>
</ul>
</li>
<li>
<a href="#mock-builders">Mock builders</a>
<ul>
<li><a href="#customizing-the-mock-class">Customizing the mock class</a></li>
<li><a href="#creating-mocks-from-a-builder">Creating mocks from a builder</a></li>
<li><a href="#generating-mock-classes-from-a-builder">Generating mock classes from a builder</a></li>
<li><a href="#copying-mock-builders">Copying mock builders</a></li>
</ul>
</li>
<li><a href="#pausing-mock-recording">Pausing mock recording</a></li>
<li>
<a href="#mocking-and-non-public-methods">Mocking and non-public methods</a>
<ul>
<li><a href="#accessing-non-public-methods-and-properties">Accessing non-public methods and properties</a></li>
</ul>
</li>
<li><a href="#mocking-problematic-classes">Mocking problematic classes</a></li>
<li><a href="#terminology">Terminology</a></li>
</ul>
</li>
<li>
<a href="#stubs">Stubs</a>
<ul>
<li>
<a href="#stubbing-an-existing-callable">Stubbing an existing callable</a>
<ul>
<li>
<a href="#stubbing-global-functions">Stubbing global functions</a>
<ul>
<li><a href="#restoring-global-functions-after-stubbing">Restoring global functions after stubbing</a></li>
<li><a href="#alternatives-for-stubbing-global-functions">Alternatives for stubbing global functions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#anonymous-stubs">Anonymous stubs</a></li>
<li>
<a href="#stub-self-values">Stub "self" values</a>
<ul>
<li><a href="#magic-self-values">Magic "self" values</a></li>
</ul>
</li>
<li>
<a href="#stub-rules-and-answers">Stub rules and answers</a>
<ul>
<li><a href="#multiple-rules">Multiple rules</a></li>
<li><a href="#multiple-answers">Multiple answers</a></li>
<li><a href="#overriding-rules">Overriding rules</a></li>
<li>
<a href="#the-default-rule-and-answer">The default rule and answer</a>
<ul>
<li><a href="#the-default-answer-callback">The default answer callback</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#matching-stub-arguments">Matching stub arguments</a></li>
<li>
<a href="#returning-values">Returning values</a>
<ul>
<li><a href="#default-values-for-return-types">Default values for return types</a></li>
</ul>
</li>
<li><a href="#returning-arguments">Returning arguments</a></li>
<li><a href="#returning-the-self-value">Returning the "self" value</a></li>
<li><a href="#throwing-exceptions">Throwing exceptions</a></li>
<li><a href="#using-a-callable-as-an-answer">Using a callable as an answer</a></li>
<li><a href="#forwarding-to-the-original-callable">Forwarding to the original callable</a></li>
<li>
<a href="#answers-that-perform-multiple-actions">Answers that perform multiple actions</a>
<ul>
<li><a href="#setting-passed-by-reference-arguments">Setting passed-by-reference arguments</a></li>
<li><a href="#invoking-arguments">Invoking arguments</a></li>
<li><a href="#invoking-callables">Invoking callables</a></li>
</ul>
</li>
<li>
<a href="#stubbing-generators">Stubbing generators</a>
<ul>
<li>
<a href="#yielding-from-a-generator">Yielding from a generator</a>
<ul>
<li><a href="#yielding-individual-values-from-a-generator">Yielding individual values from a generator</a></li>
<li><a href="#yielding-multiple-values-from-a-generator">Yielding multiple values from a generator</a></li>
</ul>
</li>
<li><a href="#returning-values-from-a-generator">Returning values from a generator</a></li>
<li><a href="#returning-arguments-from-a-generator">Returning arguments from a generator</a></li>
<li><a href="#returning-the-self-value-from-a-generator">Returning the "self" value from a generator</a></li>
<li><a href="#throwing-exceptions-from-a-generator">Throwing exceptions from a generator</a></li>
<li>
<a href="#generator-iterations-that-perform-multiple-actions">Generator iterations that perform multiple actions</a>
<ul>
<li><a href="#setting-passed-by-reference-arguments-in-a-generator">Setting passed-by-reference arguments in a generator</a></li>
<li><a href="#invoking-arguments-in-a-generator">Invoking arguments in a generator</a></li>
<li><a href="#invoking-callables-in-a-generator">Invoking callables in a generator</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#spies">Spies</a>
<ul>
<li>
<a href="#spying-on-an-existing-callable">Spying on an existing callable</a>
<ul>
<li>
<a href="#spying-on-global-functions">Spying on global functions</a>
<ul>
<li><a href="#restoring-global-functions-after-spying">Restoring global functions after spying</a></li>
<li><a href="#alternatives-for-spying-on-global-functions">Alternatives for spying on global functions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#anonymous-spies">Anonymous spies</a></li>
<li>
<a href="#call-verification">Call verification</a>
<ul>
<li><a href="#call-count">Call count</a></li>
<li><a href="#individual-calls">Individual calls</a></li>
</ul>
</li>
<li>
<a href="#verifying-spy-input">Verifying spy input</a>
<ul>
<li><a href="#verifying-that-a-call-was-made">Verifying that a call was made</a></li>
<li><a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a></li>
</ul>
</li>
<li>
<a href="#verifying-spy-output">Verifying spy output</a>
<ul>
<li>
<a href="#verifying-spy-return-values">Verifying spy return values</a>
<ul>
<li><a href="#verifying-generators-returned-by-spies">Verifying generators returned by spies</a></li>
<li><a href="#verifying-iterables-returned-by-spies">Verifying iterables returned by spies</a></li>
</ul>
</li>
<li><a href="#verifying-spy-exceptions">Verifying spy exceptions</a></li>
</ul>
</li>
<li><a href="#verifying-spy-progress">Verifying spy progress</a></li>
<li>
<a href="#verifying-cardinality-with-spies">Verifying cardinality with spies</a>
<ul>
<li><a href="#verifying-that-a-spy-event-happened-an-exact-number-of-times">Verifying that a spy event happened an exact number of times</a></li>
<li><a href="#verifying-that-a-spy-event-happened-a-bounded-number-of-times">Verifying that a spy event happened a bounded number of times</a></li>
<li><a href="#verifying-that-all-spy-events-happen-the-same-way">Verifying that all spy events happen the same way</a></li>
</ul>
</li>
<li><a href="#labeling-spies">Labeling spies</a></li>
<li><a href="#invoking-spies">Invoking spies</a></li>
<li><a href="#pausing-spy-recording">Pausing spy recording</a></li>
</ul>
</li>
<li>
<a href="#calls">Calls</a>
<ul>
<li><a href="#retrieving-calls-from-a-spy">Retrieving calls from a spy</a></li>
<li>
<a href="#verifying-call-input">Verifying call input</a>
<ul>
<li><a href="#verifying-that-a-call-was-made-with-specific-arguments">Verifying that a call was made with specific arguments</a></li>
</ul>
</li>
<li>
<a href="#verifying-call-output">Verifying call output</a>
<ul>
<li>
<a href="#verifying-call-return-values">Verifying call return values</a>
<ul>
<li><a href="#verifying-generators-returned-by-calls">Verifying generators returned by calls</a></li>
<li><a href="#verifying-iterables-returned-by-calls">Verifying iterables returned by calls</a></li>
</ul>
</li>
<li><a href="#verifying-call-exceptions">Verifying call exceptions</a></li>
</ul>
</li>
<li><a href="#verifying-call-progress">Verifying call progress</a></li>
<li>
<a href="#verifying-cardinality-with-calls">Verifying cardinality with calls</a>
<ul>
<li><a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a></li>
<li><a href="#verifying-that-a-call-event-happened-a-bounded-number-of-times">Verifying that a call event happened a bounded number of times</a></li>
<li><a href="#verifying-that-all-call-events-happen-the-same-way">Verifying that all call events happen the same way</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#verification">Verification</a>
<ul>
<li><a href="#standard-verification">Standard verification</a></li>
<li><a href="#check-verification">Check verification</a></li>
<li>
<a href="#understanding-verification-output">Understanding verification output</a>
<ul>
<li><a href="#expected-behavior-output">Expected behavior output</a></li>
<li><a href="#cardinality-output">Cardinality output</a></li>
<li><a href="#actual-behavior-output">Actual behavior output</a></li>
</ul>
</li>
<li>
<a href="#generator-and-iterable-verification">Generator and iterable verification</a>
<ul>
<li><a href="#verifying-iteration">Verifying iteration</a></li>
<li><a href="#verifying-produced-values">Verifying produced values</a></li>
<li><a href="#verifying-values-received-by-generators">Verifying values received by generators</a></li>
<li><a href="#verifying-exceptions-received-by-generators">Verifying exceptions received by generators</a></li>
<li><a href="#verifying-generator-return-values">Verifying generator return values</a></li>
<li><a href="#verifying-generator-exceptions">Verifying generator exceptions</a></li>
<li><a href="#verifying-cardinality-with-generators-and-iterables">Verifying cardinality with generators and iterables</a></li>
<li><a href="#iterable-spy-substitution">Iterable spy substitution</a></li>
<li>
<a href="#iterable-verification-caveats">Iterable verification caveats</a>
<ul>
<li><a href="#using-iterable-spies-changes-the-return-value">Using iterable spies changes the return value</a></li>
<li><a href="#repeated-iteration-of-iterable-spies">Repeated iteration of iterable spies</a></li>
<li><a href="#spying-on-iterables-that-implement-array-like-interfaces">Spying on iterables that implement array-like interfaces</a></li>
<li><a href="#nested-iterable-spies">Nested iterable spies</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#order-verification">Order verification</a>
<ul>
<li><a href="#dynamic-order-verification">Dynamic order verification</a></li>
<li>
<a href="#order-verification-caveats">Order verification caveats</a>
<ul>
<li><a href="#intermediate-events-in-order-verification">Intermediate events in order verification</a></li>
<li><a href="#similar-events-in-order-verification">Similar events in order verification</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#verifying-that-there-was-no-interaction-with-a-mock">Verifying that there was no interaction with a mock</a></li>
<li><a href="#using-colored-verification-output">Using colored verification output</a></li>
</ul>
</li>
<li>
<a href="#matchers">Matchers</a>
<ul>
<li>
<a href="#matcher-integrations">Matcher integrations</a>
<ul>
<li><a href="#hamcrest-matchers">Hamcrest matchers</a></li>
<li><a href="#phpunit-constraints">PHPUnit constraints</a></li>
<li><a href="#simpletest-expectations">SimpleTest expectations</a></li>
</ul>
</li>
<li><a href="#shorthand-matchers">Shorthand matchers</a></li>
<li><a href="#the-any-matcher">The "any" matcher</a></li>
<li>
<a href="#the-equal-to-matcher">The "equal to" matcher</a>
<ul>
<li><a href="#when-to-use-the-equal-to-matcher">When to use the "equal to" matcher</a></li>
<li>
<a href="#special-cases-for-the-equal-to-matcher">Special cases for the "equal to" matcher</a>
<ul>
<li><a href="#comparing-exceptions">Comparing exceptions</a></li>
<li><a href="#comparing-mocks">Comparing mocks</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#the-instance-of-matcher">The "instance of" matcher</a></li>
<li><a href="#the-wildcard-matcher">The "wildcard" matcher</a></li>
</ul>
</li>
<li>
<a href="#the-exporter">The exporter</a>
<ul>
<li>
<a href="#the-export-format">The export format</a>
<ul>
<li>
<a href="#export-identifiers-and-references">Export identifiers and references</a>
<ul>
<li><a href="#export-reference-types">Export reference types</a></li>
<li><a href="#export-reference-exclusions">Export reference exclusions</a></li>
<li><a href="#export-identifier-persistence">Export identifier persistence</a></li>
</ul>
</li>
<li><a href="#exporting-recursive-values">Exporting recursive values</a></li>
<li>
<a href="#exporter-special-cases">Exporter special cases</a>
<ul>
<li><a href="#exporting-closures">Exporting closures</a></li>
<li><a href="#exporting-exceptions">Exporting exceptions</a></li>
<li><a href="#exporting-mocks">Exporting mocks</a></li>
<li><a href="#exporting-stubs">Exporting stubs</a></li>
<li><a href="#exporting-spies">Exporting spies</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#export-depth">Export depth</a>
<ul>
<li><a href="#setting-the-export-depth">Setting the export depth</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#the-api">The API</a>
<ul>
<li><a href="#the-top-level-api">The top-level API</a></li>
<li><a href="#the-mock-handle-api">The mock handle API</a></li>
<li><a href="#the-mock-builder-api">The mock builder API</a></li>
<li><a href="#the-stub-api">The stub API</a></li>
<li><a href="#the-generator-answer-api">The generator answer API</a></li>
<li><a href="#the-spy-api">The spy API</a></li>
<li><a href="#the-call-api">The call API</a></li>
<li><a href="#the-arguments-api">The arguments API</a></li>
<li><a href="#the-verification-result-api">The verification result API</a></li>
<li><a href="#the-iterable-verification-result-api">The iterable verification result API</a></li>
<li><a href="#the-generator-verification-result-api">The generator verification result API</a></li>
<li><a href="#the-event-api">The event API</a></li>
<li><a href="#the-matcher-api">The matcher API</a></li>
<li><a href="#the-wildcard-matcher-api">The wildcard matcher API</a></li>
<li>
<a href="#thrown-exceptions">Thrown exceptions</a>
<ul>
<li><a href="#assertionexception">AssertionException</a></li>
<li><a href="#undefinedargumentexception">UndefinedArgumentException</a></li>
<li><a href="#undefinedcallexception">UndefinedCallException</a></li>
<li><a href="#undefinedeventexception">UndefinedEventException</a></li>
<li><a href="#undefinedresponseexception">UndefinedResponseException</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#license">License</a></li>
</ul>
<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>
<p>Available as various <a href="http://getcomposer.org/">Composer</a> packages, depending on the test framework in
use:</p>
<ul>
<li>For <a href="https://kahlan.github.io/docs/">Kahlan</a>, use <a href="https://packagist.org/packages/eloquent/phony-kahlan">eloquent/phony-kahlan</a> and import
<code>Eloquent\Phony\Kahlan</code>.</li>
<li>For <a href="https://phpunit.de/">PHPUnit</a>, use <a href="https://packagist.org/packages/eloquent/phony-phpunit">eloquent/phony-phpunit</a> and import
<code>Eloquent\Phony\Phpunit</code>.</li>
<li>For <a href="http://peridot-php.github.io/">Peridot</a>, use <a href="https://packagist.org/packages/eloquent/phony-peridot">eloquent/phony-peridot</a> and import <code>Eloquent\Phony</code>.</li>
<li>For <a href="https://github.com/danielstjules/pho">Pho</a>, use <a href="https://packagist.org/packages/eloquent/phony-pho">eloquent/phony-pho</a> and import <code>Eloquent\Phony\Pho</code>.</li>
<li>For <a href="https://github.com/simpletest/simpletest">SimpleTest</a>, use <a href="https://packagist.org/packages/eloquent/phony-simpletest">eloquent/phony-simpletest</a> and import
<code>Eloquent\Phony\Simpletest</code>.</li>
<li>For other frameworks, or standalone usage, use <a href="https://packagist.org/packages/eloquent/phony">eloquent/phony</a> and import
<code>Eloquent\Phony</code>.</li>
</ul>
<p>See <a href="#integration-with-test-frameworks">Integration with test frameworks</a>.</p>
<h2>
<a id="help" class="anchor" href="#help" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Help</h2>
<p>For help with a difficult testing scenario, questions regarding how to use
<em>Phony</em>, or to report issues with <em>Phony</em> itself, please open a <a href="https://github.com/eloquent/phony/issues">GitHub issue</a>
so that others may benefit from the outcome.</p>
<p>Alternatively, <a href="https://github.com/ezzatron">@ezzatron</a> may be contacted directly via <a href="https://twitter.com/ezzatron">Twitter</a>.</p>
<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>
<h3>
<a id="using-this-documentation" class="anchor" href="#using-this-documentation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using this documentation</h3>
<ul>
<li>The documentation can be searched with the standard search shortcut:
<ul>
<li>
<kbd>⌘</kbd> + <kbd>F</kbd> for macOS and OS X</li>
<li>
<kbd>Ctrl</kbd> + <kbd>F</kbd> for other platforms</li>
</ul>
</li>
<li>The menu automatically opens to the correct section as the documentation is
scrolled.</li>
<li>An expanded table of contents can be viewed by clicking the "+" symbol in the
menu.</li>
<li>Documentation for other versions can be selected in the bottom-right corner.</li>
</ul>
<h3>
<a id="example-test-suites" class="anchor" href="#example-test-suites" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example test suites</h3>
<p>See the <a href="https://github.com/eloquent/phony-examples">phony-examples</a> repository.</p>
<h3>
<a id="standalone-usage" class="anchor" href="#standalone-usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Standalone usage</h3>
<p>Install the <a href="https://packagist.org/packages/eloquent/phony">eloquent/phony</a> package, then:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-k">function</span> <span class="pl-c1">Eloquent\Phony\mock</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">assert</span>(<span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>) <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>);</span></pre></div>
<h3>
<a id="kahlan-usage" class="anchor" href="#kahlan-usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://kahlan.github.io/docs/">Kahlan</a> usage</h3>
<p>Install the <a href="https://packagist.org/packages/eloquent/phony-kahlan">eloquent/phony-kahlan</a> package, then:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-k">function</span> <span class="pl-c1">Eloquent\Phony\Kahlan\mock</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">describe(<span class="pl-s"><span class="pl-pds">'</span>Phony<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> () {</span>
<span class="pl-s1">    it(<span class="pl-s"><span class="pl-pds">'</span>integrates with Kahlan<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> () {</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-s"><span class="pl-pds">'</span>ClassA<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1">        expect(<span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>))<span class="pl-k">-&gt;</span>toBe(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    });</span>
<span class="pl-s1">});</span></pre></div>
<p>The <a href="https://packagist.org/packages/eloquent/phony-kahlan">eloquent/phony-kahlan</a> package also provides auto-wired mocks:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-k">function</span> <span class="pl-c1">Eloquent\Phony\Kahlan\on</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">describe(<span class="pl-s"><span class="pl-pds">'</span>Phony for Kahlan<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> () {</span>
<span class="pl-s1">    it(<span class="pl-s"><span class="pl-pds">'</span>supports auto-wiring<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-c1">ClassA</span> <span class="pl-smi">$mock</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span> <span class="pl-k">=</span> on(<span class="pl-smi">$mock</span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">        expect(<span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>))<span class="pl-k">-&gt;</span>toBe(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    });</span>
<span class="pl-s1">});</span></pre></div>
<h3>
<a id="peridot-usage" class="anchor" href="#peridot-usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="http://peridot-php.github.io/">Peridot</a> usage</h3>
<p>Install the <a href="https://packagist.org/packages/eloquent/phony-peridot">eloquent/phony-peridot</a> package, then:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-k">function</span> <span class="pl-c1">Eloquent\Phony\mock</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">describe(<span class="pl-s"><span class="pl-pds">'</span>Phony<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> () {</span>
<span class="pl-s1">    it(<span class="pl-s"><span class="pl-pds">'</span>integrates with Peridot<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> () {</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1">        expect(<span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>))<span class="pl-k">-&gt;</span><span class="pl-smi">to</span><span class="pl-k">-&gt;</span>equal(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    });</span>
<span class="pl-s1">});</span></pre></div>
<p>The <a href="https://packagist.org/packages/eloquent/phony-peridot">eloquent/phony-peridot</a> package also provides auto-wired mocks:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-k">function</span> <span class="pl-c1">Eloquent\Phony\on</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">describe(<span class="pl-s"><span class="pl-pds">'</span>Phony for Peridot<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> () {</span>
<span class="pl-s1">    it(<span class="pl-s"><span class="pl-pds">'</span>supports auto-wiring<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-c1">ClassA</span> <span class="pl-smi">$mock</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span> <span class="pl-k">=</span> on(<span class="pl-smi">$mock</span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">        expect(<span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>))<span class="pl-k">-&gt;</span><span class="pl-smi">to</span><span class="pl-k">-&gt;</span>equal(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    });</span>
<span class="pl-s1">});</span></pre></div>
<h3>
<a id="pho-usage" class="anchor" href="#pho-usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://github.com/danielstjules/pho">Pho</a> usage</h3>
<p>Install the <a href="https://packagist.org/packages/eloquent/phony-pho">eloquent/phony-pho</a> package, then:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-k">function</span> <span class="pl-c1">Eloquent\Phony\Pho\mock</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">describe(<span class="pl-s"><span class="pl-pds">'</span>Phony<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> () {</span>
<span class="pl-s1">    it(<span class="pl-s"><span class="pl-pds">'</span>integrates with Pho<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> () {</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1">        expect(<span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>))<span class="pl-k">-&gt;</span>toBe(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    });</span>
<span class="pl-s1">});</span></pre></div>
<h3>
<a id="phpunit-usage" class="anchor" href="#phpunit-usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://phpunit.de/">PHPUnit</a> usage</h3>
<p>Install the <a href="https://packagist.org/packages/eloquent/phony-phpunit">eloquent/phony-phpunit</a> package, then:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">Eloquent\Phony\Phpunit\Phony</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">PhonyTest</span> <span class="pl-k">extends</span> <span class="pl-e">PHPUnit_Framework_TestCase</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">testIntegration</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>mock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>assertSame(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>, <span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>));</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span></pre></div>
<h3>
<a id="simpletest-usage" class="anchor" href="#simpletest-usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://github.com/simpletest/simpletest">SimpleTest</a> usage</h3>
<p>Install the <a href="https://packagist.org/packages/eloquent/phony-simpletest">eloquent/phony-simpletest</a> package, then:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">Eloquent\Phony\Simpletest\Phony</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">PhonyTest</span> <span class="pl-k">extends</span> <span class="pl-e">UnitTestCase</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">testIntegration</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>mock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>assertSame(<span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>), <span class="pl-s"><span class="pl-pds">'</span>value<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>argument<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span></pre></div>
<h3>
<a id="integration-with-test-frameworks" class="anchor" href="#integration-with-test-frameworks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Integration with test frameworks</h3>
<p>In order to provide the easiest integration with test frameworks, <em>Phony</em>
exposes the same <a href="#api">API</a> through multiple namespaces. Integration is as simple as
picking the correct <a href="http://getcomposer.org/">Composer</a> package for the framework in use, and importing
the relevant namespace:</p>
<ul>
<li>For <a href="https://kahlan.github.io/docs/">Kahlan</a>, use <a href="https://packagist.org/packages/eloquent/phony-kahlan">eloquent/phony-kahlan</a> and import
<code>Eloquent\Phony\Kahlan</code>.</li>
<li>For <a href="https://phpunit.de/">PHPUnit</a>, use <a href="https://packagist.org/packages/eloquent/phony-phpunit">eloquent/phony-phpunit</a> and import
<code>Eloquent\Phony\Phpunit</code>.</li>
<li>For <a href="http://peridot-php.github.io/">Peridot</a>, use <a href="https://packagist.org/packages/eloquent/phony-peridot">eloquent/phony-peridot</a> and import <code>Eloquent\Phony</code>.</li>
<li>For <a href="https://github.com/danielstjules/pho">Pho</a>, use <a href="https://packagist.org/packages/eloquent/phony-pho">eloquent/phony-pho</a> and import <code>Eloquent\Phony\Pho</code>.</li>
<li>For <a href="https://github.com/simpletest/simpletest">SimpleTest</a>, use <a href="https://packagist.org/packages/eloquent/phony-simpletest">eloquent/phony-simpletest</a> and import
<code>Eloquent\Phony\Simpletest</code>.</li>
<li>For other frameworks, or standalone usage, use <a href="https://packagist.org/packages/eloquent/phony">eloquent/phony</a> and import
<code>Eloquent\Phony</code>.</li>
</ul>
<h3>
<a id="importing" class="anchor" href="#importing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Importing</h3>
<p>There are two ways to import <em>Phony</em>'s <a href="#api">API</a>. The most appropriate choice will
depend on the test framework in use, and the user's preferred coding style.</p>
<h4>
<a id="importing-with-use-function" class="anchor" href="#importing-with-use-function" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Importing with <a href="http://php.net/language.namespaces.importing">use function</a>
</h4>
<p>If the version of PHP in use supports <a href="http://php.net/language.namespaces.importing">use function</a>, the top-level functions
can be imported from the appropriate namespace and used directly:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-k">function</span> <span class="pl-c1">Eloquent\Phony\mock</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span></pre></div>
<h4>
<a id="importing-without-use-function" class="anchor" href="#importing-without-use-function" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Importing without <a href="http://php.net/language.namespaces.importing">use function</a>
</h4>
<p>A static facade implementation is also provided for those who prefer a more
"traditional" approach:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">Eloquent\Phony\Phony</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>mock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span></pre></div>
<h2>
<a id="mocks" class="anchor" href="#mocks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mocks</h2>
<p><em>Mocks</em> are objects that can be used as a substitute for another object. This
can be useful when a "real" object becomes difficult to use in a test.</p>
<h3>
<a id="mocking-basics" class="anchor" href="#mocking-basics" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mocking basics</h3>
<p>Any class, interface, or trait can be mocked. To create a mock, use
<a href="#facade.mock"><code>mock()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>);        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>mock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span></pre></div>
<p>The object returned by <a href="#facade.mock"><code>mock()</code></a> is <strong>not</strong> the mock object
itself, but a <a href="#mock-handles">mock handle</a>. This handle provides a <a href="#stubs">stub</a> for each method of
the type being mocked. Each stub is exposed as a <a href="#handle.__get">property</a> of
the same name as the stubbed method, and implements both <a href="#the-stub-api">the stub API</a>, and
<a href="#the-spy-api">the spy API</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> stubbing</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>1337 h4x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodB</span><span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>bad<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>input<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>throws(<span class="pl-s"><span class="pl-pds">'</span>You done goofed.<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> verification</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>swiggity<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>swooty<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodB</span><span class="pl-k">-&gt;</span>called();</span></pre></div>
<p>To access the actual mock object, call the <a href="#handle.get"><code>get()</code></a> method of the
handle:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span></pre></div>
<h3>
<a id="partial-mocks" class="anchor" href="#partial-mocks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Partial mocks</h3>
<p><em>Phony</em> supports "partial mocks", or mocks that do not override methods by
default. To create a partial mock, use <a href="#facade.partialMock"><code>partialMock()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> partialMock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>);        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>partialMock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span></pre></div>
<p>Constructor arguments can be passed to <a href="#facade.partialMock"><code>partialMock()</code></a> as
the second parameter:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> partialMock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>, [<span class="pl-s"><span class="pl-pds">'</span>argumentA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>argumentB<span class="pl-pds">'</span></span>]);</span></pre></div>
<h3>
<a id="proxy-mocks" class="anchor" href="#proxy-mocks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Proxy mocks</h3>
<p>In cases where direct mocking is not possible, such as with <code>final</code> classes and
methods, <em>Phony</em> offers an alternative strategy in the form of "proxy" mocks.
Any mock can proxy methods on to any other object by using
<a href="#handle.proxy"><code>proxy()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">interface</span> <span class="pl-en">Animal</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">speak</span>();</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">final</span> <span class="pl-k">class</span> <span class="pl-en">Cat</span> <span class="pl-k">implements</span> <span class="pl-e">Animal</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">final</span> <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">speak</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>Meow meow meow? Meow.<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">function</span> <span class="pl-en">listen</span>(<span class="pl-c1">Animal</span> <span class="pl-smi">$animal</span>)</span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>It said: <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$animal</span><span class="pl-k">-&gt;</span>speak();</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$cat</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Cat</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-c1">Animal</span><span class="pl-k">::</span><span class="pl-c1">class</span>); <span class="pl-c"><span class="pl-c">//</span> a generic animal mock</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>proxy(<span class="pl-smi">$cat</span>);          <span class="pl-c"><span class="pl-c">//</span> now it behaves exactly like `$cat`</span></span>
<span class="pl-s1"></span>
<span class="pl-s1">listen(<span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get());        <span class="pl-c"><span class="pl-c">//</span> outputs 'It said: Meow meow meow? Meow.'</span></span></pre></div>
<p>The <a href="#handle.proxy"><code>proxy()</code></a> method is also fluent, meaning that mock creation
and proxying can be done in a single expression:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-c1">Animal</span><span class="pl-k">::</span><span class="pl-c1">class</span>)<span class="pl-k">-&gt;</span>proxy(<span class="pl-k">new</span> <span class="pl-c1">Cat</span>());</span></pre></div>
<h3>
<a id="mocking-multiple-types" class="anchor" href="#mocking-multiple-types" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mocking multiple types</h3>
<p>Multiple interfaces and/or traits can be mocked simultaneously by passing an
array of types to <a href="#facade.mock"><code>mock()</code></a> or
<a href="#facade.partialMock"><code>partialMock()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock([<span class="pl-c1">InterfaceA</span><span class="pl-k">::</span><span class="pl-c1">class</span>, <span class="pl-c1">InterfaceB</span><span class="pl-k">::</span><span class="pl-c1">class</span>, <span class="pl-c1">TraitA</span><span class="pl-k">::</span><span class="pl-c1">class</span>]);        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>mock([<span class="pl-c1">InterfaceA</span><span class="pl-k">::</span><span class="pl-c1">class</span>, <span class="pl-c1">InterfaceB</span><span class="pl-k">::</span><span class="pl-c1">class</span>, <span class="pl-c1">TraitA</span><span class="pl-k">::</span><span class="pl-c1">class</span>]); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span></pre></div>
<p>A single base class may also be mocked with other types:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock([<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>, <span class="pl-c1">InterfaceA</span><span class="pl-k">::</span><span class="pl-c1">class</span>, <span class="pl-c1">TraitA</span><span class="pl-k">::</span><span class="pl-c1">class</span>]);        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>mock([<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>, <span class="pl-c1">InterfaceA</span><span class="pl-k">::</span><span class="pl-c1">class</span>, <span class="pl-c1">TraitA</span><span class="pl-k">::</span><span class="pl-c1">class</span>]); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span></pre></div>
<h3>
<a id="ad-hoc-mocks" class="anchor" href="#ad-hoc-mocks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Ad hoc mocks</h3>
<p><em>Phony</em> supports the creation of mock objects with methods and/or properties
that are not pre-defined in some other class, interface, or trait. It does so
using special "definition" values, which can be passed to
<a href="#facade.mock"><code>mock()</code></a> or <a href="#facade.partialMock"><code>partialMock()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> partialMock(</span>
<span class="pl-s1">    [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>__toString<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> () {</span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>What is this sorcery?<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        },</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>__call<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> (<span class="pl-smi">$name</span>, <span class="pl-k">array</span> <span class="pl-smi">$arguments</span>) {</span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-c1">sprintf</span>(<span class="pl-s"><span class="pl-pds">'</span>%s(%s)<span class="pl-pds">'</span></span>, <span class="pl-smi">$name</span>, <span class="pl-c1">implode</span>(<span class="pl-s"><span class="pl-pds">'</span>, <span class="pl-pds">'</span></span>, <span class="pl-smi">$arguments</span>));</span>
<span class="pl-s1">        },</span>
<span class="pl-s1">    ]</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$mock</span>;              <span class="pl-c"><span class="pl-c">//</span> outputs 'What is this sorcery?'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>a(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'a(b, c)'</span></span></pre></div>
<p>Definition values can be mocked at the same time as regular classes, traits, and
interfaces. Multiple definitions can even be mocked at the same time. Simply
specify all types to be mocked in a single array:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> partialMock(</span>
<span class="pl-s1">    [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>Countable<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        [</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>__invoke<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> () {</span>
<span class="pl-s1">                <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>You called me?<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">            }</span>
<span class="pl-s1">        ],</span>
<span class="pl-s1">        [</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>__toString<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> () {</span>
<span class="pl-s1">                <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>Are you stringing me along?<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">            }</span>
<span class="pl-s1">        ],</span>
<span class="pl-s1">    ]</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">count</span><span class="pl-k">-&gt;</span>returns(<span class="pl-c1">111</span>);</span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">mock</span>();      <span class="pl-c"><span class="pl-c">//</span> outputs 'You called me?'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$mock</span>;        <span class="pl-c"><span class="pl-c">//</span> outputs 'Are you stringing me along?'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">count</span>(<span class="pl-smi">$mock</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '111'</span></span></pre></div>
<h4>
<a id="ad-hoc-definition-values" class="anchor" href="#ad-hoc-definition-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Ad hoc definition values</h4>
<p>Ad hoc definition values support methods, properties, and constants. By default,
callback functions will be converted to methods, and everything else will become
a property:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> partialMock(</span>
<span class="pl-s1">    [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> () {</span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>A is for apple.<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        },</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>B is for banana.<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">    ]</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>a(); <span class="pl-c"><span class="pl-c">//</span> outputs 'A is for apple.'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span><span class="pl-smi">b</span>;   <span class="pl-c"><span class="pl-c">//</span> outputs 'B is for banana.'</span></span></pre></div>
<p>To override the default treatment of values, or to define static methods or
properties, keywords can be added to the keys of the definition value:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> partialMock(</span>
<span class="pl-s1">    [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>const A<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>A is for apple.<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>static b<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> () {</span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>B is for banana.<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        },</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>static c<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>C is for cat.<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>var d<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> () {</span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>D is for dog.<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        },</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>static var e<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> () {</span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>E is for egg.<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        },</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>function f<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>implode<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">    ]</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"><span class="pl-smi">$class</span> <span class="pl-k">=</span> <span class="pl-c1">get_class</span>(<span class="pl-smi">$mock</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$class</span><span class="pl-k">::</span><span class="pl-c1">A</span>;   <span class="pl-c"><span class="pl-c">//</span> outputs 'A is for apple.'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$class</span><span class="pl-k">::</span>b(); <span class="pl-c"><span class="pl-c">//</span> outputs 'B is for banana.'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$class</span><span class="pl-k">::</span><span class="pl-c1">c</span>;   <span class="pl-c"><span class="pl-c">//</span> outputs 'C is for cat.'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">var_dump</span>(<span class="pl-c1">isset</span>(<span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span><span class="pl-smi">d</span>));  <span class="pl-c"><span class="pl-c">//</span> outputs 'bool(true)'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">var_dump</span>(<span class="pl-c1">isset</span>(<span class="pl-smi">$class</span><span class="pl-k">::</span><span class="pl-c1">e</span>)); <span class="pl-c"><span class="pl-c">//</span> outputs 'bool(true)'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>f(<span class="pl-s"><span class="pl-pds">'</span>, <span class="pl-pds">'</span></span>, [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>]); <span class="pl-c"><span class="pl-c">//</span> outputs 'a, b'</span></span></pre></div>
<h4>
<a id="ad-hoc-definition-magic-self-values" class="anchor" href="#ad-hoc-definition-magic-self-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Ad hoc definition magic "self" values</h4>
<p>Methods defined in an <a href="#ad-hoc-mocks">ad hoc mock</a> definition can take advantage of
<a href="#magic-self-values">magic "self" values</a>. When stubs are retrieved from a mock, their <a href="#stub-self-values">self value</a>
is automatically set to the mock itself.</p>
<p>Any custom method with a first parameter named <code>$phonySelf</code>, regardless of the
parameter's type, will receive the self value as the first argument. This self
value can be used in place of <code>$this</code> to access instance state, and/or implement
fluent interfaces:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> partialMock(</span>
<span class="pl-s1">    [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>set<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> (<span class="pl-smi">$phonySelf</span>, <span class="pl-smi">$key</span>, <span class="pl-smi">$value</span>) {</span>
<span class="pl-s1">            <span class="pl-smi">$phonySelf</span><span class="pl-k">-&gt;</span><span class="pl-smi">values</span>[<span class="pl-smi">$key</span>] <span class="pl-k">=</span> <span class="pl-smi">$value</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-smi">$phonySelf</span>;</span>
<span class="pl-s1">        },</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>get<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> (<span class="pl-smi">$phonySelf</span>, <span class="pl-smi">$key</span>) {</span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-smi">$phonySelf</span><span class="pl-k">-&gt;</span><span class="pl-smi">values</span>[<span class="pl-smi">$key</span>] ?? <span class="pl-c1">null</span>;</span>
<span class="pl-s1">        },</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>values<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [],</span>
<span class="pl-s1">    ]</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>set(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-c1">1</span>)<span class="pl-k">-&gt;</span>get(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs '1'</span></span></pre></div>
<h3>
<a id="static-mocks" class="anchor" href="#static-mocks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Static mocks</h3>
<p><em>Phony</em> can be used to stub the behavior of static methods of generated mock
classes. To modify the behavior of a static method, use
<a href="#facade.onStatic"><code>onStatic()</code></a> to obtain a static handle from either an
existing handle, or a mock instance:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-c1">DateTime</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$static</span> <span class="pl-k">=</span> onStatic(<span class="pl-smi">$handle</span>);        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$static</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>onStatic(<span class="pl-smi">$handle</span>); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$static</span> <span class="pl-k">=</span> onStatic(<span class="pl-smi">$mock</span>);        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$static</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>onStatic(<span class="pl-smi">$mock</span>); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span></pre></div>
<p>This static handle is just like a normal <a href="#mock-handles">mock handle</a>, except that it refers to
static methods instead of instance methods:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$static</span><span class="pl-k">-&gt;</span><span class="pl-smi">createFromFormat</span><span class="pl-k">-&gt;</span>returns(<span class="pl-k">new</span> <span class="pl-c1">DateTime</span>(<span class="pl-s"><span class="pl-pds">'</span>2001-02-03T04:05:06Z<span class="pl-pds">'</span></span>));</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$class</span> <span class="pl-k">=</span> <span class="pl-smi">$static</span><span class="pl-k">-&gt;</span>className(); <span class="pl-c"><span class="pl-c">//</span> obtain the generated class name</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$date</span> <span class="pl-k">=</span> <span class="pl-smi">$class</span><span class="pl-k">::</span>createFromFormat(<span class="pl-s"><span class="pl-pds">'</span>format<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>time<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$date</span><span class="pl-k">-&gt;</span>format(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs '2001-02-03T04:05:06+00:00'</span></span></pre></div>
<p>The static handle can also be used to verify interactions with static methods:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$static</span><span class="pl-k">-&gt;</span><span class="pl-smi">createFromFormat</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>format<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>time<span class="pl-pds">'</span></span>);</span></pre></div>
<h3>
<a id="calling-a-constructor-manually" class="anchor" href="#calling-a-constructor-manually" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Calling a constructor manually</h3>
<p>In order to stub methods called in the constructor of a partial mock, it is
necessary to defer construction of the mock object. To accomplish this, pass
<code>null</code> as the second argument to <a href="#facade.partialMock"><code>partialMock()</code></a>, which
will cause <em>Phony</em> to bypass the constructor:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> partialMock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>, <span class="pl-c1">null</span>);</span></pre></div>
<p>Note that omitting the second argument will <strong>not</strong> have the same effect as
explicitly passing <code>null</code>.</p>
<p>Behavior can then be defined before the constructor is called:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>returns(<span class="pl-c1">true</span>);</span></pre></div>
<p>Finally, the constructor can be manually called using
<a href="#handle.construct"><code>construct()</code></a>, or
<a href="#handle.constructWith"><code>constructWith()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>construct(<span class="pl-s"><span class="pl-pds">'</span>argumentA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>argumentB<span class="pl-pds">'</span></span>);       <span class="pl-c"><span class="pl-c">//</span> variable arguments</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>constructWith([<span class="pl-s"><span class="pl-pds">'</span>argumentA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>argumentB<span class="pl-pds">'</span></span>]); <span class="pl-c"><span class="pl-c">//</span> array arguments</span></span></pre></div>
<p>The <a href="#handle.constructWith"><code>constructWith()</code></a> additionally supports arguments
passed by reference:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>constructWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>]);</span></pre></div>
<h3>
<a id="labeling-mocks" class="anchor" href="#labeling-mocks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Labeling mocks</h3>
<p>Every mock has a label, which is a free-form string used to help identify the
mock in verification failure messages. By default, each mock is assigned a
unique sequential integer label upon creation.</p>
<p>The label can be changed at any time by using <a href="#handle.setLabel"><code>setLabel()</code></a>
on any mock handle associated with the mock:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>label();   <span class="pl-c"><span class="pl-c">//</span> outputs 'a'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> on(<span class="pl-smi">$mock</span>)<span class="pl-k">-&gt;</span>label(); <span class="pl-c"><span class="pl-c">//</span> outputs 'a'</span></span></pre></div>
<p>The <a href="#handle.setLabel"><code>setLabel()</code></a> method is also fluent, meaning that mock
creation and label setting can be done in a single expression:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>)<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>get();</span></pre></div>
<p>When a verification fails for a labeled mock, the output is similar to the
following:</p>
<p><a href="img/verification/called-with/mock-label.svg" target="_blank"><img src="img/verification/called-with/mock-label.svg" alt="Example verification output when using a mock label" style="max-width:100%;"></a></p>
<h3>
<a id="mock-handles" class="anchor" href="#mock-handles" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mock handles</h3>
<p>Mock handles are objects that provide access to <a href="#stubs">stubs</a> for each method of a
mock object. Each method stub implements both <a href="#the-stub-api">the stub API</a> for stubbing, and
<a href="#the-spy-api">the spy API</a> for verification.</p>
<p>Mock handles are returned when <a href="#facade.mock"><code>mock()</code></a> or
<a href="#facade.partialMock"><code>partialMock()</code></a> is called:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> partialMock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span></pre></div>
<p>They can also be retrieved at any time from a mock instance, or another handle,
by using <a href="#facade.on"><code>on()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> on(<span class="pl-smi">$mock</span>);        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>on(<span class="pl-smi">$mock</span>); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> on(<span class="pl-smi">$otherHandle</span>);        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>on(<span class="pl-smi">$otherHandle</span>); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span></pre></div>
<p>To access the actual mock object, call the <a href="#handle.get"><code>get()</code></a> method of the
handle:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span></pre></div>
<p>Note that a static handle variant exists. See <a href="#static-mocks">Static mocks</a>.</p>
<h4>
<a id="mock-handle-substitution" class="anchor" href="#mock-handle-substitution" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mock handle substitution</h4>
<p><em>Phony</em> will sometimes accept a mock handle as equivalent to the mock it
represents. This simplifies some common mocking scenarios, and improves test
readability.</p>
<p>One such scenario is returning a <a href="#mocks">mock</a> from another <a href="#stubs">stub</a> (this includes
stubbed mock methods). Returning a handle from a stub is equivalent to returning
the mock itself:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$database</span> <span class="pl-k">=</span> mock(<span class="pl-c1">Database</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1"><span class="pl-smi">$result</span> <span class="pl-k">=</span> mock(<span class="pl-c1">Result</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> these two statements are equivalent</span></span>
<span class="pl-s1"><span class="pl-smi">$database</span><span class="pl-k">-&gt;</span><span class="pl-smi">select</span><span class="pl-k">-&gt;</span>returns(<span class="pl-smi">$result</span>);</span>
<span class="pl-s1"><span class="pl-smi">$database</span><span class="pl-k">-&gt;</span><span class="pl-smi">select</span><span class="pl-k">-&gt;</span>returns(<span class="pl-smi">$result</span><span class="pl-k">-&gt;</span>get());</span></pre></div>
<p>Another common situation is the use of a mock handle when
<a href="#matching-stub-arguments">matching stub arguments</a>. Use of a mock handle in a argument list is equivalent
to use of the mock itself:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$database</span> <span class="pl-k">=</span> mock(<span class="pl-c1">Database</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1"><span class="pl-smi">$query</span> <span class="pl-k">=</span> mock(<span class="pl-c1">Query</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1"><span class="pl-smi">$result</span> <span class="pl-k">=</span> mock(<span class="pl-c1">Result</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> these two statements are equivalent</span></span>
<span class="pl-s1"><span class="pl-smi">$database</span><span class="pl-k">-&gt;</span><span class="pl-smi">select</span><span class="pl-k">-&gt;</span>with(<span class="pl-smi">$query</span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-smi">$result</span>);</span>
<span class="pl-s1"><span class="pl-smi">$database</span><span class="pl-k">-&gt;</span><span class="pl-smi">select</span><span class="pl-k">-&gt;</span>with(<span class="pl-smi">$query</span><span class="pl-k">-&gt;</span>get())<span class="pl-k">-&gt;</span>returns(<span class="pl-smi">$result</span>);</span></pre></div>
<p>The same is true when <a href="#verifying-that-a-spy-was-called-with-specific-arguments">verifying that a spy was called with specific arguments</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$database</span> <span class="pl-k">=</span> mock(<span class="pl-c1">Database</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1"><span class="pl-smi">$query</span> <span class="pl-k">=</span> mock(<span class="pl-c1">Query</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> these two statements are equivalent</span></span>
<span class="pl-s1"><span class="pl-smi">$database</span><span class="pl-k">-&gt;</span><span class="pl-smi">select</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-smi">$query</span>);</span>
<span class="pl-s1"><span class="pl-smi">$database</span><span class="pl-k">-&gt;</span><span class="pl-smi">select</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-smi">$query</span><span class="pl-k">-&gt;</span>get());</span></pre></div>
<p>There are other edge-case situations where <em>Phony</em> will exhibit this behavior.
Refer to the <a href="#api">API</a> documentation for more detailed information.</p>
<h3>
<a id="mock-builders" class="anchor" href="#mock-builders" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mock builders</h3>
<p>Mock builders provide an alternative method for defining and creating mocks,
when more fine-grained control is desired. To create a mock builder, use
<a href="#facade.mockBuilder"><code>mockBuilder()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$builder</span> <span class="pl-k">=</span> mockBuilder();        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$builder</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>mockBuilder(); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span></pre></div>
<p>Types to mock can be passed directly to <a href="#facade.mockBuilder"><code>mockBuilder()</code></a>
in a similar fashion to <a href="#facade.mock"><code>mock()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$builder</span> <span class="pl-k">=</span> mockBuilder([<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>, <span class="pl-c1">InterfaceA</span><span class="pl-k">::</span><span class="pl-c1">class</span>]);</span></pre></div>
<h4>
<a id="customizing-the-mock-class" class="anchor" href="#customizing-the-mock-class" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Customizing the mock class</h4>
<p>Mock builders implement a fluent interface, with many methods for customizing
the generated mock class:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$builder</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>like(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>, <span class="pl-c1">InterfaceA</span><span class="pl-k">::</span><span class="pl-c1">class</span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>named(<span class="pl-s"><span class="pl-pds">'</span>CustomClassName<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>addMethod(</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>methodA<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-k">function</span> (<span class="pl-smi">$argumentA</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$argumentB</span>) {</span>
<span class="pl-s1">            <span class="pl-c"><span class="pl-c">//</span> ...</span></span>
<span class="pl-s1">        }</span>
<span class="pl-s1">    )</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>addProperty(<span class="pl-s"><span class="pl-pds">'</span>propertyA<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)</span></pre></div>
<p>This is only a small example of what is possible. For a full list of the
available methods, see <a href="#the-mock-builder-api">the mock builder API</a>.</p>
<h4>
<a id="creating-mocks-from-a-builder" class="anchor" href="#creating-mocks-from-a-builder" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating mocks from a builder</h4>
<p>Once the builder is configured, there are several options for creating mock
instances. All of these will internally "finalize" the mock builder, and no
further customizations can be made.</p>
<p>Use <a href="#builder.full"><code>full()</code></a> to create a new full mock instance:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>full();</span></pre></div>
<p>Use <a href="#builder.partial"><code>partial()</code></a> to create a new partial mock instance:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>partial();</span></pre></div>
<p>Constructor arguments can also be passed to <a href="#builder.partial"><code>partial()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>partial(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span></pre></div>
<p>There is also a more advanced method, <a href="#builder.partialWith"><code>partialWith()</code></a>,
that accepts arguments passed by reference:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>partialWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>]);</span></pre></div>
<p>All of the above methods for creating mock instances store the last created mock
instance on the builder. To retrieve the last created mock instance, use
<a href="#builder.get"><code>get()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$mockA</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>full();</span>
<span class="pl-s1"><span class="pl-smi">$mockB</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$mockA</span> <span class="pl-k">===</span> <span class="pl-smi">$mockB</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'true'</span></span></pre></div>
<p>If no mock instance already exists, <a href="#builder.get"><code>get()</code></a> will create a new
full mock instance, and return it.</p>
<p>Note that unlike using <a href="#facade.mock"><code>mock()</code></a>, these methods do not
automatically wrap the returned mock in a <a href="#mock-handles">mock handle</a>. To obtain a handle,
use <a href="#facade.on"><code>on()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>mock();</span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> on(<span class="pl-smi">$mock</span>);</span></pre></div>
<h4>
<a id="generating-mock-classes-from-a-builder" class="anchor" href="#generating-mock-classes-from-a-builder" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Generating mock classes from a builder</h4>
<p>The mock class can be generated without actually creating a mock instance. To
generate and return a mock class, use <a href="#builder.build"><code>build()</code></a>, (which
returns a <a href="http://php.net/reflectionclass">ReflectionClass</a>):</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$class</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>build();</span></pre></div>
<p>The <a href="#builder.build"><code>build()</code></a> method will normally return the same class for
subsequent calls. To generate a new class each time, pass <code>true</code> as the first
argument:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$classA</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>build(<span class="pl-c1">true</span>);</span>
<span class="pl-s1"><span class="pl-smi">$classB</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>build(<span class="pl-c1">true</span>);</span></pre></div>
<p>Note that this is not possible when a custom class name has been set.</p>
<p>If only the class <em>name</em> is required, <a href="#builder.className"><code>className()</code></a> will
generate the mock class, and return the class name as a string:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$className</span> <span class="pl-k">=</span> <span class="pl-smi">$builder</span><span class="pl-k">-&gt;</span>className();</span></pre></div>
<p>All of the above methods will internally "finalize" the mock builder, and no
further customizations can be made.</p>
<h4>
<a id="copying-mock-builders" class="anchor" href="#copying-mock-builders" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Copying mock builders</h4>
<p>Mock builders can be copied by using the <a href="#builder.__clone"><code>clone</code></a> operator:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$builderA</span> <span class="pl-k">=</span> mockBuilder();</span>
<span class="pl-s1"><span class="pl-smi">$builderB</span> <span class="pl-k">=</span> <span class="pl-k">clone</span> <span class="pl-smi">$builderA</span>;</span></pre></div>
<p>A copied mock builder can be modified even if the original mock builder is
"finalized":</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$countableBuilder</span> <span class="pl-k">=</span> mockBuilder(<span class="pl-s"><span class="pl-pds">'</span>Countable<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$countable</span> <span class="pl-k">=</span> <span class="pl-smi">$countableBuilder</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$countableIteratorBuilder</span> <span class="pl-k">=</span> <span class="pl-k">clone</span> <span class="pl-smi">$countableBuilder</span>;</span>
<span class="pl-s1"><span class="pl-smi">$countableIteratorBuilder</span><span class="pl-k">-&gt;</span>like(<span class="pl-s"><span class="pl-pds">'</span>Iterator<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$countableIterator</span> <span class="pl-k">=</span> <span class="pl-smi">$countableIteratorBuilder</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$countable</span> <span class="pl-k">instanceof</span> <span class="pl-c1">Countable</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>;         <span class="pl-c"><span class="pl-c">//</span> outputs 'true'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$countableIterator</span> <span class="pl-k">instanceof</span> <span class="pl-c1">Countable</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'true'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$countable</span> <span class="pl-k">instanceof</span> <span class="pl-c1">Iterator</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>;         <span class="pl-c"><span class="pl-c">//</span> outputs 'false'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$countableIterator</span> <span class="pl-k">instanceof</span> <span class="pl-c1">Iterator</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'true'</span></span></pre></div>
<p>The copied mock builder will also ignore any mock instances generated by the
original builder:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$builderA</span> <span class="pl-k">=</span> mockBuilder();</span>
<span class="pl-s1"><span class="pl-smi">$mockA</span> <span class="pl-k">=</span> <span class="pl-smi">$builderA</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$builderB</span> <span class="pl-k">=</span> <span class="pl-k">clone</span> <span class="pl-smi">$builderA</span>;</span>
<span class="pl-s1"><span class="pl-smi">$mockB</span> <span class="pl-k">=</span> <span class="pl-smi">$builderB</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$mockA</span> <span class="pl-k">===</span> <span class="pl-smi">$mockB</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'false'</span></span></pre></div>
<h3>
<a id="pausing-mock-recording" class="anchor" href="#pausing-mock-recording" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Pausing mock recording</h3>
<p>To temporarily prevent an entire mock from recording calls, use
<a href="#handle.stopRecording"><code>stopRecording()</code></a> and
<a href="#handle.startRecording"><code>startRecording()</code></a> as necessary:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(</span>
<span class="pl-s1">    [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>methodA<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-k">function</span> () {},</span>
<span class="pl-s1">    ]</span>
<span class="pl-s1">);</span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>stopRecording();</span>
<span class="pl-s1"><span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>startRecording();</span>
<span class="pl-s1"><span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> passes</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> passes</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> fails</span></span></pre></div>
<h3>
<a id="mocking-and-non-public-methods" class="anchor" href="#mocking-and-non-public-methods" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mocking and non-public methods</h3>
<p><em>Phony</em>'s mocks do not require special setup for <code>protected</code> methods. <a href="#stubs">Stubbing</a>
and <a href="#verification">verification</a> work exactly the same for <code>protected</code> methods as they do for
<code>public</code> methods:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">Cat</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">speak</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-c1">echo</span> <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>think();</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">protected</span> <span class="pl-k">function</span> <span class="pl-en">think</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>Meow.<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> partialMock(<span class="pl-c1">Cat</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1"><span class="pl-smi">$cat</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$cat</span><span class="pl-k">-&gt;</span>speak();            <span class="pl-c"><span class="pl-c">//</span> outputs 'Meow.'</span></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">think</span><span class="pl-k">-&gt;</span>called(); <span class="pl-c"><span class="pl-c">//</span> passes</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">think</span><span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>Cower in fear, mortal.<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$cat</span><span class="pl-k">-&gt;</span>speak(); <span class="pl-c"><span class="pl-c">//</span> outputs 'Cower in fear, mortal.'</span></span></pre></div>
<p>Note however, that <em>Phony</em> does not magically make non-public methods accessible
from outside the class. See <a href="#accessing-non-public-methods-and-properties">Accessing non-public methods and properties</a> for
how to achieve this.</p>
<p>Also note that <em>Phony</em> <strong>cannot</strong> mock <code>private</code> methods. This is because the
mock class generated by <em>Phony</em> is a <em>sub-class</em> of the original type, and
"overriding" a <code>private</code> method does not change the behavior of the original
method.</p>
<h4>
<a id="accessing-non-public-methods-and-properties" class="anchor" href="#accessing-non-public-methods-and-properties" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Accessing non-public methods and properties</h4>
<p>In some cases, it may be necessary to bypass the <a href="http://php.net/language.oop5.visibility">visibility</a> restrictions
imposed by the <code>protected</code> and <code>private</code> keywords in order to test a
particularly difficult-to-reach branch of code.</p>
<p>This should be considered a <a href="https://en.wikipedia.org/wiki/Code_smell">code smell</a>, and ideally the system under test
should be refactored to avoid the need for such measures. If all else fails,
<code>protected</code> and <code>private</code> keywords <em>can</em> effectively be bypassed.</p>
<p><em>Phony</em> does not help in these kinds of cases, because it does not change the
visibility of methods when mocking. That is, <code>public</code> methods remain <code>public</code>,
and <code>protected</code> methods remain <code>protected</code>.</p>
<p>The <a href="https://github.com/eloquent/liberator">Liberator</a> library is specifically designed to aid in circumventing
<code>protected</code> and <code>private</code> keywords to provide access to normally inaccessible
methods and properties.</p>
<p>It is also possible to bypass visibility restrictions, without a library, via
reflection:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">Cat</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">protected</span> <span class="pl-k">function</span> <span class="pl-en">think</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">thought</span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">private</span> <span class="pl-smi">$thought</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Meow.<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$cat</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Cat</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$think</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">ReflectionMethod</span>(<span class="pl-smi">$cat</span>, <span class="pl-s"><span class="pl-pds">'</span>think<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$think</span><span class="pl-k">-&gt;</span>setAccessible(<span class="pl-c1">true</span>);</span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$think</span><span class="pl-k">-&gt;</span>invoke(<span class="pl-smi">$cat</span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'Meow.'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$thought</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">ReflectionProperty</span>(<span class="pl-smi">$cat</span>, <span class="pl-s"><span class="pl-pds">'</span>thought<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$thought</span><span class="pl-k">-&gt;</span>setAccessible(<span class="pl-c1">true</span>);</span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$thought</span><span class="pl-k">-&gt;</span>getValue(<span class="pl-smi">$cat</span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'Meow.'</span></span></pre></div>
<h3>
<a id="mocking-problematic-classes" class="anchor" href="#mocking-problematic-classes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mocking problematic classes</h3>
<p>Some PHP classes can be difficult, if not impossible, to mock. In particular,
<code>final</code> classes can only be mocked via <a href="#proxy-mocks">proxy mocks</a>, and only in certain
circumstances.</p>
<p>For up-to-date information on known issues with other problematic classes, see
<a href="https://github.com/eloquent/phony/wiki/Mocking-problematic-classes">Mocking problematic classes</a> in the wiki.</p>
<h3>
<a id="terminology" class="anchor" href="#terminology" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Terminology</h3>
<p>By some popular definitions, <em>Phony</em>'s mocks are not technically mocks at all,
because they do not implement "expectations". According to these definitions,
<em>Phony</em>'s mocks would be more correctly called stubs.</p>
<p>However, throughout <em>Phony</em>'s <a href="#api">API</a> and documentation, the term "mock" is used
to refer to any test double that is an object. The term "stub" is used to refer
to a callable that can be programmed to provide canned answers to incoming
calls.</p>
<h2>
<a id="stubs" class="anchor" href="#stubs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Stubs</h2>
<p><em>Stubs</em> are callable entities that can be configured to behave according to a
set of rules when called. In <em>Phony</em>, every stub also implements <a href="#the-spy-api">the spy API</a>.</p>
<h3>
<a id="stubbing-an-existing-callable" class="anchor" href="#stubbing-an-existing-callable" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Stubbing an existing callable</h3>
<p>Any callable can be stubbed, by passing the callable to
<a href="#facade.stub"><code>stub()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-smi">$callable</span>);        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>stub(<span class="pl-smi">$callable</span>); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span></pre></div>
<p>By default, the created stub will return "empty" values. The exact value depends
on the <a href="http://php.net/functions.returning-values#functions.returning-values.type-declaration">return type</a> of the callable, but in many cases it will be <code>null</code>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub(</span>
<span class="pl-s1">    <span class="pl-k">function</span> () {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">);</span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (): int {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-c1">111</span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>($<span class="pl-smi">stubA</span>()); <span class="pl-c"><span class="pl-c">//</span> outputs 'NULL'</span></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>($<span class="pl-smi">stubB</span>()); <span class="pl-c"><span class="pl-c">//</span> outputs 'int(0)'</span></span></pre></div>
<p>See <a href="#default-values-for-return-types">Default values for return types</a> for more information, and
<a href="#facade.emptyValue"><code>emptyValue()</code></a> for a full list of types and associated
"empty" values.</p>
<p>The stub can be configured to behave differently in specific circumstances,
whilst falling back to the default behavior during regular operation:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-s"><span class="pl-pds">'</span>max<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>with(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-c1">9</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>($<span class="pl-smi">stub</span>(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>)); <span class="pl-c"><span class="pl-c">//</span> outputs 'NULL'</span></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>($<span class="pl-smi">stub</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>)); <span class="pl-c"><span class="pl-c">//</span> outputs 'int(9)'</span></span></pre></div>
<p>The stub can also be configured to behave exactly like the original callable:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-s"><span class="pl-pds">'</span>max<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>forwards();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>($<span class="pl-smi">stub</span>(<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>)); <span class="pl-c"><span class="pl-c">//</span> outputs 'int(3)'</span></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>($<span class="pl-smi">stub</span>(<span class="pl-c1">4</span>, <span class="pl-c1">5</span>, <span class="pl-c1">6</span>)); <span class="pl-c"><span class="pl-c">//</span> outputs 'int(6)'</span></span></pre></div>
<h4>
<a id="stubbing-global-functions" class="anchor" href="#stubbing-global-functions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Stubbing global functions</h4>
<p>When an "unqualified" function (one with no preceding backslash) is used from
within a namespace, PHP will attempt to find the function in the calling
namespace first, before looking for the function in the <em>global</em> namespace. This
behavior is known as <a href="http://php.net/language.namespaces.fallback">global function fallback</a>.</p>
<p>This behavior can be exploited to allow a stub to replace a global function
during testing. To do so, two conditions must be met:</p>
<ul>
<li>The function must be called without any qualifying namespace or backslash.</li>
<li>The function must be called from within a namespace; function calls from the
global namespace cannot be stubbed.</li>
</ul>
<p>To stub a function in the global namespace, use
<a href="#facade.stubGlobal"><code>stubGlobal()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stubGlobal(<span class="pl-smi">$function</span>, <span class="pl-smi">$namespace</span>);        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>stubGlobal(<span class="pl-smi">$function</span>, <span class="pl-smi">$namespace</span>); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span></pre></div>
<p>Where <code>$function</code> is the name of the function in the global namespace, and
<code>$namespace</code> is the namespace from which the function will be called.</p>
<p>To demonstrate, the following code will work well with
<a href="#facade.stubGlobal"><code>stubGlobal()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">Foo\Bar</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">'</span>Keep it %s.<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>real<span class="pl-pds">'</span></span>);</span></pre></div>
<p>Under normal conditions, this code would output:</p>
<pre><code>Keep it real.
</code></pre>
<p>But if the <code>printf()</code> function is stubbed before executing this code, its
behavior can be changed:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">Foo\Bar</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-k">function</span> <span class="pl-c1">Eloquent\Phony\stubGlobal</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stubGlobal(<span class="pl-s"><span class="pl-pds">'</span>printf<span class="pl-pds">'</span></span>, <span class="pl-c1">__NAMESPACE__</span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">"</span>You're a total phony!<span class="pl-pds">"</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">'</span>Keep it %s.<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>real<span class="pl-pds">'</span></span>);</span></pre></div>
<p>This code will now output:</p>
<pre><code>You're a total phony!
</code></pre>
<h5>
<a id="restoring-global-functions-after-stubbing" class="anchor" href="#restoring-global-functions-after-stubbing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Restoring global functions after stubbing</h5>
<p>Leaving global functions stubbed after a test can affect the results of other
tests in the same namespace that make use of the same global function. To avoid
this problem, it is necessary to restore the behavior of stubbed global
functions after the test concludes.</p>
<p>To restore all stubbed and/or spied global functions, use
<a href="#facade.restoreGlobalFunctions"><code>restoreGlobalFunctions()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">restoreGlobalFunctions();        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-c1">Phony</span><span class="pl-k">::</span>restoreGlobalFunctions(); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span></pre></div>
<p>This method is suitable for use in the "tear down" phase of a test.</p>
<h5>
<a id="alternatives-for-stubbing-global-functions" class="anchor" href="#alternatives-for-stubbing-global-functions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Alternatives for stubbing global functions</h5>
<p>If the system under test is not suitable for stubbing via
<a href="http://php.net/language.namespaces.fallback">global function fallback</a>, an alternative is to accept a callback via
dependency injection that can take a stub during testing:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-k">function</span> <span class="pl-c1">Eloquent\Phony\stub</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">function</span> <span class="pl-en">functionA</span>(<span class="pl-smi">$sprintf</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>sprintf<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-c1">echo</span> $<span class="pl-smi">sprintf</span>(<span class="pl-s"><span class="pl-pds">'</span>Keep it %s.<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>real<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-s"><span class="pl-pds">'</span>sprintf<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">"</span>You're a total phony!<span class="pl-pds">"</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">functionA();      <span class="pl-c"><span class="pl-c">//</span> outputs 'Keep it real.'</span></span>
<span class="pl-s1">functionA(<span class="pl-smi">$stub</span>); <span class="pl-c"><span class="pl-c">//</span> outputs "You're a total phony!"</span></span></pre></div>
<p>Another alternative is to use a library like <a href="https://github.com/IcecaveStudios/isolator">Isolator</a>, that allows the
injection of an explicit dependency that represents the functions in the global
namespace. This dependency can then be mocked during testing.</p>
<h3>
<a id="anonymous-stubs" class="anchor" href="#anonymous-stubs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Anonymous stubs</h3>
<p><em>Anonymous stubs</em> are stubs that do not wrap an existing callable. An anonymous
stub is created by calling <a href="#facade.stub"><code>stub()</code></a> without passing a callable:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub();        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>stub(); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span></pre></div>
<p>By default, anonymous stubs will always return <code>null</code> regardless of input
arguments:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">gettype</span>($<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)); <span class="pl-c"><span class="pl-c">//</span> outputs 'NULL'</span></span></pre></div>
<p>The stub can be configured to behave differently in specific circumstances,
whilst returning <code>null</code> during regular operation:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">gettype</span>($<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)); <span class="pl-c"><span class="pl-c">//</span> outputs 'NULL'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);          <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span></pre></div>
<p>The stub can also be configured to behave the same in all circumstances:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>();    <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span></pre></div>
<h3>
<a id="stub-self-values" class="anchor" href="#stub-self-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Stub "self" values</h3>
<p>All stubs have a special "self" value that is used in multiple ways by <em>Phony</em>.
The self value defaults to the stub itself:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>self() <span class="pl-k">===</span> <span class="pl-smi">$stub</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'true'</span></span></pre></div>
<p>The self value can also be set manually by calling <a href="#stub.setSelf"><code>setSelf()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub();</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>setSelf(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>self(); <span class="pl-c"><span class="pl-c">//</span> outputs 'a'</span></span></pre></div>
<p>The <a href="#stub.setSelf"><code>setSelf()</code></a> method is also fluent, meaning that stub
creation and self value setting can be done in a single expression:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>setSelf(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span></pre></div>
<p>When stubs are retrieved from a <a href="#mocks">mock</a>, their "self" value is automatically set
to the mock itself:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>self() <span class="pl-k">===</span> <span class="pl-smi">$mock</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'true'</span></span></pre></div>
<h4>
<a id="magic-self-values" class="anchor" href="#magic-self-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Magic "self" values</h4>
<p>A stubbed callback that has a first parameter named <code>$phonySelf</code>, regardless of
the parameter's type, will receive the stub <a href="#stub-self-values">self value</a> as the first argument.</p>
<p>In the case of stubs created outside of a mock, this self value will be the stub
itself, allowing recursive calls without creating an explicit reference to the
callback:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$factorial</span> <span class="pl-k">=</span> stub(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-smi">$phonySelf</span>, <span class="pl-smi">$n</span>) {</span>
<span class="pl-s1">        <span class="pl-k">if</span> (<span class="pl-c1">0</span> <span class="pl-k">===</span> <span class="pl-smi">$n</span>) {</span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-c1">1</span>;</span>
<span class="pl-s1">        }</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-smi">$n</span> <span class="pl-k">*</span> $<span class="pl-smi">phonySelf</span>(<span class="pl-smi">$n</span> <span class="pl-k">-</span> <span class="pl-c1">1</span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">);</span>
<span class="pl-s1"><span class="pl-smi">$factorial</span><span class="pl-k">-&gt;</span>forwards();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">factorial</span>(<span class="pl-c1">0</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '1'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">factorial</span>(<span class="pl-c1">1</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '1'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">factorial</span>(<span class="pl-c1">2</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '2'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">factorial</span>(<span class="pl-c1">3</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '6'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">factorial</span>(<span class="pl-c1">4</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '24'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">factorial</span>(<span class="pl-c1">5</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '120'</span></span></pre></div>
<h3>
<a id="stub-rules-and-answers" class="anchor" href="#stub-rules-and-answers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Stub rules and answers</h3>
<p><em>Stub rules</em> define the circumstances under which a stub changes its behavior.
<em>Stub answers</em> define how the stub behaves for a given rule. Each time a stub is
called, it will chose an answer by determining which rule matches the incoming
arguments:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)     <span class="pl-c"><span class="pl-c">//</span> starts the rule</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> creates an answer for the rule</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span></pre></div>
<h4>
<a id="multiple-rules" class="anchor" href="#multiple-rules" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Multiple rules</h4>
<p>Each time <a href="#stub.with"><code>with()</code></a> is called (not to be confused with
<a href="#spy.calledWith"><code>calledWith()</code></a>, which is part of <a href="#the-spy-api">the spy API</a>), a new rule
is started:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>) <span class="pl-c"><span class="pl-c">//</span> starts a rule</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>) <span class="pl-c"><span class="pl-c">//</span> starts another rule</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'y'</span></span></pre></div>
<h4>
<a id="multiple-answers" class="anchor" href="#multiple-answers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Multiple answers</h4>
<p>A rule can have multiple answers. Each time a stub is called, <em>Phony</em> finds a
matching rule, and uses the next answer for that rule. When the last answer is
reached, <em>Phony</em> will continue to use it for any subsequent calls:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)  <span class="pl-c"><span class="pl-c">//</span> creates the first answer</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> creates a subsequent answer</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">while</span> (<span class="pl-c1">true</span>) {</span>
<span class="pl-s1">  <span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'y' forever</span></span>
<span class="pl-s1">}</span></pre></div>
<h4>
<a id="overriding-rules" class="anchor" href="#overriding-rules" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Overriding rules</h4>
<p>Defining a rule that matches the same arguments as a previous rule will override
the previous rule:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> overrides previous rule</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'y'</span></span></pre></div>
<p>Defining a new rule that matches any arguments will override <strong>all</strong> previous
rules:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> overrides all previous rules</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'z'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'z'</span></span></pre></div>
<p>Later rules take precedence over earlier ones, so more generic rules should be
defined first, with more specific rules being defined later:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)  <span class="pl-c"><span class="pl-c">//</span> a generic rule</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> a more specific rule</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);      <span class="pl-c"><span class="pl-c">//</span> outputs 'y'</span></span></pre></div>
<h4>
<a id="the-default-rule-and-answer" class="anchor" href="#the-default-rule-and-answer" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The default rule and answer</h4>
<p>When a new stub is created, the first rule is started implicitly, as if
<a href="#shorthand-matchers"><code>with('*')</code></a> were called. For example, the two following
stubs behave the same:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-c"><span class="pl-c">//</span> implicit -&gt;with('*')</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span></pre></div>
<p>If a new rule is started before any answers are defined, the stub behaves as if
<a href="#stub.returns"><code>returns()</code></a> were called with no arguments, causing the stub to
return an "empty" value by default. For example, the two following stubs behave
the same:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub(<span class="pl-smi">$callable</span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub(<span class="pl-smi">$callable</span>)</span>
<span class="pl-s1">    <span class="pl-c"><span class="pl-c">//</span> implicit -&gt;with('*')-&gt;returns()</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span></pre></div>
<h5>
<a id="the-default-answer-callback" class="anchor" href="#the-default-answer-callback" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The default answer callback</h5>
<p>To change the default behavior of a stub, use
<a href="#stub.setDefaultAnswerCallback"><code>setDefaultAnswerCallback()</code></a>. This method
accepts a callback that takes the stub as the first argument:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub();</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>setDefaultAnswerCallback(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-smi">$stub</span>) {</span>
<span class="pl-s1">        <span class="pl-c"><span class="pl-c">//</span> custom answer logic goes here</span></span>
<span class="pl-s1">        <span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>default<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'default'</span></span></pre></div>
<p>The <a href="#stub.setDefaultAnswerCallback"><code>setDefaultAnswerCallback()</code></a> method is
also fluent, meaning stub creation and setting of this option can be done in a
single expression:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>setDefaultAnswerCallback(<span class="pl-smi">$defaultAnswerCallback</span>);</span></pre></div>
<h3>
<a id="matching-stub-arguments" class="anchor" href="#matching-stub-arguments" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Matching stub arguments</h3>
<p>Stub arguments can be matched using <a href="#stub.with"><code>with()</code></a> (not to be confused
with <a href="#spy.calledWith"><code>calledWith()</code></a>, which is part of <a href="#the-spy-api">the spy API</a>).
Arguments passed to <a href="#stub.with"><code>with()</code></a> can be literal values, or <a href="#matchers">matchers</a>,
including <a href="#shorthand-matchers">shorthand matchers</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>v<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>w<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with()<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);           <span class="pl-c"><span class="pl-c">//</span> outputs 'v'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'w'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);      <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);      <span class="pl-c"><span class="pl-c">//</span> outputs 'y'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>();              <span class="pl-c"><span class="pl-c">//</span> outputs 'z'</span></span></pre></div>
<h3>
<a id="returning-values" class="anchor" href="#returning-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Returning values</h3>
<p>To return a value from a stub, use <a href="#stub.returns"><code>returns()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubA</span>();          <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">gettype</span>($<span class="pl-smi">stubB</span>()); <span class="pl-c"><span class="pl-c">//</span> outputs 'NULL'</span></span></pre></div>
<p>Calling <a href="#stub.returns"><code>returns()</code></a> with multiple arguments is equivalent to
calling it once with each argument. For example, the two following stubs behave
the same:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubA</span>(); <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubA</span>(); <span class="pl-c"><span class="pl-c">//</span> outputs 'y'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubB</span>(); <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubB</span>(); <span class="pl-c"><span class="pl-c">//</span> outputs 'y'</span></span></pre></div>
<h4>
<a id="default-values-for-return-types" class="anchor" href="#default-values-for-return-types" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Default values for return types</h4>
<p>When using <a href="#stub.returns"><code>returns()</code></a> without passing an explicit value,
<em>Phony</em> will attempt to return a value that conforms to the stubbed callable's
<a href="http://php.net/functions.returning-values#functions.returning-values.type-declaration">return type</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (): int {}</span>
<span class="pl-s1">);</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>($<span class="pl-smi">stubA</span>()); <span class="pl-c"><span class="pl-c">//</span> outputs 'int(0)'</span></span></pre></div>
<p>See <a href="#facade.emptyValue"><code>emptyValue()</code></a> for a full list of types and associated
"empty" values.</p>
<p>When using a specific class name as a <a href="http://php.net/functions.returning-values#functions.returning-values.type-declaration">return type</a>, the return value will be a
<a href="#mocks">mock</a> of the specified type:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (): DateTime {})<span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"><span class="pl-smi">$result</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$result</span> <span class="pl-k">instanceof</span> <span class="pl-c1">DateTime</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'true'</span></span></pre></div>
<p>By necessity, the returned value will not be wrapped in a <a href="#mock-handles">mock handle</a>.</p>
<h3>
<a id="returning-arguments" class="anchor" href="#returning-arguments" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Returning arguments</h3>
<p>To return an argument from a stub, use
<a href="#stub.returnsArgument"><code>returnsArgument()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>returnsArgument();   <span class="pl-c"><span class="pl-c">//</span> returns the first argument</span></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>returnsArgument(<span class="pl-c1">1</span>);  <span class="pl-c"><span class="pl-c">//</span> returns the second argument</span></span>
<span class="pl-s1"><span class="pl-smi">$stubC</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>returnsArgument(<span class="pl-k">-</span><span class="pl-c1">1</span>); <span class="pl-c"><span class="pl-c">//</span> returns the last argument</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubA</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubB</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'y'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubC</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'z'</span></span></pre></div>
<h3>
<a id="returning-the-self-value" class="anchor" href="#returning-the-self-value" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Returning the "self" value</h3>
<p>When stubs are retrieved from a mock, their <a href="#stub-self-values">self value</a> is automatically set to
the mock itself. This allows mocking of <a href="http://en.wikipedia.org/wiki/Fluent_interface">fluent interfaces</a> with the
<a href="#stub.returnsSelf"><code>returnsSelf()</code></a> method:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">interface</span> <span class="pl-en">Fluent</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">methodA</span>();</span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">methodB</span>();</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-c1">Fluent</span><span class="pl-k">::</span><span class="pl-c1">class</span>)</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>returnsSelf();</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodB</span><span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$fluent</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$fluent</span><span class="pl-k">-&gt;</span>methodA()<span class="pl-k">-&gt;</span>methodB(); <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span></pre></div>
<h3>
<a id="throwing-exceptions" class="anchor" href="#throwing-exceptions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Throwing exceptions</h3>
<p>To throw an exception from a stub, use <a href="#stub.throws"><code>throws()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$exception</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>You done goofed.<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>throws(<span class="pl-smi">$exception</span>);</span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>throws();</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">stubA</span>(); <span class="pl-c"><span class="pl-c">//</span> throws $exception</span></span>
<span class="pl-s1">$<span class="pl-smi">stubB</span>(); <span class="pl-c"><span class="pl-c">//</span> throws a generic exception</span></span></pre></div>
<p>Calling <a href="#stub.throws"><code>throws()</code></a> with multiple arguments is equivalent to
calling it once with each argument. For example, the two following stubs behave
the same:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$exceptionA</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>You done goofed.<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$exceptionB</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>Consequences will never be the same.<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>throws(<span class="pl-smi">$exceptionA</span>, <span class="pl-smi">$exceptionB</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">stubA</span>(); <span class="pl-c"><span class="pl-c">//</span> throws $exceptionA</span></span>
<span class="pl-s1">$<span class="pl-smi">stubA</span>(); <span class="pl-c"><span class="pl-c">//</span> throws $exceptionB</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>throws(<span class="pl-smi">$exceptionA</span>)<span class="pl-k">-&gt;</span>throws(<span class="pl-smi">$exceptionB</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">stubB</span>(); <span class="pl-c"><span class="pl-c">//</span> throws $exceptionA</span></span>
<span class="pl-s1">$<span class="pl-smi">stubB</span>(); <span class="pl-c"><span class="pl-c">//</span> throws $exceptionB</span></span></pre></div>
<h3>
<a id="using-a-callable-as-an-answer" class="anchor" href="#using-a-callable-as-an-answer" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using a callable as an answer</h3>
<p>To use a callable as an answer, use <a href="#stub.does"><code>does()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>does(<span class="pl-s"><span class="pl-pds">'</span>max<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '3'</span></span></pre></div>
<p>Calling <a href="#stub.does"><code>does()</code></a> with multiple arguments is equivalent to calling
it once with each argument. For example, the two following stubs behave the
same:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>does(<span class="pl-s"><span class="pl-pds">'</span>min<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>max<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubA</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '1'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubA</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '3'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>does(<span class="pl-s"><span class="pl-pds">'</span>min<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>does(<span class="pl-s"><span class="pl-pds">'</span>max<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubB</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '1'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stubB</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '3'</span></span></pre></div>
<p>There is also a more powerful version of <a href="#stub.does"><code>does()</code></a>, named
<a href="#stub.doesWith"><code>doesWith()</code></a>, that allows more control over which arguments
are passed to the callable, and how they are passed:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>doesWith(</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>implode<span class="pl-pds">'</span></span>, <span class="pl-c"><span class="pl-c">//</span> callable</span></span>
<span class="pl-s1">    [<span class="pl-s"><span class="pl-pds">'</span>, <span class="pl-pds">'</span></span>],    <span class="pl-c"><span class="pl-c">//</span> fixed arguments</span></span>
<span class="pl-s1">    <span class="pl-c1">false</span>,     <span class="pl-c"><span class="pl-c">//</span> prefix the "self" value?</span></span>
<span class="pl-s1">    <span class="pl-c1">true</span>,      <span class="pl-c"><span class="pl-c">//</span> suffix the arguments object?</span></span>
<span class="pl-s1">    <span class="pl-c1">false</span>      <span class="pl-c"><span class="pl-c">//</span> suffix the arguments normally?</span></span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'x, y, z'</span></span></pre></div>
<p>The <a href="#stub.doesWith"><code>doesWith()</code></a> method also supports arguments passed by
reference:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$d</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>doesWith(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>) {</span>
<span class="pl-s1">        <span class="pl-c1">list</span>(<span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>, <span class="pl-smi">$c</span>, <span class="pl-smi">$d</span>) <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">    },</span>
<span class="pl-s1">    [<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>],</span>
<span class="pl-s1">    <span class="pl-c1">false</span>,</span>
<span class="pl-s1">    <span class="pl-c1">false</span>,</span>
<span class="pl-s1">    <span class="pl-c1">true</span></span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'a'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$b</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'b'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$c</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'c'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$d</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'd'</span></span></pre></div>
<p>Both <a href="#stub.does"><code>does()</code></a> and <a href="#stub.doesWith"><code>doesWith()</code></a> support
<a href="#magic-self-values">magic "self" values</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>does(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-smi">$phonySelf</span>, <span class="pl-smi">$argument</span>) {</span>
<span class="pl-s1">        <span class="pl-c"><span class="pl-c">//</span> $phonySelf is the "self" value, $argument is the first argument</span></span>
<span class="pl-s1">    }</span>
<span class="pl-s1">);</span></pre></div>
<h3>
<a id="forwarding-to-the-original-callable" class="anchor" href="#forwarding-to-the-original-callable" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Forwarding to the original callable</h3>
<p>When stubbing an existing callable, the stub can "forward" calls on to the
original callable using <a href="#stub.forwards"><code>forwards()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-s"><span class="pl-pds">'</span>max<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns(<span class="pl-c1">9</span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>with(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>)<span class="pl-k">-&gt;</span>forwards();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '3'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">3</span>, <span class="pl-c1">4</span>, <span class="pl-c1">5</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '9'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-c1">7</span>, <span class="pl-c1">6</span>, <span class="pl-c1">5</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '9'</span></span></pre></div>
<p>This technique can be used to return a stub or mocked method to its default
behavior in specific circumstances:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">Cat</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">speak</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>Cower in fear, mortal.<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-c1">Cat</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">speak</span><span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>Meow.<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>speak(<span class="pl-c1">true</span>)<span class="pl-k">-&gt;</span>forwards();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$cat</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$cat</span><span class="pl-k">-&gt;</span>speak();     <span class="pl-c"><span class="pl-c">//</span> outputs 'Meow.'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$cat</span><span class="pl-k">-&gt;</span>speak(<span class="pl-c1">true</span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'Cower in fear, mortal.'</span></span></pre></div>
<p>The <a href="#stub.forwards"><code>forwards()</code></a> method also supports advanced usage,
including the ability to add to, and/or remove from, the arguments passed on to
the original callable:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-s"><span class="pl-pds">'</span>implode<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>forwards(</span>
<span class="pl-s1">    [<span class="pl-s"><span class="pl-pds">'</span>, <span class="pl-pds">'</span></span>],    <span class="pl-c"><span class="pl-c">//</span> fixed arguments</span></span>
<span class="pl-s1">    <span class="pl-c1">false</span>,     <span class="pl-c"><span class="pl-c">//</span> prefix the "self" value?</span></span>
<span class="pl-s1">    <span class="pl-c1">true</span>,      <span class="pl-c"><span class="pl-c">//</span> suffix the arguments object?</span></span>
<span class="pl-s1">    <span class="pl-c1">false</span>      <span class="pl-c"><span class="pl-c">//</span> suffix the arguments normally?</span></span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'x, y, z'</span></span></pre></div>
<p>Arguments passed by reference are also supported:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$d</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>) {</span>
<span class="pl-s1">        <span class="pl-c1">list</span>(<span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>, <span class="pl-smi">$c</span>, <span class="pl-smi">$d</span>) <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>forwards([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>], <span class="pl-c1">false</span>, <span class="pl-c1">false</span>, <span class="pl-c1">true</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'a'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$b</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'b'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$c</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'c'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$d</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'd'</span></span></pre></div>
<h3>
<a id="answers-that-perform-multiple-actions" class="anchor" href="#answers-that-perform-multiple-actions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Answers that perform multiple actions</h3>
<p>Stubs can perform multiple actions as part of a single answer. This allows
callables that have side effects other than return values or exceptions to be
emulated.</p>
<p>The most familiar of these side effects is probably the modification of
passed-by-reference arguments, and the invocation of other callables, such as in
an event emitter implementation.</p>
<h4>
<a id="setting-passed-by-reference-arguments" class="anchor" href="#setting-passed-by-reference-arguments" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setting passed-by-reference arguments</h4>
<p>To set a reference argument as part of an answer, use
<a href="#stub.setsArgument"><code>setsArgument()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>) {})</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-c1">0</span>, <span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)  <span class="pl-c"><span class="pl-c">//</span> sets the first argument to 'x'</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-c1">1</span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)  <span class="pl-c"><span class="pl-c">//</span> sets the second argument to 'y'</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-k">-</span><span class="pl-c1">1</span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>) <span class="pl-c"><span class="pl-c">//</span> sets the last argument to 'z'</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$b</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'y'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$c</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'z'</span></span></pre></div>
<p>If only one argument is passed to <a href="#stub.setsArgument"><code>setsArgument()</code></a>, it
sets the first argument:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>) {})</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>) <span class="pl-c"><span class="pl-c">//</span> sets the first argument to 'x'</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span></pre></div>
<p>If <a href="#stub.setsArgument"><code>setsArgument()</code></a> is called without any arguments, it
sets the first argument to <code>null</code>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>) {})</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument() <span class="pl-c"><span class="pl-c">//</span> sets the first argument to `null`</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">gettype</span>(<span class="pl-smi">$a</span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'NULL'</span></span></pre></div>
<h4>
<a id="invoking-arguments" class="anchor" href="#invoking-arguments" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Invoking arguments</h4>
<p>To invoke an argument as part of an answer, use
<a href="#stub.callsArgument"><code>callsArgument()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgument()   <span class="pl-c"><span class="pl-c">//</span> calls the first argument</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgument(<span class="pl-c1">1</span>)  <span class="pl-c"><span class="pl-c">//</span> calls the second argument</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgument(<span class="pl-k">-</span><span class="pl-c1">1</span>) <span class="pl-c"><span class="pl-c">//</span> calls the last argument</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$x</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"><span class="pl-smi">$y</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"><span class="pl-smi">$z</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">stub</span>(<span class="pl-smi">$x</span>, <span class="pl-smi">$y</span>, <span class="pl-smi">$z</span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'xyz'</span></span></pre></div>
<p>There is also a more powerful version of
<a href="#stub.callsArgument"><code>callsArgument()</code></a>, named
<a href="#stub.callsArgumentWith"><code>callsArgumentWith()</code></a>, that allows more control over
which arguments are passed to the callable, and how they are passed:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgumentWith(</span>
<span class="pl-s1">        <span class="pl-c1">1</span>,              <span class="pl-c"><span class="pl-c">//</span> argument to invoke</span></span>
<span class="pl-s1">        [<span class="pl-s"><span class="pl-pds">'</span>%s, %s, %s<span class="pl-pds">'</span></span>], <span class="pl-c"><span class="pl-c">//</span> fixed arguments</span></span>
<span class="pl-s1">        <span class="pl-c1">false</span>,          <span class="pl-c"><span class="pl-c">//</span> prefix the "self" value?</span></span>
<span class="pl-s1">        <span class="pl-c1">true</span>,           <span class="pl-c"><span class="pl-c">//</span> suffix the arguments object?</span></span>
<span class="pl-s1">        <span class="pl-c1">false</span>           <span class="pl-c"><span class="pl-c">//</span> suffix the arguments normally?</span></span>
<span class="pl-s1">    )</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>printf<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'x, printf, y'</span></span></pre></div>
<p>The <a href="#stub.callsArgumentWith"><code>callsArgumentWith()</code></a> method also supports
arguments passed by reference:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$d</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>callsArgumentWith(</span>
<span class="pl-s1">    <span class="pl-k">-</span><span class="pl-c1">1</span>,</span>
<span class="pl-s1">    [<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>],</span>
<span class="pl-s1">    <span class="pl-c1">false</span>,</span>
<span class="pl-s1">    <span class="pl-c1">false</span>,</span>
<span class="pl-s1">    <span class="pl-c1">true</span></span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$callback</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">list</span>(<span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>, <span class="pl-smi">$c</span>, <span class="pl-smi">$d</span>) <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">};</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>, <span class="pl-smi">$callback</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'a'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$b</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'b'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$c</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'c'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$d</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'd'</span></span></pre></div>
<h4>
<a id="invoking-callables" class="anchor" href="#invoking-callables" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Invoking callables</h4>
<p>To invoke a callable as part of an answer, use <a href="#stub.calls"><code>calls()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>calls(<span class="pl-s"><span class="pl-pds">'</span>printf<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>%s, %s<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'a, b'</span></span></pre></div>
<p>Calling <a href="#stub.calls"><code>calls()</code></a> with multiple arguments is equivalent to
calling it once with each argument. For example, the two following stubs behave
the same:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$x</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"><span class="pl-smi">$y</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$x</span>, <span class="pl-smi">$y</span>)<span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">stubA</span>(); <span class="pl-c"><span class="pl-c">//</span> outputs 'xy'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$x</span>)<span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$y</span>)<span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">stubB</span>(); <span class="pl-c"><span class="pl-c">//</span> outputs 'xy'</span></span></pre></div>
<p>There is also a more powerful version of <a href="#stub.calls"><code>calls()</code></a>, named
<a href="#stub.callsWith"><code>callsWith()</code></a>, that allows more control over which arguments
are passed to the callable, and how they are passed:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsWith(</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>printf<span class="pl-pds">'</span></span>,   <span class="pl-c"><span class="pl-c">//</span> argument to invoke</span></span>
<span class="pl-s1">        [<span class="pl-s"><span class="pl-pds">'</span>%s, %s<span class="pl-pds">'</span></span>], <span class="pl-c"><span class="pl-c">//</span> fixed arguments</span></span>
<span class="pl-s1">        <span class="pl-c1">false</span>,      <span class="pl-c"><span class="pl-c">//</span> prefix the "self" value?</span></span>
<span class="pl-s1">        <span class="pl-c1">false</span>,      <span class="pl-c"><span class="pl-c">//</span> suffix the arguments object?</span></span>
<span class="pl-s1">        <span class="pl-c1">true</span>        <span class="pl-c"><span class="pl-c">//</span> suffix the arguments normally?</span></span>
<span class="pl-s1">    )</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'x, y'</span></span></pre></div>
<p>The <a href="#stub.callsWith"><code>callsWith()</code></a> method also supports arguments passed by
reference:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$d</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>callsWith(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>) {</span>
<span class="pl-s1">        <span class="pl-c1">list</span>(<span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>, <span class="pl-smi">$c</span>, <span class="pl-smi">$d</span>) <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">    },</span>
<span class="pl-s1">    [<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>],</span>
<span class="pl-s1">    <span class="pl-c1">false</span>,</span>
<span class="pl-s1">    <span class="pl-c1">false</span>,</span>
<span class="pl-s1">    <span class="pl-c1">true</span></span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'a'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$b</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'b'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$c</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'c'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$d</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'd'</span></span></pre></div>
<p>Both <a href="#stub.calls"><code>calls()</code></a> and <a href="#stub.callsWith"><code>callsWith()</code></a> support
<a href="#magic-self-values">magic "self" values</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>calls(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-smi">$phonySelf</span>, <span class="pl-smi">$argument</span>) {</span>
<span class="pl-s1">        <span class="pl-c"><span class="pl-c">//</span> $phonySelf is the "self" value, $argument is the first argument</span></span>
<span class="pl-s1">    }</span>
<span class="pl-s1">);</span></pre></div>
<h3>
<a id="stubbing-generators" class="anchor" href="#stubbing-generators" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Stubbing generators</h3>
<p>To return a <a href="http://php.net/language.generators.overview">generator</a> from a stub, use <a href="#stub.generates"><code>generates()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub();</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>generates();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>();</span>
<span class="pl-s1"><span class="pl-smi">$values</span> <span class="pl-k">=</span> <span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c"><span class="pl-c">//</span> consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generator</span> <span class="pl-k">instanceof</span> <span class="pl-c1">Generator</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'true'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">json_encode</span>(<span class="pl-smi">$values</span>);                               <span class="pl-c"><span class="pl-c">//</span> outputs '[]'</span></span></pre></div>
<p>The result of <a href="#stub.generates"><code>generates()</code></a> is a <a href="#the-generator-answer-api">generator answer</a>. This
object can be used to further customize the behavior of the generator. See the
subsequent headings for details of these customizations.</p>
<p>Certain methods, such as <a href="#generatorAnswer.returns"><code>returns()</code></a>, or
<a href="#generatorAnswer.throws"><code>throws()</code></a>, mark the "end" of generator answer. When
a generator answer is "ended", the original stub is returned, allowing continued
stubbing in a fluent manner:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates()     <span class="pl-c"><span class="pl-c">//</span> returns a generator</span></span>
<span class="pl-s1">        <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">        <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">        <span class="pl-k">-&gt;</span>returns()   <span class="pl-c"><span class="pl-c">//</span> ends the generator</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>)    <span class="pl-c"><span class="pl-c">//</span> returns a normal value</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates()     <span class="pl-c"><span class="pl-c">//</span> returns another generator</span></span>
<span class="pl-s1">        <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">        <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>e<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">        <span class="pl-k">-&gt;</span>throws();   <span class="pl-c"><span class="pl-c">//</span> ends the generator by throwing</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$resultA</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>();</span>
<span class="pl-s1"><span class="pl-smi">$resultB</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>();</span>
<span class="pl-s1"><span class="pl-smi">$resultC</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$resultA</span> <span class="pl-k">instanceof</span> <span class="pl-c1">Generator</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'true'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$resultB</span> <span class="pl-k">instanceof</span> <span class="pl-c1">Generator</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'false'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$resultC</span> <span class="pl-k">instanceof</span> <span class="pl-c1">Generator</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'true'</span></span></pre></div>
<h4>
<a id="yielding-from-a-generator" class="anchor" href="#yielding-from-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Yielding from a generator</h4>
<p>Keys and values to be yielded can be passed directly to
<a href="#stub.generates"><code>generates()</code></a> as any iterable value:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates([<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>])<span class="pl-k">-&gt;</span>returns()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates([<span class="pl-s"><span class="pl-pds">'</span>e<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>f<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>g<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>h<span class="pl-pds">'</span></span>])<span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generatorA</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>();</span>
<span class="pl-s1"><span class="pl-smi">$generatorB</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$valuesA</span> <span class="pl-k">=</span> <span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorA</span>); <span class="pl-c"><span class="pl-c">//</span> consume the generator</span></span>
<span class="pl-s1"><span class="pl-smi">$valuesB</span> <span class="pl-k">=</span> <span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorB</span>); <span class="pl-c"><span class="pl-c">//</span> consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">json_encode</span>(<span class="pl-smi">$valuesA</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '["a","b","c","d"]'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">json_encode</span>(<span class="pl-smi">$valuesB</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '{"e":"f","g":"h"}'</span></span></pre></div>
<h5>
<a id="yielding-individual-values-from-a-generator" class="anchor" href="#yielding-individual-values-from-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Yielding individual values from a generator</h5>
<p>For more complicated generator behavior stubbing,
<a href="#generatorAnswer.yields"><code>yields()</code></a> can be used to interleave yields with
other actions:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$count</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>;</span>
<span class="pl-s1"><span class="pl-smi">$callback</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () <span class="pl-k">use</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$count</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Called %d time(s)<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, <span class="pl-k">++</span><span class="pl-smi">$count</span>);</span>
<span class="pl-s1">};</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$argument</span>) {});</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$callback</span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$callback</span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">foreach</span> ($<span class="pl-smi">stub</span>() <span class="pl-k">as</span> <span class="pl-smi">$value</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Value: %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, <span class="pl-smi">$value</span>);</span>
<span class="pl-s1">}</span></pre></div>
<p>The above example outputs:</p>
<pre><code>Called 1 time(s)
Value: a
Called 2 time(s)
Value: b
</code></pre>
<p>If <a href="#generatorAnswer.yields"><code>yields()</code></a> is called with 2 arguments, they are
treated as key and value respectively. When called with 1 argument, the argument
is treated as the value to yield. When called with no arguments, the generator
will yield with no value:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$values</span> <span class="pl-k">=</span> <span class="pl-c1">iterator_to_array</span>($<span class="pl-smi">stub</span>()); <span class="pl-c"><span class="pl-c">//</span> consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">json_encode</span>(<span class="pl-smi">$values</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '{"a":"b","0":"c","1":null}'</span></span></pre></div>
<h5>
<a id="yielding-multiple-values-from-a-generator" class="anchor" href="#yielding-multiple-values-from-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Yielding multiple values from a generator</h5>
<p>To yield a set of values from an array, an iterator, or another generator, use
<a href="#generatorAnswer.yieldsFrom"><code>yieldsFrom()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yieldsFrom([<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>])</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yieldsFrom([<span class="pl-s"><span class="pl-pds">'</span>e<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>f<span class="pl-pds">'</span></span>])</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$values</span> <span class="pl-k">=</span> <span class="pl-c1">iterator_to_array</span>($<span class="pl-smi">stub</span>()); <span class="pl-c"><span class="pl-c">//</span> consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">json_encode</span>(<span class="pl-smi">$values</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '{"a":"b","c":"d","e":"f"}'</span></span></pre></div>
<p>Calling <a href="#stub.generates"><code>generates()</code></a> with multiple sets of values creates
multiple answers that yield the supplied values on subsequent invocations. The
returned <a href="#the-generator-answer-api">generator answer</a> will allow customization of the final answer only.
For example, the two following stubs behave the same:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates([<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>], [<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>])</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>e<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">json_encode</span>(<span class="pl-c1">iterator_to_array</span>($<span class="pl-smi">stubA</span>())); <span class="pl-c"><span class="pl-c">//</span> outputs '["a","b"]'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">json_encode</span>(<span class="pl-c1">iterator_to_array</span>($<span class="pl-smi">stubA</span>())); <span class="pl-c"><span class="pl-c">//</span> outputs '["c","d","e"]'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates([<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>])</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates([<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>])</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>e<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">json_encode</span>(<span class="pl-c1">iterator_to_array</span>($<span class="pl-smi">stubB</span>())); <span class="pl-c"><span class="pl-c">//</span> outputs '["a","b"]'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">json_encode</span>(<span class="pl-c1">iterator_to_array</span>($<span class="pl-smi">stubB</span>())); <span class="pl-c"><span class="pl-c">//</span> outputs '["c","d","e"]'</span></span></pre></div>
<h4>
<a id="returning-values-from-a-generator" class="anchor" href="#returning-values-from-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Returning values from a generator</h4>
<p>To return a value from a generator, use <a href="#generatorAnswer.returns"><code>returns()</code></a>
on any <a href="#the-generator-answer-api">generator answer</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>();</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c"><span class="pl-c">//</span> consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>getReturn(); <span class="pl-c"><span class="pl-c">//</span> outputs 'a'</span></span></pre></div>
<p>Calling <a href="#generatorAnswer.returns"><code>returns()</code></a> with multiple arguments allows
for easy specification of the generator return value on subsequent invocations.
For example, the two following stubs behave the same:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generatorA</span> <span class="pl-k">=</span> $<span class="pl-smi">stubA</span>();</span>
<span class="pl-s1"><span class="pl-smi">$generatorB</span> <span class="pl-k">=</span> $<span class="pl-smi">stubA</span>();</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorA</span>);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorB</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generatorA</span><span class="pl-k">-&gt;</span>getReturn(); <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generatorB</span><span class="pl-k">-&gt;</span>getReturn(); <span class="pl-c"><span class="pl-c">//</span> outputs 'y'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generatorA</span> <span class="pl-k">=</span> $<span class="pl-smi">stubB</span>();</span>
<span class="pl-s1"><span class="pl-smi">$generatorB</span> <span class="pl-k">=</span> $<span class="pl-smi">stubB</span>();</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorA</span>);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorB</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generatorA</span><span class="pl-k">-&gt;</span>getReturn(); <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generatorB</span><span class="pl-k">-&gt;</span>getReturn(); <span class="pl-c"><span class="pl-c">//</span> outputs 'y'</span></span></pre></div>
<p>Note that it is perfectly valid to call <a href="#generatorAnswer.returns"><code>returns()</code></a>
with no arguments in order to end the generator by returning <code>null</code>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>returns();</span></pre></div>
<h4>
<a id="returning-arguments-from-a-generator" class="anchor" href="#returning-arguments-from-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Returning arguments from a generator</h4>
<p>To return an argument from a generator, use
<a href="#generatorAnswer.returnsArgument"><code>returnsArgument()</code></a> on any
<a href="#the-generator-answer-api">generator answer</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>returnsArgument();   <span class="pl-c"><span class="pl-c">//</span> returns the first argument</span></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>returnsArgument(<span class="pl-c1">1</span>);  <span class="pl-c"><span class="pl-c">//</span> returns the second argument</span></span>
<span class="pl-s1"><span class="pl-smi">$stubC</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>returnsArgument(<span class="pl-k">-</span><span class="pl-c1">1</span>); <span class="pl-c"><span class="pl-c">//</span> returns the last argument</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generatorA</span> <span class="pl-k">=</span> $<span class="pl-smi">stubA</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$generatorB</span> <span class="pl-k">=</span> $<span class="pl-smi">stubB</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$generatorC</span> <span class="pl-k">=</span> $<span class="pl-smi">stubC</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorA</span>); <span class="pl-c"><span class="pl-c">//</span> consume the generator</span></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorB</span>); <span class="pl-c"><span class="pl-c">//</span> consume the generator</span></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorC</span>); <span class="pl-c"><span class="pl-c">//</span> consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generatorA</span><span class="pl-k">-&gt;</span>getReturn(); <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generatorB</span><span class="pl-k">-&gt;</span>getReturn(); <span class="pl-c"><span class="pl-c">//</span> outputs 'y'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generatorC</span><span class="pl-k">-&gt;</span>getReturn(); <span class="pl-c"><span class="pl-c">//</span> outputs 'z'</span></span></pre></div>
<h4>
<a id="returning-the-self-value-from-a-generator" class="anchor" href="#returning-the-self-value-from-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Returning the "self" value from a generator</h4>
<p>The stub <a href="#stub-self-values">self value</a> can be returned from a generator by using
<a href="#generatorAnswer.returnsSelf"><code>returnsSelf()</code></a> on any <a href="#the-generator-answer-api">generator answer</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock();</span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>returnsSelf();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c"><span class="pl-c">//</span> consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>getReturn() <span class="pl-k">===</span> <span class="pl-smi">$mock</span> ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'true'</span></span></pre></div>
<h4>
<a id="throwing-exceptions-from-a-generator" class="anchor" href="#throwing-exceptions-from-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Throwing exceptions from a generator</h4>
<p>To throw an exception from a generator, use
<a href="#generatorAnswer.throws"><code>throws()</code></a> on any <a href="#the-generator-answer-api">generator answer</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$exception</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>You done goofed.<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>throws(<span class="pl-smi">$exception</span>);</span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>throws();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generatorA</span> <span class="pl-k">=</span> $<span class="pl-smi">stubA</span>();</span>
<span class="pl-s1"><span class="pl-smi">$generatorB</span> <span class="pl-k">=</span> $<span class="pl-smi">stubB</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorA</span>); <span class="pl-c"><span class="pl-c">//</span> throws $exception</span></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorB</span>); <span class="pl-c"><span class="pl-c">//</span> throws a generic exception</span></span></pre></div>
<p>Calling <a href="#generatorAnswer.throws"><code>throws()</code></a> with multiple arguments allows for
easy specification of the thrown exception on subsequent invocations. For
example, the two following stubs behave the same:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$exceptionA</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>You done goofed.<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$exceptionB</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>Consequences will never be the same.<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>throws(<span class="pl-smi">$exceptionA</span>, <span class="pl-smi">$exceptionB</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generatorA</span> <span class="pl-k">=</span> $<span class="pl-smi">stubA</span>();</span>
<span class="pl-s1"><span class="pl-smi">$generatorB</span> <span class="pl-k">=</span> $<span class="pl-smi">stubA</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorA</span>); <span class="pl-c"><span class="pl-c">//</span> throws $exceptionA</span></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorB</span>); <span class="pl-c"><span class="pl-c">//</span> throws $exceptionB</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>throws(<span class="pl-smi">$exceptionA</span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>throws(<span class="pl-smi">$exceptionB</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generatorA</span> <span class="pl-k">=</span> $<span class="pl-smi">stubB</span>();</span>
<span class="pl-s1"><span class="pl-smi">$generatorB</span> <span class="pl-k">=</span> $<span class="pl-smi">stubB</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorA</span>); <span class="pl-c"><span class="pl-c">//</span> throws $exceptionA</span></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generatorB</span>); <span class="pl-c"><span class="pl-c">//</span> throws $exceptionB</span></span></pre></div>
<h4>
<a id="generator-iterations-that-perform-multiple-actions" class="anchor" href="#generator-iterations-that-perform-multiple-actions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Generator iterations that perform multiple actions</h4>
<p>Stubbed generators can perform multiple actions as part of a single iteration.
This allows side effects other than yielded values to be emulated.</p>
<p>The most familiar of these side effects is probably the modification of
passed-by-reference arguments, and the invocation of other callables.</p>
<h5>
<a id="setting-passed-by-reference-arguments-in-a-generator" class="anchor" href="#setting-passed-by-reference-arguments-in-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setting passed-by-reference arguments in a generator</h5>
<p>To set a reference argument as part of a generator, use
<a href="#generatorAnswer.setsArgument"><code>setsArgument()</code></a> on any <a href="#the-generator-answer-api">generator answer</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>) {})<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-c1">0</span>, <span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)  <span class="pl-c"><span class="pl-c">//</span> sets the first argument to 'x'</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-c1">1</span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)  <span class="pl-c"><span class="pl-c">//</span> sets the second argument to 'y'</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-k">-</span><span class="pl-c1">1</span>, <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>) <span class="pl-c"><span class="pl-c">//</span> sets the last argument to 'z'</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>]);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c"><span class="pl-c">//</span> consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$b</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'y'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$c</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'z'</span></span></pre></div>
<p>If only one argument is passed to
<a href="#generatorAnswer.setsArgument"><code>setsArgument()</code></a>, it sets the first argument:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>) {})<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>) <span class="pl-c"><span class="pl-c">//</span> sets the first argument to 'x'</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>]);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c"><span class="pl-c">//</span> consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span></pre></div>
<p>If <a href="#generatorAnswer.setsArgument"><code>setsArgument()</code></a> is called without any
arguments, it sets the first argument to <code>null</code>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>) {})<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument() <span class="pl-c"><span class="pl-c">//</span> sets the first argument to `null`</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>]);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c"><span class="pl-c">//</span> consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">gettype</span>(<span class="pl-smi">$a</span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'NULL'</span></span></pre></div>
<p>Setting of arguments can be configured to occur in between yields:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>) {})<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>) <span class="pl-c"><span class="pl-c">//</span> first iteration starts</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)       <span class="pl-c"><span class="pl-c">//</span> first iteration ends</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setsArgument(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>) <span class="pl-c"><span class="pl-c">//</span> second iteration starts</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)       <span class="pl-c"><span class="pl-c">//</span> second iteration ends</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">foreach</span> (<span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>]) <span class="pl-k">as</span> <span class="pl-smi">$value</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>%s, %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, <span class="pl-smi">$value</span>, <span class="pl-smi">$a</span>);</span>
<span class="pl-s1">}</span></pre></div>
<p>The above example outputs:</p>
<pre><code>a, x
b, y
</code></pre>
<h5>
<a id="invoking-arguments-in-a-generator" class="anchor" href="#invoking-arguments-in-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Invoking arguments in a generator</h5>
<p>To invoke an argument as part of a generator, use
<a href="#generatorAnswer.callsArgument"><code>callsArgument()</code></a> on any <a href="#the-generator-answer-api">generator answer</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgument()   <span class="pl-c"><span class="pl-c">//</span> calls the first argument</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgument(<span class="pl-c1">1</span>)  <span class="pl-c"><span class="pl-c">//</span> calls the second argument</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgument(<span class="pl-k">-</span><span class="pl-c1">1</span>) <span class="pl-c"><span class="pl-c">//</span> calls the last argument</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$x</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"><span class="pl-smi">$y</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"><span class="pl-smi">$z</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>z<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>(<span class="pl-smi">$x</span>, <span class="pl-smi">$y</span>, <span class="pl-smi">$z</span>);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'xyz'</span></span></pre></div>
<p>There is also a more powerful version of
<a href="#generatorAnswer.callsArgument"><code>callsArgument()</code></a>, named
<a href="#generatorAnswer.callsArgumentWith"><code>callsArgumentWith()</code></a>, that allows more
control over which arguments are passed to the callable, and how they are
passed:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgumentWith(</span>
<span class="pl-s1">        <span class="pl-c1">1</span>,              <span class="pl-c"><span class="pl-c">//</span> argument to invoke</span></span>
<span class="pl-s1">        [<span class="pl-s"><span class="pl-pds">'</span>%s, %s, %s<span class="pl-pds">'</span></span>], <span class="pl-c"><span class="pl-c">//</span> fixed arguments</span></span>
<span class="pl-s1">        <span class="pl-c1">false</span>,          <span class="pl-c"><span class="pl-c">//</span> prefix the "self" value?</span></span>
<span class="pl-s1">        <span class="pl-c1">true</span>,           <span class="pl-c"><span class="pl-c">//</span> suffix the arguments object?</span></span>
<span class="pl-s1">        <span class="pl-c1">false</span>           <span class="pl-c"><span class="pl-c">//</span> suffix the arguments normally?</span></span>
<span class="pl-s1">    )</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>printf<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'x, printf, y'</span></span></pre></div>
<p>The <a href="#generatorAnswer.callsArgumentWith"><code>callsArgumentWith()</code></a> method also
supports arguments passed by reference:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$d</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgumentWith(</span>
<span class="pl-s1">        <span class="pl-k">-</span><span class="pl-c1">1</span>,</span>
<span class="pl-s1">        [<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>],</span>
<span class="pl-s1">        <span class="pl-c1">false</span>,</span>
<span class="pl-s1">        <span class="pl-c1">false</span>,</span>
<span class="pl-s1">        <span class="pl-c1">true</span></span>
<span class="pl-s1">    )</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$callback</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">list</span>(<span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>, <span class="pl-smi">$c</span>, <span class="pl-smi">$d</span>) <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">};</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>, <span class="pl-smi">$callback</span>]);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c"><span class="pl-c">//</span> consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'a'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$b</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'b'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$c</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'c'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$d</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'd'</span></span></pre></div>
<p>Calling of arguments can be configured to occur in between yields:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$count</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>;</span>
<span class="pl-s1"><span class="pl-smi">$callback</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () <span class="pl-k">use</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$count</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Called %d time(s)<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, <span class="pl-k">++</span><span class="pl-smi">$count</span>);</span>
<span class="pl-s1">};</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>) {})<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgument() <span class="pl-c"><span class="pl-c">//</span> first iteration starts</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)     <span class="pl-c"><span class="pl-c">//</span> first iteration ends</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsArgument() <span class="pl-c"><span class="pl-c">//</span> second iteration starts</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)     <span class="pl-c"><span class="pl-c">//</span> second iteration ends</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">foreach</span> ($<span class="pl-smi">stub</span>(<span class="pl-smi">$callback</span>) <span class="pl-k">as</span> <span class="pl-smi">$value</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Value: %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, <span class="pl-smi">$value</span>);</span>
<span class="pl-s1">}</span></pre></div>
<p>The above example outputs:</p>
<pre><code>Called 1 time(s)
Value: a
Called 2 time(s)
Value: b
</code></pre>
<h5>
<a id="invoking-callables-in-a-generator" class="anchor" href="#invoking-callables-in-a-generator" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Invoking callables in a generator</h5>
<p>To invoke a callable as part of a generator, use
<a href="#generatorAnswer.calls"><code>calls()</code></a> on any <a href="#the-generator-answer-api">generator answer</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>calls(<span class="pl-s"><span class="pl-pds">'</span>printf<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>%s, %s<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'a, b'</span></span></pre></div>
<p>Calling <a href="#generatorAnswer.calls"><code>calls()</code></a> with multiple arguments is
equivalent to calling it once with each argument. For example, the two following
stubs behave the same:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$x</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"><span class="pl-smi">$y</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>; };</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$x</span>, <span class="pl-smi">$y</span>)<span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> $<span class="pl-smi">stubA</span>();</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'xy'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()<span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$x</span>)<span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$y</span>)<span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> $<span class="pl-smi">stubB</span>();</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'xy'</span></span></pre></div>
<p>There is also a more powerful version of <a href="#generatorAnswer.calls"><code>calls()</code></a>,
named <a href="#generatorAnswer.callsWith"><code>callsWith()</code></a>, that allows more control over
which arguments are passed to the callable, and how they are passed:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsWith(</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>printf<span class="pl-pds">'</span></span>,   <span class="pl-c"><span class="pl-c">//</span> argument to invoke</span></span>
<span class="pl-s1">        [<span class="pl-s"><span class="pl-pds">'</span>%s, %s<span class="pl-pds">'</span></span>], <span class="pl-c"><span class="pl-c">//</span> fixed arguments</span></span>
<span class="pl-s1">        <span class="pl-c1">false</span>,      <span class="pl-c"><span class="pl-c">//</span> prefix the "self" value?</span></span>
<span class="pl-s1">        <span class="pl-c1">false</span>,      <span class="pl-c"><span class="pl-c">//</span> suffix the arguments object?</span></span>
<span class="pl-s1">        <span class="pl-c1">true</span>        <span class="pl-c"><span class="pl-c">//</span> suffix the arguments normally?</span></span>
<span class="pl-s1">    )</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'x, y'</span></span></pre></div>
<p>The <a href="#generatorAnswer.callsWith"><code>callsWith()</code></a> method also supports arguments
passed by reference:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"><span class="pl-smi">$d</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>callsWith(</span>
<span class="pl-s1">        <span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>) {</span>
<span class="pl-s1">            <span class="pl-c1">list</span>(<span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>, <span class="pl-smi">$c</span>, <span class="pl-smi">$d</span>) <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">        },</span>
<span class="pl-s1">        [<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>],</span>
<span class="pl-s1">        <span class="pl-c1">false</span>,</span>
<span class="pl-s1">        <span class="pl-c1">false</span>,</span>
<span class="pl-s1">        <span class="pl-c1">true</span></span>
<span class="pl-s1">    )</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$c</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$d</span>])</span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$generator</span>); <span class="pl-c"><span class="pl-c">//</span> consume the generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'a'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$b</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'b'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$c</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'c'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$d</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'd'</span></span></pre></div>
<p>Calling of callables can be configured to occur in between yields:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$count</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>;</span>
<span class="pl-s1"><span class="pl-smi">$callback</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () <span class="pl-k">use</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$count</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Called %d time(s)<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, <span class="pl-k">++</span><span class="pl-smi">$count</span>);</span>
<span class="pl-s1">};</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>) {})<span class="pl-k">-&gt;</span>generates()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$callback</span>) <span class="pl-c"><span class="pl-c">//</span> first iteration starts</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)      <span class="pl-c"><span class="pl-c">//</span> first iteration ends</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>calls(<span class="pl-smi">$callback</span>) <span class="pl-c"><span class="pl-c">//</span> second iteration starts</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>yields(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)      <span class="pl-c"><span class="pl-c">//</span> second iteration ends</span></span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>returns();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">foreach</span> ($<span class="pl-smi">stub</span>(<span class="pl-smi">$callback</span>) <span class="pl-k">as</span> <span class="pl-smi">$value</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Value: %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, <span class="pl-smi">$value</span>);</span>
<span class="pl-s1">}</span></pre></div>
<p>The above example outputs:</p>
<pre><code>Called 1 time(s)
Value: a
Called 2 time(s)
Value: b
</code></pre>
<h2>
<a id="spies" class="anchor" href="#spies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Spies</h2>
<p><em>Spies</em> record interactions with callable entities, such as functions, methods,
closures, and objects with an <a href="http://php.net/language.oop5.magic#object.invoke"><code>__invoke()</code></a> method. They can be used to verify
both the <em>input</em>, and <em>output</em> of function calls.</p>
<p>Most of the methods in <a href="#the-spy-api">the spy API</a> are mirrored in <a href="#the-call-api">the call API</a>.</p>
<h3>
<a id="spying-on-an-existing-callable" class="anchor" href="#spying-on-an-existing-callable" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Spying on an existing callable</h3>
<p>Any callable can be wrapped in a spy, by passing the callable to
<a href="#facade.spy"><code>spy()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy(<span class="pl-smi">$callable</span>);        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>spy(<span class="pl-smi">$callable</span>); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span></pre></div>
<p>The created spy will behave exactly like the wrapped callable:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy(<span class="pl-s"><span class="pl-pds">'</span>max<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">spy</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">1</span>); <span class="pl-c"><span class="pl-c">//</span> outputs '3'</span></span></pre></div>
<h4>
<a id="spying-on-global-functions" class="anchor" href="#spying-on-global-functions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Spying on global functions</h4>
<p>When an "unqualified" function (one with no preceding backslash) is used from
within a namespace, PHP will attempt to find the function in the calling
namespace first, before looking for the function in the <em>global</em> namespace. This
behavior is known as <a href="http://php.net/language.namespaces.fallback">global function fallback</a>.</p>
<p>This behavior can be exploited to allow a spy to record interactions with a
global function during testing. To do so, two conditions must be met:</p>
<ul>
<li>The function must be called without any qualifying namespace or backslash.</li>
<li>The function must be called from within a namespace; function calls from the
global namespace cannot be spied on.</li>
</ul>
<p>To spy on a function in the global namespace, use
<a href="#facade.spyGlobal"><code>spyGlobal()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spyGlobal(<span class="pl-smi">$function</span>, <span class="pl-smi">$namespace</span>);        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>spyGlobal(<span class="pl-smi">$function</span>, <span class="pl-smi">$namespace</span>); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span></pre></div>
<p>Where <code>$function</code> is the name of the function in the global namespace, and
<code>$namespace</code> is the namespace from which the function will be called.</p>
<p>To demonstrate, the following code shows that if the <code>sprintf()</code> function is
spied on before it is called, its input and output can be verified:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">Foo\Bar</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-k">function</span> <span class="pl-c1">Eloquent\Phony\spyGlobal</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spyGlobal(<span class="pl-s"><span class="pl-pds">'</span>sprintf<span class="pl-pds">'</span></span>, <span class="pl-c1">__NAMESPACE__</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$message</span> <span class="pl-k">=</span> <span class="pl-c1">sprintf</span>(<span class="pl-s"><span class="pl-pds">'</span>Keep it %s.<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>real<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>Keep it %s.<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>real<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> verification passes</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>Keep it real.<span class="pl-pds">'</span></span>);         <span class="pl-c"><span class="pl-c">//</span> verification passes</span></span></pre></div>
<h5>
<a id="restoring-global-functions-after-spying" class="anchor" href="#restoring-global-functions-after-spying" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Restoring global functions after spying</h5>
<p>Leaving global functions spied after a test can result in additional memory use,
as all further interactions with the function will be recorded by <em>Phony</em>. To
avoid this problem, it is necessary to restore the behavior of spied global
functions after the test concludes.</p>
<p>To restore all spied and/or stubbed global functions, use
<a href="#facade.restoreGlobalFunctions"><code>restoreGlobalFunctions()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">restoreGlobalFunctions();        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-c1">Phony</span><span class="pl-k">::</span>restoreGlobalFunctions(); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span></pre></div>
<p>This method is suitable for use in the "tear down" phase of a test.</p>
<h5>
<a id="alternatives-for-spying-on-global-functions" class="anchor" href="#alternatives-for-spying-on-global-functions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Alternatives for spying on global functions</h5>
<p>If the system under test is not suitable for spying via
<a href="http://php.net/language.namespaces.fallback">global function fallback</a>, an alternative is to accept a callback via
dependency injection that can take a spy during testing:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-k">function</span> <span class="pl-c1">Eloquent\Phony\spy</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">function</span> <span class="pl-en">functionA</span>(<span class="pl-smi">$sprintf</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>sprintf<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-smi">$message</span> <span class="pl-k">=</span> $<span class="pl-smi">sprintf</span>(<span class="pl-s"><span class="pl-pds">'</span>Keep it %s.<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>real<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy(<span class="pl-s"><span class="pl-pds">'</span>sprintf<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">functionA(<span class="pl-smi">$spy</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>Keep it %s.<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>real<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> verification passes</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>Keep it real.<span class="pl-pds">'</span></span>);         <span class="pl-c"><span class="pl-c">//</span> verification passes</span></span></pre></div>
<p>Another alternative is to use a library like <a href="https://github.com/IcecaveStudios/isolator">Isolator</a>, that allows the
injection of an explicit dependency that represents the functions in the global
namespace. This dependency can then be mocked during testing.</p>
<h3>
<a id="anonymous-spies" class="anchor" href="#anonymous-spies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Anonymous spies</h3>
<p><em>Anonymous spies</em> are spies that do not wrap an existing callable. Their only
purpose is to record input arguments. An anonymous spy is created by calling
<a href="#facade.spy"><code>spy()</code></a> without passing a callable:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy();        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>spy(); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span></pre></div>
<p>Regardless of input arguments, anonymous spies will always return <code>null</code>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">gettype</span>($<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)); <span class="pl-c"><span class="pl-c">//</span> outputs 'NULL'</span></span></pre></div>
<h3>
<a id="call-verification" class="anchor" href="#call-verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Call verification</h3>
<p><em>Phony</em> provides the ability to make verifications on individual recorded calls.
The API for verifying calls mirrors the methods available for spy verification.</p>
<p>See <a href="#the-call-api">the call API</a> for more information.</p>
<h4>
<a id="call-count" class="anchor" href="#call-count" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Call count</h4>
<p>The number of calls recorded by a spy can be retrieved using
<a href="#spy.callCount"><code>callCount()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>callCount();</span></pre></div>
<h4>
<a id="individual-calls" class="anchor" href="#individual-calls" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Individual calls</h4>
<p>To get the first call, use <a href="#spy.firstCall"><code>firstCall()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>firstCall();</span></pre></div>
<p>To get the last call, use <a href="#spy.lastCall"><code>lastCall()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>lastCall();</span></pre></div>
<p>To get a specific call by index, use <a href="#spy.callAt"><code>callAt()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>callAt(<span class="pl-c1">0</span>); <span class="pl-c"><span class="pl-c">//</span> returns the first call</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>callAt(<span class="pl-c1">9</span>); <span class="pl-c"><span class="pl-c">//</span> returns the tenth call</span></span></pre></div>
<p>These methods will throw an exception if no call is found.</p>
<p>Similar methods also exist for <a href="#the-verification-result-api">verification results</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>called()<span class="pl-k">-&gt;</span>firstCall();</span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>called()<span class="pl-k">-&gt;</span>lastCall();</span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>called()<span class="pl-k">-&gt;</span>callAt(<span class="pl-c1">0</span>);</span></pre></div>
<h3>
<a id="verifying-spy-input" class="anchor" href="#verifying-spy-input" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying spy input</h3>
<h4>
<a id="verifying-that-a-call-was-made" class="anchor" href="#verifying-that-a-call-was-made" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that a call was made</h4>
<p>To verify that a spy was called, use <a href="#spy.called"><code>called()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>called();</span></pre></div>
<p>Example output from <a href="#spy.called"><code>called()</code></a>:</p>
<p><a href="img/verification/called/no-calls.svg" target="_blank"><img src="img/verification/called/no-calls.svg" alt="Example output from $spy-&gt;called()" style="max-width:100%;"></a></p>
<h4>
<a id="verifying-that-a-spy-was-called-with-specific-arguments" class="anchor" href="#verifying-that-a-spy-was-called-with-specific-arguments" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that a spy was called with specific arguments</h4>
<p>To verify input arguments, use <a href="#spy.calledWith"><code>calledWith()</code></a>. Arguments
passed to <a href="#spy.calledWith"><code>calledWith()</code></a> can be literal values, or
<a href="#matchers">matchers</a>, including <a href="#shorthand-matchers">shorthand matchers</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith();         <span class="pl-c"><span class="pl-c">//</span> called with no arguments</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> called with 'a' followed by 'b'</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> called with 'a' followed by 0-n arguments</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> called with 'a' followed by exactly 1 argument</span></span></pre></div>
<p>Arguments can be retrieved by calling <a href="#call.arguments"><code>arguments()</code></a> or
<a href="#call.argument"><code>argument()</code></a> on an <a href="#individual-calls">individual call</a> recorded via the spy:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>firstCall()<span class="pl-k">-&gt;</span>arguments(); <span class="pl-c"><span class="pl-c">//</span> all arguments as an array</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>firstCall()<span class="pl-k">-&gt;</span>argument();  <span class="pl-c"><span class="pl-c">//</span> first argument</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>firstCall()<span class="pl-k">-&gt;</span>argument(<span class="pl-c1">1</span>); <span class="pl-c"><span class="pl-c">//</span> second argument</span></span></pre></div>
<p>Calls can also be retrieved from any <a href="#the-verification-result-api">verification result</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>called()<span class="pl-k">-&gt;</span>firstCall()<span class="pl-k">-&gt;</span>arguments(); <span class="pl-c"><span class="pl-c">//</span> all arguments as an array</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>called()<span class="pl-k">-&gt;</span>firstCall()<span class="pl-k">-&gt;</span>argument();  <span class="pl-c"><span class="pl-c">//</span> first argument</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>called()<span class="pl-k">-&gt;</span>firstCall()<span class="pl-k">-&gt;</span>argument(<span class="pl-c1">1</span>); <span class="pl-c"><span class="pl-c">//</span> second argument</span></span></pre></div>
<p>Example output from <a href="#spy.calledWith"><code>calledWith()</code></a>:</p>
<p><a href="img/verification/called-with/argument-mismatch.svg" target="_blank"><img src="img/verification/called-with/argument-mismatch.svg" alt="Example output from $spy-&gt;calledWith()" style="max-width:100%;"></a></p>
<h3>
<a id="verifying-spy-output" class="anchor" href="#verifying-spy-output" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying spy output</h3>
<h4>
<a id="verifying-spy-return-values" class="anchor" href="#verifying-spy-return-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying spy return values</h4>
<p>To verify a spy's return value, use <a href="#spy.returned"><code>returned()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>returned();    <span class="pl-c"><span class="pl-c">//</span> returned anything</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> returned 'a'</span></span></pre></div>
<p>Return values can be retrieved by calling <a href="#call.returnValue"><code>returnValue()</code></a>
on an <a href="#individual-calls">individual call</a> recorded via the spy:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>firstCall()<span class="pl-k">-&gt;</span>returnValue();</span></pre></div>
<p>Calls can also be retrieved from any <a href="#the-verification-result-api">verification result</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>called()<span class="pl-k">-&gt;</span>firstCall()<span class="pl-k">-&gt;</span>returnValue();</span></pre></div>
<p>Example output from <a href="#spy.returned"><code>returned()</code></a>:</p>
<p><a href="img/verification/returned/value-mismatch.svg" target="_blank"><img src="img/verification/returned/value-mismatch.svg" alt="Example output from $spy-&gt;returned()" style="max-width:100%;"></a></p>
<h5>
<a id="verifying-generators-returned-by-spies" class="anchor" href="#verifying-generators-returned-by-spies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying generators returned by spies</h5>
<p>To verify that a spy returned a <a href="http://php.net/language.generators.overview">generator</a>, use
<a href="#spy.generated"><code>generated()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>generated();</span></pre></div>
<p>The result returned by <a href="#spy.generated"><code>generated()</code></a> can be used for further
verification of the generator's behavior:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>generated(); <span class="pl-c"><span class="pl-c">//</span> returned a generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> generator yielded 'a'</span></span>
<span class="pl-s1"><span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> generator returned 'b'</span></span></pre></div>
<p>See <a href="#generator-and-iterable-verification">Generator and iterable verification</a> for a complete explanation of the
available verifications.</p>
<p>Example output from <a href="#spy.generated"><code>generated()</code></a>:</p>
<p><a href="img/verification/generated/no-generator.svg" target="_blank"><img src="img/verification/generated/no-generator.svg" alt="Example output from $spy-&gt;generated()" style="max-width:100%;"></a></p>
<h5>
<a id="verifying-iterables-returned-by-spies" class="anchor" href="#verifying-iterables-returned-by-spies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying iterables returned by spies</h5>
<p>To verify that a spy returned an iterable value, such as an array or iterator,
use <a href="#spy.iterated"><code>iterated()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>iterated();</span></pre></div>
<p>If <a href="#generator-and-iterable-verification">iterable spies</a> are enabled, the result returned by
<a href="#spy.iterated"><code>iterated()</code></a> can be used for further verification of the
iterable's behavior:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$iterable</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>iterated(); <span class="pl-c"><span class="pl-c">//</span> returned an iterable</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$iterable</span><span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);      <span class="pl-c"><span class="pl-c">//</span> iterable produced 'a'</span></span>
<span class="pl-s1"><span class="pl-smi">$iterable</span><span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> iterable produced 'b' =&gt; 'c'</span></span></pre></div>
<p>See <a href="#generator-and-iterable-verification">Generator and iterable verification</a> for a complete explanation of the
available verifications.</p>
<p>Example output from <a href="#spy.iterated"><code>iterated()</code></a>:</p>
<p><a href="img/verification/iterated/no-iterable.svg" target="_blank"><img src="img/verification/iterated/no-iterable.svg" alt="Example output from $spy-&gt;iterated()" style="max-width:100%;"></a></p>
<h4>
<a id="verifying-spy-exceptions" class="anchor" href="#verifying-spy-exceptions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying spy exceptions</h4>
<p>To verify that a spy threw an exception, use <a href="#spy.threw"><code>threw()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>threw();                                         <span class="pl-c"><span class="pl-c">//</span> threw any exception</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>threw(<span class="pl-s"><span class="pl-pds">'</span>RuntimeException<span class="pl-pds">'</span></span>);                       <span class="pl-c"><span class="pl-c">//</span> threw a runtime exception</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>threw(<span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>You done goofed.<span class="pl-pds">'</span></span>)); <span class="pl-c"><span class="pl-c">//</span> threw a runtime exception with a specific message</span></span></pre></div>
<p>Thrown exceptions can be retrieved by calling <a href="#call.exception"><code>exception()</code></a>
on an <a href="#individual-calls">individual call</a> recorded via the spy:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$exception</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>firstCall()<span class="pl-k">-&gt;</span>exception();</span></pre></div>
<p>Calls can also be retrieved from any <a href="#the-verification-result-api">verification result</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$exception</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>called()<span class="pl-k">-&gt;</span>firstCall()<span class="pl-k">-&gt;</span>exception();</span></pre></div>
<p>Example output from <a href="#spy.threw"><code>threw()</code></a>:</p>
<p><a href="img/verification/threw/value-mismatch.svg" target="_blank"><img src="img/verification/threw/value-mismatch.svg" alt="Example output from $spy-&gt;threw()" style="max-width:100%;"></a></p>
<h3>
<a id="verifying-spy-progress" class="anchor" href="#verifying-spy-progress" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying spy progress</h3>
<p>To verify that a spy call has completed, use <a href="#spy.completed"><code>completed()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>completed();</span></pre></div>
<p>When <a href="#generator-and-iterable-verification">generator spies</a> are in use, a call that returns a generator will not be
considered "complete" until the generator has been completely consumed via
iteration.</p>
<p>Similarly, when <a href="#generator-and-iterable-verification">iterable spies</a> are in use, a call that returns an iterable
will not be considered "complete" until the iterable has been completely
consumed via iteration.</p>
<p>To ignore iterable events, and simply verify that a spy has returned a value
<em>or</em> thrown an exception, use <a href="#spy.responded"><code>responded()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>responded();</span></pre></div>
<p>Responses can be retrieved by calling <a href="#call.response"><code>response()</code></a> on an
<a href="#individual-calls">individual call</a> recorded via the spy:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c1">list</span>(<span class="pl-smi">$exception</span>, <span class="pl-smi">$value</span>) <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>firstCall()<span class="pl-k">-&gt;</span>response();</span></pre></div>
<p>Generator responses can be retrieved by calling
<a href="#call.generatorResponse"><code>generatorResponse()</code></a> on an <a href="#individual-calls">individual call</a>
recorded via the spy:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c1">list</span>(<span class="pl-smi">$exception</span>, <span class="pl-smi">$value</span>) <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>firstCall()<span class="pl-k">-&gt;</span>generatorResponse();</span></pre></div>
<p>Calls can also be retrieved from any <a href="#the-verification-result-api">verification result</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c1">list</span>(<span class="pl-smi">$exception</span>, <span class="pl-smi">$value</span>) <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>called()<span class="pl-k">-&gt;</span>firstCall()<span class="pl-k">-&gt;</span>response();</span>
<span class="pl-s1"><span class="pl-c1">list</span>(<span class="pl-smi">$exception</span>, <span class="pl-smi">$value</span>) <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>called()<span class="pl-k">-&gt;</span>firstCall()<span class="pl-k">-&gt;</span>generatorResponse();</span></pre></div>
<p>Example output from <a href="#spy.completed"><code>completed()</code></a>:</p>
<p><a href="img/verification/completed/none-completed.svg" target="_blank"><img src="img/verification/completed/none-completed.svg" alt="Example output from $spy-&gt;completed()" style="max-width:100%;"></a></p>
<p>Example output from <a href="#spy.responded"><code>responded()</code></a>:</p>
<p><a href="img/verification/responded/no-responses.svg" target="_blank"><img src="img/verification/responded/no-responses.svg" alt="Example output from $spy-&gt;responded()" style="max-width:100%;"></a></p>
<h3>
<a id="verifying-cardinality-with-spies" class="anchor" href="#verifying-cardinality-with-spies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying cardinality with spies</h3>
<p>When used with a spy, cardinality modifiers change the amount of <strong>calls</strong> that
must meet the requirements of a subsequent verification.</p>
<p>This differs slightly from their usage with calls, where cardinality modifiers
change the amount of <strong>events</strong> within the call that must meet the requirements
of a subsequent verification.</p>
<p>Note that cardinality also applies differently when using generator and iterable
verification. See <a href="#verifying-cardinality-with-generators-and-iterables">Verifying cardinality with generators and iterables</a>.</p>
<p>Cardinality must be specified <strong>before</strong> verification, and can be applied to
any verification:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>once()<span class="pl-k">-&gt;</span>called();        <span class="pl-c"><span class="pl-c">//</span> called exactly 1 time</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>once()<span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> called exactly 1 time with 'a'</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>once()<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);   <span class="pl-c"><span class="pl-c">//</span> returned 'b' exactly 1 time</span></span></pre></div>
<p>The default cardinality is <code>atLeast(1)</code>, meaning verifications will pass if at
least one matching event was recorded.</p>
<h4>
<a id="verifying-that-a-spy-event-happened-an-exact-number-of-times" class="anchor" href="#verifying-that-a-spy-event-happened-an-exact-number-of-times" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that a spy event happened an exact number of times</h4>
<p>To verify that an event happened an exact number of times, use one of
<a href="#spy.never"><code>never()</code></a>, <a href="#spy.once"><code>once()</code></a>, <a href="#spy.twice"><code>twice()</code></a>,
<a href="#spy.thrice"><code>thrice()</code></a>, or <a href="#spy.times"><code>times()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>never()<span class="pl-k">-&gt;</span>called();   <span class="pl-c"><span class="pl-c">//</span> never called</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>once()<span class="pl-k">-&gt;</span>called();    <span class="pl-c"><span class="pl-c">//</span> called exactly 1 time</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>twice()<span class="pl-k">-&gt;</span>called();   <span class="pl-c"><span class="pl-c">//</span> called exactly 2 times</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>thrice()<span class="pl-k">-&gt;</span>called();  <span class="pl-c"><span class="pl-c">//</span> called exactly 3 times</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>times(<span class="pl-c1">10</span>)<span class="pl-k">-&gt;</span>called(); <span class="pl-c"><span class="pl-c">//</span> called exactly 10 times</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>never()<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);   <span class="pl-c"><span class="pl-c">//</span> never returned 'a'</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>once()<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);    <span class="pl-c"><span class="pl-c">//</span> returned 'a' exactly 1 time</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>twice()<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);   <span class="pl-c"><span class="pl-c">//</span> returned 'a' exactly 2 times</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>thrice()<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);  <span class="pl-c"><span class="pl-c">//</span> returned 'a' exactly 3 times</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>times(<span class="pl-c1">10</span>)<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> returned 'a' exactly 10 times</span></span></pre></div>
<h4>
<a id="verifying-that-a-spy-event-happened-a-bounded-number-of-times" class="anchor" href="#verifying-that-a-spy-event-happened-a-bounded-number-of-times" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that a spy event happened a bounded number of times</h4>
<p>To verify that an event happened a bounded number of times, use one of
<a href="#spy.atLeast"><code>atLeast()</code></a>, <a href="#spy.atMost"><code>atMost()</code></a>, or
<a href="#spy.between"><code>between()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>atLeast(<span class="pl-c1">2</span>)<span class="pl-k">-&gt;</span>called();    <span class="pl-c"><span class="pl-c">//</span> called 2 or more times</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>atMost(<span class="pl-c1">3</span>)<span class="pl-k">-&gt;</span>called();     <span class="pl-c"><span class="pl-c">//</span> called no more than 3 times</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>between(<span class="pl-c1">2</span>, <span class="pl-c1">4</span>)<span class="pl-k">-&gt;</span>called(); <span class="pl-c"><span class="pl-c">//</span> called 2, 3, or 4 times</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>atLeast(<span class="pl-c1">2</span>)<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);    <span class="pl-c"><span class="pl-c">//</span> returned 'a' 2 or more times</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>atMost(<span class="pl-c1">3</span>)<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);     <span class="pl-c"><span class="pl-c">//</span> returned 'a' no more than 3 times</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>between(<span class="pl-c1">2</span>, <span class="pl-c1">4</span>)<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> returned 'a' 2, 3, or 4 times</span></span></pre></div>
<h4>
<a id="verifying-that-all-spy-events-happen-the-same-way" class="anchor" href="#verifying-that-all-spy-events-happen-the-same-way" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that all spy events happen the same way</h4>
<p>To verify that all events happen the same way, use <a href="#spy.always"><code>always()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>always()<span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> always called with 'a'</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>always()<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);   <span class="pl-c"><span class="pl-c">//</span> always returned 'b'</span></span></pre></div>
<p>Note that <a href="#spy.always"><code>always()</code></a> does not interfere with other cardinality
modifiers, and can be combined to produce powerful verifications:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>twice()<span class="pl-k">-&gt;</span>always()<span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> called exactly 2 times, and always with 'a'</span></span></pre></div>
<h3>
<a id="labeling-spies" class="anchor" href="#labeling-spies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Labeling spies</h3>
<p>Every spy has a label, which is a free-form string used to help identify the spy
in verification failure messages. By default, each spy is assigned a unique
sequential integer label upon creation.</p>
<p>The label can be changed at any time by using <a href="#spy.setLabel"><code>setLabel()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy();</span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>label(); <span class="pl-c"><span class="pl-c">//</span> outputs 'a'</span></span></pre></div>
<p>The <a href="#spy.setLabel"><code>setLabel()</code></a> method is also fluent, meaning that spy
creation and label setting can be done in a single expression:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy()<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span></pre></div>
<p>When a verification fails for a labeled spy, the output is similar to the
following:</p>
<p><a href="img/verification/called-with/spy-label.svg" target="_blank"><img src="img/verification/called-with/spy-label.svg" alt="Example verification output when using a spy label" style="max-width:100%;"></a></p>
<h3>
<a id="invoking-spies" class="anchor" href="#invoking-spies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Invoking spies</h3>
<p>Spies can be invoked directly like any other dynamic callable:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> passes</span></span></pre></div>
<p>They can also be invoked more explicitly using <a href="#spy.invoke"><code>invoke()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>invoke(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> passes</span></span></pre></div>
<p>There is also a more advanced method, <a href="#spy.invokeWith"><code>invokeWith()</code></a>, that
supports arguments passed by reference:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>) {</span>
<span class="pl-s1">        <span class="pl-c1">list</span>(<span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>) <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>invokeWith([<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> passes</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$a</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'x'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$b</span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'y'</span></span></pre></div>
<h3>
<a id="pausing-spy-recording" class="anchor" href="#pausing-spy-recording" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Pausing spy recording</h3>
<p>To temporarily prevent spies from recording calls, use
<a href="#spy.stopRecording"><code>stopRecording()</code></a> and
<a href="#spy.startRecording"><code>startRecording()</code></a> as necessary:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy();</span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>stopRecording();</span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>startRecording();</span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> passes</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> passes</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> fails</span></span></pre></div>
<h2>
<a id="calls" class="anchor" href="#calls" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Calls</h2>
<p><em>Phony</em> provides the ability to make verifications on individual recorded calls.
<a href="#the-call-api">The call API</a> mirrors the methods available on <a href="#the-spy-api">the spy API</a>.</p>
<h3>
<a id="retrieving-calls-from-a-spy" class="anchor" href="#retrieving-calls-from-a-spy" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Retrieving calls from a spy</h3>
<p>To get the first call, use <a href="#spy.firstCall"><code>firstCall()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>firstCall();</span></pre></div>
<p>To get the last call, use <a href="#spy.lastCall"><code>lastCall()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>lastCall();</span></pre></div>
<p>To get a specific call by index, use <a href="#spy.callAt"><code>callAt()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>callAt(<span class="pl-c1">0</span>); <span class="pl-c"><span class="pl-c">//</span> returns the first call</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>callAt(<span class="pl-c1">9</span>); <span class="pl-c"><span class="pl-c">//</span> returns the tenth call</span></span></pre></div>
<p>These methods will throw an exception if no call is found.</p>
<h3>
<a id="verifying-call-input" class="anchor" href="#verifying-call-input" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying call input</h3>
<h4>
<a id="verifying-that-a-call-was-made-with-specific-arguments" class="anchor" href="#verifying-that-a-call-was-made-with-specific-arguments" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that a call was made with specific arguments</h4>
<p>To verify input arguments, use <a href="#call.calledWith"><code>calledWith()</code></a>. Arguments
passed to <a href="#call.calledWith"><code>calledWith()</code></a> can be literal values, or
<a href="#matchers">matchers</a>, including <a href="#shorthand-matchers">shorthand matchers</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>calledWith();         <span class="pl-c"><span class="pl-c">//</span> called with no arguments</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> called with 'a' followed by 'b'</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> called with 'a' followed by 0-n arguments</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> called with 'a' followed by exactly 1 argument</span></span></pre></div>
<p>Arguments can also be retrieved with <a href="#call.arguments"><code>arguments()</code></a> or
<a href="#call.argument"><code>argument()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>arguments(); <span class="pl-c"><span class="pl-c">//</span> all arguments as an array</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>argument();  <span class="pl-c"><span class="pl-c">//</span> first argument</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>argument(<span class="pl-c1">1</span>); <span class="pl-c"><span class="pl-c">//</span> second argument</span></span></pre></div>
<p>Example output from <a href="#call.calledWith"><code>calledWith()</code></a>:</p>
<p><a href="img/verification/called-with/call-argument-mismatch.svg" target="_blank"><img src="img/verification/called-with/call-argument-mismatch.svg" alt="Example output from $call-&gt;calledWith()" style="max-width:100%;"></a></p>
<h3>
<a id="verifying-call-output" class="anchor" href="#verifying-call-output" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying call output</h3>
<h4>
<a id="verifying-call-return-values" class="anchor" href="#verifying-call-return-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying call return values</h4>
<p>To verify a call's return value, use <a href="#call.returned"><code>returned()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>returned();    <span class="pl-c"><span class="pl-c">//</span> returned anything</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> returned 'a'</span></span></pre></div>
<p>Return values can be retrieved with <a href="#call.returnValue"><code>returnValue()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> <span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>returnValue();</span></pre></div>
<p>Example output from <a href="#call.returned"><code>returned()</code></a>:</p>
<p><a href="img/verification/returned/call-value-mismatch.svg" target="_blank"><img src="img/verification/returned/call-value-mismatch.svg" alt="Example output from $call-&gt;returned()" style="max-width:100%;"></a></p>
<h5>
<a id="verifying-generators-returned-by-calls" class="anchor" href="#verifying-generators-returned-by-calls" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying generators returned by calls</h5>
<p>To verify that a call returned a <a href="http://php.net/language.generators.overview">generator</a>, use
<a href="#call.generated"><code>generated()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>generated();</span></pre></div>
<p>The result returned by <a href="#call.generated"><code>generated()</code></a> can be used for further
verification of the generator's behavior:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>generated(); <span class="pl-c"><span class="pl-c">//</span> returned a generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> generator yielded 'a'</span></span>
<span class="pl-s1"><span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> generator returned 'b'</span></span></pre></div>
<p>See <a href="#generator-and-iterable-verification">Generator and iterable verification</a> for a complete explanation of the
available verifications.</p>
<p>Example output from <a href="#call.generated"><code>generated()</code></a>:</p>
<p><a href="img/verification/generated/call-no-generator.svg" target="_blank"><img src="img/verification/generated/call-no-generator.svg" alt="Example output from $call-&gt;generated()" style="max-width:100%;"></a></p>
<h5>
<a id="verifying-iterables-returned-by-calls" class="anchor" href="#verifying-iterables-returned-by-calls" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying iterables returned by calls</h5>
<p>To verify that a call returned an iterable value, such as an array or iterator,
use <a href="#call.iterated"><code>iterated()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>iterated();</span></pre></div>
<p>If <a href="#generator-and-iterable-verification">iterable spies</a> are enabled, the result returned by
<a href="#call.iterated"><code>iterated()</code></a> can be used for further verification of the
iterable's behavior:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$iterable</span> <span class="pl-k">=</span> <span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>iterated(); <span class="pl-c"><span class="pl-c">//</span> returned an iterable</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$iterable</span><span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);      <span class="pl-c"><span class="pl-c">//</span> iterable produced 'a'</span></span>
<span class="pl-s1"><span class="pl-smi">$iterable</span><span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> iterable produced 'b' =&gt; 'c'</span></span></pre></div>
<p>See <a href="#generator-and-iterable-verification">Generator and iterable verification</a> for a complete explanation of the
available verifications.</p>
<p>Example output from <a href="#call.iterated"><code>iterated()</code></a>:</p>
<p><a href="img/verification/iterated/call-no-iterable.svg" target="_blank"><img src="img/verification/iterated/call-no-iterable.svg" alt="Example output from $call-&gt;iterated()" style="max-width:100%;"></a></p>
<h4>
<a id="verifying-call-exceptions" class="anchor" href="#verifying-call-exceptions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying call exceptions</h4>
<p>To verify that a call threw an exception, use <a href="#call.threw"><code>threw()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>threw();                                         <span class="pl-c"><span class="pl-c">//</span> threw any exception</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>threw(<span class="pl-s"><span class="pl-pds">'</span>RuntimeException<span class="pl-pds">'</span></span>);                       <span class="pl-c"><span class="pl-c">//</span> threw a runtime exception</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>threw(<span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>You done goofed.<span class="pl-pds">'</span></span>)); <span class="pl-c"><span class="pl-c">//</span> threw a runtime exception with a specific message</span></span></pre></div>
<p>Thrown exceptions can be retrieved with <a href="#call.exception"><code>exception()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$exception</span> <span class="pl-k">=</span> <span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>exception();</span></pre></div>
<p>Example output from <a href="#call.threw"><code>threw()</code></a>:</p>
<p><a href="img/verification/threw/call-value-mismatch.svg" target="_blank"><img src="img/verification/threw/call-value-mismatch.svg" alt="Example output from $call-&gt;threw()" style="max-width:100%;"></a></p>
<h3>
<a id="verifying-call-progress" class="anchor" href="#verifying-call-progress" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying call progress</h3>
<p>To verify that a call has completed, use <a href="#call.completed"><code>completed()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>completed();</span></pre></div>
<p>When <a href="#generator-and-iterable-verification">generator spies</a> are in use, a call that returns a generator will not be
considered "complete" until the generator has been completely consumed via
iteration.</p>
<p>Similarly, when <a href="#generator-and-iterable-verification">iterable spies</a> are in use, a call that returns an iterable
will not be considered "complete" until the iterable has been completely
consumed via iteration.</p>
<p>To ignore iterable events, and simply verify that a call has returned a value
<em>or</em> thrown an exception, use <a href="#call.responded"><code>responded()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>responded();</span></pre></div>
<p>Responses can be retrieved with <a href="#call.exception"><code>exception()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c1">list</span>(<span class="pl-smi">$exception</span>, <span class="pl-smi">$value</span>) <span class="pl-k">=</span> <span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>response();</span></pre></div>
<p>Generator responses can be retrieved with <a href="#call.exception"><code>exception()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c1">list</span>(<span class="pl-smi">$exception</span>, <span class="pl-smi">$value</span>) <span class="pl-k">=</span> <span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>generatorResponse();</span></pre></div>
<p>Example output from <a href="#call.completed"><code>completed()</code></a>:</p>
<p><a href="img/verification/completed/call-none-completed.svg" target="_blank"><img src="img/verification/completed/call-none-completed.svg" alt="Example output from $call-&gt;completed()" style="max-width:100%;"></a></p>
<p>Example output from <a href="#call.responded"><code>responded()</code></a>:</p>
<p><a href="img/verification/responded/call-no-responses.svg" target="_blank"><img src="img/verification/responded/call-no-responses.svg" alt="Example output from $call-&gt;responded()" style="max-width:100%;"></a></p>
<h3>
<a id="verifying-cardinality-with-calls" class="anchor" href="#verifying-cardinality-with-calls" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying cardinality with calls</h3>
<p>When used with a call, cardinality modifiers change the amount of times that
<strong>events</strong> within that call must meet the requirements of a subsequent
verification.</p>
<p>This differs slightly from their usage with spies, where cardinality modifiers
change the amount of <strong>calls</strong> that must meet the requirements of a subsequent
verification.</p>
<p>Cardinality must be specified <strong>before</strong> verification, and can be applied to
any verification:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>never()<span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> not called with 'a'</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>never()<span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);   <span class="pl-c"><span class="pl-c">//</span> did not return 'b'</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>never()<span class="pl-k">-&gt;</span>threw();         <span class="pl-c"><span class="pl-c">//</span> did not throw an exception</span></span></pre></div>
<p>The default cardinality is <code>atLeast(1)</code>, meaning verifications will pass if at
least one matching event was recorded.</p>
<h4>
<a id="verifying-that-a-call-event-happened-an-exact-number-of-times" class="anchor" href="#verifying-that-a-call-event-happened-an-exact-number-of-times" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that a call event happened an exact number of times</h4>
<p>To verify that an event happened an exact number of times, use one of
<a href="#call.never"><code>never()</code></a>, <a href="#call.once"><code>once()</code></a>, <a href="#call.twice"><code>twice()</code></a>,
<a href="#call.thrice"><code>thrice()</code></a>, or <a href="#call.times"><code>times()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>never()<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);   <span class="pl-c"><span class="pl-c">//</span> never produced 'a'</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>once()<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);    <span class="pl-c"><span class="pl-c">//</span> produced 'a' exactly 1 time</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>twice()<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);   <span class="pl-c"><span class="pl-c">//</span> produced 'a' exactly 2 times</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>thrice()<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);  <span class="pl-c"><span class="pl-c">//</span> produced 'a' exactly 3 times</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>times(<span class="pl-c1">10</span>)<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> produced 'a' exactly 10 times</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>never()<span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);   <span class="pl-c"><span class="pl-c">//</span> never received 'a'</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>once()<span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);    <span class="pl-c"><span class="pl-c">//</span> received 'a' exactly 1 time</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>twice()<span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);   <span class="pl-c"><span class="pl-c">//</span> received 'a' exactly 2 times</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>thrice()<span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);  <span class="pl-c"><span class="pl-c">//</span> received 'a' exactly 3 times</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>times(<span class="pl-c1">10</span>)<span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> received 'a' exactly 10 times</span></span></pre></div>
<h4>
<a id="verifying-that-a-call-event-happened-a-bounded-number-of-times" class="anchor" href="#verifying-that-a-call-event-happened-a-bounded-number-of-times" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that a call event happened a bounded number of times</h4>
<p>To verify that an event happened a bounded number of times, use one of
<a href="#call.atLeast"><code>atLeast()</code></a>, <a href="#call.atMost"><code>atMost()</code></a>, or
<a href="#call.between"><code>between()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>atLeast(<span class="pl-c1">2</span>)<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);    <span class="pl-c"><span class="pl-c">//</span> produced 'a' 2 or more times</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>atMost(<span class="pl-c1">3</span>)<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);     <span class="pl-c"><span class="pl-c">//</span> produced 'a' no more than 3 times</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>between(<span class="pl-c1">2</span>, <span class="pl-c1">4</span>)<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> produced 'a' 2, 3, or 4 times</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>atLeast(<span class="pl-c1">2</span>)<span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);    <span class="pl-c"><span class="pl-c">//</span> received 'a' 2 or more times</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>atMost(<span class="pl-c1">3</span>)<span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);     <span class="pl-c"><span class="pl-c">//</span> received 'a' no more than 3 times</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>between(<span class="pl-c1">2</span>, <span class="pl-c1">4</span>)<span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> received 'a' 2, 3, or 4 times</span></span></pre></div>
<h4>
<a id="verifying-that-all-call-events-happen-the-same-way" class="anchor" href="#verifying-that-all-call-events-happen-the-same-way" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that all call events happen the same way</h4>
<p>To verify that all events happen the same way, use <a href="#call.always"><code>always()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>always()<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> always produced 'a'</span></span>
<span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>always()<span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> always received 'b'</span></span></pre></div>
<p>Note that <a href="#call.always"><code>always()</code></a> does not interfere with other cardinality
modifiers, and can be combined to produce powerful verifications:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$call</span><span class="pl-k">-&gt;</span>twice()<span class="pl-k">-&gt;</span>always()<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> produced exactly 2 values, both of which are 'a'</span></span></pre></div>
<h2>
<a id="verification" class="anchor" href="#verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verification</h2>
<p>"Verification" is a general term, used to refer to any <em>Phony</em> method or
function that asserts that something happened. <em>Phony</em> implements many
verification methods and functions across its <a href="#api">API</a>, but they all behave in a
similar manner.</p>
<p>Each verification method or function has two variants. For most use-cases, the
<a href="#standard-verification">standard verification</a> style will be the best fit. When verification fails,
this variant will record an assertion failure with the <a href="#integration-with-test-frameworks">testing framework</a> in
use. This typically (but not always) involves an exception being thrown.</p>
<p>For situations where this is not desirable, the <a href="#check-verification">check verification</a> style can
be used. When verification fails, this variant will simply return <code>null</code>, and no
assertion failure will be recorded with the <a href="#integration-with-test-frameworks">testing framework</a> in use.</p>
<p>For information on specific verification methods, see these sections:</p>
<ul>
<li>
<a href="#spies">Spies</a>
<ul>
<li>
<a href="#call-verification">Call verification</a>
<ul>
<li><a href="#call-count">Call count</a></li>
<li><a href="#individual-calls">Individual calls</a></li>
</ul>
</li>
<li>
<a href="#verifying-spy-input">Verifying spy input</a>
<ul>
<li><a href="#verifying-that-a-call-was-made">Verifying that a call was made</a></li>
<li><a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a></li>
</ul>
</li>
<li>
<a href="#verifying-spy-output">Verifying spy output</a>
<ul>
<li>
<a href="#verifying-spy-return-values">Verifying spy return values</a>
<ul>
<li><a href="#verifying-generators-returned-by-spies">Verifying generators returned by spies</a></li>
<li><a href="#verifying-iterables-returned-by-spies">Verifying iterables returned by spies</a></li>
</ul>
</li>
<li><a href="#verifying-spy-exceptions">Verifying spy exceptions</a></li>
</ul>
</li>
<li><a href="#verifying-spy-progress">Verifying spy progress</a></li>
<li>
<a href="#verifying-cardinality-with-spies">Verifying cardinality with spies</a>
<ul>
<li><a href="#verifying-that-a-spy-event-happened-an-exact-number-of-times">Verifying that a spy event happened an exact number of times</a></li>
<li><a href="#verifying-that-a-spy-event-happened-a-bounded-number-of-times">Verifying that a spy event happened a bounded number of times</a></li>
<li><a href="#verifying-that-all-spy-events-happen-the-same-way">Verifying that all spy events happen the same way</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#calls">Calls</a>
<ul>
<li>
<a href="#verifying-call-input">Verifying call input</a>
<ul>
<li><a href="#verifying-that-a-call-was-made-with-specific-arguments">Verifying that a call was made with specific arguments</a></li>
</ul>
</li>
<li>
<a href="#verifying-call-output">Verifying call output</a>
<ul>
<li>
<a href="#verifying-call-return-values">Verifying call return values</a>
<ul>
<li><a href="#verifying-generators-returned-by-calls">Verifying generators returned by calls</a></li>
<li><a href="#verifying-iterables-returned-by-calls">Verifying iterables returned by calls</a></li>
</ul>
</li>
<li><a href="#verifying-call-exceptions">Verifying call exceptions</a></li>
</ul>
</li>
<li><a href="#verifying-call-progress">Verifying call progress</a></li>
<li>
<a href="#verifying-cardinality-with-calls">Verifying cardinality with calls</a>
<ul>
<li><a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a></li>
<li><a href="#verifying-that-a-call-event-happened-a-bounded-number-of-times">Verifying that a call event happened a bounded number of times</a></li>
<li><a href="#verifying-that-all-call-events-happen-the-same-way">Verifying that all call events happen the same way</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#verification">Verification</a>
<ul>
<li><a href="#standard-verification">Standard verification</a></li>
<li><a href="#check-verification">Check verification</a></li>
<li>
<a href="#understanding-verification-output">Understanding verification output</a>
<ul>
<li><a href="#expected-behavior-output">Expected behavior output</a></li>
<li><a href="#cardinality-output">Cardinality output</a></li>
<li><a href="#actual-behavior-output">Actual behavior output</a></li>
</ul>
</li>
<li>
<a href="#generator-and-iterable-verification">Generator and iterable verification</a>
<ul>
<li><a href="#verifying-iteration">Verifying iteration</a></li>
<li><a href="#verifying-produced-values">Verifying produced values</a></li>
<li><a href="#verifying-values-received-by-generators">Verifying values received by generators</a></li>
<li><a href="#verifying-exceptions-received-by-generators">Verifying exceptions received by generators</a></li>
<li><a href="#verifying-generator-return-values">Verifying generator return values</a></li>
<li><a href="#verifying-generator-exceptions">Verifying generator exceptions</a></li>
<li><a href="#verifying-cardinality-with-generators-and-iterables">Verifying cardinality with generators and iterables</a></li>
<li><a href="#iterable-spy-substitution">Iterable spy substitution</a></li>
<li>
<a href="#iterable-verification-caveats">Iterable verification caveats</a>
<ul>
<li><a href="#using-iterable-spies-changes-the-return-value">Using iterable spies changes the return value</a></li>
<li><a href="#repeated-iteration-of-iterable-spies">Repeated iteration of iterable spies</a></li>
<li><a href="#spying-on-iterables-that-implement-array-like-interfaces">Spying on iterables that implement array-like interfaces</a></li>
<li><a href="#nested-iterable-spies">Nested iterable spies</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#order-verification">Order verification</a>
<ul>
<li><a href="#dynamic-order-verification">Dynamic order verification</a></li>
<li>
<a href="#order-verification-caveats">Order verification caveats</a>
<ul>
<li><a href="#intermediate-events-in-order-verification">Intermediate events in order verification</a></li>
<li><a href="#similar-events-in-order-verification">Similar events in order verification</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#verifying-that-there-was-no-interaction-with-a-mock">Verifying that there was no interaction with a mock</a></li>
<li><a href="#using-colored-verification-output">Using colored verification output</a></li>
</ul>
</li>
</ul>
<h3>
<a id="standard-verification" class="anchor" href="#standard-verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Standard verification</h3>
<p>"Standard" verification involves "recording" failures with the
<a href="#integration-with-test-frameworks">testing framework</a> in use. For most testing frameworks, this involves throwing
a specific type of exception used by the framework.</p>
<p>In some cases, the framework will not use a specific exception type, and will
treat <em>any</em> exception as a failure. In this case, and in the case that no
<a href="#integration-with-test-frameworks">testing framework</a> is being used, <em>Phony</em> will simply throw its own
<a href="#assertionexception">AssertionException</a> on failure.</p>
<p>In rare cases, such as use with <a href="https://github.com/simpletest/simpletest">SimpleTest</a>, failures do not result in any
exception being thrown. The failure is recorded with the <a href="#integration-with-test-frameworks">testing framework</a>
via whatever method the framework uses instead. This may mean that execution
continues past the failed verification call.</p>
<p>As with <a href="#check-verification">check verification</a>, verification successes will return a
<a href="#the-verification-result-api">verification result</a>, which can be used for further verifications, including
<a href="#order-verification">order verification</a>.</p>
<h3>
<a id="check-verification" class="anchor" href="#check-verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Check verification</h3>
<p>In contrast to <a href="#standard-verification">standard verification</a>, "check" verification does not involve
integration with the <a href="#integration-with-test-frameworks">testing framework</a> in use.</p>
<p>In the case of verification failure, <code>null</code> will be returned. As with
<a href="#standard-verification">standard verification</a>, verification successes will return a
<a href="#the-verification-result-api">verification result</a>, which can be used for further verifications, including
<a href="#order-verification">order verification</a>.</p>
<p>Check verification may be used to integrate with <a href="#integration-with-test-frameworks">testing frameworks</a> that do
not yet have first-class support in <em>Phony</em>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">expect(<span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>checkCalled())<span class="pl-k">-&gt;</span><span class="pl-smi">to</span><span class="pl-k">-&gt;</span><span class="pl-smi">be</span><span class="pl-k">-&gt;</span><span class="pl-smi">ok</span>;</span></pre></div>
<h3>
<a id="understanding-verification-output" class="anchor" href="#understanding-verification-output" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Understanding verification output</h3>
<p>See also: <a href="#the-export-format">The export format</a>.</p>
<p>Typical verification output looks something like the following example. Hovering
over a section of the example will provide an explanation of that part of the
output:</p>
<p><a href="img/verification.svg" target="_blank"><img src="img/verification.svg" alt="Example verification output" style="max-width:100%;"></a></p>
<h4>
<a id="expected-behavior-output" class="anchor" href="#expected-behavior-output" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Expected behavior output</h4>
<p>The first part of the output explains what was expected. In the above example:</p>
<ul>
<li>
<code>Expected ClassA[label]-&gt;methodA call</code> -
Expected a call to <code>methodA</code> on a mock of <code>ClassA</code>, with a label of <code>label</code>.</li>
<li>
<code>with arguments:</code> - The arguments should match the conditions detailed below.</li>
<li>
<code>✓ "aardvark" (1 match)</code> - The first argument should be the string
<code>"aardvark"</code>, and 1 call had a matching first argument.</li>
<li>
<code>✗ #0["bonobo", "chameleon", "dugong"] (0 matches)</code> - The second argument
should be an array with 3 string elements, but no calls had a matching second
argument.</li>
</ul>
<h4>
<a id="cardinality-output" class="anchor" href="#cardinality-output" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Cardinality output</h4>
<p>The second part of the output explains the "cardinality" of both the expectation
(if relevant), and the actual events. In the above example:</p>
<ul>
<li>
<code>Matched 0 of 2:</code> - There were 2 calls, and neither of them matched.</li>
</ul>
<h4>
<a id="actual-behavior-output" class="anchor" href="#actual-behavior-output" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Actual behavior output</h4>
<p>The third part of the output explains what actually happened. In the above
example:</p>
<ul>
<li>
<code>✗ Call #0:</code> - The first call did not match.</li>
<li>
<code>✓ "aardvark"</code> - The first argument of the first call matched.</li>
<li>
<code>✗ #0["bonobo", "[-chameleon-]{+capybara+}", "dugong"]</code> - The second argument
of the first call did not match. The second array element was expected to be
<code>"chameleon"</code>, but it was actually <code>"capybara"</code>.</li>
<li>
<code>✗ Call #1:</code> - The second call did not match.</li>
<li>
<code>✗ "[-aardvark-]{+armadillo+}"</code> - The first argument of the second call did
not match. The argument was expected to be <code>"aardvark"</code>, but it was actually
<code>"armadillo"</code>.</li>
<li>
<code>✗ #0["bonobo", "chameleon", "[-dugong-]{+dormouse+}"]</code> - The second argument
of the second call did not match. The third array element was expected to be
<code>"dugong"</code>, but it was actually <code>"dormouse"</code>.</li>
</ul>
<h3>
<a id="generator-and-iterable-verification" class="anchor" href="#generator-and-iterable-verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Generator and iterable verification</h3>
<p>When spying on a callable that returns a <a href="http://php.net/language.generators.overview">generator</a>, additional verification
can be performed on events that happen after the generator is returned, such as
the yielding of values. This is accomplished via the use of "generator spies".</p>
<p>The use of generator spies is an optional behavior that can be disabled by
calling <a href="#spy.setUseGeneratorSpies"><code>setUseGeneratorSpies()</code></a> on a spy:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>setUseGeneratorSpies(<span class="pl-c1">false</span>);</span></pre></div>
<p>"Iterable spies" also exist for other iterators and arrays, but are disabled
by default because they typically change the return type of the spy. This
feature can be enabled by calling
<a href="#spy.setUseIterableSpies"><code>setUseIterableSpies()</code></a> on a spy:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>setUseIterableSpies(<span class="pl-c1">true</span>);</span></pre></div>
<p>Both <a href="#spy.setUseGeneratorSpies"><code>setUseGeneratorSpies()</code></a> and
<a href="#spy.setUseIterableSpies"><code>setUseIterableSpies()</code></a> are fluent, meaning
spy creation and setting of these options can be done in a single expression:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy()</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setUseIterableSpies(<span class="pl-c1">true</span>)</span>
<span class="pl-s1">    <span class="pl-k">-&gt;</span>setUseGeneratorSpies(<span class="pl-c1">false</span>);</span></pre></div>
<h4>
<a id="verifying-iteration" class="anchor" href="#verifying-iteration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying iteration</h4>
<p>To verify that iteration of a generator or iterable commenced, use
<a href="#verification.used"><code>used()</code></a> on any <a href="#the-generator-verification-result-api">generator verification result</a> or
<a href="#the-iterable-verification-result-api">iterable verification result</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$subject</span><span class="pl-k">-&gt;</span>generated()<span class="pl-k">-&gt;</span>used(); <span class="pl-c"><span class="pl-c">//</span> iteration of the generator commenced</span></span>
<span class="pl-s1"><span class="pl-smi">$subject</span><span class="pl-k">-&gt;</span>iterated()<span class="pl-k">-&gt;</span>used();  <span class="pl-c"><span class="pl-c">//</span> iteration of the iterable commenced</span></span></pre></div>
<p>To verify that iteration of a generator or iterable completed, use
<a href="#verification.consumed"><code>consumed()</code></a> on any <a href="#the-generator-verification-result-api">generator verification result</a> or
<a href="#the-iterable-verification-result-api">iterable verification result</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$subject</span><span class="pl-k">-&gt;</span>generated()<span class="pl-k">-&gt;</span>consumed(); <span class="pl-c"><span class="pl-c">//</span> iteration of the generator completed</span></span>
<span class="pl-s1"><span class="pl-smi">$subject</span><span class="pl-k">-&gt;</span>iterated()<span class="pl-k">-&gt;</span>consumed();  <span class="pl-c"><span class="pl-c">//</span> iteration of the iterable completed</span></span></pre></div>
<p>Example output from <a href="#verification.used"><code>used()</code></a>:</p>
<p><a href="img/verification/used/iterated-unused.svg" target="_blank"><img src="img/verification/used/iterated-unused.svg" alt="Example output from $iterable-&gt;used()" style="max-width:100%;"></a></p>
<p>Example output from <a href="#verification.consumed"><code>consumed()</code></a>:</p>
<p><a href="img/verification/consumed/iterated-unconsumed.svg" target="_blank"><img src="img/verification/consumed/iterated-unconsumed.svg" alt="Example output from $iterable-&gt;consumed()" style="max-width:100%;"></a></p>
<h4>
<a id="verifying-produced-values" class="anchor" href="#verifying-produced-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying produced values</h4>
<p>To verify that a value was yielded by a generator, use
<a href="#verification.produced"><code>produced()</code></a> on any <a href="#the-generator-verification-result-api">generator verification result</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$subject</span><span class="pl-k">-&gt;</span>generated(); <span class="pl-c"><span class="pl-c">//</span> returned a generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>produced();         <span class="pl-c"><span class="pl-c">//</span> produced anything</span></span>
<span class="pl-s1"><span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);      <span class="pl-c"><span class="pl-c">//</span> produced 'a' with any key</span></span>
<span class="pl-s1"><span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> produced 'b' with key 'a'</span></span></pre></div>
<p>To verify that a value was produced by an iterable, use
<a href="#verification.produced"><code>produced()</code></a> on any <a href="#the-iterable-verification-result-api">iterable verification result</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$iterable</span> <span class="pl-k">=</span> <span class="pl-smi">$subject</span><span class="pl-k">-&gt;</span>iterated(); <span class="pl-c"><span class="pl-c">//</span> returned an iterable</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$iterable</span><span class="pl-k">-&gt;</span>produced();         <span class="pl-c"><span class="pl-c">//</span> produced anything</span></span>
<span class="pl-s1"><span class="pl-smi">$iterable</span><span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);      <span class="pl-c"><span class="pl-c">//</span> produced 'a' with any key</span></span>
<span class="pl-s1"><span class="pl-smi">$iterable</span><span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> produced 'b' with key 'a'</span></span></pre></div>
<p>Example output from <a href="#verification.produced"><code>produced()</code></a>:</p>
<p><a href="img/verification/produced/iterated-key-value-mismatch.svg" target="_blank"><img src="img/verification/produced/iterated-key-value-mismatch.svg" alt="Example output from $iterable-&gt;produced()" style="max-width:100%;"></a></p>
<h4>
<a id="verifying-values-received-by-generators" class="anchor" href="#verifying-values-received-by-generators" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying values received by generators</h4>
<p>To verify that a value was received by a generator, use
<a href="#verification.received"><code>received()</code></a> on any <a href="#the-generator-verification-result-api">generator verification result</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$subject</span><span class="pl-k">-&gt;</span>generated(); <span class="pl-c"><span class="pl-c">//</span> returned a generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>received();    <span class="pl-c"><span class="pl-c">//</span> received anything</span></span>
<span class="pl-s1"><span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>received(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> received 'a'</span></span></pre></div>
<p>Example output from <a href="#verification.received"><code>received()</code></a>:</p>
<p><a href="img/verification/received/value-mismatch.svg" target="_blank"><img src="img/verification/received/value-mismatch.svg" alt="Example output from $generator-&gt;received()" style="max-width:100%;"></a></p>
<h4>
<a id="verifying-exceptions-received-by-generators" class="anchor" href="#verifying-exceptions-received-by-generators" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying exceptions received by generators</h4>
<p>To verify that an exception was received by a generator, use
<a href="#verification.receivedException"><code>receivedException()</code></a> on any
<a href="#the-generator-verification-result-api">generator verification result</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$subject</span><span class="pl-k">-&gt;</span>generated(); <span class="pl-c"><span class="pl-c">//</span> returned a generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>receivedException();                                         <span class="pl-c"><span class="pl-c">//</span> received any exception</span></span>
<span class="pl-s1"><span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>receivedException(<span class="pl-s"><span class="pl-pds">'</span>RuntimeException<span class="pl-pds">'</span></span>);                       <span class="pl-c"><span class="pl-c">//</span> received a runtime exception</span></span>
<span class="pl-s1"><span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>receivedException(<span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>You done goofed.<span class="pl-pds">'</span></span>)); <span class="pl-c"><span class="pl-c">//</span> received a runtime exception with a specific message</span></span></pre></div>
<p>Example output from <a href="#verification.receivedException"><code>receivedException()</code></a>:</p>
<p><a href="img/verification/received-exception/value-mismatch.svg" target="_blank"><img src="img/verification/received-exception/value-mismatch.svg" alt="Example output from $generator-&gt;receivedException()" style="max-width:100%;"></a></p>
<h4>
<a id="verifying-generator-return-values" class="anchor" href="#verifying-generator-return-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying generator return values</h4>
<p>To verify a generator's return value, use <a href="#verification.returned"><code>returned()</code></a>
on any <a href="#the-generator-verification-result-api">generator verification result</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$subject</span><span class="pl-k">-&gt;</span>generated(); <span class="pl-c"><span class="pl-c">//</span> returned a generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>returned();    <span class="pl-c"><span class="pl-c">//</span> returned anything</span></span>
<span class="pl-s1"><span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> returned 'a'</span></span></pre></div>
<p>Example output from <a href="#verification.returned"><code>returned()</code></a>:</p>
<p><a href="img/verification/generated-returned/value-mismatch.svg" target="_blank"><img src="img/verification/generated-returned/value-mismatch.svg" alt="Example output from $generator-&gt;returned()" style="max-width:100%;"></a></p>
<h4>
<a id="verifying-generator-exceptions" class="anchor" href="#verifying-generator-exceptions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying generator exceptions</h4>
<p>To verify that a generator threw an exception, use
<a href="#verification.threw"><code>threw()</code></a> on any <a href="#the-generator-verification-result-api">generator verification result</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$generator</span> <span class="pl-k">=</span> <span class="pl-smi">$subject</span><span class="pl-k">-&gt;</span>generated(); <span class="pl-c"><span class="pl-c">//</span> returned a generator</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>threw();                                         <span class="pl-c"><span class="pl-c">//</span> threw any exception</span></span>
<span class="pl-s1"><span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>threw(<span class="pl-s"><span class="pl-pds">'</span>RuntimeException<span class="pl-pds">'</span></span>);                       <span class="pl-c"><span class="pl-c">//</span> threw a runtime exception</span></span>
<span class="pl-s1"><span class="pl-smi">$generator</span><span class="pl-k">-&gt;</span>threw(<span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>You done goofed.<span class="pl-pds">'</span></span>)); <span class="pl-c"><span class="pl-c">//</span> threw a runtime exception with a specific message</span></span></pre></div>
<p>Example output from <a href="#verification.threw"><code>threw()</code></a>:</p>
<p><a href="img/verification/generated-threw/value-mismatch.svg" target="_blank"><img src="img/verification/generated-threw/value-mismatch.svg" alt="Example output from $generator-&gt;threw()" style="max-width:100%;"></a></p>
<h4>
<a id="verifying-cardinality-with-generators-and-iterables" class="anchor" href="#verifying-cardinality-with-generators-and-iterables" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying cardinality with generators and iterables</h4>
<p>When used <strong>before</strong> <code>generated()</code> or <code>iterated()</code>, cardinality modifiers change
the amount of calls that must return a <a href="http://php.net/language.generators.overview">generator</a> or iterable:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$subject</span><span class="pl-k">-&gt;</span>twice()<span class="pl-k">-&gt;</span>generated(); <span class="pl-c"><span class="pl-c">//</span> returned a generator exactly 2 times</span></span>
<span class="pl-s1"><span class="pl-smi">$subject</span><span class="pl-k">-&gt;</span>twice()<span class="pl-k">-&gt;</span>iterated();  <span class="pl-c"><span class="pl-c">//</span> returned an iterable exactly 2 times</span></span></pre></div>
<p>When used <strong>after</strong> <code>generated()</code> or <code>iterated()</code>, cardinality modifiers relate
to the subset of calls that already satisfied the initial verification:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$subject</span><span class="pl-k">-&gt;</span>generated()<span class="pl-k">-&gt;</span>twice()<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> produced 'a' from exactly 2 generator calls</span></span>
<span class="pl-s1"><span class="pl-smi">$subject</span><span class="pl-k">-&gt;</span>iterated()<span class="pl-k">-&gt;</span>twice()<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);  <span class="pl-c"><span class="pl-c">//</span> produced 'a' from exactly 2 iterable calls</span></span></pre></div>
<p>See <a href="#verifying-cardinality-with-spies">Verifying cardinality with spies</a> and <a href="#verifying-cardinality-with-calls">Verifying cardinality with calls</a>
for a full list or cardinality modifiers.</p>
<h4>
<a id="iterable-spy-substitution" class="anchor" href="#iterable-spy-substitution" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Iterable spy substitution</h4>
<p>Phony will sometimes accept an iterable spy, or generator spy, as equivalent to
the iterable value it is spying on. This simplifies some stubbing and
verification scenarios.</p>
<p>When stubbing, iterable spies and generator spies are substituted when
<a href="#matching-stub-arguments">matching stub arguments</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>setUseIterableSpies(<span class="pl-c1">true</span>)<span class="pl-k">-&gt;</span>returnsArgument();</span>
<span class="pl-s1"><span class="pl-smi">$iterable</span> <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1"><span class="pl-smi">$iterableSpy</span> <span class="pl-k">=</span> $<span class="pl-smi">stubA</span>(<span class="pl-smi">$iterable</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> these two statements are equivalent</span></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span><span class="pl-k">-&gt;</span>with(<span class="pl-smi">$iterable</span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$stubB</span><span class="pl-k">-&gt;</span>with(<span class="pl-smi">$iterableSpy</span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span></pre></div>
<p>The same is true when <a href="#verifying-that-a-spy-was-called-with-specific-arguments">verifying that a spy was called with specific arguments</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stubA</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>setUseIterableSpies(<span class="pl-c1">true</span>)<span class="pl-k">-&gt;</span>returnsArgument();</span>
<span class="pl-s1"><span class="pl-smi">$iterable</span> <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1"><span class="pl-smi">$iterableSpy</span> <span class="pl-k">=</span> $<span class="pl-smi">stubA</span>(<span class="pl-smi">$iterable</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stubB</span> <span class="pl-k">=</span> stub();</span>
<span class="pl-s1">$<span class="pl-smi">stubB</span>(<span class="pl-smi">$iterableSpy</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> these two statements are equivalent</span></span>
<span class="pl-s1"><span class="pl-smi">$database</span><span class="pl-k">-&gt;</span><span class="pl-smi">select</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-smi">$iterable</span>);</span>
<span class="pl-s1"><span class="pl-smi">$database</span><span class="pl-k">-&gt;</span><span class="pl-smi">select</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-smi">$iterableSpy</span>);</span></pre></div>
<p>And also when <a href="#verifying-spy-return-values">verifying spy return values</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>setUseIterableSpies(<span class="pl-c1">true</span>)<span class="pl-k">-&gt;</span>returnsArgument();</span>
<span class="pl-s1"><span class="pl-smi">$iterable</span> <span class="pl-k">=</span> [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1"><span class="pl-smi">$iterableSpy</span> <span class="pl-k">=</span> $<span class="pl-smi">stub</span>(<span class="pl-smi">$iterable</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> these two statements are equivalent</span></span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>returned(<span class="pl-smi">$iterable</span>);    <span class="pl-c"><span class="pl-c">//</span> passes</span></span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>returned(<span class="pl-smi">$iterableSpy</span>); <span class="pl-c"><span class="pl-c">//</span> passes</span></span></pre></div>
<p>There are other edge-case situations where <em>Phony</em> will exhibit this behavior.
Refer to the <a href="#api">API</a> documentation for more detailed information.</p>
<h4>
<a id="iterable-verification-caveats" class="anchor" href="#iterable-verification-caveats" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Iterable verification caveats</h4>
<h5>
<a id="using-iterable-spies-changes-the-return-value" class="anchor" href="#using-iterable-spies-changes-the-return-value" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using iterable spies changes the return value</h5>
<p>When generator spies are enabled, the return value of spied functions that
produce generators will automatically be wrapped in another generator that spies
on the original. This is usually not a problem, because it is impossible to
distinguish the two generators aside from an identity comparison (<code>===</code>).</p>
<p>If the system under test relies upon the identity of returned generators, it may
be advisable to disable generator spies using
<a href="#spy.setUseGeneratorSpies"><code>$spy-&gt;setUseGeneratorSpies(false)</code></a>.</p>
<p>Similarly, when iterable spies are enabled, the return value of functions that
produce iterable values will automatically be wrapped in an iterator that spies
on the original value. This can be more problematic than with generator spies,
because it changes the <em>type</em> of the return value. That is why iterable spies
are disabled by default.</p>
<h5>
<a id="repeated-iteration-of-iterable-spies" class="anchor" href="#repeated-iteration-of-iterable-spies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Repeated iteration of iterable spies</h5>
<p>Events are only recorded the first time an iterable spy is iterated over. If the
underlying value is an array, or is iterated with an iterator that supports
<a href="http://php.net/iterator.rewind"><code>rewind()</code></a>, subsequent iterations will behave as expected, but no events will
be recorded.</p>
<p>This has no relevance for <a href="#generator-and-iterable-verification">generator spies</a>, as generators cannot be rewound.</p>
<h5>
<a id="spying-on-iterables-that-implement-array-like-interfaces" class="anchor" href="#spying-on-iterables-that-implement-array-like-interfaces" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Spying on iterables that implement array-like interfaces</h5>
<p>It's quite common for iterable objects to also implement <a href="http://php.net/arrayaccess">ArrayAccess</a> and
<a href="http://php.net/countable">Countable</a>. Iterable spies <em>always</em> implement these interfaces, which may be
incompatible with code that checks for these interfaces at run time.</p>
<p>If the underlying iterable object implements <a href="http://php.net/arrayaccess">ArrayAccess</a> and/or <a href="http://php.net/countable">Countable</a>,
<em>Phony</em> will pass relevant calls through to the underlying implementation. If
these interfaces are <em>not</em> implemented, then the behavior of calls to
<a href="http://php.net/arrayaccess">ArrayAccess</a> and/or <a href="http://php.net/countable">Countable</a> is undefined, but will most likely result in an
error.</p>
<h5>
<a id="nested-iterable-spies" class="anchor" href="#nested-iterable-spies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Nested iterable spies</h5>
<p>It is possible for an iterable value to become nested in multiple iterable
spies. Consider the following:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-c1">Traversable</span> <span class="pl-smi">$traversable</span>) {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-smi">$traversable</span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">);</span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>setUseIterableSpies(<span class="pl-c1">true</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$traversable</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">ArrayIterator</span>([<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>]);</span>
<span class="pl-s1"><span class="pl-smi">$iterableSpy</span> <span class="pl-k">=</span> $<span class="pl-smi">spy</span>(<span class="pl-smi">$traversable</span>);</span>
<span class="pl-s1"><span class="pl-smi">$nestedIterableSpy</span> <span class="pl-k">=</span> $<span class="pl-smi">spy</span>(<span class="pl-smi">$iterableSpy</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> note that $traversable !== $iterableSpy !== $nestedIterableSpy</span></span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> in other words, they are all different iterator instances</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">iterator_to_array</span>(<span class="pl-smi">$nestedIterableSpy</span>); <span class="pl-c"><span class="pl-c">//</span> consume the outer-most traversable</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$firstCall</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>callAt(<span class="pl-c1">0</span>);          <span class="pl-c"><span class="pl-c">//</span> the call that returned $iterableSpy</span></span>
<span class="pl-s1"><span class="pl-smi">$firstCall</span><span class="pl-k">-&gt;</span>iterated()<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> passes</span></span>
<span class="pl-s1"><span class="pl-smi">$firstCall</span><span class="pl-k">-&gt;</span>iterated()<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> passes</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$secondCall</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>callAt(<span class="pl-c1">1</span>);          <span class="pl-c"><span class="pl-c">//</span> the call that returned $nestedIterableSpy</span></span>
<span class="pl-s1"><span class="pl-smi">$secondCall</span><span class="pl-k">-&gt;</span>iterated()<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> passes</span></span>
<span class="pl-s1"><span class="pl-smi">$secondCall</span><span class="pl-k">-&gt;</span>iterated()<span class="pl-k">-&gt;</span>produced(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> passes</span></span></pre></div>
<p>This example demonstrates that even when iterable spies are nested, in most
cases this is desirable, because it means that the iterable events are recorded
against <em>both</em> of the relevant calls.</p>
<p>Note that this nesting behavior can lead to some confusing results when an
iterable is partially traversed before being wrapped in another iterable spy.
Behavior in these circumstances is up to the PHP runtime, but generally
speaking, it "just works".</p>
<h3>
<a id="order-verification" class="anchor" href="#order-verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Order verification</h3>
<p>To verify that events happened in a particular order, use
<a href="#facade.inOrder"><code>inOrder()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1">inOrder(</span>
<span class="pl-s1">    <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">    <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">    <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">    <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span>
<span class="pl-s1"><span class="pl-c1">Phony</span><span class="pl-k">::</span>inOrder(</span>
<span class="pl-s1">    <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">    <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">    <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">    <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">);</span></pre></div>
<p>To relax order verification within a call to <a href="#facade.inOrder"><code>inOrder()</code></a>, use
<a href="#facade.anyOrder"><code>anyOrder()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1">inOrder(</span>
<span class="pl-s1">    anyOrder(</span>
<span class="pl-s1">        <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">        <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    ),</span>
<span class="pl-s1">    anyOrder(</span>
<span class="pl-s1">        <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">        <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    )</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span>
<span class="pl-s1"><span class="pl-c1">Phony</span><span class="pl-k">::</span>inOrder(</span>
<span class="pl-s1">    <span class="pl-c1">Phony</span><span class="pl-k">::</span>anyOrder(</span>
<span class="pl-s1">        <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">        <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    ),</span>
<span class="pl-s1">    <span class="pl-c1">Phony</span><span class="pl-k">::</span>anyOrder(</span>
<span class="pl-s1">        <span class="pl-smi">$spyA</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">        <span class="pl-smi">$spyB</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">    )</span>
<span class="pl-s1">);</span></pre></div>
<p>Event order can be verified across all defined mocks, stubs, and spies, using
any <a href="#verification">verification</a> implemented by <em>Phony</em>. Both <a href="#facade.inOrder"><code>inOrder()</code></a>
and <a href="#facade.anyOrder"><code>anyOrder()</code></a> will accept any number of
<a href="#the-verification-result-api">verification results</a> to verify.</p>
<p>Example output from <a href="#facade.inOrder"><code>inOrder()</code></a>:</p>
<p><a href="img/verification/in-order/unexpected-order.svg" target="_blank"><img src="img/verification/in-order/unexpected-order.svg" alt="Example output from inOrder()" style="max-width:100%;"></a></p>
<h4>
<a id="dynamic-order-verification" class="anchor" href="#dynamic-order-verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Dynamic order verification</h4>
<p>When the number of events to verify is dynamic, the [<code>...</code> operator] can be
used:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$calledEvents</span> <span class="pl-k">=</span> [];</span>
<span class="pl-s1"><span class="pl-smi">$returnedEvents</span> <span class="pl-k">=</span> [];</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">foreach</span> (<span class="pl-smi">$spies</span> <span class="pl-k">as</span> <span class="pl-smi">$spy</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$calledEvents</span>[] <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>called();</span>
<span class="pl-s1">    <span class="pl-smi">$returnedEvents</span>[] <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>returned();</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1">inOrder(</span>
<span class="pl-s1">    anyOrder(<span class="pl-k">...</span><span class="pl-smi">$calledEvents</span>),</span>
<span class="pl-s1">    anyOrder(<span class="pl-k">...</span><span class="pl-smi">$returnedEvents</span>)</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span>
<span class="pl-s1"><span class="pl-c1">Phony</span><span class="pl-k">::</span>inOrder(</span>
<span class="pl-s1">    <span class="pl-c1">Phony</span><span class="pl-k">::</span>anyOrder(<span class="pl-k">...</span><span class="pl-smi">$calledEvents</span>),</span>
<span class="pl-s1">    <span class="pl-c1">Phony</span><span class="pl-k">::</span>anyOrder(<span class="pl-k">...</span><span class="pl-smi">$returnedEvents</span>)</span>
<span class="pl-s1">);</span></pre></div>
<h4>
<a id="order-verification-caveats" class="anchor" href="#order-verification-caveats" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Order verification caveats</h4>
<h5>
<a id="intermediate-events-in-order-verification" class="anchor" href="#intermediate-events-in-order-verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Intermediate events in order verification</h5>
<p>Order verification <strong>does not</strong> verify that the specified events were the <em>only</em>
events that occurred:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$withA</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$withB</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$withC</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">inOrder(<span class="pl-smi">$withA</span>, <span class="pl-smi">$withB</span>); <span class="pl-c"><span class="pl-c">//</span> passes</span></span>
<span class="pl-s1">inOrder(<span class="pl-smi">$withA</span>, <span class="pl-smi">$withC</span>); <span class="pl-c"><span class="pl-c">//</span> passes</span></span>
<span class="pl-s1">inOrder(<span class="pl-smi">$withB</span>, <span class="pl-smi">$withC</span>); <span class="pl-c"><span class="pl-c">//</span> passes</span></span></pre></div>
<p>To verify that specific events did not occur, use <a href="#spy.never"><code>$spy-&gt;never()</code></a>
or <a href="#call.never"><code>$call-&gt;never()</code></a>.</p>
<h5>
<a id="similar-events-in-order-verification" class="anchor" href="#similar-events-in-order-verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Similar events in order verification</h5>
<p>Order verification <strong>does not</strong> verify that the specified events happened in
<em>only</em> one order:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$withA</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$withB</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">inOrder(<span class="pl-smi">$withA</span>, <span class="pl-smi">$withB</span>);         <span class="pl-c"><span class="pl-c">//</span> passes</span></span>
<span class="pl-s1">inOrder(<span class="pl-smi">$withB</span>, <span class="pl-smi">$withA</span>);         <span class="pl-c"><span class="pl-c">//</span> passes</span></span>
<span class="pl-s1">inOrder(<span class="pl-smi">$withA</span>, <span class="pl-smi">$withB</span>, <span class="pl-smi">$withA</span>); <span class="pl-c"><span class="pl-c">//</span> passes</span></span></pre></div>
<p>However, it <em>is</em> possible to verify event order more explicitly using
<a href="#individual-calls">individual calls</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">inOrder(<span class="pl-smi">$withA</span><span class="pl-k">-&gt;</span>firstCall(), <span class="pl-smi">$withB</span>); <span class="pl-c"><span class="pl-c">//</span> passes</span></span>
<span class="pl-s1">inOrder(<span class="pl-smi">$withA</span><span class="pl-k">-&gt;</span>lastCall(), <span class="pl-smi">$withB</span>);  <span class="pl-c"><span class="pl-c">//</span> fails</span></span></pre></div>
<p>Of course, extracting <a href="#individual-calls">individual calls</a> is only helpful when verifying the
order of calls. Similar methods exist to aid in explicitly verifying the order
of other types of events:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-smi">$x</span>) {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-smi">$x</span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">);</span>
<span class="pl-s1"></span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$returnedA</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$returnedB</span> <span class="pl-k">=</span> <span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>returned(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">inOrder(<span class="pl-smi">$returnedA</span><span class="pl-k">-&gt;</span>firstEvent(), <span class="pl-smi">$returnedB</span>); <span class="pl-c"><span class="pl-c">//</span> passes</span></span>
<span class="pl-s1">inOrder(<span class="pl-smi">$returnedA</span><span class="pl-k">-&gt;</span>lastEvent(), <span class="pl-smi">$returnedB</span>);  <span class="pl-c"><span class="pl-c">//</span> fails</span></span></pre></div>
<h3>
<a id="verifying-that-there-was-no-interaction-with-a-mock" class="anchor" href="#verifying-that-there-was-no-interaction-with-a-mock" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Verifying that there was no interaction with a mock</h3>
<p>To verify that there was no interaction with a mock, use
<a href="#handle.noInteraction"><code>noInteraction()</code></a> on any <a href="#mock-handles">mock handle</a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>noInteraction(); <span class="pl-c"><span class="pl-c">//</span> passes</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span><span class="pl-k">-&gt;</span>methodA();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>noInteraction(); <span class="pl-c"><span class="pl-c">//</span> fails</span></span></pre></div>
<p>This verification will fail if any of the mock's methods have been called.</p>
<p>Example output from <a href="#handle.noInteraction"><code>noInteraction()</code></a>:</p>
<p><a href="img/verification/no-interaction/parent-class.svg" target="_blank"><img src="img/verification/no-interaction/parent-class.svg" alt="Example output from $handle-&gt;noInteraction()" style="max-width:100%;"></a></p>
<h3>
<a id="using-colored-verification-output" class="anchor" href="#using-colored-verification-output" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using colored verification output</h3>
<p>To control the use of <a href="https://en.wikipedia.org/wiki/ANSI_escape_code#Colors">ANSI colored output</a>, use
<a href="#facade.setUseColor"><code>setUseColor()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">setUseColor(<span class="pl-smi">$useColor</span>);        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-c1">Phony</span><span class="pl-k">::</span>setUseColor(<span class="pl-smi">$useColor</span>); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span></pre></div>
<p>Passing <code>true</code> turns color on, passing <code>false</code> turns color off, and passing
<code>null</code> will cause <em>Phony</em> to automatically detect whether color should be used
(this is the default behavior).</p>
<h2>
<a id="matchers" class="anchor" href="#matchers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Matchers</h2>
<p><em>Matchers</em> are used to determine whether the arguments of a call match certain
criteria. Utilized correctly, they can make verifications less brittle, and
improve the quality of a test suite.</p>
<p><em>Phony</em> implements only a few matchers itself, and provides first-class support
for numerous third-party matcher libraries.</p>
<h3>
<a id="matcher-integrations" class="anchor" href="#matcher-integrations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Matcher integrations</h3>
<h4>
<a id="kahlan-argument-matchers" class="anchor" href="#kahlan-argument-matchers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://kahlan.github.io/docs/">Kahlan</a> argument matchers</h4>
<p><a href="https://kahlan.github.io/docs/">Kahlan</a> is a popular "describe-it" style testing framework.
<a href="https://kahlan.github.io/docs/matchers.html#argument">Kahlan argument matchers</a> can be used in any <em>Phony</em> verification:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-c1">Arg</span><span class="pl-k">::</span>toBe(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>));</span></pre></div>
<p>Kahlan argument matchers are supported when using the <a href="https://packagist.org/packages/eloquent/phony-kahlan">eloquent/phony-kahlan</a>
package.</p>
<h4>
<a id="hamcrest-matchers" class="anchor" href="#hamcrest-matchers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://github.com/hamcrest/hamcrest-php">Hamcrest</a> matchers</h4>
<p><a href="https://github.com/hamcrest/hamcrest-php">Hamcrest</a> is a popular stand-alone matcher library, that originated in Java,
and has been ported to many languages, including an "official" port for PHP. Its
matchers can be used in any <em>Phony</em> verification:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(equalTo(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>));</span></pre></div>
<p>Hamcrest matchers are supported regardless of <a href="#integration-with-test-frameworks">which Composer package</a> is in
use.</p>
<h4>
<a id="phpunit-constraints" class="anchor" href="#phpunit-constraints" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://phpunit.de/">PHPUnit</a> constraints</h4>
<p><a href="https://phpunit.de/">PHPUnit</a> is a popular unit testing framework. <a href="https://phpunit.de/manual/current/en/appendixes.assertions.html#appendixes.assertions.assertThat">PHPUnit matchers</a> (referred to
as "constraints") can be used in any <em>Phony</em> verification:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> where $this is a PHPUnit test case</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>equalTo(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>));</span></pre></div>
<p>PHPUnit constraints are supported when using the <a href="https://packagist.org/packages/eloquent/phony-phpunit">eloquent/phony-phpunit</a>
package.</p>
<h4>
<a id="simpletest-expectations" class="anchor" href="#simpletest-expectations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://github.com/simpletest/simpletest">SimpleTest</a> expectations</h4>
<p><a href="https://github.com/simpletest/simpletest">SimpleTest</a> is a legacy unit testing framework. <a href="http://www.simpletest.org/en/expectation_documentation.html">SimpleTest matchers</a>
(referred to as "expectations") can be used in any <em>Phony</em> verification:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-k">new</span> <span class="pl-c1">EqualExpectation</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>));</span></pre></div>
<p>SimpleTest expectations are supported when using the <a href="https://packagist.org/packages/eloquent/phony-simpletest">eloquent/phony-simpletest</a>
package.</p>
<h3>
<a id="shorthand-matchers" class="anchor" href="#shorthand-matchers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Shorthand matchers</h3>
<p><em>Phony</em> provides two "shorthand matchers"; <code>'~'</code>, and <code>'*'</code>. These strings are
automatically transformed into specific matchers:</p>
<ul>
<li>
<code>'~'</code> is equivalent to an <a href="#the-any-matcher">"any" matcher</a>
</li>
<li>
<code>'*'</code> is equivalent to a <a href="#the-wildcard-matcher">"wildcard" matcher</a>
</li>
</ul>
<p>For typical <em>Phony</em> usage, this results in much simpler verifications. For
example, the following verifications are exactly equivalent:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, any(), <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, wildcard());</span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>);</span></pre></div>
<p>In the case that a verification expects a literal <code>'~'</code>, or <code>'*'</code> value, the
<a href="#the-equal-to-matcher">"equal to" matcher</a> can be used to prevent <em>Phony</em> interpreting shorthand
matchers:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(equalTo(<span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>), equalTo(<span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>));</span></pre></div>
<h3>
<a id="the-any-matcher" class="anchor" href="#the-any-matcher" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The "any" matcher</h3>
<p>This matcher matches a single argument of any value:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> any();        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>any(); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(any()); <span class="pl-c"><span class="pl-c">//</span> typical usage</span></span></pre></div>
<h3>
<a id="the-equal-to-matcher" class="anchor" href="#the-equal-to-matcher" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The "equal to" matcher</h3>
<p>This is the default matcher used by <em>Phony</em>. It takes a single argument, and
matches values that are equal to that argument:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> equalTo(<span class="pl-smi">$value</span>);        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>equalTo(<span class="pl-smi">$value</span>); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(equalTo(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)); <span class="pl-c"><span class="pl-c">//</span> typical usage</span></span></pre></div>
<p>This matcher is equivalent to strict comparison (<code>===</code>), except that it does not
require objects to be the same <em>instance</em>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> equalTo((<span class="pl-k">object</span>) [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">0</span>]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>(<span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches((<span class="pl-k">object</span>) [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">0</span>]));    <span class="pl-c"><span class="pl-c">//</span> outputs 'bool(true)'</span></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>(<span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches((<span class="pl-k">object</span>) [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">null</span>])); <span class="pl-c"><span class="pl-c">//</span> outputs 'bool(false)'</span></span></pre></div>
<h4>
<a id="when-to-use-the-equal-to-matcher" class="anchor" href="#when-to-use-the-equal-to-matcher" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>When to use the "equal to" matcher</h4>
<p>In most cases, it's not necessary to create an "equal to" matcher manually,
because <em>Phony</em> implicitly wraps anything that's not already a matcher. For
example, this verification:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span></pre></div>
<p>is exactly equivalent to this one:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(equalTo(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>));</span></pre></div>
<p>In fact, there are only two circumstances in which this matcher should be used.
The first is when a verification expects a literal <code>*</code> or <code>~</code> string (which
<em>Phony</em> would otherwise interpret as special <a href="#shorthand-matchers">shorthand matchers</a>):</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(equalTo(<span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>), equalTo(<span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>));</span></pre></div>
<p>The second circumstance is when a verification expects an actual matcher as an
argument:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(equalTo(<span class="pl-k">new</span> <span class="pl-c1">EqualToMatcher</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>)));</span></pre></div>
<h4>
<a id="special-cases-for-the-equal-to-matcher" class="anchor" href="#special-cases-for-the-equal-to-matcher" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Special cases for the "equal to" matcher</h4>
<p>For certain types of values, the "equal to" matcher will exhibit special
behavior, in order to improve the usefulness of its comparisons, or to improve
performance in common use cases.</p>
<h5>
<a id="comparing-exceptions" class="anchor" href="#comparing-exceptions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Comparing exceptions</h5>
<p>When an exception is compared, some internal PHP details are stripped from the
output, including file path, line number, and stack trace.</p>
<p>In the following example, note that differing line numbers are ignored, but
differing codes are not:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> equalTo(<span class="pl-k">new</span> <span class="pl-c1">Exception</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>));</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Exception</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Exception</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-c1">1</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches(<span class="pl-smi">$a</span>) ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'true'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches(<span class="pl-smi">$b</span>) ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'false'</span></span></pre></div>
<h5>
<a id="comparing-mocks" class="anchor" href="#comparing-mocks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Comparing mocks</h5>
<p>When a mock is compared, some internal <em>Phony</em> details are ignored. In addition,
if a <a href="#labeling-mocks">label</a> has been set on the mock, it will be included in
the comparison.</p>
<p>In the following example, note that differing mock behaviors are ignored, but
differing labels are not:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> equalTo(mock(<span class="pl-c1">ClassX</span><span class="pl-k">::</span><span class="pl-c1">class</span>)<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>get());</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassX</span><span class="pl-k">::</span><span class="pl-c1">class</span>)<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$a</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodX</span><span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches(<span class="pl-smi">$a</span><span class="pl-k">-&gt;</span>get()) ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'true'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassX</span><span class="pl-k">::</span><span class="pl-c1">class</span>)<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassX</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches(<span class="pl-smi">$b</span><span class="pl-k">-&gt;</span>get()) ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'false'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches(<span class="pl-smi">$c</span><span class="pl-k">-&gt;</span>get()) ? <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>; <span class="pl-c"><span class="pl-c">//</span> outputs 'false'</span></span></pre></div>
<p>Since mocks are labeled with a unique integer by default, they can normally be
used to differentiate calls without requiring the use of an 'identical to'
matcher:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassX</span><span class="pl-k">::</span><span class="pl-c1">class</span>)<span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassX</span><span class="pl-k">::</span><span class="pl-c1">class</span>)<span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub();</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>with(<span class="pl-smi">$a</span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$stub</span><span class="pl-k">-&gt;</span>with(<span class="pl-smi">$b</span>)<span class="pl-k">-&gt;</span>returns(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-smi">$a</span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'a'</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> $<span class="pl-smi">stub</span>(<span class="pl-smi">$b</span>); <span class="pl-c"><span class="pl-c">//</span> outputs 'b'</span></span></pre></div>
<h3>
<a id="the-instance-of-matcher" class="anchor" href="#the-instance-of-matcher" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The "instance of" matcher</h3>
<p>The "instance of" matcher is a matcher that is functionally equivalent to the
<code>instanceof</code> operator:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> anInstanceOf(<span class="pl-smi">$type</span>);        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> <span class="pl-c1">Phony</span><span class="pl-k">::</span>anInstanceOf(<span class="pl-smi">$type</span>); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(anInstanceOf(<span class="pl-c1">Iterator</span><span class="pl-k">::</span><span class="pl-c1">class</span>)); <span class="pl-c"><span class="pl-c">//</span> typical usage</span></span></pre></div>
<p>Just like <code>instanceof</code>, the "instance of" matcher supports both class names and
interfaces; which can be specified as either a string, or an object:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$arrayIterator</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">ArrayIterator</span>([]);</span>
<span class="pl-s1"><span class="pl-smi">$emptyIterator</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">EmptyIterator</span>();</span>
<span class="pl-s1"><span class="pl-smi">$nonIterator</span> <span class="pl-k">=</span> (<span class="pl-k">object</span>) [];</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> anInstanceOf(<span class="pl-c1">Iterator</span><span class="pl-k">::</span><span class="pl-c1">class</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>(<span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches(<span class="pl-smi">$arrayIterator</span>)); <span class="pl-c"><span class="pl-c">//</span> outputs 'bool(true)'</span></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>(<span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches(<span class="pl-smi">$emptyIterator</span>)); <span class="pl-c"><span class="pl-c">//</span> outputs 'bool(true)'</span></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>(<span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches(<span class="pl-smi">$nonIterator</span>));   <span class="pl-c"><span class="pl-c">//</span> outputs 'bool(false)'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$matcher</span> <span class="pl-k">=</span> anInstanceOf(<span class="pl-k">new</span> <span class="pl-c1">ArrayIterator</span>([]));</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>(<span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches(<span class="pl-smi">$arrayIterator</span>)); <span class="pl-c"><span class="pl-c">//</span> outputs 'bool(true)'</span></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>(<span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches(<span class="pl-smi">$emptyIterator</span>)); <span class="pl-c"><span class="pl-c">//</span> outputs 'bool(false)'</span></span>
<span class="pl-s1"><span class="pl-c1">var_dump</span>(<span class="pl-smi">$matcher</span><span class="pl-k">-&gt;</span>matches(<span class="pl-smi">$nonIterator</span>));   <span class="pl-c"><span class="pl-c">//</span> outputs 'bool(false)'</span></span></pre></div>
<h3>
<a id="the-wildcard-matcher" class="anchor" href="#the-wildcard-matcher" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The "wildcard" matcher</h3>
<p>The "wildcard" matcher is a special matcher that can match multiple arguments:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, wildcard()); <span class="pl-c"><span class="pl-c">//</span> verification passes</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, any());      <span class="pl-c"><span class="pl-c">//</span> verification fails (not enough arguments)</span></span></pre></div>
<p>It is usually much simpler to take advantage of <a href="#shorthand-matchers">shorthand matchers</a> when
dealing with wildcards:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> verification passes</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> verification fails (not enough arguments)</span></span></pre></div>
<p>By default, wildcard matchers will match any argument value. This behavior can
be modified by wrapping any non-wildcard matcher (including literal values) in a
wildcard. This is accomplished by passing the matcher to the wildcard as the
first argument:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(wildcard(equalTo(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>))); <span class="pl-c"><span class="pl-c">//</span> verification passes</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(wildcard(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>));          <span class="pl-c"><span class="pl-c">//</span> verification passes</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(wildcard(equalTo(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>))); <span class="pl-c"><span class="pl-c">//</span> verification fails</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(wildcard(<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>));          <span class="pl-c"><span class="pl-c">//</span> verification fails</span></span></pre></div>
<p>Wildcards can also have minimum and/or maximum options, which limit how many
arguments they match. The second and third parameters, respectively, are for
specifying the minimum, and maximum argument counts:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">$<span class="pl-smi">spy</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(wildcard(<span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>)); <span class="pl-c"><span class="pl-c">//</span> verification passes</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(wildcard(<span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>, <span class="pl-c1">4</span>));    <span class="pl-c"><span class="pl-c">//</span> verification fails (too few arguments)</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(wildcard(<span class="pl-s"><span class="pl-pds">'</span>~<span class="pl-pds">'</span></span>, <span class="pl-c1">0</span>, <span class="pl-c1">2</span>)); <span class="pl-c"><span class="pl-c">//</span> verification fails (too many arguments)</span></span></pre></div>
<p>The behavior of wildcard matchers is only well defined when they appear at the
end of a matcher list. If a wildcard appears before any other matcher, any
behavior exhibited by <em>Phony</em> is not guaranteed, and may change in future
versions:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>);           <span class="pl-c"><span class="pl-c">//</span> this is supported</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> this is supported</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> this is not supported</span></span>
<span class="pl-s1"><span class="pl-smi">$spy</span><span class="pl-k">-&gt;</span>calledWith(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>); <span class="pl-c"><span class="pl-c">//</span> this is not supported</span></span></pre></div>
<h2>
<a id="the-exporter" class="anchor" href="#the-exporter" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The exporter</h2>
<p>When a <em>Phony</em> verification fails, the failure message will often contain string
representations of the actual, or expected PHP values involved. These string
representations are generated by <em>Phony</em>'s internal exporter.</p>
<h3>
<a id="the-export-format" class="anchor" href="#the-export-format" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The export format</h3>
<p>The exporter generates a concise, unambiguous, human-readable representation of
any PHP value, including recursive objects and arrays:</p>
<table>
<thead>
<tr>
<th>Input value</th>
<th>Exporter output</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>null</code></td>
<td><code>'null'</code></td>
</tr>
<tr>
<td><code>true</code></td>
<td><code>'true'</code></td>
</tr>
<tr>
<td><code>false</code></td>
<td><code>'false'</code></td>
</tr>
<tr>
<td><code>111</code></td>
<td><code>'111'</code></td>
</tr>
<tr>
<td><code>1.11</code></td>
<td><code>'1.110000e+0'</code></td>
</tr>
<tr>
<td><code>'1.11'</code></td>
<td><code>'"1.11"'</code></td>
</tr>
<tr>
<td><code>"a\nb"</code></td>
<td><code>'"a\nb"'</code></td>
</tr>
<tr>
<td><code>STDIN</code></td>
<td><code>'resource#1'</code></td>
</tr>
<tr>
<td><code>[1, 2]</code></td>
<td><code>'#0[1, 2]'</code></td>
</tr>
<tr>
<td><code>['a' =&gt; 1, 'b' =&gt; 2]</code></td>
<td><code>'#0["a": 1, "b": 2]</code></td>
</tr>
<tr>
<td><code>(object) ['a' =&gt; 1, 'b' =&gt; 2]</code></td>
<td><code>'#0{a: 1, b: 2}'</code></td>
</tr>
<tr>
<td><code>new ClassA()</code></td>
<td><code>'ClassA#0{}'</code></td>
</tr>
</tbody>
</table>
<h4>
<a id="export-identifiers-and-references" class="anchor" href="#export-identifiers-and-references" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Export identifiers and references</h4>
<p>Exported arrays, objects, and "wrapper" types (such as <a href="#mock-handles">mock handles</a>) include a
numeric identifier that can be used to identify repeated occurrences of the same
value. This is represented as a number sign (<code>#</code>) followed by the identifier:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> (<span class="pl-k">object</span>) [];</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $value is exported as '#0{}'</span></span></pre></div>
<p>When a value appears multiple times, its internal structure will only be
described the first time. Subsequent appearances will be indicated by a
reference to the value's identifier. This is represented as an ampersand (<code>&amp;</code>)
followed by the identifier:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$inner</span> <span class="pl-k">=</span> [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>];</span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [<span class="pl-k">&amp;</span><span class="pl-smi">$inner</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$inner</span>];</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $value is exported as '#0[#1[1, 2], &amp;1[]]'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$inner</span> <span class="pl-k">=</span> (<span class="pl-k">object</span>) [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">1</span>];</span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> (<span class="pl-k">object</span>) [<span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$inner</span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$inner</span>];</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $value is exported as '#0{b: #1{a: 1}, c: &amp;1{}}'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$inner</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>)<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>mock-label<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [<span class="pl-smi">$inner</span>, <span class="pl-smi">$inner</span>];</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $value is exported as '#0[handle#1(PhonyMock_ClassA_0#0{}[mock-label]), &amp;1()]'</span></span></pre></div>
<h5>
<a id="export-reference-types" class="anchor" href="#export-reference-types" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Export reference types</h5>
<p>Array references appear followed by brackets (e.g. <code>&amp;0[]</code>), object references
appear followed by braces (e.g. <code>&amp;0{}</code>), and wrapper references appear followed
by parentheses (e.g. <code>&amp;0()</code>):</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$array</span> <span class="pl-k">=</span> [];</span>
<span class="pl-s1"><span class="pl-smi">$object</span> <span class="pl-k">=</span> (<span class="pl-k">object</span>) [];</span>
<span class="pl-s1"><span class="pl-smi">$wrapper</span> <span class="pl-k">=</span> spy(<span class="pl-s"><span class="pl-pds">'</span>implode<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>spy-label<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [<span class="pl-k">&amp;</span><span class="pl-smi">$array</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$array</span>];</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $value is exported as '#0[#1[], &amp;1[]]'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [<span class="pl-smi">$object</span>, <span class="pl-smi">$object</span>];</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $value is exported as '#0[#0{}, &amp;0{}]'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [<span class="pl-smi">$wrapper</span>, <span class="pl-smi">$wrapper</span>];</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $value is exported as '#0[spy#1(implode)[spy-label], &amp;1()]'</span></span></pre></div>
<p>This is necessary in order to disambiguate references, because arrays and other
types can sometimes have the same identifier:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [</span>
<span class="pl-s1">    (<span class="pl-k">object</span>) [],</span>
<span class="pl-s1">    [</span>
<span class="pl-s1">        (<span class="pl-k">object</span>) [],</span>
<span class="pl-s1">    ],</span>
<span class="pl-s1">];</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $value is exported as '#0[#0{}, #1[#1{}]]'</span></span></pre></div>
<h5>
<a id="export-reference-exclusions" class="anchor" href="#export-reference-exclusions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Export reference exclusions</h5>
<p>As well as excluding the content, object references exclude the class name, and
wrapper references exclude the type, for brevity:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$inner</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">ClassA</span>();</span>
<span class="pl-s1"><span class="pl-smi">$inner</span><span class="pl-k">-&gt;</span><span class="pl-smi">c</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>d<span class="pl-pds">"</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> (<span class="pl-k">object</span>) [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$inner</span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$inner</span>];</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $value is exported as '#0{a: ClassA#1{c: "d"}, b: &amp;1{}}'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$inner</span> <span class="pl-k">=</span> mock();</span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [<span class="pl-smi">$inner</span>, <span class="pl-smi">$inner</span>];</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $value is exported as '#0[handle#0(PhonyMock_0#1{}[0]), &amp;0()]'</span></span></pre></div>
<h5>
<a id="export-identifier-persistence" class="anchor" href="#export-identifier-persistence" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Export identifier persistence</h5>
<p>Identifiers for objects and wrappers are persistent across invocations of the
exporter, and share a single sequence of numbers:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> (<span class="pl-k">object</span>) [];</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> (<span class="pl-k">object</span>) [];</span>
<span class="pl-s1"><span class="pl-smi">$c</span> <span class="pl-k">=</span> mock();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [<span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>, <span class="pl-smi">$c</span>, <span class="pl-smi">$a</span>];</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $value is exported as '#0[#0{}, #1{}, handle#2(PhonyMock_0#3{}[0]), &amp;0{}]'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [<span class="pl-smi">$b</span>, <span class="pl-smi">$a</span>, <span class="pl-smi">$b</span>, <span class="pl-smi">$c</span>];</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $value is exported as '#0[#1{}, #0{}, &amp;1{}, handle#2(PhonyMock_0#3{}[0])]'</span></span></pre></div>
<p>But due to PHP's limitations, array identifiers are only persistent within a
single exporter invocation:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$a</span> <span class="pl-k">=</span> [];</span>
<span class="pl-s1"><span class="pl-smi">$b</span> <span class="pl-k">=</span> [];</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$valueA</span> <span class="pl-k">=</span> [<span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$a</span>];</span>
<span class="pl-s1"><span class="pl-smi">$valueB</span> <span class="pl-k">=</span> [<span class="pl-k">&amp;</span><span class="pl-smi">$b</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$a</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$b</span>];</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> both $valueA and $valueB are exported as '#0[#1[], #2[], &amp;1[]]'</span></span></pre></div>
<h4>
<a id="exporting-recursive-values" class="anchor" href="#exporting-recursive-values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exporting recursive values</h4>
<p>If a recursive value is exported, the points of recursion are exported as
<a href="#export-identifiers-and-references">references</a>, in the same way that multiple instances of the same value are
handled:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [];</span>
<span class="pl-s1"><span class="pl-smi">$value</span>[] <span class="pl-k">=</span> <span class="pl-k">&amp;</span><span class="pl-smi">$value</span>;</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $value is exported as '#0[&amp;0[]]'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> (<span class="pl-k">object</span>) [];</span>
<span class="pl-s1"><span class="pl-smi">$value</span><span class="pl-k">-&gt;</span><span class="pl-smi">a</span> <span class="pl-k">=</span> <span class="pl-smi">$value</span>;</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $value is exported as '#0{a: &amp;0{}}'</span></span></pre></div>
<h4>
<a id="exporter-special-cases" class="anchor" href="#exporter-special-cases" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exporter special cases</h4>
<p>For certain types of values, the exporter will exhibit special behavior, in
order to improve the usefulness of its output, or to improve performance in
common use cases.</p>
<h5>
<a id="exporting-closures" class="anchor" href="#exporting-closures" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exporting closures</h5>
<p>When a closure is exported, the file path and start line number are included in
the output:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$closure</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () {}; <span class="pl-c"><span class="pl-c">//</span> file path is /path/to/example.php, line number is 123</span></span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $closure is exported as 'Closure#0{}[example.php:123]'</span></span></pre></div>
<p>Only the basename of the path is included, for brevity.</p>
<h5>
<a id="exporting-exceptions" class="anchor" href="#exporting-exceptions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exporting exceptions</h5>
<p>When an exception is exported, some internal PHP details are stripped from the
output, including file path, line number, and stack trace:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$exception</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Exception</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-c1">1</span>, <span class="pl-k">new</span> <span class="pl-c1">Exception</span>());</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $exception is exported as 'Exception#0{message: "a", code: 1, previous: Exception#1{}}'</span></span></pre></div>
<p>Additionally, when the message is <code>''</code>, the code is <code>0</code>, and/or the previous
exception is <code>null</code>, these values are excluded for brevity:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$exception</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>();</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $exception is exported as 'RuntimeException#0{}'</span></span></pre></div>
<h5>
<a id="exporting-mocks" class="anchor" href="#exporting-mocks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exporting mocks</h5>
<p>When a mock is exported, some internal <em>Phony</em> details are stripped from the
output. In addition, if a <a href="#labeling-mocks">label</a> has been set on the mock, this
will be included in the output:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>)<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>mock-label<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$mock</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span>get();</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $mock is exported as 'PhonyMock_ClassA_0#0{}[mock-label]'</span></span></pre></div>
<p>When a <a href="#mock-handles">mock handle</a> is exported, it is represented as a wrapper around the mock
itself:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>)<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>mock-label<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $handle is exported as 'handle#1(PhonyMock_ClassA_0#0{}[mock-label])'</span></span></pre></div>
<p>When a <a href="#static-mocks">static handle</a> is exported, it is represented as a wrapper around the
mock class:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$staticHandle</span> <span class="pl-k">=</span> onStatic(<span class="pl-smi">$handle</span>);</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $staticHandle is exported as 'static-handle#0(PhonyMock_ClassA_0)'</span></span></pre></div>
<h5>
<a id="exporting-stubs" class="anchor" href="#exporting-stubs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exporting stubs</h5>
<p>When a <a href="#stubs">stub</a> is exported, it is represented as a wrapper around the callable
entity that is stubbed, with the <a href="#labeling-spies">label</a> also included in the output:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub(<span class="pl-s"><span class="pl-pds">'</span>implode<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>stub-label<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $stub is exported as 'stub#0(implode)[stub-label]'</span></span></pre></div>
<p>Anonymous stubs have a simpler representation, since they don't wrap any
callable entity:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> stub()<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>stub-label<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $stub is exported as 'stub#0[stub-label]'</span></span></pre></div>
<p>In the case of method stubs, class name information is also included:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handle</span> <span class="pl-k">=</span> mock(<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>)<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>mock-label<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$staticHandle</span> <span class="pl-k">=</span> onStatic(<span class="pl-smi">$handle</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> <span class="pl-smi">$handle</span><span class="pl-k">-&gt;</span><span class="pl-smi">methodA</span><span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>stub-label<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $stub is exported as 'stub#0(ClassA[mock-label]-&gt;methodA)[stub-label]'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stub</span> <span class="pl-k">=</span> <span class="pl-smi">$staticHandle</span><span class="pl-k">-&gt;</span><span class="pl-smi">staticMethodA</span><span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>stub-label<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $stub is exported as 'stub#1(ClassA::staticMethodA)[stub-label]'</span></span></pre></div>
<h5>
<a id="exporting-spies" class="anchor" href="#exporting-spies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exporting spies</h5>
<p>When a <a href="#spies">spy</a> is exported, it is represented as a wrapper around the callable
entity that is spied on, with the <a href="#labeling-spies">label</a> also included in the
output:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy(<span class="pl-s"><span class="pl-pds">'</span>implode<span class="pl-pds">'</span></span>)<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>spy-label<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $spy is exported as 'spy#0(implode)[spy-label]'</span></span></pre></div>
<p>Anonymous spies have a simpler representation, since they don't wrap any
callable entity:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy()<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>spy-label<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $spy is exported as 'spy#0[spy-label]'</span></span></pre></div>
<p>In the case of method spies, class name information is also included:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$object</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">ClassA</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy([<span class="pl-smi">$object</span>, <span class="pl-s"><span class="pl-pds">'</span>methodA<span class="pl-pds">'</span></span>])<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>spy-label<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $spy is exported as 'spy#0(ClassA-&gt;methodA)[spy-label]'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$spy</span> <span class="pl-k">=</span> spy([<span class="pl-c1">ClassA</span><span class="pl-k">::</span><span class="pl-c1">class</span>, <span class="pl-s"><span class="pl-pds">'</span>staticMethodA<span class="pl-pds">'</span></span>])<span class="pl-k">-&gt;</span>setLabel(<span class="pl-s"><span class="pl-pds">'</span>spy-label<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $spy is exported as 'spy#1(ClassA::staticMethodA)[spy-label]'</span></span></pre></div>
<h3>
<a id="export-depth" class="anchor" href="#export-depth" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Export depth</h3>
<p>For complicated nested structures, exporting the entire value right down to its
innermost values is not always desirable. <em>Phony</em> sets a limit on how deep into
a nested structure the exporter will descend.</p>
<p>When a value is beyond the export depth, and has sub-values, its contents will
be replaced with a special notation that simply indicates how many sub-values
exist within that value:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [[], [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>]];</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $value is exported as '#0[#1[], #2[~3]]'</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> [(<span class="pl-k">object</span>) [], (<span class="pl-k">object</span>) [<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>]];</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> $value is exported as '#0[#0{}, #1{~3}]'</span></span></pre></div>
<h4>
<a id="setting-the-export-depth" class="anchor" href="#setting-the-export-depth" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setting the export depth</h4>
<p>To set the export depth, use <a href="#facade.setExportDepth"><code>setExportDepth()</code></a>:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1">setExportDepth(<span class="pl-smi">$depth</span>);        <span class="pl-c"><span class="pl-c">//</span> with `use function`</span></span>
<span class="pl-s1"><span class="pl-c1">Phony</span><span class="pl-k">::</span>setExportDepth(<span class="pl-smi">$depth</span>); <span class="pl-c"><span class="pl-c">//</span> without `use function`</span></span></pre></div>
<p>Where <code>$depth</code> is an integer indicating the desired export depth.</p>
<p>Negative values are treated as infinite depth, and will cause <em>Phony</em> to export
values in their entirety. Note that this can produce immense amounts of output
for large nested structures.</p>
<a name="api"></a>
<h2>
<a id="the-api" class="anchor" href="#the-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The API</h2>
<h3>
<a id="the-top-level-api" class="anchor" href="#the-top-level-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The top-level API</h3>
<p>This is the API presented by <em>Phony</em> once it is <a href="#importing">imported</a>. These may be
functions or static methods depending on the method of importing:</p>
<ul>
<li><a href="#facade.mock"><code>mock()</code></a></li>
<li><a href="#facade.partialMock"><code>partialMock()</code></a></li>
<li><a href="#facade.mockBuilder"><code>mockBuilder()</code></a></li>
<li><a href="#facade.on"><code>on()</code></a></li>
<li><a href="#facade.onStatic"><code>onStatic()</code></a></li>
<li><a href="#facade.stub"><code>stub()</code></a></li>
<li><a href="#facade.spy"><code>spy()</code></a></li>
<li><a href="#facade.stubGlobal"><code>stubGlobal()</code></a></li>
<li><a href="#facade.spyGlobal"><code>spyGlobal()</code></a></li>
<li><a href="#facade.restoreGlobalFunctions"><code>restoreGlobalFunctions()</code></a></li>
<li><a href="#facade.any"><code>any()</code></a></li>
<li><a href="#facade.equalTo"><code>equalTo()</code></a></li>
<li><a href="#facade.anInstanceOf"><code>anInstanceOf()</code></a></li>
<li><a href="#facade.wildcard"><code>wildcard()</code></a></li>
<li><a href="#facade.emptyValue"><code>emptyValue()</code></a></li>
<li><a href="#facade.inOrder"><code>inOrder()</code></a></li>
<li><a href="#facade.checkInOrder"><code>checkInOrder()</code></a></li>
<li><a href="#facade.anyOrder"><code>anyOrder()</code></a></li>
<li><a href="#facade.checkAnyOrder"><code>checkAnyOrder()</code></a></li>
<li><a href="#facade.setUseColor"><code>setUseColor()</code></a></li>
<li><a href="#facade.setExportDepth"><code>setExportDepth()</code></a></li>
</ul>
<a name="facade.mock"></a>
<hr>
<blockquote>
<p><em><a href="#the-mock-handle-api">handle</a></em> <a href="#facade.mock"><strong>mock</strong></a>($types = []) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-handle-api">handle</a></em> Phony::<a href="#facade.mock"><strong>mock</strong></a>($types = []) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Create a new <a href="#mocking-basics">full mock</a>, and return a <a href="#mock-handles">mock handle</a>.</p>
<p><em>Each value in <code>$types</code> can be either a class name, or an <a href="#ad-hoc-mocks">ad hoc mock</a>
definition. If only a single type is being mocked, the class name or definition
can be passed without being wrapped in an array.</em></p>
<p><em>See <a href="#mocking-basics">Mocking basics</a>.</em></p>
<a name="facade.partialMock"></a>
<hr>
<blockquote>
<p><em><a href="#the-mock-handle-api">handle</a></em> <a href="#facade.partialMock"><strong>partialMock</strong></a>($types = [], $arguments = []) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-handle-api">handle</a></em> Phony::<a href="#facade.partialMock"><strong>partialMock</strong></a>($types = [], $arguments = []) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Create a new <a href="#partial-mocks">partial mock</a>, and return a <a href="#mock-handles">mock handle</a>.</p>
<p><em>Each value in <code>$types</code> can be either a class name, or an <a href="#ad-hoc-mocks">ad hoc mock</a>
definition. If only a single type is being mocked, the class name or definition
can be passed without being wrapped in an array.</em></p>
<p><em>Omitting <code>$arguments</code> will cause the original constructor to be called with an
empty argument list. However, if a <code>null</code> value is supplied for <code>$arguments</code>,
the original constructor will not be called at all.</em></p>
<p><em>See <a href="#partial-mocks">Partial mocks</a>, <a href="#calling-a-constructor-manually">Calling a constructor manually</a>.</em></p>
<a name="facade.mockBuilder"></a>
<hr>
<blockquote>
<p><em><a href="#the-mock-builder-api">builder</a></em> <a href="#facade.mockBuilder"><strong>mockBuilder</strong></a>($types = []) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-builder-api">builder</a></em> Phony::<a href="#facade.mockBuilder"><strong>mockBuilder</strong></a>($types = []) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Create a new <a href="#mock-builders">mock builder</a>.</p>
<p><em>Each value in <code>$types</code> can be either a class name, or an <a href="#ad-hoc-mocks">ad hoc mock</a>
definition. If only a single type is being mocked, the class name or definition
can be passed without being wrapped in an array.</em></p>
<a name="facade.on"></a>
<hr>
<blockquote>
<p><em><a href="#the-mock-handle-api">handle</a></em> <a href="#facade.on"><strong>on</strong></a>($mock) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-handle-api">handle</a></em> Phony::<a href="#facade.on"><strong>on</strong></a>($mock) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Returns a <a href="#mock-handles">mock handle</a> for <code>$mock</code>.</p>
<a name="facade.onStatic"></a>
<hr>
<blockquote>
<p><em><a href="#the-mock-handle-api">handle</a></em> <a href="#facade.onStatic"><strong>onStatic</strong></a>($class) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-mock-handle-api">handle</a></em> Phony::<a href="#facade.onStatic"><strong>onStatic</strong></a>($class) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Returns a static <a href="#static-mocks">static handle</a> for <code>$class</code>.</p>
<p><em>See <a href="#static-mocks">Static mocks</a>.</em></p>
<a name="facade.stub"></a>
<hr>
<blockquote>
<p><em><a href="#the-stub-api">stub</a></em> <a href="#facade.stub"><strong>stub</strong></a>($callback = null) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-stub-api">stub</a></em> Phony::<a href="#facade.stub"><strong>stub</strong></a>($callback = null) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Create a new <a href="#stubs">stub</a>.</p>
<p><em>See <a href="#stubbing-an-existing-callable">Stubbing an existing callable</a>, <a href="#anonymous-stubs">Anonymous stubs</a>.</em></p>
<a name="facade.spy"></a>
<hr>
<blockquote>
<p><em><a href="#the-spy-api">spy</a></em> <a href="#facade.spy"><strong>spy</strong></a>($callback = null) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-spy-api">spy</a></em> Phony::<a href="#facade.spy"><strong>spy</strong></a>($callback = null) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Create a new <a href="#spies">spy</a>.</p>
<p><em>See <a href="#spying-on-an-existing-callable">Spying on an existing callable</a>, <a href="#anonymous-spies">Anonymous spies</a>.</em></p>
<a name="facade.stubGlobal"></a>
<hr>
<blockquote>
<p><em><a href="#the-stub-api">stub</a></em> <a href="#facade.stubGlobal"><strong>stubGlobal</strong></a>($function, $namespace) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-stub-api">stub</a></em> Phony::<a href="#facade.stubGlobal"><strong>stubGlobal</strong></a>($function, $namespace) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Create a stub of a function in the global namespace, and declare it as a
function in another namespace.</p>
<p><em>Stubs created via this function do not forward to the original function by
default. This differs from stubs created by other methods.</em></p>
<p><em>See <a href="#stubbing-global-functions">Stubbing global functions</a>.</em></p>
<a name="facade.spyGlobal"></a>
<hr>
<blockquote>
<p><em><a href="#the-spy-api">spy</a></em> <a href="#facade.spyGlobal"><strong>spyGlobal</strong></a>($function, $namespace) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-spy-api">spy</a></em> Phony::<a href="#facade.spyGlobal"><strong>spyGlobal</strong></a>($function, $namespace) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Create a spy of a function in the global namespace, and declare it as a function
in another namespace.</p>
<p><em>See <a href="#spying-on-global-functions">Spying on global functions</a>.</em></p>
<a name="facade.restoreGlobalFunctions"></a>
<hr>
<blockquote>
<p><em>void</em> <a href="#facade.restoreGlobalFunctions"><strong>restoreGlobalFunctions</strong></a>() <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em>void</em> Phony::<a href="#facade.restoreGlobalFunctions"><strong>restoreGlobalFunctions</strong></a>() <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Restores the behavior of any functions in the global namespace that have been
altered via <a href="#facade.spyGlobal"><code>spyGlobal()</code></a> or
<a href="#facade.stubGlobal"><code>stubGlobal()</code></a>.</p>
<p><em>See <a href="#spying-on-global-functions">Spying on global functions</a>, <a href="#stubbing-global-functions">Stubbing global functions</a>.</em></p>
<a name="facade.any"></a>
<hr>
<blockquote>
<p><em><a href="#the-matcher-api">matcher</a></em> <a href="#facade.any"><strong>any</strong></a>() <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-matcher-api">matcher</a></em> Phony::<a href="#facade.any"><strong>any</strong></a>() <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Create a new <a href="#the-any-matcher">"any" matcher</a>.</p>
<a name="facade.equalTo"></a>
<hr>
<blockquote>
<p><em><a href="#the-matcher-api">matcher</a></em> <a href="#facade.equalTo"><strong>equalTo</strong></a>($value) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-matcher-api">matcher</a></em> Phony::<a href="#facade.equalTo"><strong>equalTo</strong></a>($value) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Create a new <a href="#the-equal-to-matcher">"equal to" matcher</a>.</p>
<a name="facade.anInstanceOf"></a>
<hr>
<blockquote>
<p><em><a href="#the-matcher-api">matcher</a></em> <a href="#facade.anInstanceOf"><strong>anInstanceOf</strong></a>($type) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-matcher-api">matcher</a></em> Phony::<a href="#facade.anInstanceOf"><strong>anInstanceOf</strong></a>($type) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Create a new <a href="#the-instance-of-matcher">"instance of" matcher</a>.</p>
<p><em>The <code>$type</code> parameter accepts either a class name, an interface name, or an
object.</em></p>
<a name="facade.wildcard"></a>
<hr>
<blockquote>
<p><em><a href="#the-wildcard-matcher-api">wildcard</a></em> <a href="#facade.wildcard"><strong>wildcard</strong></a>($value = null, $minimumArguments = 0, $maximumArguments = -1) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-wildcard-matcher-api">wildcard</a></em> Phony::<a href="#facade.wildcard"><strong>wildcard</strong></a>($value = null, $minimumArguments = 0, $maximumArguments = -1) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Create a new <a href="#the-wildcard-matcher">"wildcard" matcher</a>.</p>
<p><em>The <code>$value</code> parameter accepts a value, or a <a href="#matchers">matcher</a>, to check against each
argument that the wildcard matches.</em></p>
<p><em>Negative values for <code>$maximumArguments</code> represent "no maximum".</em></p>
<a name="facade.emptyValue"></a>
<hr>
<blockquote>
<p><em>mixed</em> <a href="#facade.emptyValue"><strong>emptyValue</strong></a>($type) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em>mixed</em> Phony::<a href="#facade.emptyValue"><strong>emptyValue</strong></a>($type) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Create a new "empty" value.</p>
<p><em>The <code>$type</code> parameter accepts a <a href="http://php.net/reflectiontype">ReflectionType</a>, which can be created via
PHP's built-in <a href="http://php.net/reflection">reflection</a> API.</em></p>
<p><em>This table details the "empty" value that will be returned for each type:</em></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Empty value</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>no type, or nullable type</em></td>
<td><code>null</code></td>
</tr>
<tr>
<td><code>bool</code></td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>float</code></td>
<td><code>.0</code></td>
</tr>
<tr>
<td><code>string</code></td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>array</code></td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>iterable</code></td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>object</code></td>
<td><code>(object) []</code></td>
</tr>
<tr>
<td><code>stdClass</code></td>
<td><code>(object) []</code></td>
</tr>
<tr>
<td><code>callable</code></td>
<td><code>stub()</code></td>
</tr>
<tr>
<td><code>Closure</code></td>
<td><code>function () {}</code></td>
</tr>
<tr>
<td><code>Generator</code></td>
<td><code>(function () {return; yield;})()</code></td>
</tr>
<tr>
<td><code>ClassName</code></td>
<td><code>mock(ClassName::class)-&gt;get()</code></td>
</tr>
</tbody>
</table>
<a name="facade.inOrder"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> <a href="#facade.inOrder"><strong>inOrder</strong></a>(...$events) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em>
throws <a href="#assertionexception">AssertionException</a><br>
<em><a href="#the-verification-result-api">verification</a></em> Phony::<a href="#facade.inOrder"><strong>inOrder</strong></a>(...$events) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em>
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless the supplied events happened in chronological order.</p>
<p><em>Each value in <code>$events</code> should be an event, or a <a href="#the-verification-result-api">verification result</a>.</em></p>
<p><em>See <a href="#order-verification">Order verification</a>.</em></p>
<a name="facade.checkInOrder"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> <a href="#facade.checkInOrder"><strong>checkInOrder</strong></a>(...$events) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-verification-result-api">verification</a>|null</em> Phony::<a href="#facade.checkInOrder"><strong>checkInOrder</strong></a>(...$events) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Checks if the supplied events happened in chronological order.</p>
<p><em>Each value in <code>$events</code> should be an event, or a <a href="#the-verification-result-api">verification result</a>.</em></p>
<p><em>See <a href="#order-verification">Order verification</a>, <a href="#check-verification">Check verification</a>.</em></p>
<a name="facade.anyOrder"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> <a href="#facade.anyOrder"><strong>anyOrder</strong></a>(...$events) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em>
throws <a href="#assertionexception">AssertionException</a><br>
<em><a href="#the-verification-result-api">verification</a></em> Phony::<a href="#facade.anyOrder"><strong>anyOrder</strong></a>(...$events) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em>
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless at least one event is supplied.</p>
<p><em>Each value in <code>$events</code> should be an event, or a <a href="#the-verification-result-api">verification result</a>.</em></p>
<p><em>See <a href="#order-verification">Order verification</a>.</em></p>
<a name="facade.checkAnyOrder"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> <a href="#facade.checkAnyOrder"><strong>checkAnyOrder</strong></a>(...$events) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em><a href="#the-verification-result-api">verification</a>|null</em> Phony::<a href="#facade.checkAnyOrder"><strong>checkAnyOrder</strong></a>(...$events) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Checks that at least one event is supplied.</p>
<p><em>Each value in <code>$events</code> should be an event, or a <a href="#the-verification-result-api">verification result</a>.</em></p>
<p><em>See <a href="#order-verification">Order verification</a>, <a href="#check-verification">Check verification</a>.</em></p>
<a name="facade.setUseColor"></a>
<hr>
<blockquote>
<p><em>void</em> <a href="#facade.setUseColor"><strong>setUseColor</strong></a>($useColor) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em>void</em> Phony::<a href="#facade.setUseColor"><strong>setUseColor</strong></a>($useColor) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Turn on or off the use of <a href="https://en.wikipedia.org/wiki/ANSI_escape_code#Colors">ANSI colored output</a>.</p>
<p><em>Pass <code>null</code> to detect automatically.</em></p>
<p><em>See <a href="#using-colored-verification-output">Using colored verification output</a>.</em></p>
<a name="facade.setExportDepth"></a>
<hr>
<blockquote>
<p><em>int</em> <a href="#facade.setExportDepth"><strong>setExportDepth</strong></a>($depth) <em>(with <a href="http://php.net/language.namespaces.importing">use function</a>)</em><br>
<em>int</em> Phony::<a href="#facade.setExportDepth"><strong>setExportDepth</strong></a>($depth) <em>(without <a href="http://php.net/language.namespaces.importing">use function</a>)</em></p>
</blockquote>
<p>Set the default export depth, and return the previous depth.</p>
<p><em>Negative depths are treated as infinite depth.</em></p>
<p><em>See <a href="#setting-the-export-depth">Setting the export depth</a>.</em></p>
<h3>
<a id="the-mock-handle-api" class="anchor" href="#the-mock-handle-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The mock handle API</h3>
<p><a href="#mock-handles">Mock handles</a> implement the following methods:</p>
<ul>
<li><a href="#handle.get"><code>$handle-&gt;get()</code></a></li>
<li><a href="%60#handle.__get"><code>$handle-&gt;$method</code></a></li>
<li><a href="#handle.stub"><code>$handle-&gt;stub()</code></a></li>
<li><a href="#handle.label"><code>$handle-&gt;label()</code></a></li>
<li><a href="#handle.setLabel"><code>$handle-&gt;setLabel()</code></a></li>
<li><a href="#handle.construct"><code>$handle-&gt;construct()</code></a></li>
<li><a href="#handle.constructWith"><code>$handle-&gt;constructWith()</code></a></li>
<li><a href="#handle.clazz"><code>$handle-&gt;clazz()</code></a></li>
<li><a href="#handle.className"><code>$handle-&gt;className()</code></a></li>
<li><a href="#handle.full"><code>$handle-&gt;full()</code></a></li>
<li><a href="#handle.partial"><code>$handle-&gt;partial()</code></a></li>
<li><a href="#handle.proxy"><code>$handle-&gt;proxy()</code></a></li>
<li><a href="#handle.defaultAnswerCallback"><code>$handle-&gt;defaultAnswerCallback()</code></a></li>
<li><a href="#handle.setDefaultAnswerCallback"><code>$handle-&gt;setDefaultAnswerCallback()</code></a></li>
<li><a href="#handle.noInteraction"><code>$handle-&gt;noInteraction()</code></a></li>
<li><a href="#handle.checkNoInteraction"><code>$handle-&gt;checkNoInteraction()</code></a></li>
<li><a href="#handle.stopRecording"><code>$handle-&gt;stopRecording()</code></a></li>
<li><a href="#handle.startRecording"><code>$handle-&gt;startRecording()</code></a></li>
</ul>
<p>See also:</p>
<ul>
<li><a href="#facade.mock"><code>mock()</code></a></li>
<li><a href="#facade.partialMock"><code>partialMock()</code></a></li>
<li><a href="#facade.on"><code>on()</code></a></li>
<li><a href="#facade.onStatic"><code>onStatic()</code></a></li>
</ul>
<a name="handle.get"></a>
<hr>
<blockquote>
<p><em>mock</em> $handle-&gt;<a href="#handle.get"><strong>get</strong></a>()</p>
</blockquote>
<p>Get the <a href="#mocks">mock</a>.</p>
<p><em>This method is not available on <a href="#static-mocks">static mock handles</a>.</em></p>
<p><em>See <a href="#mocking-basics">Mocking basics</a>, <a href="#mock-handles">Mock handles</a>.</em></p>
<a name="handle.__get"></a>
<a name="handle.stub"></a>
<hr>
<blockquote>
<p>$handle-&gt;<a href="#handle.__get"><strong>$method</strong></a> or
<em><a href="#the-stub-api">stub</a></em> $handle-&gt;<a href="#handle.stub"><strong>stub</strong></a>($method, $isNewRule = true)</p>
</blockquote>
<p>Get the <a href="#stubs">stub</a> for <code>$method</code>.</p>
<p><em>If <code>false</code> is passed for <code>$isNewRule</code>, a new rule will not be started.</em></p>
<p><em>See <a href="#mocking-basics">Mocking basics</a>.</em></p>
<a name="handle.label"></a>
<hr>
<blockquote>
<p><em>string</em> $handle-&gt;<a href="#handle.label"><strong>label</strong></a>()</p>
</blockquote>
<p>Get the <a href="#labeling-mocks">label</a>.</p>
<p><em>This method is not available on <a href="#static-mocks">static mock handles</a>.</em></p>
<a name="handle.setLabel"></a>
<hr>
<blockquote>
<p><em>fluent</em> $handle-&gt;<a href="#handle.setLabel"><strong>setLabel</strong></a>($label)</p>
</blockquote>
<p>Set the <a href="#labeling-mocks">label</a>.</p>
<p><em>This method is not available on <a href="#static-mocks">static mock handles</a>.</em></p>
<a name="handle.construct"></a>
<hr>
<blockquote>
<p><em>fluent</em> $handle-&gt;<a href="#handle.construct"><strong>construct</strong></a>(...$arguments)</p>
</blockquote>
<p>Call the original constructor.</p>
<p><em>This method does not support reference parameters.</em></p>
<p><em>This method is not available on <a href="#static-mocks">static mock handles</a>.</em></p>
<p><em>See <a href="#calling-a-constructor-manually">Calling a constructor manually</a>.</em></p>
<a name="handle.constructWith"></a>
<hr>
<blockquote>
<p><em>fluent</em> $handle-&gt;<a href="#handle.constructWith"><strong>constructWith</strong></a>($arguments = [])</p>
</blockquote>
<p>Call the original constructor.</p>
<p><em>This method supports reference parameters.</em></p>
<p><em>This method is not available on <a href="#static-mocks">static mock handles</a>.</em></p>
<p><em>See <a href="#calling-a-constructor-manually">Calling a constructor manually</a>.</em></p>
<a name="handle.clazz"></a>
<hr>
<blockquote>
<p><em><a href="http://php.net/reflectionclass">ReflectionClass</a></em> $handle-&gt;<a href="#handle.clazz"><strong>clazz</strong></a>()</p>
</blockquote>
<p>Get the generated mock class.</p>
<a name="handle.className"></a>
<hr>
<blockquote>
<p><em>string</em> $handle-&gt;<a href="#handle.className"><strong>className</strong></a>()</p>
</blockquote>
<p>Get the class name of the generated mock class.</p>
<a name="handle.full"></a>
<hr>
<blockquote>
<p><em>fluent</em> $handle-&gt;<a href="#handle.full"><strong>full</strong></a>()</p>
</blockquote>
<p>Turn the mock into a <a href="#mocking-basics">full mock</a>.</p>
<a name="handle.partial"></a>
<hr>
<blockquote>
<p><em>fluent</em> $handle-&gt;<a href="#handle.partial"><strong>partial</strong></a>()</p>
</blockquote>
<p>Turn the mock into a <a href="#partial-mocks">partial mock</a>.</p>
<a name="handle.proxy"></a>
<hr>
<blockquote>
<p><em>fluent</em> $handle-&gt;<a href="#handle.proxy"><strong>proxy</strong></a>()</p>
</blockquote>
<p>Use the supplied object as the implementation for all methods of the mock.</p>
<p><em>This method may help when partial mocking of a particular implementation is not
possible; as in the case of a <code>final</code> class.</em></p>
<p><em>See <a href="#proxy-mocks">Proxy mocks</a>.</em></p>
<a name="handle.defaultAnswerCallback"></a>
<hr>
<blockquote>
<p><em>callable</em> $handle-&gt;<a href="#handle.defaultAnswerCallback"><strong>defaultAnswerCallback</strong></a>()</p>
</blockquote>
<p>Get the <a href="#the-default-answer-callback">default answer callback</a>.</p>
<a name="handle.setDefaultAnswerCallback"></a>
<hr>
<blockquote>
<p><em>fluent</em> $handle-&gt;<a href="#handle.setDefaultAnswerCallback"><strong>setDefaultAnswerCallback</strong></a>($callback)</p>
</blockquote>
<p>Set the <a href="#the-default-answer-callback">default answer callback</a> for all method stubs of this mock.</p>
<p><em>This method accepts a callback that takes the stub as the first argument.</em></p>
<a name="handle.noInteraction"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $handle-&gt;<a href="#handle.noInteraction"><strong>noInteraction</strong></a>()
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless there was no interaction with the mock.</p>
<p><em>See <a href="#verifying-that-there-was-no-interaction-with-a-mock">Verifying that there was no interaction with a mock</a>.</em></p>
<a name="handle.checkNoInteraction"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $handle-&gt;<a href="#handle.checkNoInteraction"><strong>checkNoInteraction</strong></a>()</p>
</blockquote>
<p>Checks if there was no interaction with the mock.</p>
<p><em>See <a href="#verifying-that-there-was-no-interaction-with-a-mock">Verifying that there was no interaction with a mock</a>,
<a href="#check-verification">Check verification</a>.</em></p>
<a name="handle.stopRecording"></a>
<hr>
<blockquote>
<p><em>fluent</em> $handle-&gt;<a href="#handle.stopRecording"><strong>stopRecording</strong></a>()</p>
</blockquote>
<p>Stop recording calls.</p>
<p><em>See <a href="#pausing-mock-recording">Pausing mock recording</a>.</em></p>
<a name="handle.startRecording"></a>
<hr>
<blockquote>
<p><em>fluent</em> $handle-&gt;<a href="#handle.startRecording"><strong>startRecording</strong></a>()</p>
</blockquote>
<p>Start recording calls.</p>
<p><em>See <a href="#pausing-mock-recording">Pausing mock recording</a>.</em></p>
<h3>
<a id="the-mock-builder-api" class="anchor" href="#the-mock-builder-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The mock builder API</h3>
<p><a href="#mock-builders">Mock builders</a> implement the following methods:</p>
<ul>
<li><a href="#builder.__clone"><code>clone $builder</code></a></li>
<li><a href="#builder.types"><code>$builder-&gt;types()</code></a></li>
<li><a href="#builder.like"><code>$builder-&gt;like()</code></a></li>
<li><a href="#builder.addMethod"><code>$builder-&gt;addMethod()</code></a></li>
<li><a href="#builder.addProperty"><code>$builder-&gt;addProperty()</code></a></li>
<li><a href="#builder.addStaticMethod"><code>$builder-&gt;addStaticMethod()</code></a></li>
<li><a href="#builder.addStaticProperty"><code>$builder-&gt;addStaticProperty()</code></a></li>
<li><a href="#builder.addConstant"><code>$builder-&gt;addConstant()</code></a></li>
<li><a href="#builder.named"><code>$builder-&gt;named()</code></a></li>
<li><a href="#builder.isFinalized"><code>$builder-&gt;isFinalized()</code></a></li>
<li><a href="#builder.finalize"><code>$builder-&gt;finalize()</code></a></li>
<li><a href="#builder.isBuilt"><code>$builder-&gt;isBuilt()</code></a></li>
<li><a href="#builder.build"><code>$builder-&gt;build()</code></a></li>
<li><a href="#builder.className"><code>$builder-&gt;className()</code></a></li>
<li><a href="#builder.get"><code>$builder-&gt;get()</code></a></li>
<li><a href="#builder.full"><code>$builder-&gt;full()</code></a></li>
<li><a href="#builder.partial"><code>$builder-&gt;partial()</code></a></li>
<li><a href="#builder.partialWith"><code>$builder-&gt;partialWith()</code></a></li>
</ul>
<p>See also:</p>
<ul>
<li><a href="#facade.mockBuilder"><code>mockBuilder()</code></a></li>
</ul>
<a name="builder.__clone"></a>
<hr>
<blockquote>
<p><em><a href="#the-mock-builder-api">builder</a></em> <a href="#builder.__clone"><strong>clone</strong></a> $builder</p>
</blockquote>
<p>Copy an existing mock builder.</p>
<p><em>See <a href="#copying-mock-builders">Copying mock builders</a>.</em></p>
<a name="builder.types"></a>
<hr>
<blockquote>
<p><em>array&lt;string,<a href="http://php.net/reflectionclass">ReflectionClass</a>&gt;</em> $builder-&gt;<a href="#builder.types"><strong>types</strong></a>()</p>
</blockquote>
<p>Get the types that will be mocked.</p>
<p><em>Returns a map of class name to class.</em></p>
<a name="builder.like"></a>
<hr>
<blockquote>
<p><em>fluent</em> $builder-&gt;<a href="#builder.like"><strong>like</strong></a>(...$types)</p>
</blockquote>
<p>Add classes, interfaces, or traits.</p>
<p><em>Each type value can be either a class name, or an <a href="#ad-hoc-mocks">ad hoc mock</a> definition.</em></p>
<p><em>See <a href="#customizing-the-mock-class">Customizing the mock class</a>.</em></p>
<a name="builder.addMethod"></a>
<hr>
<blockquote>
<p><em>fluent</em> $builder-&gt;<a href="#builder.addMethod"><strong>addMethod</strong></a>($name, $callback = null)</p>
</blockquote>
<p>Add a custom method.</p>
<p><em>See <a href="#customizing-the-mock-class">Customizing the mock class</a>.</em></p>
<a name="builder.addProperty"></a>
<hr>
<blockquote>
<p><em>fluent</em> $builder-&gt;<a href="#builder.addProperty"><strong>addProperty</strong></a>($name, $value = null)</p>
</blockquote>
<p>Add a custom property.</p>
<p><em>See <a href="#customizing-the-mock-class">Customizing the mock class</a>.</em></p>
<a name="builder.addStaticMethod"></a>
<hr>
<blockquote>
<p><em>fluent</em> $builder-&gt;<a href="#builder.addStaticMethod"><strong>addStaticMethod</strong></a>($name, $callback = null)</p>
</blockquote>
<p>Add a custom static method.</p>
<p><em>See <a href="#customizing-the-mock-class">Customizing the mock class</a>.</em></p>
<a name="builder.addStaticProperty"></a>
<hr>
<blockquote>
<p><em>fluent</em> $builder-&gt;<a href="#builder.addStaticProperty"><strong>addStaticProperty</strong></a>($name, $value = null)</p>
</blockquote>
<p>Add a custom static property.</p>
<p><em>See <a href="#customizing-the-mock-class">Customizing the mock class</a>.</em></p>
<a name="builder.addConstant"></a>
<hr>
<blockquote>
<p><em>fluent</em> $builder-&gt;<a href="#builder.addConstant"><strong>addConstant</strong></a>($name, $value = null)</p>
</blockquote>
<p>Add a custom class constant.</p>
<p><em>See <a href="#customizing-the-mock-class">Customizing the mock class</a>.</em></p>
<a name="builder.named"></a>
<hr>
<blockquote>
<p><em>fluent</em> $builder-&gt;<a href="#builder.named"><strong>named</strong></a>($className)</p>
</blockquote>
<p>Set the class name.</p>
<p><em>See <a href="#customizing-the-mock-class">Customizing the mock class</a>.</em></p>
<a name="builder.isFinalized"></a>
<hr>
<blockquote>
<p><em>bool</em> $builder-&gt;<a href="#builder.isFinalized"><strong>isFinalized</strong></a>()</p>
</blockquote>
<p>Returns <code>true</code> if this builder is finalized.</p>
<p><em>See <a href="#generating-mock-classes-from-a-builder">Generating mock classes from a builder</a>.</em></p>
<a name="builder.finalize"></a>
<hr>
<blockquote>
<p><em>fluent</em> $builder-&gt;<a href="#builder.finalize"><strong>finalize</strong></a>()</p>
</blockquote>
<p>Finalize the mock builder.</p>
<p><em>See <a href="#generating-mock-classes-from-a-builder">Generating mock classes from a builder</a>.</em></p>
<a name="builder.isBuilt"></a>
<hr>
<blockquote>
<p><em>bool</em> $builder-&gt;<a href="#builder.isBuilt"><strong>isBuilt</strong></a>()</p>
</blockquote>
<p>Returns <code>true</code> if the mock class has been built.</p>
<p><em>See <a href="#generating-mock-classes-from-a-builder">Generating mock classes from a builder</a>.</em></p>
<a name="builder.build"></a>
<hr>
<blockquote>
<p><em><a href="http://php.net/reflectionclass">ReflectionClass</a></em> $builder-&gt;<a href="#builder.build"><strong>build</strong></a>($createNew = false)</p>
</blockquote>
<p>Generate and define the mock class.</p>
<p><em>Calling this method will finalize the mock builder.</em></p>
<p><em>See <a href="#generating-mock-classes-from-a-builder">Generating mock classes from a builder</a>.</em></p>
<a name="builder.className"></a>
<hr>
<blockquote>
<p><em>string</em> $builder-&gt;<a href="#builder.className"><strong>className</strong></a>()</p>
</blockquote>
<p>Generate and define the mock class, and return the class name.</p>
<p><em>Calling this method will finalize the mock builder.</em></p>
<p><em>See <a href="#generating-mock-classes-from-a-builder">Generating mock classes from a builder</a>.</em></p>
<a name="builder.get"></a>
<hr>
<blockquote>
<p><em>mock</em> $builder-&gt;<a href="#builder.get"><strong>get</strong></a>()</p>
</blockquote>
<p>Get a mock.</p>
<p><em>This method will return the last created mock, only creating a new mock if no
existing mock is available.</em></p>
<p><em>If no existing mock is available, the created mock will be a full mock.</em></p>
<p><em>Calling this method will finalize the mock builder.</em></p>
<p><em>See <a href="#creating-mocks-from-a-builder">Creating mocks from a builder</a>.</em></p>
<a name="builder.full"></a>
<hr>
<blockquote>
<p><em>mock</em> $builder-&gt;<a href="#builder.full"><strong>full</strong></a>()</p>
</blockquote>
<p>Create a new <a href="#mocking-basics">full mock</a>.</p>
<p><em>This method will always create a new mock.</em></p>
<p><em>Calling this method will finalize the mock builder.</em></p>
<p><em>See <a href="#creating-mocks-from-a-builder">Creating mocks from a builder</a>.</em></p>
<a name="builder.partial"></a>
<hr>
<blockquote>
<p><em>mock</em> $builder-&gt;<a href="#builder.partial"><strong>partial</strong></a>(...$arguments)</p>
</blockquote>
<p>Create a new <a href="#partial-mocks">partial mock</a>.</p>
<p><em>The constructor will be called with <code>$arguments</code>.</em></p>
<p><em>This method will always create a new mock.</em></p>
<p><em>Calling this method will finalize the mock builder.</em></p>
<p><em>This method does not support reference parameters.</em></p>
<p><em>See <a href="#creating-mocks-from-a-builder">Creating mocks from a builder</a>.</em></p>
<a name="builder.partialWith"></a>
<hr>
<blockquote>
<p><em>mock</em> $builder-&gt;<a href="#builder.partialWith"><strong>partialWith</strong></a>($arguments = [])</p>
</blockquote>
<p>Create a new <a href="#partial-mocks">partial mock</a>.</p>
<p><em>The constructor will be called with <code>$arguments</code>, unless <code>$arguments</code> is
<code>null</code>, in which case the constructor will not be called at all.</em></p>
<p><em>This method will always create a new mock.</em></p>
<p><em>Calling this method will finalize the mock builder.</em></p>
<p><em>This method supports reference parameters.</em></p>
<p><em>See <a href="#creating-mocks-from-a-builder">Creating mocks from a builder</a>.</em></p>
<h3>
<a id="the-stub-api" class="anchor" href="#the-stub-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The stub API</h3>
<p>In addition to <a href="#the-spy-api">the spy API</a>, <a href="#stubs">stubs</a> implement the following methods:</p>
<ul>
<li><a href="#stub.self"><code>$stub-&gt;self()</code></a></li>
<li><a href="#stub.setSelf"><code>$stub-&gt;setSelf()</code></a></li>
<li><a href="#stub.defaultAnswerCallback"><code>$stub-&gt;defaultAnswerCallback()</code></a></li>
<li><a href="#stub.setDefaultAnswerCallback"><code>$stub-&gt;setDefaultAnswerCallback()</code></a></li>
<li><a href="#stub.with"><code>$stub-&gt;with()</code></a></li>
<li><a href="#stub.calls"><code>$stub-&gt;calls()</code></a></li>
<li><a href="#stub.callsWith"><code>$stub-&gt;callsWith()</code></a></li>
<li><a href="#stub.callsArgument"><code>$stub-&gt;callsArgument()</code></a></li>
<li><a href="#stub.callsArgumentWith"><code>$stub-&gt;callsArgumentWith()</code></a></li>
<li><a href="#stub.setsArgument"><code>$stub-&gt;setsArgument()</code></a></li>
<li><a href="#stub.does"><code>$stub-&gt;does()</code></a></li>
<li><a href="#stub.doesWith"><code>$stub-&gt;doesWith()</code></a></li>
<li><a href="#stub.forwards"><code>$stub-&gt;forwards()</code></a></li>
<li><a href="#stub.returns"><code>$stub-&gt;returns()</code></a></li>
<li><a href="#stub.returnsArgument"><code>$stub-&gt;returnsArgument()</code></a></li>
<li><a href="#stub.returnsSelf"><code>$stub-&gt;returnsSelf()</code></a></li>
<li><a href="#stub.throws"><code>$stub-&gt;throws()</code></a></li>
<li><a href="#stub.generates"><code>$stub-&gt;generates()</code></a></li>
</ul>
<p>See also:</p>
<ul>
<li><a href="#facade.stub"><code>stub()</code></a></li>
<li><a href="#facade.stubGlobal"><code>stubGlobal()</code></a></li>
<li><a href="#handle.__get"><code>$handle-&gt;$method</code></a></li>
<li><a href="#handle.stub"><code>$handle-&gt;stub()</code></a></li>
</ul>
<a name="stub.self"></a>
<hr>
<blockquote>
<p><em>mixed</em> $stub-&gt;<a href="#stub.self"><strong>self</strong></a>()</p>
</blockquote>
<p>Get the <a href="#stub-self-values">self value</a> of this stub.</p>
<a name="stub.setSelf"></a>
<hr>
<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.setSelf"><strong>setSelf</strong></a>($self)</p>
</blockquote>
<p>Set the <a href="#stub-self-values">self value</a> of this stub.</p>
<a name="stub.defaultAnswerCallback"></a>
<hr>
<blockquote>
<p><em>callable</em> $stub-&gt;<a href="#stub.defaultAnswerCallback"><strong>defaultAnswerCallback</strong></a>()</p>
</blockquote>
<p>Get the <a href="#the-default-answer-callback">default answer callback</a>.</p>
<a name="stub.setDefaultAnswerCallback"></a>
<hr>
<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.setDefaultAnswerCallback"><strong>setDefaultAnswerCallback</strong></a>($callback)</p>
</blockquote>
<p>Set the <a href="#the-default-answer-callback">default answer callback</a> of this stub.</p>
<p><em>This method accepts a callback that takes the stub as the first argument.</em></p>
<a name="stub.with"></a>
<hr>
<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.with"><strong>with</strong></a>(...$arguments)</p>
</blockquote>
<p>Modify the current criteria to match the supplied arguments.</p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#matching-stub-arguments">Matching stub arguments</a>.</em></p>
<a name="stub.calls"></a>
<hr>
<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.calls"><strong>calls</strong></a>(...$callbacks)</p>
</blockquote>
<p>Add callbacks to be called as part of an answer.</p>
<p><em>Note that all supplied callbacks will be called in the same invocation.</em></p>
<p><em>See <a href="#invoking-callables">Invoking callables</a>.</em></p>
<a name="stub.callsWith"></a>
<hr>
<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.callsWith"><strong>callsWith</strong></a>($callback, $arguments = [], $prefixSelf = false, $suffixArgumentsObject = false, $suffixArguments = true)</p>
</blockquote>
<p>Add a callback to be called as part of an answer.</p>
<p><em>Note that all supplied callbacks will be called in the same invocation.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>
<p><em>See <a href="#invoking-callables">Invoking callables</a>.</em></p>
<a name="stub.callsArgument"></a>
<hr>
<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.callsArgument"><strong>callsArgument</strong></a>(...$indices)</p>
</blockquote>
<p>Add argument callbacks to be called as part of an answer.</p>
<p><em>Calling this method with no arguments is equivalent to calling it with a single
argument of <code>0</code>.</em></p>
<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>
<p><em>Note that all supplied callbacks will be called in the same invocation.</em></p>
<p><em>See <a href="#invoking-arguments">Invoking arguments</a>.</em></p>
<a name="stub.callsArgumentWith"></a>
<hr>
<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.callsArgumentWith"><strong>callsArgumentWith</strong></a>($index = 0, $arguments = [], $prefixSelf = false, $suffixArgumentsObject = false, $suffixArguments = true)</p>
</blockquote>
<p>Add an argument callback to be called as part of an answer.</p>
<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>
<p><em>This method supports reference parameters.</em></p>
<p><em>Note that all supplied callbacks will be called in the same invocation.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>
<p><em>See <a href="#invoking-arguments">Invoking arguments</a>.</em></p>
<a name="stub.setsArgument"></a>
<hr>
<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.setsArgument"><strong>setsArgument</strong></a>($indexOrValue = null, $value = null)</p>
</blockquote>
<p>Set the value of an argument passed by reference as part of an answer.</p>
<p><em>If called with no arguments, sets the first argument to <code>null</code>.</em></p>
<p><em>If called with one argument, sets the first argument to <code>$indexOrValue</code>.</em></p>
<p><em>If called with two arguments, sets the argument at <code>$indexOrValue</code> to
<code>$value</code>.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>
<p><em>See <a href="#setting-passed-by-reference-arguments">Setting passed-by-reference arguments</a>.</em></p>
<a name="stub.does"></a>
<hr>
<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.does"><strong>does</strong></a>(...$callbacks)</p>
</blockquote>
<p>Add callbacks as answers.</p>
<p><em>See <a href="#using-a-callable-as-an-answer">Using a callable as an answer</a>.</em></p>
<a name="stub.doesWith"></a>
<hr>
<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.doesWith"><strong>doesWith</strong></a>($callback, $arguments = [], $prefixSelf = false, $suffixArgumentsObject = false, $suffixArguments = true)</p>
</blockquote>
<p>Add a callback as an answer.</p>
<p><em>The supplied arguments support reference parameters.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>
<p><em>See <a href="#using-a-callable-as-an-answer">Using a callable as an answer</a>.</em></p>
<a name="stub.forwards"></a>
<hr>
<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.forwards"><strong>forwards</strong></a>($arguments = [], $prefixSelf = false, $suffixArgumentsObject = false, $suffixArguments = true)</p>
</blockquote>
<p>Add an answer that calls the wrapped callback.</p>
<p><em>The supplied arguments support reference parameters.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>
<p><em>See <a href="#forwarding-to-the-original-callable">Forwarding to the original callable</a>.</em></p>
<a name="stub.returns"></a>
<hr>
<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.returns"><strong>returns</strong></a>(...$values)</p>
</blockquote>
<p>Add answers that return values.</p>
<p><em>Calling this method with no arguments is equivalent to calling it with a single
argument of <code>null</code>.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>
<p><em>See <a href="#returning-values">Returning values</a>.</em></p>
<a name="stub.returnsArgument"></a>
<hr>
<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.returnsArgument"><strong>returnsArgument</strong></a>($index = 0)</p>
</blockquote>
<p>Add an answer that returns an argument.</p>
<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>
<p><em>See <a href="#returning-arguments">Returning arguments</a>.</em></p>
<a name="stub.returnsSelf"></a>
<hr>
<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.returnsSelf"><strong>returnsSelf</strong></a>()</p>
</blockquote>
<p>Add an answer that returns the self value.</p>
<p><em>See <a href="#returning-the-self-value">Returning the "self" value</a>, <a href="#stub-self-values">Stub "self" values</a>.</em></p>
<a name="stub.throws"></a>
<hr>
<blockquote>
<p><em>fluent</em> $stub-&gt;<a href="#stub.throws"><strong>throws</strong></a>(...$exceptions)</p>
</blockquote>
<p>Add answers that throw exceptions.</p>
<p><em>Calling this method with no arguments is equivalent to calling it with a single
argument of <code>null</code>.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>
<p><em>See <a href="#throwing-exceptions">Throwing exceptions</a>.</em></p>
<a name="stub.generates"></a>
<hr>
<blockquote>
<p><em><a href="#the-generator-answer-api">generator-answer</a></em> $stub-&gt;<a href="#stub.generates"><strong>generates</strong></a>($values = [])</p>
</blockquote>
<p>Add an answer that returns a generator, and return the answer for further
behavior customization.</p>
<p><em>Any supplied <code>$values</code> will be yielded from the resulting generator.</em></p>
<p><em>See <a href="#stubbing-generators">Stubbing generators</a>, <a href="#yielding-from-a-generator">Yielding from a generator</a>.</em></p>
<h3>
<a id="the-generator-answer-api" class="anchor" href="#the-generator-answer-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The generator answer API</h3>
<p>When <a href="#stubbing-generators">stubbing generators</a>, calls to <a href="#stub.generates"><code>generates()</code></a> produce
"generator answers", which implement the following methods:</p>
<ul>
<li><a href="#generatorAnswer.calls"><code>$generatorAnswer-&gt;calls()</code></a></li>
<li><a href="#generatorAnswer.callsWith"><code>$generatorAnswer-&gt;callsWith()</code></a></li>
<li><a href="#generatorAnswer.callsArgument"><code>$generatorAnswer-&gt;callsArgument()</code></a></li>
<li><a href="#generatorAnswer.callsArgumentWith"><code>$generatorAnswer-&gt;callsArgumentWith()</code></a></li>
<li><a href="#generatorAnswer.setsArgument"><code>$generatorAnswer-&gt;setsArgument()</code></a></li>
<li><a href="#generatorAnswer.yields"><code>$generatorAnswer-&gt;yields()</code></a></li>
<li><a href="#generatorAnswer.yieldsFrom"><code>$generatorAnswer-&gt;yieldsFrom()</code></a></li>
<li><a href="#generatorAnswer.returns"><code>$generatorAnswer-&gt;returns()</code></a></li>
<li><a href="#generatorAnswer.returnsArgument"><code>$generatorAnswer-&gt;returnsArgument()</code></a></li>
<li><a href="#generatorAnswer.returnsSelf"><code>$generatorAnswer-&gt;returnsSelf()</code></a></li>
<li><a href="#generatorAnswer.throws"><code>$generatorAnswer-&gt;throws()</code></a></li>
</ul>
<p>See also:</p>
<ul>
<li><a href="#stub.generates"><code>$stub-&gt;generates()</code></a></li>
</ul>
<a name="generatorAnswer.calls"></a>
<hr>
<blockquote>
<p><em>fluent</em> $generatorAnswer-&gt;<a href="#generatorAnswer.calls"><strong>calls</strong></a>(...$callbacks)</p>
</blockquote>
<p>Add callbacks to be called as part of the answer.</p>
<p><em>See <a href="#invoking-callables-in-a-generator">Invoking callables in a generator</a>.</em></p>
<a name="generatorAnswer.callsWith"></a>
<hr>
<blockquote>
<p><em>fluent</em> $generatorAnswer-&gt;<a href="#generatorAnswer.callsWith"><strong>callsWith</strong></a>($callback, $arguments = [], $prefixSelf = false, $suffixArgumentsObject = false, $suffixArguments = true)</p>
</blockquote>
<p>Add callbacks to be called as part of the answer.</p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>
<p><em>See <a href="#invoking-callables-in-a-generator">Invoking callables in a generator</a>.</em></p>
<a name="generatorAnswer.callsArgument"></a>
<hr>
<blockquote>
<p><em>fluent</em> $generatorAnswer-&gt;<a href="#generatorAnswer.callsArgument"><strong>callsArgument</strong></a>(...$indices)</p>
</blockquote>
<p>Add argument callbacks to be called as part of the answer.</p>
<p><em>Calling this method with no arguments is equivalent to calling it with a single
argument of <code>0</code>.</em></p>
<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>
<p><em>See <a href="#invoking-arguments-in-a-generator">Invoking arguments in a generator</a>.</em></p>
<a name="generatorAnswer.callsArgumentWith"></a>
<hr>
<blockquote>
<p><em>fluent</em> $generatorAnswer-&gt;<a href="#generatorAnswer.callsArgumentWith"><strong>callsArgumentWith</strong></a>($index = 0, $arguments = [], $prefixSelf = false, $suffixArgumentsObject = false, $suffixArguments = true)</p>
</blockquote>
<p>Add an argument callback to be called as part of the answer.</p>
<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>
<p><em>This method supports reference parameters.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>
<p><em>See <a href="#invoking-arguments-in-a-generator">Invoking arguments in a generator</a>.</em></p>
<a name="generatorAnswer.setsArgument"></a>
<hr>
<blockquote>
<p><em>fluent</em> $generatorAnswer-&gt;<a href="#generatorAnswer.setsArgument"><strong>setsArgument</strong></a>($indexOrValue = null, $value = null)</p>
</blockquote>
<p>Set the value of an argument passed by reference as part of the answer.</p>
<p><em>If called with no arguments, sets the first argument to <code>null</code>.</em></p>
<p><em>If called with one argument, sets the first argument to <code>$indexOrValue</code>.</em></p>
<p><em>If called with two arguments, sets the argument at <code>$indexOrValue</code> to
<code>$value</code>.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> of the value.</em></p>
<p><em>See <a href="#setting-passed-by-reference-arguments-in-a-generator">Setting passed-by-reference arguments in a generator</a>.</em></p>
<a name="generatorAnswer.yields"></a>
<hr>
<blockquote>
<p><em>fluent</em> $generatorAnswer-&gt;<a href="#generatorAnswer.yields"><strong>yields</strong></a>($keyOrValue = null, $value = null)</p>
</blockquote>
<p>Add a yielded value to the answer.</p>
<p><em>If both <code>$keyOrValue</code> and <code>$value</code> are supplied, the stub will yield like
<code>yield $keyOrValue =&gt; $value;</code>.</em></p>
<p><em>If only <code>$keyOrValue</code> is supplied, the stub will yield like
<code>yield $keyOrValue;</code>.</em></p>
<p><em>If no arguments are supplied, the stub will yield like <code>yield;</code>.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>
<p><em>See <a href="#yielding-individual-values-from-a-generator">Yielding individual values from a generator</a>.</em></p>
<a name="generatorAnswer.yieldsFrom"></a>
<hr>
<blockquote>
<p><em>fluent</em> $generatorAnswer-&gt;<a href="#generatorAnswer.yieldsFrom"><strong>yieldsFrom</strong></a>($values)</p>
</blockquote>
<p>Add a set of yielded values to the answer.</p>
<p><em>The <code>$values</code> argument can be an array, an iterator, or even another
generator.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>
<p><em>See <a href="#yielding-multiple-values-from-a-generator">Yielding multiple values from a generator</a>.</em></p>
<a name="generatorAnswer.returns"></a>
<hr>
<blockquote>
<p><em><a href="#the-stub-api">stub</a></em> $generatorAnswer-&gt;<a href="#generatorAnswer.returns"><strong>returns</strong></a>(...$values)</p>
</blockquote>
<p>End the generator by returning a value.</p>
<p><em>Calling this method with no arguments is equivalent to calling it with a single
argument of <code>null</code>.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>
<p><em>See <a href="#returning-values-from-a-generator">Returning values from a generator</a>.</em></p>
<a name="generatorAnswer.returnsArgument"></a>
<hr>
<blockquote>
<p><em><a href="#the-stub-api">stub</a></em> $generatorAnswer-&gt;<a href="#generatorAnswer.returnsArgument"><strong>returnsArgument</strong></a>($index = 0)</p>
</blockquote>
<p>End the generator by returning an argument.</p>
<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>
<p><em>See <a href="#returning-arguments-from-a-generator">Returning arguments from a generator</a>.</em></p>
<a name="generatorAnswer.returnsSelf"></a>
<hr>
<blockquote>
<p><em><a href="#the-stub-api">stub</a></em> $generatorAnswer-&gt;<a href="#generatorAnswer.returnsSelf"><strong>returnsSelf</strong></a>()</p>
</blockquote>
<p>End the generator by returning the self value.</p>
<p><em>See <a href="#returning-the-self-value-from-a-generator">Returning the "self" value from a generator</a>, <a href="#stub-self-values">Stub "self" values</a>.</em></p>
<a name="generatorAnswer.throws"></a>
<hr>
<blockquote>
<p><em><a href="#the-stub-api">stub</a></em> $generatorAnswer-&gt;<a href="#generatorAnswer.throws"><strong>throws</strong></a>(...$exceptions)</p>
</blockquote>
<p>End the generator by throwing an exception.</p>
<p><em>Calling this method with no arguments is equivalent to calling it with a single
argument of <code>null</code>.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a>.</em></p>
<p><em>See <a href="#throwing-exceptions-from-a-generator">Throwing exceptions from a generator</a>.</em></p>
<h3>
<a id="the-spy-api" class="anchor" href="#the-spy-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The spy API</h3>
<p>Both <a href="#spies">spies</a> and <a href="#stubs">stubs</a> implement the following methods:</p>
<ul>
<li><a href="#spy.__invoke"><code>$spy()</code></a></li>
<li><a href="#spy.invoke"><code>$spy-&gt;invoke()</code></a></li>
<li><a href="#spy.invokeWith"><code>$spy-&gt;invokeWith()</code></a></li>
<li><a href="#spy.label"><code>$spy-&gt;label()</code></a></li>
<li><a href="#spy.setLabel"><code>$spy-&gt;setLabel()</code></a></li>
<li><a href="#spy.useGeneratorSpies"><code>$spy-&gt;useGeneratorSpies()</code></a></li>
<li><a href="#spy.setUseGeneratorSpies"><code>$spy-&gt;setUseGeneratorSpies()</code></a></li>
<li><a href="#spy.useIterableSpies"><code>$spy-&gt;useIterableSpies()</code></a></li>
<li><a href="#spy.setUseIterableSpies"><code>$spy-&gt;setUseIterableSpies()</code></a></li>
<li><a href="#spy.stopRecording"><code>$spy-&gt;stopRecording()</code></a></li>
<li><a href="#spy.startRecording"><code>$spy-&gt;startRecording()</code></a></li>
<li><a href="#spy.hasCalls"><code>$spy-&gt;hasCalls()</code></a></li>
<li><a href="#spy.callCount"><code>$spy-&gt;callCount()</code></a></li>
<li><a href="#spy.allCalls"><code>$spy-&gt;allCalls()</code></a></li>
<li><a href="#spy.firstCall"><code>$spy-&gt;firstCall()</code></a></li>
<li><a href="#spy.lastCall"><code>$spy-&gt;lastCall()</code></a></li>
<li><a href="#spy.callAt"><code>$spy-&gt;callAt()</code></a></li>
<li><a href="#spy.hasEvents"><code>$spy-&gt;hasEvents()</code></a></li>
<li><a href="#spy.eventCount"><code>$spy-&gt;eventCount()</code></a></li>
<li><a href="#spy.allEvents"><code>$spy-&gt;allEvents()</code></a></li>
<li><a href="#spy.firstEvent"><code>$spy-&gt;firstEvent()</code></a></li>
<li><a href="#spy.lastEvent"><code>$spy-&gt;lastEvent()</code></a></li>
<li><a href="#spy.eventAt"><code>$spy-&gt;eventAt()</code></a></li>
<li><a href="#spy.called"><code>$spy-&gt;called()</code></a></li>
<li><a href="#spy.checkCalled"><code>$spy-&gt;checkCalled()</code></a></li>
<li><a href="#spy.calledWith"><code>$spy-&gt;calledWith()</code></a></li>
<li><a href="#spy.checkCalledWith"><code>$spy-&gt;checkCalledWith()</code></a></li>
<li><a href="#spy.returned"><code>$spy-&gt;returned()</code></a></li>
<li><a href="#spy.checkReturned"><code>$spy-&gt;checkReturned()</code></a></li>
<li><a href="#spy.threw"><code>$spy-&gt;threw()</code></a></li>
<li><a href="#spy.checkThrew"><code>$spy-&gt;checkThrew()</code></a></li>
<li><a href="#spy.responded"><code>$spy-&gt;responded()</code></a></li>
<li><a href="#spy.checkResponded"><code>$spy-&gt;checkResponded()</code></a></li>
<li><a href="#spy.completed"><code>$spy-&gt;completed()</code></a></li>
<li><a href="#spy.checkCompleted"><code>$spy-&gt;checkCompleted()</code></a></li>
<li><a href="#spy.generated"><code>$spy-&gt;generated()</code></a></li>
<li><a href="#spy.checkGenerated"><code>$spy-&gt;checkGenerated()</code></a></li>
<li><a href="#spy.iterated"><code>$spy-&gt;iterated()</code></a></li>
<li><a href="#spy.checkIterated"><code>$spy-&gt;checkIterated()</code></a></li>
<li><a href="#spy.never"><code>$spy-&gt;never()</code></a></li>
<li><a href="#spy.once"><code>$spy-&gt;once()</code></a></li>
<li><a href="#spy.twice"><code>$spy-&gt;twice()</code></a></li>
<li><a href="#spy.thrice"><code>$spy-&gt;thrice()</code></a></li>
<li><a href="#spy.times"><code>$spy-&gt;times()</code></a></li>
<li><a href="#spy.atLeast"><code>$spy-&gt;atLeast()</code></a></li>
<li><a href="#spy.atMost"><code>$spy-&gt;atMost()</code></a></li>
<li><a href="#spy.between"><code>$spy-&gt;between()</code></a></li>
<li><a href="#spy.always"><code>$spy-&gt;always()</code></a></li>
</ul>
<p>See also:</p>
<ul>
<li><a href="#facade.stub"><code>stub()</code></a></li>
<li><a href="#facade.spy"><code>spy()</code></a></li>
</ul>
<a name="spy.__invoke"></a>
<a name="spy.invoke"></a>
<hr>
<blockquote>
<p><a href="#spy.__invoke"><strong>$spy(...$arguments)</strong></a> or
<em>mixed</em> $spy-&gt;<a href="#spy.invoke"><strong>invoke</strong></a>(...$arguments)
throws <a href="http://php.net/class.exception">Exception</a>, <a href="http://php.net/class.error">Error</a></p>
</blockquote>
<p>Invoke the spy, record the call, and return or throw the result.</p>
<p><em>This method does not support reference parameters.</em></p>
<p><em>See <a href="#invoking-spies">Invoking spies</a>.</em></p>
<a name="spy.invokeWith"></a>
<hr>
<blockquote>
<p><em>mixed</em> $spy-&gt;<a href="#spy.invokeWith"><strong>invokeWith</strong></a>($arguments)
throws <a href="http://php.net/class.exception">Exception</a>, <a href="http://php.net/class.error">Error</a></p>
</blockquote>
<p>Invoke the spy, record the call, and return or throw the result.</p>
<p><em>This method supports reference parameters.</em></p>
<p><em>See <a href="#invoking-spies">Invoking spies</a>.</em></p>
<a name="spy.label"></a>
<hr>
<blockquote>
<p><em>string</em> $spy-&gt;<a href="#spy.label"><strong>label</strong></a>()</p>
</blockquote>
<p>Get the <a href="#labeling-spies">label</a>.</p>
<a name="spy.setLabel"></a>
<hr>
<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.setLabel"><strong>setLabel</strong></a>($label)</p>
</blockquote>
<p>Set the <a href="#labeling-spies">label</a>.</p>
<a name="spy.useGeneratorSpies"></a>
<hr>
<blockquote>
<p><em>bool</em> $spy-&gt;<a href="#spy.useGeneratorSpies"><strong>useGeneratorSpies</strong></a>()</p>
</blockquote>
<p>Returns <code>true</code> if this spy uses <a href="#generator-and-iterable-verification">generator spies</a>.</p>
<a name="spy.setUseGeneratorSpies"></a>
<hr>
<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.setUseGeneratorSpies"><strong>setUseGeneratorSpies</strong></a>($useGeneratorSpies)</p>
</blockquote>
<p>Turn on or off the use of <a href="#generator-and-iterable-verification">generator spies</a>.</p>
<a name="spy.useIterableSpies"></a>
<hr>
<blockquote>
<p><em>bool</em> $spy-&gt;<a href="#spy.useIterableSpies"><strong>useIterableSpies</strong></a>()</p>
</blockquote>
<p>Returns <code>true</code> if this spy uses <a href="#generator-and-iterable-verification">iterable spies</a>.</p>
<a name="spy.setUseIterableSpies"></a>
<hr>
<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.setUseIterableSpies"><strong>setUseIterableSpies</strong></a>($useIterableSpies)</p>
</blockquote>
<p>Turn on or off the use of <a href="#generator-and-iterable-verification">iterable spies</a>.</p>
<a name="spy.stopRecording"></a>
<hr>
<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.stopRecording"><strong>stopRecording</strong></a>()</p>
</blockquote>
<p>Stop recording calls.</p>
<p><em>See <a href="#pausing-spy-recording">Pausing spy recording</a>.</em></p>
<a name="spy.startRecording"></a>
<hr>
<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.startRecording"><strong>startRecording</strong></a>()</p>
</blockquote>
<p>Start recording calls.</p>
<p><em>See <a href="#pausing-spy-recording">Pausing spy recording</a>.</em></p>
<a name="spy.hasCalls"></a>
<hr>
<blockquote>
<p><em>bool</em> $spy-&gt;<a href="#spy.hasCalls"><strong>hasCalls</strong></a>()</p>
</blockquote>
<p>Returns <code>true</code> if any calls were recorded.</p>
<p><em>See <a href="#call-verification">Call verification</a>.</em></p>
<a name="spy.callCount"></a>
<hr>
<blockquote>
<p><em>int</em> $spy-&gt;<a href="#spy.callCount"><strong>callCount</strong></a>()</p>
</blockquote>
<p>Get the number of calls.</p>
<p><em>See <a href="#call-count">Call count</a>.</em></p>
<a name="spy.allCalls"></a>
<hr>
<blockquote>
<p><em>array&lt;<a href="#the-call-api">call</a>&gt;</em> $spy-&gt;<a href="#spy.allCalls"><strong>allCalls</strong></a>()</p>
</blockquote>
<p>Get all calls as an array.</p>
<p><em>See <a href="#call-verification">Call verification</a>.</em></p>
<a name="spy.firstCall"></a>
<hr>
<blockquote>
<p><em><a href="#the-call-api">call</a></em> $spy-&gt;<a href="#spy.firstCall"><strong>firstCall</strong></a>()
throws <a href="#undefinedcallexception">UndefinedCallException</a></p>
</blockquote>
<p>Get the first call.</p>
<p><em>See <a href="#individual-calls">Individual calls</a>.</em></p>
<a name="spy.lastCall"></a>
<hr>
<blockquote>
<p><em><a href="#the-call-api">call</a></em> $spy-&gt;<a href="#spy.lastCall"><strong>lastCall</strong></a>()
throws <a href="#undefinedcallexception">UndefinedCallException</a></p>
</blockquote>
<p>Get the last call.</p>
<p><em>See <a href="#individual-calls">Individual calls</a>.</em></p>
<a name="spy.callAt"></a>
<hr>
<blockquote>
<p><em><a href="#the-call-api">call</a></em> $spy-&gt;<a href="#spy.callAt"><strong>callAt</strong></a>($index = 0)
throws <a href="#undefinedcallexception">UndefinedCallException</a></p>
</blockquote>
<p>Get the call at <code>$index</code>.</p>
<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>
<p><em>See <a href="#individual-calls">Individual calls</a>.</em></p>
<a name="spy.hasEvents"></a>
<hr>
<blockquote>
<p><em>bool</em> $spy-&gt;<a href="#spy.hasEvents"><strong>hasEvents</strong></a>()</p>
</blockquote>
<p>Returns <code>true</code> if any events were recorded.</p>
<p><em>See <a href="#similar-events-in-order-verification">Similar events in order verification</a>.</em></p>
<a name="spy.eventCount"></a>
<hr>
<blockquote>
<p><em>int</em> $spy-&gt;<a href="#spy.eventCount"><strong>eventCount</strong></a>()</p>
</blockquote>
<p>Get the number of events.</p>
<p><em>See <a href="#similar-events-in-order-verification">Similar events in order verification</a>.</em></p>
<a name="spy.allEvents"></a>
<hr>
<blockquote>
<p><em>array&lt;<a href="#the-event-api">event</a>&gt;</em> $spy-&gt;<a href="#spy.allEvents"><strong>allEvents</strong></a>()</p>
</blockquote>
<p>Get all events as an array.</p>
<p><em>See <a href="#similar-events-in-order-verification">Similar events in order verification</a>.</em></p>
<a name="spy.firstEvent"></a>
<hr>
<blockquote>
<p><em><a href="#the-event-api">event</a></em> $spy-&gt;<a href="#spy.firstEvent"><strong>firstEvent</strong></a>()
throws <a href="#undefinedeventexception">UndefinedEventException</a></p>
</blockquote>
<p>Get the first event.</p>
<p><em>See <a href="#similar-events-in-order-verification">Similar events in order verification</a>.</em></p>
<a name="spy.lastEvent"></a>
<hr>
<blockquote>
<p><em><a href="#the-event-api">event</a></em> $spy-&gt;<a href="#spy.lastEvent"><strong>lastEvent</strong></a>()
throws <a href="#undefinedeventexception">UndefinedEventException</a></p>
</blockquote>
<p>Get the last event.</p>
<p><em>See <a href="#similar-events-in-order-verification">Similar events in order verification</a>.</em></p>
<a name="spy.eventAt"></a>
<hr>
<blockquote>
<p><em><a href="#the-event-api">event</a></em> $spy-&gt;<a href="#spy.eventAt"><strong>eventAt</strong></a>($index = 0)
throws <a href="#undefinedeventexception">UndefinedEventException</a></p>
</blockquote>
<p>Get the event at <code>$index</code>.</p>
<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>
<p><em>See <a href="#similar-events-in-order-verification">Similar events in order verification</a>.</em></p>
<a name="spy.called"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $spy-&gt;<a href="#spy.called"><strong>called</strong></a>()
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless called.</p>
<p><em>See <a href="#verifying-that-a-call-was-made">Verifying that a call was made</a>.</em></p>
<a name="spy.checkCalled"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $spy-&gt;<a href="#spy.checkCalled"><strong>checkCalled</strong></a>()</p>
</blockquote>
<p>Checks if called.</p>
<p><em>See <a href="#verifying-that-a-call-was-made">Verifying that a call was made</a>, <a href="#check-verification">Check verification</a>.</em></p>
<a name="spy.calledWith"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $spy-&gt;<a href="#spy.calledWith"><strong>calledWith</strong></a>(...$arguments)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless called with the supplied arguments.</p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a>.</em></p>
<a name="spy.checkCalledWith"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $spy-&gt;<a href="#spy.checkCalledWith"><strong>checkCalledWith</strong></a>(...$arguments)</p>
</blockquote>
<p>Checks if called with the supplied arguments.</p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a>,
<a href="#check-verification">Check verification</a>.</em></p>
<a name="spy.returned"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $spy-&gt;<a href="#spy.returned"><strong>returned</strong></a>($value = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless this spy returned the supplied value.</p>
<p><em>When called with no arguments, this method simply checks that the spy returned
any value.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-spy-return-values">Verifying spy return values</a>.</em></p>
<a name="spy.checkReturned"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $spy-&gt;<a href="#spy.checkReturned"><strong>checkReturned</strong></a>($value = null)</p>
</blockquote>
<p>Checks if this spy returned the supplied value.</p>
<p><em>When called with no arguments, this method simply checks that the spy returned
any value.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-spy-return-values">Verifying spy return values</a>, <a href="#check-verification">Check verification</a>.</em></p>
<a name="spy.threw"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $spy-&gt;<a href="#spy.threw"><strong>threw</strong></a>($type = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless this spy threw an exception of the supplied type.</p>
<p><em>When called with no arguments, this method simply checks that the spy threw any
exception.</em></p>
<p><em>When called with a string, this method checks that the spy threw an exception
that is an instance of <code>$type</code>.</em></p>
<p><em>When called with an exception instance, this method checks that the spy threw
an exception that is equal to the supplied instance.</em></p>
<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the spy threw an
exception that matches the supplied matcher.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-spy-exceptions">Verifying spy exceptions</a>.</em></p>
<a name="spy.checkThrew"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $spy-&gt;<a href="#spy.checkThrew"><strong>checkThrew</strong></a>($type = null)</p>
</blockquote>
<p>Checks if this spy threw an exception of the supplied type.</p>
<p><em>When called with no arguments, this method simply checks that the spy threw any
exception.</em></p>
<p><em>When called with a string, this method checks that the spy threw an exception
that is an instance of <code>$type</code>.</em></p>
<p><em>When called with an exception instance, this method checks that the spy threw
an exception that is equal to the supplied instance.</em></p>
<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the spy threw an
exception that matches the supplied matcher.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-spy-exceptions">Verifying spy exceptions</a>, <a href="#check-verification">Check verification</a>.</em></p>
<a name="spy.responded"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $spy-&gt;<a href="#spy.responded"><strong>responded</strong></a>()
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless this spy responded.</p>
<p><em>A spy that has "responded" has returned a value, or thrown an exception.</em></p>
<p><em>See <a href="#verifying-spy-progress">Verifying spy progress</a>.</em></p>
<a name="spy.checkResponded"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $spy-&gt;<a href="#spy.checkResponded"><strong>checkResponded</strong></a>()</p>
</blockquote>
<p>Checks if this spy responded.</p>
<p><em>A spy that has "responded" has returned a value, or thrown an exception.</em></p>
<p><em>See <a href="#verifying-spy-progress">Verifying spy progress</a>, <a href="#check-verification">Check verification</a>.</em></p>
<a name="spy.completed"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $spy-&gt;<a href="#spy.completed"><strong>completed</strong></a>()
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless this spy completed.</p>
<p><em>When <a href="#generator-and-iterable-verification">generator spies</a> are in use, a call that returns a generator will not be
considered "complete" until the generator has been completely consumed via
iteration.</em></p>
<p><em>Similarly, when <a href="#generator-and-iterable-verification">iterable spies</a> are in use, a call that returns an iterable
will not be considered "complete" until the iterable has been completely
consumed via iteration.</em></p>
<p><em>See <a href="#verifying-spy-progress">Verifying spy progress</a>.</em></p>
<a name="spy.checkCompleted"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $spy-&gt;<a href="#spy.checkCompleted"><strong>checkCompleted</strong></a>()</p>
</blockquote>
<p>Checks if this spy completed.</p>
<p><em>When <a href="#generator-and-iterable-verification">generator spies</a> are in use, a call that returns a generator will not be
considered "complete" until the generator has been completely consumed via
iteration.</em></p>
<p><em>Similarly, when <a href="#generator-and-iterable-verification">iterable spies</a> are in use, a call that returns an iterable
will not be considered "complete" until the iterable has been completely
consumed via iteration.</em></p>
<p><em>See <a href="#verifying-spy-progress">Verifying spy progress</a>, <a href="#check-verification">Check verification</a>.</em></p>
<a name="spy.generated"></a>
<hr>
<blockquote>
<p><em><a href="#the-generator-verification-result-api">generator-verification</a></em> $spy-&gt;<a href="#spy.generated"><strong>generated</strong></a>()
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless this spy returned a generator.</p>
<p><em>See <a href="#verifying-generators-returned-by-spies">Verifying generators returned by spies</a>,
<a href="#generator-and-iterable-verification">Generator and iterable verification</a>.</em></p>
<a name="spy.checkGenerated"></a>
<hr>
<blockquote>
<p><em><a href="#the-generator-verification-result-api">generator-verification</a>|null</em> $spy-&gt;<a href="#spy.checkGenerated"><strong>checkGenerated</strong></a>()</p>
</blockquote>
<p>Checks if this spy returned a generator.</p>
<p><em>See <a href="#verifying-generators-returned-by-spies">Verifying generators returned by spies</a>,
<a href="#generator-and-iterable-verification">Generator and iterable verification</a>.</em></p>
<a name="spy.iterated"></a>
<hr>
<blockquote>
<p><em><a href="#the-iterable-verification-result-api">iterable-verification</a></em> $spy-&gt;<a href="#spy.iterated"><strong>iterated</strong></a>()
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless this spy returned an iterable.</p>
<p><em>See <a href="#verifying-iterables-returned-by-spies">Verifying iterables returned by spies</a>,
<a href="#generator-and-iterable-verification">Generator and iterable verification</a>.</em></p>
<a name="spy.checkIterated"></a>
<hr>
<blockquote>
<p><em><a href="#the-iterable-verification-result-api">iterable-verification</a>|null</em> $spy-&gt;<a href="#spy.checkIterated"><strong>checkIterated</strong></a>()</p>
</blockquote>
<p>Checks if this spy returned an iterable.</p>
<p><em>See <a href="#verifying-iterables-returned-by-spies">Verifying iterables returned by spies</a>,
<a href="#generator-and-iterable-verification">Generator and iterable verification</a>.</em></p>
<a name="spy.never"></a>
<hr>
<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.never"><strong>never</strong></a>()</p>
</blockquote>
<p>Requires that the next verification never matches.</p>
<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>
<a name="spy.once"></a>
<hr>
<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.once"><strong>once</strong></a>()</p>
</blockquote>
<p>Requires that the next verification matches only once.</p>
<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>
<a name="spy.twice"></a>
<hr>
<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.twice"><strong>twice</strong></a>()</p>
</blockquote>
<p>Requires that the next verification matches exactly two times.</p>
<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>
<a name="spy.thrice"></a>
<hr>
<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.thrice"><strong>thrice</strong></a>()</p>
</blockquote>
<p>Requires that the next verification matches exactly three times.</p>
<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>
<a name="spy.times"></a>
<hr>
<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.times"><strong>times</strong></a>($times)</p>
</blockquote>
<p>Requires that the next verification matches exactly <code>$times</code> times.</p>
<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>
<a name="spy.atLeast"></a>
<hr>
<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.atLeast"><strong>atLeast</strong></a>($minimum)</p>
</blockquote>
<p>Requires that the next verification matches a number of times greater than or
equal to <code>$minimum</code>.</p>
<p><em>See <a href="#verifying-that-a-spy-event-happened-a-bounded-number-of-times">Verifying that a spy event happened a bounded number of times</a>.</em></p>
<a name="spy.atMost"></a>
<hr>
<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.atMost"><strong>atMost</strong></a>($maximum)</p>
</blockquote>
<p>Requires that the next verification matches a number of times less than or equal
to <code>$maximum</code>.</p>
<p><em>See <a href="#verifying-that-a-spy-event-happened-a-bounded-number-of-times">Verifying that a spy event happened a bounded number of times</a>.</em></p>
<a name="spy.between"></a>
<hr>
<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.between"><strong>between</strong></a>($minimum, $maximum)</p>
</blockquote>
<p>Requires that the next verification matches a number of times greater than or
equal to <code>$minimum</code>, and less than or equal to <code>$maximum</code>.</p>
<p><em>See <a href="#verifying-that-a-spy-event-happened-a-bounded-number-of-times">Verifying that a spy event happened a bounded number of times</a>.</em></p>
<a name="spy.always"></a>
<hr>
<blockquote>
<p><em>fluent</em> $spy-&gt;<a href="#spy.always"><strong>always</strong></a>()</p>
</blockquote>
<p>Requires that the next verification matches for all possible items.</p>
<p><em>See <a href="#verifying-that-all-spy-events-happen-the-same-way">Verifying that all spy events happen the same way</a>.</em></p>
<h3>
<a id="the-call-api" class="anchor" href="#the-call-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The call API</h3>
<p><a href="#calls">Calls</a> implement the following methods:</p>
<ul>
<li><a href="#call.arguments"><code>$call-&gt;arguments()</code></a></li>
<li><a href="#call.argument"><code>$call-&gt;argument()</code></a></li>
<li><a href="#call.argumentCount"><code>$call-&gt;argumentCount()</code></a></li>
<li><a href="#call.returnValue"><code>$call-&gt;returnValue()</code></a></li>
<li><a href="#call.generatorReturnValue"><code>$call-&gt;generatorReturnValue()</code></a></li>
<li><a href="#call.exception"><code>$call-&gt;exception()</code></a></li>
<li><a href="#call.generatorException"><code>$call-&gt;generatorException()</code></a></li>
<li><a href="#call.response"><code>$call-&gt;response()</code></a></li>
<li><a href="#call.generatorResponse"><code>$call-&gt;generatorResponse()</code></a></li>
<li><a href="#call.hasResponded"><code>$call-&gt;hasResponded()</code></a></li>
<li><a href="#call.isIterable"><code>$call-&gt;isIterable()</code></a></li>
<li><a href="#call.isGenerator"><code>$call-&gt;isGenerator()</code></a></li>
<li><a href="#call.hasCompleted"><code>$call-&gt;hasCompleted()</code></a></li>
<li><a href="#call.time"><code>$call-&gt;time()</code></a></li>
<li><a href="#call.responseTime"><code>$call-&gt;responseTime()</code></a></li>
<li><a href="#call.endTime"><code>$call-&gt;endTime()</code></a></li>
<li><a href="#call.responseDuration"><code>$call-&gt;responseDuration()</code></a></li>
<li><a href="#call.duration"><code>$call-&gt;duration()</code></a></li>
<li><a href="#call.index"><code>$call-&gt;index()</code></a></li>
<li><a href="#call.sequenceNumber"><code>$call-&gt;sequenceNumber()</code></a></li>
<li><a href="#call.calledWith"><code>$call-&gt;calledWith()</code></a></li>
<li><a href="#call.checkCalledWith"><code>$call-&gt;checkCalledWith()</code></a></li>
<li><a href="#call.returned"><code>$call-&gt;returned()</code></a></li>
<li><a href="#call.checkReturned"><code>$call-&gt;checkReturned()</code></a></li>
<li><a href="#call.threw"><code>$call-&gt;threw()</code></a></li>
<li><a href="#call.checkThrew"><code>$call-&gt;checkThrew()</code></a></li>
<li><a href="#call.responded"><code>$call-&gt;responded()</code></a></li>
<li><a href="#call.checkResponded"><code>$call-&gt;checkResponded()</code></a></li>
<li><a href="#call.completed"><code>$call-&gt;completed()</code></a></li>
<li><a href="#call.checkCompleted"><code>$call-&gt;checkCompleted()</code></a></li>
<li><a href="#call.generated"><code>$call-&gt;generated()</code></a></li>
<li><a href="#call.checkGenerated"><code>$call-&gt;checkGenerated()</code></a></li>
<li><a href="#call.iterated"><code>$call-&gt;iterated()</code></a></li>
<li><a href="#call.checkIterated"><code>$call-&gt;checkIterated()</code></a></li>
<li><a href="#call.never"><code>$call-&gt;never()</code></a></li>
<li><a href="#call.once"><code>$call-&gt;once()</code></a></li>
<li><a href="#call.twice"><code>$call-&gt;twice()</code></a></li>
<li><a href="#call.thrice"><code>$call-&gt;thrice()</code></a></li>
<li><a href="#call.times"><code>$call-&gt;times()</code></a></li>
<li><a href="#call.atLeast"><code>$call-&gt;atLeast()</code></a></li>
<li><a href="#call.atMost"><code>$call-&gt;atMost()</code></a></li>
<li><a href="#call.between"><code>$call-&gt;between()</code></a></li>
<li><a href="#call.always"><code>$call-&gt;always()</code></a></li>
</ul>
<p>See also:</p>
<ul>
<li><a href="#spy.allCalls"><code>$spy-&gt;allCalls()</code></a></li>
<li><a href="#spy.firstCall"><code>$spy-&gt;firstCall()</code></a></li>
<li><a href="#spy.lastCall"><code>$spy-&gt;lastCall()</code></a></li>
<li><a href="#spy.callAt"><code>$spy-&gt;callAt()</code></a></li>
<li><a href="#verification.allCalls"><code>$verification-&gt;allCalls()</code></a></li>
<li><a href="#verification.firstCall"><code>$verification-&gt;firstCall()</code></a></li>
<li><a href="#verification.lastCall"><code>$verification-&gt;lastCall()</code></a></li>
<li><a href="#verification.callAt"><code>$verification-&gt;callAt()</code></a></li>
</ul>
<a name="call.arguments"></a>
<hr>
<blockquote>
<p><em><a href="#the-arguments-api">arguments</a></em> $call-&gt;<a href="#call.arguments"><strong>arguments</strong></a>()</p>
</blockquote>
<p>Get the arguments.</p>
<p><em>See <a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a>,
<a href="#verifying-that-a-call-was-made-with-specific-arguments">Verifying that a call was made with specific arguments</a>.</em></p>
<a name="call.argument"></a>
<hr>
<blockquote>
<p><em>mixed</em> $call-&gt;<a href="#call.argument"><strong>argument</strong></a>($index = 0)
throws <a href="#undefinedargumentexception">UndefinedArgumentException</a></p>
</blockquote>
<p>Get an argument by index.</p>
<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>
<p><em>See <a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a>,
<a href="#verifying-that-a-call-was-made-with-specific-arguments">Verifying that a call was made with specific arguments</a>.</em></p>
<a name="call.argumentCount"></a>
<hr>
<blockquote>
<p><em>int</em> $call-&gt;<a href="#call.argumentCount"><strong>argumentCount</strong></a>()</p>
</blockquote>
<p>Get the number of arguments.</p>
<p><em>See <a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a>,
<a href="#verifying-that-a-call-was-made-with-specific-arguments">Verifying that a call was made with specific arguments</a>.</em></p>
<a name="call.returnValue"></a>
<hr>
<blockquote>
<p><em>mixed</em> $call-&gt;<a href="#call.returnValue"><strong>returnValue</strong></a>()
throws <a href="#undefinedresponseexception">UndefinedResponseException</a></p>
</blockquote>
<p>Get the return value.</p>
<p><em>An <a href="#undefinedresponseexception">UndefinedResponseException</a> will be thrown if the call has not yet
responded, or threw an exception.</em></p>
<p><em>See <a href="#verifying-spy-return-values">Verifying spy return values</a>, <a href="#verifying-call-return-values">Verifying call return values</a>.</em></p>
<a name="call.generatorReturnValue"></a>
<hr>
<blockquote>
<p><em>mixed</em> $call-&gt;<a href="#call.generatorReturnValue"><strong>generatorReturnValue</strong></a>()
throws <a href="#undefinedresponseexception">UndefinedResponseException</a></p>
</blockquote>
<p>Get the generator return value.</p>
<p><em>An <a href="#undefinedresponseexception">UndefinedResponseException</a> will be thrown if the call has not yet
responded, did not respond by returning a generator, has not completed
iteration, or if the generator ended by throwing an exception.</em></p>
<p><em>See <a href="#verifying-generator-return-values">Verifying generator return values</a>.</em></p>
<a name="call.exception"></a>
<hr>
<blockquote>
<p><em><a href="http://php.net/class.throwable">Throwable</a></em> $call-&gt;<a href="#call.exception"><strong>exception</strong></a>()
throws <a href="#undefinedresponseexception">UndefinedResponseException</a></p>
</blockquote>
<p>Get the thrown exception.</p>
<p><em>An <a href="#undefinedresponseexception">UndefinedResponseException</a> will be thrown if the call has not yet
responded, or did not throw an exception.</em></p>
<p><em>See <a href="#verifying-spy-exceptions">Verifying spy exceptions</a>, <a href="#verifying-call-exceptions">Verifying call exceptions</a>.</em></p>
<a name="call.generatorException"></a>
<hr>
<blockquote>
<p><em><a href="http://php.net/class.throwable">Throwable</a></em> $call-&gt;<a href="#call.generatorException"><strong>generatorException</strong></a>()
throws <a href="#undefinedresponseexception">UndefinedResponseException</a></p>
</blockquote>
<p>Get the exception thrown by the generator.</p>
<p><em>An <a href="#undefinedresponseexception">UndefinedResponseException</a> will be thrown if the call has not yet
responded, did not respond by returning a generator, has not completed
iteration, or if the generator ended by returning a value.</em></p>
<p><em>See <a href="#verifying-generator-exceptions">Verifying generator exceptions</a>.</em></p>
<a name="call.response"></a>
<hr>
<blockquote>
<p><em>tuple&lt;<a href="http://php.net/class.throwable">Throwable</a>|null,mixed&gt;</em> $call-&gt;<a href="#call.response"><strong>response</strong></a>()
throws <a href="#undefinedresponseexception">UndefinedResponseException</a></p>
</blockquote>
<p>Get the response.</p>
<p><em>This method returns a 2-tuple. The first element is the thrown exception, or
<code>null</code> if no exception was thrown. The second element is the returned value,
or <code>null</code> if an exception was thrown.</em></p>
<p><em>An <a href="#undefinedresponseexception">UndefinedResponseException</a> will be thrown if the call has not yet
responded.</em></p>
<p><em>See <a href="#verifying-spy-progress">Verifying spy progress</a>, <a href="#verifying-call-progress">Verifying call progress</a>.</em></p>
<a name="call.generatorResponse"></a>
<hr>
<blockquote>
<p><em>tuple&lt;<a href="http://php.net/class.throwable">Throwable</a>|null,mixed&gt;</em> $call-&gt;<a href="#call.generatorResponse"><strong>generatorResponse</strong></a>()
throws <a href="#undefinedresponseexception">UndefinedResponseException</a></p>
</blockquote>
<p>Get the generator response.</p>
<p><em>This method returns a 2-tuple. The first element is the thrown exception, or
<code>null</code> if no exception was thrown. The second element is the returned value,
or <code>null</code> if an exception was thrown.</em></p>
<p><em>An <a href="#undefinedresponseexception">UndefinedResponseException</a> will be thrown if the call has not yet
responded, did not respond by returning a generator, or if the generator has not
completed iteration.</em></p>
<p><em>See <a href="#verifying-spy-progress">Verifying spy progress</a>, <a href="#verifying-call-progress">Verifying call progress</a>.</em></p>
<a name="call.hasResponded"></a>
<hr>
<blockquote>
<p><em>bool</em> $call-&gt;<a href="#call.hasResponded"><strong>hasResponded</strong></a>()</p>
</blockquote>
<p>Returns true if this call has responded.</p>
<p><em>A call that has "responded" has returned a value, or thrown an exception.</em></p>
<p><em>See <a href="#verifying-spy-progress">Verifying spy progress</a>, <a href="#verifying-call-progress">Verifying call progress</a>.</em></p>
<a name="call.isIterable"></a>
<hr>
<blockquote>
<p><em>bool</em> $call-&gt;<a href="#call.isIterable"><strong>isIterable</strong></a>()</p>
</blockquote>
<p>Returns true if this call has responded with an iterable.</p>
<p><em>A call that has "responded" has returned a value, or thrown an exception.</em></p>
<p><em>See <a href="#verifying-spy-progress">Verifying spy progress</a>, <a href="#verifying-call-progress">Verifying call progress</a>.</em></p>
<a name="call.isGenerator"></a>
<hr>
<blockquote>
<p><em>bool</em> $call-&gt;<a href="#call.isGenerator"><strong>isGenerator</strong></a>()</p>
</blockquote>
<p>Returns true if this call has responded with a generator.</p>
<p><em>A call that has "responded" has returned a value, or thrown an exception.</em></p>
<p><em>See <a href="#verifying-spy-progress">Verifying spy progress</a>, <a href="#verifying-call-progress">Verifying call progress</a>.</em></p>
<a name="call.hasCompleted"></a>
<hr>
<blockquote>
<p><em>bool</em> $call-&gt;<a href="#call.hasCompleted"><strong>hasCompleted</strong></a>()</p>
</blockquote>
<p>Returns true if this call has completed.</p>
<p><em>When <a href="#generator-and-iterable-verification">generator spies</a> are in use, a call that returns a generator will not be
considered "complete" until the generator has been completely consumed via
iteration.</em></p>
<p><em>Similarly, when <a href="#generator-and-iterable-verification">iterable spies</a> are in use, a call that returns an iterable
will not be considered "complete" until the iterable has been completely
consumed via iteration.</em></p>
<p><em>See <a href="#verifying-spy-progress">Verifying spy progress</a>, <a href="#verifying-call-progress">Verifying call progress</a>.</em></p>
<a name="call.time"></a>
<hr>
<blockquote>
<p><em>float</em> $call-&gt;<a href="#call.time"><strong>time</strong></a>()</p>
</blockquote>
<p>Get the time at which the call occurred, in seconds since the Unix epoch.</p>
<p><em>See <a href="#verifying-spy-progress">Verifying spy progress</a>, <a href="#verifying-call-progress">Verifying call progress</a>.</em></p>
<a name="call.responseTime"></a>
<hr>
<blockquote>
<p><em>float|null</em> $call-&gt;<a href="#call.responseTime"><strong>responseTime</strong></a>()</p>
</blockquote>
<p>Get the time at which the call responded, in seconds since the Unix epoch.</p>
<p><em>If the call has not yet responded, <code>null</code> will be returned.</em></p>
<p><em>A call that has "responded" has returned a value, or thrown an exception.</em></p>
<p><em>See <a href="#verifying-spy-progress">Verifying spy progress</a>, <a href="#verifying-call-progress">Verifying call progress</a>.</em></p>
<a name="call.endTime"></a>
<hr>
<blockquote>
<p><em>float|null</em> $call-&gt;<a href="#call.endTime"><strong>endTime</strong></a>()</p>
</blockquote>
<p>Get the time at which the call completed, in seconds since the Unix epoch.</p>
<p><em>If the call has not yet completed, <code>null</code> will be returned.</em></p>
<p><em>When <a href="#generator-and-iterable-verification">generator spies</a> are in use, a call that returns a generator will not be
considered "complete" until the generator has been completely consumed via
iteration.</em></p>
<p><em>Similarly, when <a href="#generator-and-iterable-verification">iterable spies</a> are in use, a call that returns an iterable
will not be considered "complete" until the iterable has been completely
consumed via iteration.</em></p>
<p><em>See <a href="#verifying-spy-progress">Verifying spy progress</a>, <a href="#verifying-call-progress">Verifying call progress</a>.</em></p>
<a name="call.responseDuration"></a>
<hr>
<blockquote>
<p><em>float|null</em> $call-&gt;<a href="#call.responseDuration"><strong>responseDuration</strong></a>()</p>
</blockquote>
<p>Get the call response duration, in seconds.</p>
<p><em>If the call has not yet responded, <code>null</code> will be returned.</em></p>
<p><em>A call that has "responded" has returned a value, or thrown an exception.</em></p>
<p><em>See <a href="#verifying-spy-progress">Verifying spy progress</a>, <a href="#verifying-call-progress">Verifying call progress</a>.</em></p>
<a name="call.duration"></a>
<hr>
<blockquote>
<p><em>float|null</em> $call-&gt;<a href="#call.duration"><strong>duration</strong></a>()</p>
</blockquote>
<p>Get the call response duration, in seconds.</p>
<p><em>If the call has not yet completed, <code>null</code> will be returned.</em></p>
<p><em>When <a href="#generator-and-iterable-verification">generator spies</a> are in use, a call that returns a generator will not be
considered "complete" until the generator has been completely consumed via
iteration.</em></p>
<p><em>Similarly, when <a href="#generator-and-iterable-verification">iterable spies</a> are in use, a call that returns an iterable
will not be considered "complete" until the iterable has been completely
consumed via iteration.</em></p>
<p><em>See <a href="#verifying-spy-progress">Verifying spy progress</a>, <a href="#verifying-call-progress">Verifying call progress</a>.</em></p>
<a name="call.index"></a>
<hr>
<blockquote>
<p><em>int</em> $call-&gt;<a href="#call.index"><strong>index</strong></a>()</p>
</blockquote>
<p>Get the call index.</p>
<p><em>This number tracks the order of this call with respect to other calls made
against the same spy.</em></p>
<a name="call.sequenceNumber"></a>
<hr>
<blockquote>
<p><em>int</em> $call-&gt;<a href="#call.sequenceNumber"><strong>sequenceNumber</strong></a>()</p>
</blockquote>
<p>Get the sequence number.</p>
<p><em>The sequence number is a unique number assigned to every event that Phony
records. The numbers are assigned sequentially, meaning that sequence numbers
can be used to determine event order.</em></p>
<a name="call.calledWith"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $call-&gt;<a href="#call.calledWith"><strong>calledWith</strong></a>(...$arguments)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless called with the supplied arguments.</p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-that-a-call-was-made-with-specific-arguments">Verifying that a call was made with specific arguments</a>.</em></p>
<a name="call.checkCalledWith"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $call-&gt;<a href="#call.checkCalledWith"><strong>checkCalledWith</strong></a>(...$arguments)</p>
</blockquote>
<p>Checks if called with the supplied arguments.</p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-that-a-call-was-made-with-specific-arguments">Verifying that a call was made with specific arguments</a>,
<a href="#check-verification">Check verification</a>.</em></p>
<a name="call.returned"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $call-&gt;<a href="#call.returned"><strong>returned</strong></a>($value = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless this call returned the supplied value.</p>
<p><em>When called with no arguments, this method simply checks that the call returned
any value.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-call-return-values">Verifying call return values</a>.</em></p>
<a name="call.checkReturned"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $call-&gt;<a href="#call.checkReturned"><strong>checkReturned</strong></a>($value = null)</p>
</blockquote>
<p>Checks if this call returned the supplied value.</p>
<p><em>When called with no arguments, this method simply checks that the call returned
any value.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-call-return-values">Verifying call return values</a>, <a href="#check-verification">Check verification</a>.</em></p>
<a name="call.threw"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $call-&gt;<a href="#call.threw"><strong>threw</strong></a>($type = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless this call threw an exception of the supplied type.</p>
<p><em>When called with no arguments, this method simply checks that the call threw
any exception.</em></p>
<p><em>When called with a string, this method checks that the call threw an exception
that is an instance of <code>$type</code>.</em></p>
<p><em>When called with an exception instance, this method checks that the call threw
an exception that is equal to the supplied instance.</em></p>
<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the call threw an
exception that matches the supplied matcher.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-call-exceptions">Verifying call exceptions</a>.</em></p>
<a name="call.checkThrew"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $call-&gt;<a href="#call.checkThrew"><strong>checkThrew</strong></a>($type = null)</p>
</blockquote>
<p>Checks if this call threw an exception of the supplied type.</p>
<p><em>When called with no arguments, this method simply checks that the call threw
any exception.</em></p>
<p><em>When called with a string, this method checks that the call threw an exception
that is an instance of <code>$type</code>.</em></p>
<p><em>When called with an exception instance, this method checks that the call threw
an exception that is equal to the supplied instance.</em></p>
<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the call threw an
exception that matches the supplied matcher.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-call-exceptions">Verifying call exceptions</a>, <a href="#check-verification">Check verification</a>.</em></p>
<a name="call.responded"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $call-&gt;<a href="#call.responded"><strong>responded</strong></a>()
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless this call responded.</p>
<p><em>A call that has "responded" has returned a value, or thrown an exception.</em></p>
<p><em>See <a href="#verifying-call-progress">Verifying call progress</a>.</em></p>
<a name="call.checkResponded"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $call-&gt;<a href="#call.checkResponded"><strong>checkResponded</strong></a>()</p>
</blockquote>
<p>Checks if this call responded.</p>
<p><em>A call that has "responded" has returned a value, or thrown an exception.</em></p>
<p><em>See <a href="#verifying-call-progress">Verifying call progress</a>, <a href="#check-verification">Check verification</a>.</em></p>
<a name="call.completed"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $call-&gt;<a href="#call.completed"><strong>completed</strong></a>()
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless this call completed.</p>
<p><em>When <a href="#generator-and-iterable-verification">generator spies</a> are in use, a call that returns a generator will not be
considered "complete" until the generator has been completely consumed via
iteration.</em></p>
<p><em>Similarly, when <a href="#generator-and-iterable-verification">iterable spies</a> are in use, a call that returns an iterable
will not be considered "complete" until the iterable has been completely
consumed via iteration.</em></p>
<p><em>See <a href="#verifying-call-progress">Verifying call progress</a>.</em></p>
<a name="call.checkCompleted"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $call-&gt;<a href="#call.checkCompleted"><strong>checkCompleted</strong></a>()</p>
</blockquote>
<p>Checks if this call completed.</p>
<p><em>When <a href="#generator-and-iterable-verification">generator spies</a> are in use, a call that returns a generator will not be
considered "complete" until the generator has been completely consumed via
iteration.</em></p>
<p><em>Similarly, when <a href="#generator-and-iterable-verification">iterable spies</a> are in use, a call that returns an iterable
will not be considered "complete" until the iterable has been completely
consumed via iteration.</em></p>
<p><em>See <a href="#verifying-call-progress">Verifying call progress</a>, <a href="#check-verification">Check verification</a>.</em></p>
<a name="call.generated"></a>
<hr>
<blockquote>
<p><em><a href="#the-generator-verification-result-api">generator-verification</a></em> $call-&gt;<a href="#call.generated"><strong>generated</strong></a>()
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless this call returned a generator.</p>
<p><em>See <a href="#verifying-generators-returned-by-calls">Verifying generators returned by calls</a>,
<a href="#generator-and-iterable-verification">Generator and iterable verification</a>.</em></p>
<a name="call.checkGenerated"></a>
<hr>
<blockquote>
<p><em><a href="#the-generator-verification-result-api">generator-verification</a>|null</em> $call-&gt;<a href="#call.checkGenerated"><strong>checkGenerated</strong></a>()</p>
</blockquote>
<p>Checks if this call returned a generator.</p>
<p><em>See <a href="#verifying-generators-returned-by-calls">Verifying generators returned by calls</a>,
<a href="#generator-and-iterable-verification">Generator and iterable verification</a>.</em></p>
<a name="call.iterated"></a>
<hr>
<blockquote>
<p><em><a href="#the-iterable-verification-result-api">iterable-verification</a></em> $call-&gt;<a href="#call.iterated"><strong>iterated</strong></a>()
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless this call returned an iterable.</p>
<p><em>See <a href="#verifying-iterables-returned-by-calls">Verifying iterables returned by calls</a>,
<a href="#generator-and-iterable-verification">Generator and iterable verification</a>.</em></p>
<a name="call.checkIterated"></a>
<hr>
<blockquote>
<p><em><a href="#the-iterable-verification-result-api">iterable-verification</a>|null</em> $call-&gt;<a href="#call.checkIterated"><strong>checkIterated</strong></a>()</p>
</blockquote>
<p>Checks if this call returned an iterable.</p>
<p><em>See <a href="#verifying-iterables-returned-by-calls">Verifying iterables returned by calls</a>,
<a href="#generator-and-iterable-verification">Generator and iterable verification</a>.</em></p>
<a name="call.never"></a>
<hr>
<blockquote>
<p><em>fluent</em> $call-&gt;<a href="#call.never"><strong>never</strong></a>()</p>
</blockquote>
<p>Requires that the next verification never matches.</p>
<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>
<a name="call.once"></a>
<hr>
<blockquote>
<p><em>fluent</em> $call-&gt;<a href="#call.once"><strong>once</strong></a>()</p>
</blockquote>
<p>Requires that the next verification matches only once.</p>
<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>
<a name="call.twice"></a>
<hr>
<blockquote>
<p><em>fluent</em> $call-&gt;<a href="#call.twice"><strong>twice</strong></a>()</p>
</blockquote>
<p>Requires that the next verification matches exactly two times.</p>
<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>
<a name="call.thrice"></a>
<hr>
<blockquote>
<p><em>fluent</em> $call-&gt;<a href="#call.thrice"><strong>thrice</strong></a>()</p>
</blockquote>
<p>Requires that the next verification matches exactly three times.</p>
<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>
<a name="call.times"></a>
<ul>
<li><a href="#verification.received"><code>$verification-&gt;received()</code></a></li>
<li><a href="#verification.checkReceived"><code>$verification-&gt;checkReceived()</code></a></li>
<li><a href="#verification.receivedException"><code>$verification-&gt;receivedException()</code></a></li>
<li><a href="#verification.checkReceivedException"><code>$verification-&gt;checkReceivedException()</code></a></li>
<li><a href="#verification.returned"><code>$verification-&gt;returned()</code></a></li>
<li><a href="#verification.checkReturned"><code>$verification-&gt;checkReturned()</code></a></li>
<li><a href="#verification.threw"><code>$verification-&gt;threw()</code></a></li>
<li><a href="#verification.checkThrew"><code>$verification-&gt;checkThrew()</code></a></li>
</ul>
<hr>
<blockquote>
<p><em>fluent</em> $call-&gt;<a href="#call.times"><strong>times</strong></a>($times)</p>
</blockquote>
<p>Requires that the next verification matches exactly <code>$times</code> times.</p>
<p><em>See <a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>
<a name="call.atLeast"></a>
<hr>
<blockquote>
<p><em>fluent</em> $call-&gt;<a href="#call.atLeast"><strong>atLeast</strong></a>($minimum)</p>
</blockquote>
<p>Requires that the next verification matches a number of times greater than or
equal to <code>$minimum</code>.</p>
<p><em>See <a href="#verifying-that-a-call-event-happened-a-bounded-number-of-times">Verifying that a call event happened a bounded number of times</a>.</em></p>
<a name="call.atMost"></a>
<hr>
<blockquote>
<p><em>fluent</em> $call-&gt;<a href="#call.atMost"><strong>atMost</strong></a>($maximum)</p>
</blockquote>
<p>Requires that the next verification matches a number of times less than or equal
to <code>$maximum</code>.</p>
<p><em>See <a href="#verifying-that-a-call-event-happened-a-bounded-number-of-times">Verifying that a call event happened a bounded number of times</a>.</em></p>
<a name="call.between"></a>
<hr>
<blockquote>
<p><em>fluent</em> $call-&gt;<a href="#call.between"><strong>between</strong></a>($minimum, $maximum)</p>
</blockquote>
<p>Requires that the next verification matches a number of times greater than or
equal to <code>$minimum</code>, and less than or equal to <code>$maximum</code>.</p>
<p><em>See <a href="#verifying-that-a-call-event-happened-a-bounded-number-of-times">Verifying that a call event happened a bounded number of times</a>.</em></p>
<a name="call.always"></a>
<hr>
<blockquote>
<p><em>fluent</em> $call-&gt;<a href="#call.always"><strong>always</strong></a>()</p>
</blockquote>
<p>Requires that the next verification matches for all possible items.</p>
<p><em>See <a href="#verifying-that-all-call-events-happen-the-same-way">Verifying that all call events happen the same way</a>.</em></p>
<h3>
<a id="the-arguments-api" class="anchor" href="#the-arguments-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The arguments API</h3>
<p>When <a href="#verifying-that-a-spy-was-called-with-specific-arguments">verifying that a spy was called with specific arguments</a>, or
<a href="#verifying-that-a-call-was-made-with-specific-arguments">verifying that a call was made with specific arguments</a>, calls to
<a href="#call.arguments"><code>arguments()</code></a> produce objects which implement the following
methods:</p>
<ul>
<li><a href="#arguments.all"><code>$arguments-&gt;all()</code></a></li>
<li><a href="#arguments.count"><code>count($arguments)</code></a></li>
<li><a href="#arguments.count"><code>$arguments-&gt;count()</code></a></li>
<li><a href="#arguments.implements.Traversable"><code>foreach ($arguments as $index =&gt; $argument)</code></a></li>
<li><a href="#arguments.has"><code>$arguments-&gt;has()</code></a></li>
<li><a href="#arguments.get"><code>$arguments-&gt;get()</code></a></li>
<li><a href="#arguments.set"><code>$arguments-&gt;set()</code></a></li>
<li><a href="#arguments.copy"><code>$arguments-&gt;copy()</code></a></li>
</ul>
<p>See also:</p>
<ul>
<li><a href="#call.arguments"><code>$call-&gt;arguments()</code></a></li>
<li><a href="#stub.callsWith"><code>$stub-&gt;callsWith()</code></a></li>
<li><a href="#stub.callsArgumentWith"><code>$stub-&gt;callsArgumentWith()</code></a></li>
<li><a href="#stub.doesWith"><code>$stub-&gt;doesWith()</code></a></li>
<li><a href="#stub.forwards"><code>$stub-&gt;forwards()</code></a></li>
<li><a href="#generatorAnswer.callsWith"><code>$generatorAnswer-&gt;callsWith()</code></a></li>
<li><a href="#generatorAnswer.callsArgumentWith"><code>$generatorAnswer-&gt;callsArgumentWith()</code></a></li>
</ul>
<a name="arguments.all"></a>
<hr>
<blockquote>
<p><em>array&lt;mixed&gt;</em> $arguments-&gt;<a href="#arguments.all"><strong>all</strong></a>()</p>
</blockquote>
<p>Get the arguments as an array.</p>
<p><em>Arguments passed by reference will be references in the returned array.</em></p>
<p><em>See <a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a>,
<a href="#verifying-that-a-call-was-made-with-specific-arguments">Verifying that a call was made with specific arguments</a>.</em></p>
<a name="arguments.count"></a>
<hr>
<blockquote>
<p><a href="#arguments.count"><strong>count($arguments)</strong></a> or
<em>int</em> $arguments-&gt;<a href="#arguments.count"><strong>count</strong></a>()</p>
</blockquote>
<p>Returns the total number of arguments.</p>
<p><em>See <a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a>,
<a href="#verifying-that-a-call-was-made-with-specific-arguments">Verifying that a call was made with specific arguments</a>.</em></p>
<a name="arguments.implements.Traversable"></a>
<hr>
<blockquote>
<p><a href="#arguments.implements.Traversable"><strong>foreach ($arguments as $index =&gt; $argument)</strong></a> { /* ... */ }</p>
</blockquote>
<p>Arguments implement the <a href="http://php.net/traversable">Traversable</a> interface, allowing them to be used in a
<code>foreach</code> statement.</p>
<p><em>See <a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a>,
<a href="#verifying-that-a-call-was-made-with-specific-arguments">Verifying that a call was made with specific arguments</a>.</em></p>
<a name="arguments.has"></a>
<hr>
<blockquote>
<p><em>bool</em> $arguments-&gt;<a href="#arguments.has"><strong>has</strong></a>($index = 0)</p>
</blockquote>
<p>Returns <code>true</code> if an argument exists at <code>$index</code>.</p>
<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>
<p><em>See <a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a>,
<a href="#verifying-that-a-call-was-made-with-specific-arguments">Verifying that a call was made with specific arguments</a>.</em></p>
<a name="arguments.get"></a>
<hr>
<blockquote>
<p><em>mixed</em> $arguments-&gt;<a href="#arguments.get"><strong>get</strong></a>($index = 0)
throws <a href="#undefinedargumentexception">UndefinedArgumentException</a></p>
</blockquote>
<p>Get the argument at <code>$index</code>.</p>
<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>
<p><em>See <a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a>,
<a href="#verifying-that-a-call-was-made-with-specific-arguments">Verifying that a call was made with specific arguments</a>.</em></p>
<a name="arguments.set"></a>
<hr>
<blockquote>
<p><em>fluent</em> $arguments-&gt;<a href="#arguments.set"><strong>set</strong></a>($indexOrValue = null, $value = null)
throws <a href="#undefinedargumentexception">UndefinedArgumentException</a></p>
</blockquote>
<p>Set an argument by index.</p>
<p><em>If called with no arguments, sets the first argument to <code>null</code>.</em></p>
<p><em>If called with one argument, sets the first argument to <code>$indexOrValue</code>.</em></p>
<p><em>If called with two arguments, sets the argument at <code>$indexOrValue</code> to
<code>$value</code>.</em></p>
<p><em>See <a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a>,
<a href="#verifying-that-a-call-was-made-with-specific-arguments">Verifying that a call was made with specific arguments</a>.</em></p>
<a name="arguments.copy"></a>
<hr>
<blockquote>
<p><em><a href="#the-arguments-api">arguments</a></em> $arguments-&gt;<a href="#arguments.copy"><strong>copy</strong></a>()</p>
</blockquote>
<p>Copy these arguments, breaking any references.</p>
<p><em>See <a href="#verifying-that-a-spy-was-called-with-specific-arguments">Verifying that a spy was called with specific arguments</a>,
<a href="#verifying-that-a-call-was-made-with-specific-arguments">Verifying that a call was made with specific arguments</a>.</em></p>
<h3>
<a id="the-verification-result-api" class="anchor" href="#the-verification-result-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The verification result API</h3>
<p>All forms of <a href="#verification">verification</a> produce "verification results" that implement the
following methods:</p>
<ul>
<li><a href="#verification.hasCalls"><code>$verification-&gt;hasCalls()</code></a></li>
<li><a href="#verification.callCount"><code>$verification-&gt;callCount()</code></a></li>
<li><a href="#verification.allCalls"><code>$verification-&gt;allCalls()</code></a></li>
<li><a href="#verification.firstCall"><code>$verification-&gt;firstCall()</code></a></li>
<li><a href="#verification.lastCall"><code>$verification-&gt;lastCall()</code></a></li>
<li><a href="#verification.callAt"><code>$verification-&gt;callAt()</code></a></li>
<li><a href="#verification.hasEvents"><code>$verification-&gt;hasEvents()</code></a></li>
<li><a href="#verification.eventCount"><code>$verification-&gt;eventCount()</code></a></li>
<li><a href="#verification.allEvents"><code>$verification-&gt;allEvents()</code></a></li>
<li><a href="#verification.firstEvent"><code>$verification-&gt;firstEvent()</code></a></li>
<li><a href="#verification.lastEvent"><code>$verification-&gt;lastEvent()</code></a></li>
<li><a href="#verification.eventAt"><code>$verification-&gt;eventAt()</code></a></li>
</ul>
<p>See also:</p>
<ul>
<li><a href="#spy.called"><code>$spy-&gt;called()</code></a></li>
<li><a href="#spy.checkCalled"><code>$spy-&gt;checkCalled()</code></a></li>
<li><a href="#spy.calledWith"><code>$spy-&gt;calledWith()</code></a></li>
<li><a href="#spy.checkCalledWith"><code>$spy-&gt;checkCalledWith()</code></a></li>
<li><a href="#spy.returned"><code>$spy-&gt;returned()</code></a></li>
<li><a href="#spy.checkReturned"><code>$spy-&gt;checkReturned()</code></a></li>
<li><a href="#spy.threw"><code>$spy-&gt;threw()</code></a></li>
<li><a href="#spy.checkThrew"><code>$spy-&gt;checkThrew()</code></a></li>
<li><a href="#spy.responded"><code>$spy-&gt;responded()</code></a></li>
<li><a href="#spy.checkResponded"><code>$spy-&gt;checkResponded()</code></a></li>
<li><a href="#spy.completed"><code>$spy-&gt;completed()</code></a></li>
<li><a href="#spy.checkCompleted"><code>$spy-&gt;checkCompleted()</code></a></li>
<li><a href="#spy.generated"><code>$spy-&gt;generated()</code></a></li>
<li><a href="#spy.checkGenerated"><code>$spy-&gt;checkGenerated()</code></a></li>
<li><a href="#spy.iterated"><code>$spy-&gt;iterated()</code></a></li>
<li><a href="#spy.checkIterated"><code>$spy-&gt;checkIterated()</code></a></li>
<li><a href="#call.calledWith"><code>$call-&gt;calledWith()</code></a></li>
<li><a href="#call.checkCalledWith"><code>$call-&gt;checkCalledWith()</code></a></li>
<li><a href="#call.returned"><code>$call-&gt;returned()</code></a></li>
<li><a href="#call.checkReturned"><code>$call-&gt;checkReturned()</code></a></li>
<li><a href="#call.threw"><code>$call-&gt;threw()</code></a></li>
<li><a href="#call.checkThrew"><code>$call-&gt;checkThrew()</code></a></li>
<li><a href="#call.responded"><code>$call-&gt;responded()</code></a></li>
<li><a href="#call.checkResponded"><code>$call-&gt;checkResponded()</code></a></li>
<li><a href="#call.completed"><code>$call-&gt;completed()</code></a></li>
<li><a href="#call.checkCompleted"><code>$call-&gt;checkCompleted()</code></a></li>
<li><a href="#call.generated"><code>$call-&gt;generated()</code></a></li>
<li><a href="#call.checkGenerated"><code>$call-&gt;checkGenerated()</code></a></li>
<li><a href="#call.iterated"><code>$call-&gt;iterated()</code></a></li>
<li><a href="#call.checkIterated"><code>$call-&gt;checkIterated()</code></a></li>
<li><a href="#verification.used"><code>$verification-&gt;used()</code></a></li>
<li><a href="#verification.checkUsed"><code>$verification-&gt;checkUsed()</code></a></li>
<li><a href="#verification.produced"><code>$verification-&gt;produced()</code></a></li>
<li><a href="#verification.checkProduced"><code>$verification-&gt;checkProduced()</code></a></li>
<li><a href="#verification.consumed"><code>$verification-&gt;consumed()</code></a></li>
<li><a href="#verification.checkConsumed"><code>$verification-&gt;checkConsumed()</code></a></li>
<li><a href="#verification.received"><code>$verification-&gt;received()</code></a></li>
<li><a href="#verification.checkReceived"><code>$verification-&gt;checkReceived()</code></a></li>
<li><a href="#verification.receivedException"><code>$verification-&gt;receivedException()</code></a></li>
<li><a href="#verification.checkReceivedException"><code>$verification-&gt;checkReceivedException()</code></a></li>
<li><a href="#verification.returned"><code>$verification-&gt;returned()</code></a></li>
<li><a href="#verification.checkReturned"><code>$verification-&gt;checkReturned()</code></a></li>
<li><a href="#verification.threw"><code>$verification-&gt;threw()</code></a></li>
<li><a href="#verification.checkThrew"><code>$verification-&gt;checkThrew()</code></a></li>
<li><a href="#handle.noInteraction"><code>$handle-&gt;noInteraction()</code></a></li>
<li><a href="#handle.checkNoInteraction"><code>$handle-&gt;checkNoInteraction()</code></a></li>
<li><a href="#facade.inOrder"><code>inOrder()</code></a></li>
<li><a href="#facade.checkInOrder"><code>checkInOrder()</code></a></li>
<li><a href="#facade.anyOrder"><code>anyOrder()</code></a></li>
<li><a href="#facade.checkAnyOrder"><code>checkAnyOrder()</code></a></li>
</ul>
<a name="verification.hasCalls"></a>
<hr>
<blockquote>
<p><em>bool</em> $verification-&gt;<a href="#verification.hasCalls"><strong>hasCalls</strong></a>()</p>
</blockquote>
<p>Returns <code>true</code> if this verification matched any calls.</p>
<p><em>See <a href="#call-verification">Call verification</a>.</em></p>
<a name="verification.callCount"></a>
<hr>
<blockquote>
<p><em>int</em> $verification-&gt;<a href="#verification.callCount"><strong>callCount</strong></a>()</p>
</blockquote>
<p>Get the number of calls.</p>
<p><em>See <a href="#call-count">Call count</a>.</em></p>
<a name="verification.allCalls"></a>
<hr>
<blockquote>
<p><em>array&lt;<a href="#the-call-api">call</a>&gt;</em> $verification-&gt;<a href="#verification.allCalls"><strong>allCalls</strong></a>()</p>
</blockquote>
<p>Get all calls as an array.</p>
<p><em>See <a href="#call-verification">Call verification</a>.</em></p>
<a name="verification.firstCall"></a>
<hr>
<blockquote>
<p><em><a href="#the-call-api">call</a></em> $verification-&gt;<a href="#verification.firstCall"><strong>firstCall</strong></a>()
throws <a href="#undefinedcallexception">UndefinedCallException</a></p>
</blockquote>
<p>Get the first call.</p>
<p><em>See <a href="#individual-calls">Individual calls</a>.</em></p>
<a name="verification.lastCall"></a>
<hr>
<blockquote>
<p><em><a href="#the-call-api">call</a></em> $verification-&gt;<a href="#verification.lastCall"><strong>lastCall</strong></a>()
throws <a href="#undefinedcallexception">UndefinedCallException</a></p>
</blockquote>
<p>Get the last call.</p>
<p><em>See <a href="#individual-calls">Individual calls</a>.</em></p>
<a name="verification.callAt"></a>
<hr>
<blockquote>
<p><em><a href="#the-call-api">call</a></em> $verification-&gt;<a href="#verification.callAt"><strong>callAt</strong></a>($index = 0)
throws <a href="#undefinedcallexception">UndefinedCallException</a></p>
</blockquote>
<p>Get the call at <code>$index</code>.</p>
<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>
<p><em>See <a href="#individual-calls">Individual calls</a>.</em></p>
<a name="verification.hasEvents"></a>
<hr>
<blockquote>
<p><em>bool</em> $verification-&gt;<a href="#verification.hasEvents"><strong>hasEvents</strong></a>()</p>
</blockquote>
<p>Returns <code>true</code> if this verification matched any events.</p>
<p><em>See <a href="#similar-events-in-order-verification">Similar events in order verification</a>.</em></p>
<a name="verification.eventCount"></a>
<hr>
<blockquote>
<p><em>int</em> $verification-&gt;<a href="#verification.eventCount"><strong>eventCount</strong></a>()</p>
</blockquote>
<p>Get the number of events.</p>
<p><em>See <a href="#similar-events-in-order-verification">Similar events in order verification</a>.</em></p>
<a name="verification.allEvents"></a>
<hr>
<blockquote>
<p><em>array&lt;<a href="#the-event-api">event</a>&gt;</em> $verification-&gt;<a href="#verification.allEvents"><strong>allEvents</strong></a>()</p>
</blockquote>
<p>Get all events as an array.</p>
<p><em>See <a href="#similar-events-in-order-verification">Similar events in order verification</a>.</em></p>
<a name="verification.firstEvent"></a>
<hr>
<blockquote>
<p><em><a href="#the-event-api">event</a></em> $verification-&gt;<a href="#verification.firstEvent"><strong>firstEvent</strong></a>()
throws <a href="#undefinedeventexception">UndefinedEventException</a></p>
</blockquote>
<p>Get the first event.</p>
<p><em>See <a href="#similar-events-in-order-verification">Similar events in order verification</a>.</em></p>
<a name="verification.lastEvent"></a>
<hr>
<blockquote>
<p><em><a href="#the-event-api">event</a></em> $verification-&gt;<a href="#verification.lastEvent"><strong>lastEvent</strong></a>()
throws <a href="#undefinedeventexception">UndefinedEventException</a></p>
</blockquote>
<p>Get the last event.</p>
<p><em>See <a href="#similar-events-in-order-verification">Similar events in order verification</a>.</em></p>
<a name="verification.eventAt"></a>
<hr>
<blockquote>
<p><em><a href="#the-event-api">event</a></em> $verification-&gt;<a href="#verification.eventAt"><strong>eventAt</strong></a>($index = 0)
throws <a href="#undefinedeventexception">UndefinedEventException</a></p>
</blockquote>
<p>Get the event at <code>$index</code>.</p>
<p><em>Negative indices are offset from the end of the list. That is, <code>-1</code> indicates
the last element, and <code>-2</code> indicates the second last element.</em></p>
<p><em>See <a href="#similar-events-in-order-verification">Similar events in order verification</a>.</em></p>
<h3>
<a id="the-iterable-verification-result-api" class="anchor" href="#the-iterable-verification-result-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The iterable verification result API</h3>
<p>In addition to <a href="#the-verification-result-api">the verification result API</a>, iterable verification results
implement the following methods:</p>
<ul>
<li><a href="#verification.used"><code>$verification-&gt;used()</code></a></li>
<li><a href="#verification.checkUsed"><code>$verification-&gt;checkUsed()</code></a></li>
<li><a href="#verification.produced"><code>$verification-&gt;produced()</code></a></li>
<li><a href="#verification.checkProduced"><code>$verification-&gt;checkProduced()</code></a></li>
<li><a href="#verification.consumed"><code>$verification-&gt;consumed()</code></a></li>
<li><a href="#verification.checkConsumed"><code>$verification-&gt;checkConsumed()</code></a></li>
<li><a href="#verification.never"><code>$verification-&gt;never()</code></a></li>
<li><a href="#verification.once"><code>$verification-&gt;once()</code></a></li>
<li><a href="#verification.twice"><code>$verification-&gt;twice()</code></a></li>
<li><a href="#verification.thrice"><code>$verification-&gt;thrice()</code></a></li>
<li><a href="#verification.times"><code>$verification-&gt;times()</code></a></li>
<li><a href="#verification.atLeast"><code>$verification-&gt;atLeast()</code></a></li>
<li><a href="#verification.atMost"><code>$verification-&gt;atMost()</code></a></li>
<li><a href="#verification.between"><code>$verification-&gt;between()</code></a></li>
<li><a href="#verification.always"><code>$verification-&gt;always()</code></a></li>
</ul>
<p>See also:</p>
<ul>
<li><a href="#spy.iterated"><code>$spy-&gt;iterated()</code></a></li>
<li><a href="#spy.checkIterated"><code>$spy-&gt;checkIterated()</code></a></li>
<li><a href="#call.iterated"><code>$call-&gt;iterated()</code></a></li>
<li><a href="#call.checkIterated"><code>$call-&gt;checkIterated()</code></a></li>
</ul>
<a name="verification.used"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $verification-&gt;<a href="#verification.used"><strong>used</strong></a>()
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless iteration of the iterable commenced.</p>
<p><em>See <a href="#verifying-iteration">Verifying iteration</a>.</em></p>
<a name="verification.checkUsed"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $verification-&gt;<a href="#verification.checkUsed"><strong>checkUsed</strong></a>()</p>
</blockquote>
<p>Checks if iteration of the iterable commenced.</p>
<p><em>See <a href="#verifying-iteration">Verifying iteration</a>, <a href="#check-verification">Check verification</a>.</em></p>
<a name="verification.produced"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $verification-&gt;<a href="#verification.produced"><strong>produced</strong></a>($keyOrValue = null, $value = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless the iterable produced the supplied values.</p>
<p><em>When called with no arguments, this method simply checks that the iterable
produced any value.</em></p>
<p><em>With a single argument, it checks that a value matching the argument was
produced.</em></p>
<p><em>With two arguments, it checks that a key and value matching the respective
arguments were produced together.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-produced-values">Verifying produced values</a>.</em></p>
<a name="verification.checkProduced"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $verification-&gt;<a href="#verification.checkProduced"><strong>checkProduced</strong></a>($keyOrValue = null, $value = null)</p>
</blockquote>
<p>Checks if the iterable produced the supplied values.</p>
<p><em>When called with no arguments, this method simply checks that the iterable
produced any value.</em></p>
<p><em>With a single argument, it checks that a value matching the argument was
produced.</em></p>
<p><em>With two arguments, it checks that a key and value matching the respective
arguments were produced together.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-produced-values">Verifying produced values</a>, <a href="#check-verification">Check verification</a>.</em></p>
<a name="verification.consumed"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $verification-&gt;<a href="#verification.consumed"><strong>consumed</strong></a>()
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless iteration of the iterable completed.</p>
<p><em>See <a href="#verifying-iteration">Verifying iteration</a>.</em></p>
<a name="verification.checkConsumed"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $verification-&gt;<a href="#verification.checkConsumed"><strong>checkConsumed</strong></a>()</p>
</blockquote>
<p>Checks if iteration of the iterable completed.</p>
<p><em>See <a href="#verifying-iteration">Verifying iteration</a>, <a href="#check-verification">Check verification</a>.</em></p>
<a name="verification.never"></a>
<hr>
<blockquote>
<p><em>fluent</em> $verification-&gt;<a href="#verification.never"><strong>never</strong></a>()</p>
</blockquote>
<p>Requires that the next verification never matches.</p>
<p><em>See <a href="#verifying-cardinality-with-generators-and-iterables">Verifying cardinality with generators and iterables</a>,
<a href="#verifying-that-a-spy-event-happened-an-exact-number-of-times">Verifying that a spy event happened an exact number of times</a>,
<a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>
<a name="verification.once"></a>
<hr>
<blockquote>
<p><em>fluent</em> $verification-&gt;<a href="#verification.once"><strong>once</strong></a>()</p>
</blockquote>
<p>Requires that the next verification matches only once.</p>
<p><em>See <a href="#verifying-cardinality-with-generators-and-iterables">Verifying cardinality with generators and iterables</a>,
<a href="#verifying-that-a-spy-event-happened-an-exact-number-of-times">Verifying that a spy event happened an exact number of times</a>,
<a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>
<a name="verification.twice"></a>
<hr>
<blockquote>
<p><em>fluent</em> $verification-&gt;<a href="#verification.twice"><strong>twice</strong></a>()</p>
</blockquote>
<p>Requires that the next verification matches exactly two times.</p>
<p><em>See <a href="#verifying-cardinality-with-generators-and-iterables">Verifying cardinality with generators and iterables</a>,
<a href="#verifying-that-a-spy-event-happened-an-exact-number-of-times">Verifying that a spy event happened an exact number of times</a>,
<a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>
<a name="verification.thrice"></a>
<hr>
<blockquote>
<p><em>fluent</em> $verification-&gt;<a href="#verification.thrice"><strong>thrice</strong></a>()</p>
</blockquote>
<p>Requires that the next verification matches exactly three times.</p>
<p><em>See <a href="#verifying-cardinality-with-generators-and-iterables">Verifying cardinality with generators and iterables</a>,
<a href="#verifying-that-a-spy-event-happened-an-exact-number-of-times">Verifying that a spy event happened an exact number of times</a>,
<a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>
<a name="verification.times"></a>
<hr>
<blockquote>
<p><em>fluent</em> $verification-&gt;<a href="#verification.times"><strong>times</strong></a>($times)</p>
</blockquote>
<p>Requires that the next verification matches exactly <code>$times</code> times.</p>
<p><em>See <a href="#verifying-cardinality-with-generators-and-iterables">Verifying cardinality with generators and iterables</a>,
<a href="#verifying-that-a-spy-event-happened-an-exact-number-of-times">Verifying that a spy event happened an exact number of times</a>,
<a href="#verifying-that-a-call-event-happened-an-exact-number-of-times">Verifying that a call event happened an exact number of times</a>.</em></p>
<a name="verification.atLeast"></a>
<hr>
<blockquote>
<p><em>fluent</em> $verification-&gt;<a href="#verification.atLeast"><strong>atLeast</strong></a>($minimum)</p>
</blockquote>
<p>Requires that the next verification matches a number of times greater than or
equal to <code>$minimum</code>.</p>
<p><em>See <a href="#verifying-cardinality-with-generators-and-iterables">Verifying cardinality with generators and iterables</a>,
<a href="#verifying-that-a-spy-event-happened-a-bounded-number-of-times">Verifying that a spy event happened a bounded number of times</a>,
<a href="#verifying-that-a-call-event-happened-a-bounded-number-of-times">Verifying that a call event happened a bounded number of times</a>.</em></p>
<a name="verification.atMost"></a>
<hr>
<blockquote>
<p><em>fluent</em> $verification-&gt;<a href="#verification.atMost"><strong>atMost</strong></a>($maximum)</p>
</blockquote>
<p>Requires that the next verification matches a number of times less than or equal
to <code>$maximum</code>.</p>
<p><em>See <a href="#verifying-cardinality-with-generators-and-iterables">Verifying cardinality with generators and iterables</a>,
<a href="#verifying-that-a-spy-event-happened-a-bounded-number-of-times">Verifying that a spy event happened a bounded number of times</a>,
<a href="#verifying-that-a-call-event-happened-a-bounded-number-of-times">Verifying that a call event happened a bounded number of times</a>.</em></p>
<a name="verification.between"></a>
<hr>
<blockquote>
<p><em>fluent</em> $verification-&gt;<a href="#verification.between"><strong>between</strong></a>($minimum, $maximum)</p>
</blockquote>
<p>Requires that the next verification matches a number of times greater than or
equal to <code>$minimum</code>, and less than or equal to <code>$maximum</code>.</p>
<p><em>See <a href="#verifying-cardinality-with-generators-and-iterables">Verifying cardinality with generators and iterables</a>,
<a href="#verifying-that-a-spy-event-happened-a-bounded-number-of-times">Verifying that a spy event happened a bounded number of times</a>,
<a href="#verifying-that-a-call-event-happened-a-bounded-number-of-times">Verifying that a call event happened a bounded number of times</a>.</em></p>
<a name="verification.always"></a>
<hr>
<blockquote>
<p><em>fluent</em> $verification-&gt;<a href="#verification.always"><strong>always</strong></a>()</p>
</blockquote>
<p>Requires that the next verification matches for all possible items.</p>
<p><em>See <a href="#verifying-cardinality-with-generators-and-iterables">Verifying cardinality with generators and iterables</a>,
<a href="#verifying-that-all-spy-events-happen-the-same-way">Verifying that all spy events happen the same way</a>,
<a href="#verifying-that-all-call-events-happen-the-same-way">Verifying that all call events happen the same way</a>.</em></p>
<h3>
<a id="the-generator-verification-result-api" class="anchor" href="#the-generator-verification-result-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The generator verification result API</h3>
<p>In addition to <a href="#the-verification-result-api">the verification result API</a> and
<a href="#the-iterable-verification-result-api">the iterable verification result API</a>, generator verification results implement
the following methods:</p>
<ul>
<li><a href="#verification.received"><code>$verification-&gt;received()</code></a></li>
<li><a href="#verification.checkReceived"><code>$verification-&gt;checkReceived()</code></a></li>
<li><a href="#verification.receivedException"><code>$verification-&gt;receivedException()</code></a></li>
<li><a href="#verification.checkReceivedException"><code>$verification-&gt;checkReceivedException()</code></a></li>
<li><a href="#verification.returned"><code>$verification-&gt;returned()</code></a></li>
<li><a href="#verification.checkReturned"><code>$verification-&gt;checkReturned()</code></a></li>
<li><a href="#verification.threw"><code>$verification-&gt;threw()</code></a></li>
<li><a href="#verification.checkThrew"><code>$verification-&gt;checkThrew()</code></a></li>
</ul>
<p>See also:</p>
<ul>
<li><a href="#spy.generated"><code>$spy-&gt;generated()</code></a></li>
<li><a href="#spy.checkGenerated"><code>$spy-&gt;checkGenerated()</code></a></li>
<li><a href="#call.generated"><code>$call-&gt;generated()</code></a></li>
<li><a href="#call.checkGenerated"><code>$call-&gt;checkGenerated()</code></a></li>
</ul>
<a name="verification.received"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $verification-&gt;<a href="#verification.received"><strong>received</strong></a>($value = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless the generator received the supplied value.</p>
<p><em>When called with no arguments, this method simply checks that the generator
received any value.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-values-received-by-generators">Verifying values received by generators</a>.</em></p>
<a name="verification.checkReceived"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $verification-&gt;<a href="#verification.checkReceived"><strong>checkReceived</strong></a>($value = null)</p>
</blockquote>
<p>Checks if the generator received the supplied value.</p>
<p><em>When called with no arguments, this method simply checks that the generator
received any value.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-values-received-by-generators">Verifying values received by generators</a>, <a href="#check-verification">Check verification</a>.</em></p>
<a name="verification.receivedException"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $verification-&gt;<a href="#verification.receivedException"><strong>receivedException</strong></a>($type = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless the generator received an exception of the supplied
type.</p>
<p><em>When called with no arguments, this method simply checks that the generator
received any exception.</em></p>
<p><em>When called with a string, this method checks that the generator received an
exception that is an instance of <code>$type</code>.</em></p>
<p><em>When called with an exception instance, this method checks that the generator
received an exception that is equal to the supplied instance.</em></p>
<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the generator received an
exception that matches the supplied matcher.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-exceptions-received-by-generators">Verifying exceptions received by generators</a>.</em></p>
<a name="verification.checkReceivedException"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $verification-&gt;<a href="#verification.checkReceivedException"><strong>checkReceivedException</strong></a>($type = null)</p>
</blockquote>
<p>Checks if the generator received an exception of the supplied type.</p>
<p><em>When called with no arguments, this method simply checks that the generator
received any exception.</em></p>
<p><em>When called with a string, this method checks that the generator received an
exception that is an instance of <code>$type</code>.</em></p>
<p><em>When called with an exception instance, this method checks that the generator
received an exception that is equal to the supplied instance.</em></p>
<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the generator received an
exception that matches the supplied matcher.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-exceptions-received-by-generators">Verifying exceptions received by generators</a>, <a href="#check-verification">Check verification</a>.</em></p>
<a name="verification.returned"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $verification-&gt;<a href="#verification.returned"><strong>returned</strong></a>($value = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless the generator returned the supplied value.</p>
<p><em>When called with no arguments, this method simply checks that the generator
returned any value.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-generator-return-values">Verifying generator return values</a>.</em></p>
<a name="verification.checkReturned"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $verification-&gt;<a href="#verification.checkReturned"><strong>checkReturned</strong></a>($value = null)</p>
</blockquote>
<p>Checks if the generator returned the supplied value.</p>
<p><em>When called with no arguments, this method simply checks that the generator
returned any value.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-generator-return-values">Verifying generator return values</a>, <a href="#check-verification">Check verification</a>.</em></p>
<a name="verification.threw"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a></em> $verification-&gt;<a href="#verification.threw"><strong>threw</strong></a>($type = null)
throws <a href="#assertionexception">AssertionException</a></p>
</blockquote>
<p>Throws an exception unless this generator threw an exception of the supplied
type.</p>
<p><em>When called with no arguments, this method simply checks that the generator
threw any exception.</em></p>
<p><em>When called with a string, this method checks that the generator threw an
exception that is an instance of <code>$type</code>.</em></p>
<p><em>When called with an exception instance, this method checks that the generator
threw an exception that is equal to the supplied instance.</em></p>
<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the generator threw an
exception that matches the supplied matcher.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-generator-exceptions">Verifying generator exceptions</a>.</em></p>
<a name="verification.checkThrew"></a>
<hr>
<blockquote>
<p><em><a href="#the-verification-result-api">verification</a>|null</em> $verification-&gt;<a href="#verification.checkThrew"><strong>checkThrew</strong></a>($type = null)</p>
</blockquote>
<p>Checks if this generator threw an exception of the supplied type.</p>
<p><em>When called with no arguments, this method simply checks that the generator
threw any exception.</em></p>
<p><em>When called with a string, this method checks that the generator threw an
exception that is an instance of <code>$type</code>.</em></p>
<p><em>When called with an exception instance, this method checks that the generator
threw an exception that is equal to the supplied instance.</em></p>
<p><em>When called with a <a href="#matchers">matcher</a>, this method checks that the generator threw an
exception that matches the supplied matcher.</em></p>
<p><em>This method supports <a href="#mock-handle-substitution">mock handle substitution</a> and
<a href="#iterable-spy-substitution">iterable spy substitution</a>.</em></p>
<p><em>See <a href="#verifying-generator-exceptions">Verifying generator exceptions</a>, <a href="#check-verification">Check verification</a>.</em></p>
<h3>
<a id="the-event-api" class="anchor" href="#the-event-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The event API</h3>
<p>When events are exposed from an API, they implement the following methods:</p>
<ul>
<li><a href="#event.time"><code>$event-&gt;time()</code></a></li>
<li><a href="#event.sequenceNumber"><code>$event-&gt;sequenceNumber()</code></a></li>
</ul>
<p>See also:</p>
<ul>
<li><a href="#spy.allEvents"><code>$spy-&gt;allEvents()</code></a></li>
<li><a href="#spy.firstEvent"><code>$spy-&gt;firstEvent()</code></a></li>
<li><a href="#spy.lastEvent"><code>$spy-&gt;lastEvent()</code></a></li>
<li><a href="#spy.eventAt"><code>$spy-&gt;eventAt()</code></a></li>
<li><a href="#verification.allEvents"><code>$verification-&gt;allEvents()</code></a></li>
<li><a href="#verification.firstEvent"><code>$verification-&gt;firstEvent()</code></a></li>
<li><a href="#verification.lastEvent"><code>$verification-&gt;lastEvent()</code></a></li>
<li><a href="#verification.eventAt"><code>$verification-&gt;eventAt()</code></a></li>
</ul>
<a name="event.time"></a>
<hr>
<blockquote>
<p><em>float</em> $event-&gt;<a href="#event.time"><strong>time</strong></a>()</p>
</blockquote>
<p>Get the time at which the event occurred, in seconds since the Unix epoch.</p>
<a name="event.sequenceNumber"></a>
<hr>
<blockquote>
<p><em>int</em> $event-&gt;<a href="#event.sequenceNumber"><strong>sequenceNumber</strong></a>()</p>
</blockquote>
<p>Get the sequence number.</p>
<p><em>The sequence number is a unique number assigned to every event that Phony
records. The numbers are assigned sequentially, meaning that sequence numbers
can be used to determine event order.</em></p>
<h3>
<a id="the-matcher-api" class="anchor" href="#the-matcher-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The matcher API</h3>
<p><a href="#matchers">Matchers</a> implement the following methods:</p>
<ul>
<li><a href="#matcher.matches"><code>$matcher-&gt;matches()</code></a></li>
<li><a href="#matcher.__toString"><code>"$matcher"</code></a></li>
<li><a href="#matcher.describe"><code>$matcher-&gt;describe()</code></a></li>
</ul>
<p>See also:</p>
<ul>
<li><a href="#facade.any"><code>any()</code></a></li>
<li><a href="#facade.equalTo"><code>equalTo()</code></a></li>
<li><a href="#facade.anInstanceOf"><code>anInstanceOf()</code></a></li>
<li><a href="#wildcard.matcher"><code>$wildcard-&gt;matcher()</code></a></li>
</ul>
<a name="matcher.matches"></a>
<hr>
<blockquote>
<p><em>bool</em> $matcher-&gt;<a href="#matcher.matches"><strong>matches</strong></a>($value)</p>
</blockquote>
<p>Returns <code>true</code> if <code>$value</code> matches this matcher's criteria.</p>
<p><em>See <a href="#matchers">Matchers</a>.</em></p>
<a name="matcher.__toString"></a>
<a name="matcher.describe"></a>
<hr>
<blockquote>
<p><a href="#matcher.__toString"><strong>"$matcher"</strong></a> or
<em>string</em> $matcher-&gt;<a href="#matcher.describe"><strong>describe</strong></a>()</p>
</blockquote>
<p>Describe this matcher.</p>
<p><em>See <a href="#matchers">Matchers</a>.</em></p>
<h3>
<a id="the-wildcard-matcher-api" class="anchor" href="#the-wildcard-matcher-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The wildcard matcher API</h3>
<p>The <a href="#the-wildcard-matcher">"wildcard" matcher</a> implements the following methods:</p>
<ul>
<li><a href="#wildcard.matcher"><code>$wildcard-&gt;matcher()</code></a></li>
<li><a href="#wildcard.minimumArguments"><code>$wildcard-&gt;minimumArguments()</code></a></li>
<li><a href="#wildcard.maximumArguments"><code>$wildcard-&gt;maximumArguments()</code></a></li>
<li><a href="#wildcard.__toString"><code>"$wildcard"</code></a></li>
<li><a href="#wildcard.describe"><code>$wildcard-&gt;describe()</code></a></li>
</ul>
<p>See also:</p>
<ul>
<li><a href="#facade.wildcard"><code>wildcard()</code></a></li>
</ul>
<a name="wildcard.matcher"></a>
<hr>
<blockquote>
<p><em><a href="#the-matcher-api">matcher</a></em> $wildcard-&gt;<a href="#wildcard.matcher"><strong>matcher</strong></a>()</p>
</blockquote>
<p>Get the matcher to use for each argument.</p>
<p><em>See <a href="#the-wildcard-matcher">The "wildcard" matcher</a>.</em></p>
<a name="wildcard.minimumArguments"></a>
<hr>
<blockquote>
<p><em>int</em> $wildcard-&gt;<a href="#wildcard.minimumArguments"><strong>minimumArguments</strong></a>()</p>
</blockquote>
<p>Get the minimum number of arguments to match.</p>
<p><em>See <a href="#the-wildcard-matcher">The "wildcard" matcher</a>.</em></p>
<a name="wildcard.maximumArguments"></a>
<hr>
<blockquote>
<p><em>int</em> $wildcard-&gt;<a href="#wildcard.maximumArguments"><strong>maximumArguments</strong></a>()</p>
</blockquote>
<p>Get the maximum number of arguments to match.</p>
<p><em>Negative values are used to represent "no maximum".</em></p>
<p><em>See <a href="#the-wildcard-matcher">The "wildcard" matcher</a>.</em></p>
<a name="wildcard.__toString"></a>
<a name="wildcard.describe"></a>
<hr>
<blockquote>
<p><a href="#wildcard.__toString"><strong>"$wildcard"</strong></a> or
<em>string</em> $wildcard-&gt;<a href="#wildcard.describe"><strong>describe</strong></a>()</p>
</blockquote>
<p>Describe this matcher.</p>
<p><em>See <a href="#the-wildcard-matcher">The "wildcard" matcher</a>.</em></p>
<h3>
<a id="thrown-exceptions" class="anchor" href="#thrown-exceptions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Thrown exceptions</h3>
<h4>
<a id="assertionexception" class="anchor" href="#assertionexception" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AssertionException</h4>
<p>Thrown when a verification fails. The exact exception class and implementation
depends on the <a href="#integration-with-test-frameworks">testing framework</a> in use. See <a href="#standard-verification">Standard verification</a>.</p>
<p>Other than the standard PHP <a href="http://php.net/class.exception">Exception</a> methods, assertion exceptions have no
public API methods.</p>
<h4>
<a id="undefinedargumentexception" class="anchor" href="#undefinedargumentexception" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>UndefinedArgumentException</h4>
<p>Thrown when an argument that was requested does not exist.</p>
<p>Namespace: <code>Eloquent\Phony\Call\Exception</code></p>
<a name="undefinedargumentexception.index"></a>
<hr>
<blockquote>
<p><em>int</em> $exception-&gt;<a href="#undefinedargumentexception.index"><strong>index</strong></a>()</p>
</blockquote>
<p>Get the index.</p>
<h4>
<a id="undefinedcallexception" class="anchor" href="#undefinedcallexception" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>UndefinedCallException</h4>
<p>Thrown when a call that was requested does not exist.</p>
<p>Namespace: <code>Eloquent\Phony\Call\Exception</code></p>
<a name="undefinedcallexception.index"></a>
<hr>
<blockquote>
<p><em>int</em> $exception-&gt;<a href="#undefinedcallexception.index"><strong>index</strong></a>()</p>
</blockquote>
<p>Get the index.</p>
<h4>
<a id="undefinedeventexception" class="anchor" href="#undefinedeventexception" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>UndefinedEventException</h4>
<p>Thrown when an event that was requested does not exist.</p>
<p>Namespace: <code>Eloquent\Phony\Event\Exception</code></p>
<a name="undefinedeventexception.index"></a>
<hr>
<blockquote>
<p><em>int</em> $exception-&gt;<a href="#undefinedeventexception.index"><strong>index</strong></a>()</p>
</blockquote>
<p>Get the index.</p>
<h4>
<a id="undefinedresponseexception" class="anchor" href="#undefinedresponseexception" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>UndefinedResponseException</h4>
<p>Thrown when the call has not yet produced a response of the requested type.</p>
<p>This can occur when an individual call is queried for its response details
before the call has returned a value, or thrown an exception.</p>
<p>Other than the standard PHP <a href="http://php.net/class.exception">Exception</a> methods, undefined response exceptions
have no public API methods.</p>
<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>
<p>For the full copyright and license information, please view the <a href="https://github.com/eloquent/phony/blob/HEAD/LICENSE">LICENSE file</a>.</p>

<!-- END content -->

</div>

</div>

<script src="//cdnjs.cloudflare.com/ajax/libs/gumshoe/3.1.2/js/gumshoe.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/svg-injector/1.1.3/svg-injector.min.js"></script>
<script src="../js/phony.js"></script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-41826908-1', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>
